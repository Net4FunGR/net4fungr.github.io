<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><title>Kube My Router Up! - Part Two</title><meta name=author content=" ">
<meta name=description content="This is the second part of a three-part blog post around google’s Kubernetes based Network Emulation (KNE) software. In this part, I am showing how to deploy a k8s cluster with a single control node using kubeadm over the VMs created during the first part."><meta name=keywords content='k8s,kubeadm,Ubuntu'><meta itemprop=name content="Kube my router up! - Part Two"><meta itemprop=description content="This is the second part of a three-part blog post around google’s Kubernetes based Network Emulation (KNE) software. In this part, I am showing how to deploy a k8s cluster with a single control node using kubeadm over the VMs created during the first part."><meta itemprop=datePublished content="2022-05-31T12:40:24+03:00"><meta itemprop=dateModified content="2022-05-31T12:40:24+03:00"><meta itemprop=wordCount content="3571"><meta itemprop=image content="https://net4fungr.github.io/posts/kube-my-router-pt2/featured-image.png"><meta itemprop=keywords content="K8s,Kubeadm,Ubuntu"><meta property="og:url" content="https://net4fungr.github.io/posts/kube-my-router-pt2/"><meta property="og:site_name" content="Becos :: Back Blog"><meta property="og:title" content="Kube my router up! - Part Two"><meta property="og:description" content="This is the second part of a three-part blog post around google’s Kubernetes based Network Emulation (KNE) software. In this part, I am showing how to deploy a k8s cluster with a single control node using kubeadm over the VMs created during the first part."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-05-31T12:40:24+03:00"><meta property="article:modified_time" content="2022-05-31T12:40:24+03:00"><meta property="article:tag" content="K8s"><meta property="article:tag" content="Kubeadm"><meta property="article:tag" content="Ubuntu"><meta property="og:image" content="https://net4fungr.github.io/posts/kube-my-router-pt2/featured-image.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://net4fungr.github.io/posts/kube-my-router-pt2/featured-image.png"><meta name=twitter:title content="Kube my router up! - Part Two"><meta name=twitter:description content="This is the second part of a three-part blog post around google’s Kubernetes based Network Emulation (KNE) software. In this part, I am showing how to deploy a k8s cluster with a single control node using kubeadm over the VMs created during the first part."><meta name=twitter:site content="@mkaliotis"><meta name=twitter:creator content="@mkaliotis"><meta name=application-name content="Becos :: Back Blog"><meta name=apple-mobile-web-app-title content="Becos :: Back Blog"><meta name=theme-color data-light=#f8f8f8 data-dark=#252627 content="#f8f8f8"><meta name=msapplication-TileColor content="#da532c"><link rel=canonical type=text/html href=https://net4fungr.github.io/posts/kube-my-router-pt2/ title="Kube my router up! - Part Two - Becos :: Back Blog"><link rel=prev type=text/html href=https://net4fungr.github.io/posts/kube-my-router-pt1/ title="Kube my router up! - Part One"><link rel=next type=text/html href=https://net4fungr.github.io/posts/kube-my-router-pt3/ title="Kube my router up! - Last Part"><link rel=alternate type=text/markdown href=https://net4fungr.github.io/posts/kube-my-router-pt2/index.md title="Kube my router up! - Part Two - Becos :: Back Blog"><link rel=stylesheet href=/css/style.min.css><link rel=preload href=/lib/fontawesome-free/all.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/fontawesome-free/all.min.css></noscript><link rel=preload href=/lib/animate/animate.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/animate/animate.min.css></noscript><meta name=google-site-verification content="m_enMQYWx1a1cSKPfRT_00wHfqT8ir4PZSBPyeaIH-o"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Kube my router up! - Part Two","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/net4fungr.github.io\/posts\/kube-my-router-pt2\/"},"image":[{"@type":"ImageObject","url":"https:\/\/net4fungr.github.io\/posts\/kube-my-router-pt2\/featured-image.png","width":854,"height":330}],"genre":"posts","keywords":"k8s, kubeadm, Ubuntu","wordcount":3571,"url":"https:\/\/net4fungr.github.io\/posts\/kube-my-router-pt2\/","datePublished":"2022-05-31T12:40:24+03:00","dateModified":"2022-05-31T12:40:24+03:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":" "},"description":""}</script><script src=/js/head/color-scheme.min.js></script></head><body data-header-desktop=sticky data-header-mobile=auto><div class=wrapper data-page-style=narrow><header class="desktop animate__faster" id=header-desktop><div class=header-wrapper data-github-corner=right><div class=header-title><a href=/ title="Becos :: Back Blog"><img class=logo src=/images/pyrtr_small.png alt="Becos :: Back Blog" height=32 width=32><span class=header-title-pre><</span><span class=header-title-text>...ssh and blog...</span><span class=header-title-post>/></span></a><span class="typeit header-subtitle"><template>revamped!</template></span></div><nav><ul class=menu><li class=menu-item><a class=menu-link href=/categories/ title="Posts Organised by Category"><i class="fa-solid fa-folder-tree fa-fw fa-sm" aria-hidden=true></i> Categories</a></li><li class=menu-item><a class=menu-link href=/collections/ title="Multipart Posts"><i class="fa-solid fa-layer-group fa-fw fa-sm" aria-hidden=true></i> Collections</a></li><li class=menu-item><a class=menu-link href=/archives/ title="All My Posts"><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> Archives</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> Tags</a></li><li class=menu-item><a class=menu-link href=https://becos76.github.io title="About Me" rel="noopener noreferrer" target=_blank><i class="fa-solid fa-signature fa-fw fa-sm" aria-hidden=true></i> About</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id=search-desktop><input type=text placeholder="Search titles or contents ..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></li><li class="menu-item theme-switch" title="Switch Theme"><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></li></ul></nav></div></header><header class="mobile animate__faster" id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Becos :: Back Blog"><img class=logo src=/images/pyrtr_small.png alt="Becos :: Back Blog" height=26 width=26><span class=header-title-pre><</span><span class=header-title-text>...ssh and blog...</span><span class=header-title-post>/></span></a><span class="typeit header-subtitle"><template>revamped!</template></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents ..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></li><li class=menu-item><a class=menu-link href=/categories/ title="Posts Organised by Category"><i class="fa-solid fa-folder-tree fa-fw fa-sm" aria-hidden=true></i> Categories</a></li><li class=menu-item><a class=menu-link href=/collections/ title="Multipart Posts"><i class="fa-solid fa-layer-group fa-fw fa-sm" aria-hidden=true></i> Collections</a></li><li class=menu-item><a class=menu-link href=/archives/ title="All My Posts"><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> Archives</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> Tags</a></li><li class=menu-item><a class=menu-link href=https://becos76.github.io title="About Me" rel="noopener noreferrer" target=_blank><i class="fa-solid fa-signature fa-fw fa-sm" aria-hidden=true></i> About</a></li><li class="menu-item menu-system"><span class="menu-system-item theme-switch" title="Switch Theme"><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></span></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=container><aside class="aside-collection animate__animated animate__fadeIn animate__faster" aria-label=Collections><div class="details collection-details open"><div class="details-summary collection-summary"><i class="fa-solid fa-layer-group fa-fw" aria-hidden=true></i>
<span class=collection-name title=Collections>Kube My Router Up!</span>
<span class=collection-count>3</span><i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class="details-content collection-content"><nav><ul class=collection-list><li class=collection-item><a href=/posts/kube-my-router-pt1/ title="Kube My Router Up! - Part One">Kube My Router Up! - Part One</a></li><li class=collection-item><span class=active title="Kube My Router Up! - Part Two">Kube My Router Up! - Part Two</span></li><li class=collection-item><a href=/posts/kube-my-router-pt3/ title="Kube My Router Up! - Last Part">Kube My Router Up! - Last Part</a></li></ul><div class=collection-nav-simple><a href=/posts/kube-my-router-pt1/ class=collection-nav-item rel=prev title="Kube My Router Up! - Part One"><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i></a><span class=text-secondary>2/3</span><a href=/posts/kube-my-router-pt3/ class=collection-nav-item rel=next title="Kube My Router Up! - Last Part"><i class="fa-solid fa-angle-right fa-fw" aria-hidden=true></i></a></div></nav></div></div><div class="details related-details open"><div class="details-summary related-summary"><i class="fa-solid fa-fire fa-fade text-danger fa-fw" aria-hidden=true></i>
<span class=related-title>Related Content</span><i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class="details-content related-content"><ul class=related-list><li class=related-item><a href=/posts/kube-my-router-pt1/ title="Kube My Router Up! - Part One">Kube My Router Up! - Part One</a></li></ul></div></div></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span>Kube My Router Up! - Part Two</span></h1><p class="single-subtitle animate__animated animate__fadeIn">Setup a 3 node k8s cluster with kubeadm</p></div><div class=post-meta><div class=post-meta-line><span class=post-author><span class=author><i class="fa-solid fa-user-circle" aria-hidden=true></i>
</span></span><span class=post-included-in>&nbsp;included in <a href=/categories/art-of-labbing/ class=post-category title="Category - Art of Labbing"><i class="fa-regular fa-folder fa-fw" aria-hidden=true></i> Art of Labbing</a> and <a href=/collections/kube-my-router-up/ class=post-collection title="Collection - Kube My Router Up!"><i class="fa-solid fa-layer-group fa-fw" aria-hidden=true></i> Kube My Router Up!</a></span></div><div class=post-meta-line><span title="published on 2022-05-31 12:40:24"><i class="fa-solid fa-calendar-days fa-fw me-1" aria-hidden=true></i><time datetime=2022-05-31>2022-05-31</time></span>&nbsp;<span title="3571 words"><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden=true></i>About 3600 words</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden=true></i>17 minutes</span>&nbsp;</div></div><div class=featured-image><img src=/posts/kube-my-router-pt2/featured-image.png alt=/posts/kube-my-router-pt2/featured-image.png></div><div class="details toc" id=toc-static data-kept=false><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fa-solid fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#intro><a href=/posts/kube-my-router-pt1/#intro>Intro</a></a></li><li><a href=#part-one---setting-up-the-k8s-vms-in-eve-ng><a href=/posts/kube-my-router-pt1/>Part One - Setting up the k8s VMs in EVE-NG</a></a></li><li><a href=#part-two---deploying-the-k8s-cluster-with-kubeadm><a href=/posts/kube-my-router-pt2/>Part Two - Deploying the k8s cluster with kubeadm</a></a><ul><li><a href=#the-intent>The Intent</a></li><li><a href=#prepare-all-nodes-for-kubeadm>Prepare all nodes for kubeadm</a></li><li><a href=#install-a-container-runtime>Install a container runtime</a></li><li><a href=#bootstrap-k8s-control-node>Bootstrap k8s control node</a></li><li><a href=#install-network-cni>Install network CNI</a></li><li><a href=#add-worker-nodes>Add worker nodes</a></li><li><a href=#testing-applications>Testing applications</a></li><li><a href=#references-and-influences>References and influences</a></li></ul></li><li><a href=#last-part---installing-and-testing-kne><a href=/posts/kube-my-router-pt3/>Last Part - Installing and testing KNE</a></a></li><li><a href=#outro><a href=/posts/kube-my-router-pt3/#outro>Outro</a></a></li></ul></nav></div></div><div class=content id=content><h2 class=heading-element id=intro><span><a href=/posts/kube-my-router-pt1/#intro>Intro</a></span>
<a href=#intro class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><hr><h2 class=heading-element id=part-one---setting-up-the-k8s-vms-in-eve-ng><span><a href=/posts/kube-my-router-pt1/>Part One - Setting up the k8s VMs in EVE-NG</a></span>
<a href=#part-one---setting-up-the-k8s-vms-in-eve-ng class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><hr><h2 class=heading-element id=part-two---deploying-the-k8s-cluster-with-kubeadm><span><a href=/posts/kube-my-router-pt2/>Part Two - Deploying the k8s cluster with kubeadm</a></span>
<a href=#part-two---deploying-the-k8s-cluster-with-kubeadm class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><hr><h3 class=heading-element id=the-intent><span>The Intent</span>
<a href=#the-intent class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><ul><li>Deploy k8s cluster with kubeadm</li><li>Single control plane, two workers</li><li>Use containerd as the container runtime</li><li>Flannel as network overlay CNI plugin</li></ul><hr><p>The main question points while preparing the k8s cluster for KNE where which CRI and which CNI to use, since I am not very deep in to k8s. A brief research done on the kind container that KNE uses to deploy the cluster and run the simulations in it revealed that it uses containerd as the CRI.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>❯ kubectl get nodes -owide
</span></span><span class=line><span class=cl>NAME                STATUS   ROLES                  AGE   VERSION   INTERNAL-IP   EXTERNAL-IP   OS-IMAGE                                   KERNEL-VERSION      CONTAINER-RUNTIME
</span></span><span class=line><span class=cl>kne-control-plane   Ready    control-plane,master   14d   v1.22.1   172.19.0.2    &lt;none&gt;        Ubuntu Impish Indri <span class=o>(</span>development branch<span class=o>)</span>   5.4.0-107-generic   containerd://1.5.5</span></span></code></pre></div><p>Kindnet as the primary the CNI.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>❯ kubectl get ds -n kube-system
</span></span><span class=line><span class=cl>NAME         DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR            AGE
</span></span><span class=line><span class=cl>kindnet      <span class=m>1</span>         <span class=m>1</span>         <span class=m>1</span>       <span class=m>1</span>            <span class=m>1</span>           &lt;none&gt;                   14d
</span></span><span class=line><span class=cl>kube-proxy   <span class=m>1</span>         <span class=m>1</span>         <span class=m>1</span>       <span class=m>1</span>            <span class=m>1</span>           kubernetes.io/os<span class=o>=</span>linux   14d</span></span></code></pre></div><p>In terms of network configuration:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>❯ docker ps
</span></span><span class=line><span class=cl>CONTAINER ID   IMAGE                  COMMAND                  CREATED       STATUS       PORTS                       NAMES
</span></span><span class=line><span class=cl>a099e5c3f7d3   kindest/node:v1.22.1   <span class=s2>&#34;/usr/local/bin/entr…&#34;</span>   <span class=m>2</span> weeks ago   Up <span class=m>2</span> weeks   127.0.0.1:34459-&gt;6443/tcp   kne-control-plane
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>❯ docker <span class=nb>exec</span> -it a099e5c3f7d3 bash
</span></span><span class=line><span class=cl>root@kne-control-plane:/#
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>root@kne-control-plane:/# ll /etc/cni/net.d/
</span></span><span class=line><span class=cl>total <span class=m>16</span>
</span></span><span class=line><span class=cl>drwx------ <span class=m>2</span> root root <span class=m>4096</span> May <span class=m>22</span> 22:16 ./
</span></span><span class=line><span class=cl>drwx------ <span class=m>3</span> root root <span class=m>4096</span> May <span class=m>22</span> 22:14 ../
</span></span><span class=line><span class=cl>-r--r--r-- <span class=m>1</span> root root  <span class=m>518</span> May <span class=m>22</span> 22:16 00-meshnet.conflist
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> root root  <span class=m>409</span> May <span class=m>22</span> 22:15 10-kindnet.conflist
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>root@kne-control-plane:/# cat /etc/cni/net.d/10-kindnet.conflist
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;cniVersion&#34;</span>: <span class=s2>&#34;0.3.1&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;name&#34;</span>: <span class=s2>&#34;kindnet&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;plugins&#34;</span>: <span class=o>[</span>
</span></span><span class=line><span class=cl>        <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;type&#34;</span>: <span class=s2>&#34;ptp&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;ipMasq&#34;</span>: false,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;ipam&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;type&#34;</span>: <span class=s2>&#34;host-local&#34;</span>,
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;dataDir&#34;</span>: <span class=s2>&#34;/run/cni-ipam-state&#34;</span>,
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;routes&#34;</span>: <span class=o>[</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                                <span class=o>{</span> <span class=s2>&#34;dst&#34;</span>: <span class=s2>&#34;0.0.0.0/0&#34;</span> <span class=o>}</span>
</span></span><span class=line><span class=cl>                        <span class=o>]</span>,
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;ranges&#34;</span>: <span class=o>[</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                                <span class=o>[</span> <span class=o>{</span> <span class=s2>&#34;subnet&#34;</span>: <span class=s2>&#34;10.244.0.0/24&#34;</span> <span class=o>}</span> <span class=o>]</span>
</span></span><span class=line><span class=cl>                        <span class=o>]</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>                ,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;mtu&#34;</span>: <span class=m>1500</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=o>}</span>,
</span></span><span class=line><span class=cl>        <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;type&#34;</span>: <span class=s2>&#34;portmap&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;capabilities&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;portMappings&#34;</span>: <span class=nb>true</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>root@kne-control-plane:/# cat /etc/cni/net.d/00-meshnet.conflist
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;cniVersion&#34;</span>: <span class=s2>&#34;0.3.1&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;name&#34;</span>: <span class=s2>&#34;kindnet&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;plugins&#34;</span>: <span class=o>[</span>
</span></span><span class=line><span class=cl>                <span class=o>{</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;ipMasq&#34;</span>: false,
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;ipam&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>                                <span class=s2>&#34;dataDir&#34;</span>: <span class=s2>&#34;/run/cni-ipam-state&#34;</span>,
</span></span><span class=line><span class=cl>                                <span class=s2>&#34;ranges&#34;</span>: <span class=o>[</span>
</span></span><span class=line><span class=cl>                                        <span class=o>[</span>
</span></span><span class=line><span class=cl>                                                <span class=o>{</span>
</span></span><span class=line><span class=cl>                                                        <span class=s2>&#34;subnet&#34;</span>: <span class=s2>&#34;10.244.0.0/24&#34;</span>
</span></span><span class=line><span class=cl>                                                <span class=o>}</span>
</span></span><span class=line><span class=cl>                                        <span class=o>]</span>
</span></span><span class=line><span class=cl>                                <span class=o>]</span>,
</span></span><span class=line><span class=cl>                                <span class=s2>&#34;routes&#34;</span>: <span class=o>[</span>
</span></span><span class=line><span class=cl>                                        <span class=o>{</span>
</span></span><span class=line><span class=cl>                                                <span class=s2>&#34;dst&#34;</span>: <span class=s2>&#34;0.0.0.0/0&#34;</span>
</span></span><span class=line><span class=cl>                                        <span class=o>}</span>
</span></span><span class=line><span class=cl>                                <span class=o>]</span>,
</span></span><span class=line><span class=cl>                                <span class=s2>&#34;type&#34;</span>: <span class=s2>&#34;host-local&#34;</span>
</span></span><span class=line><span class=cl>                        <span class=o>}</span>,
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;mtu&#34;</span>: 1500,
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;type&#34;</span>: <span class=s2>&#34;ptp&#34;</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>,
</span></span><span class=line><span class=cl>                <span class=o>{</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;capabilities&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>                                <span class=s2>&#34;portMappings&#34;</span>: <span class=nb>true</span>
</span></span><span class=line><span class=cl>                        <span class=o>}</span>,
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;type&#34;</span>: <span class=s2>&#34;portmap&#34;</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>,
</span></span><span class=line><span class=cl>                <span class=o>{</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;name&#34;</span>: <span class=s2>&#34;meshnet&#34;</span>,
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;type&#34;</span>: <span class=s2>&#34;meshnet&#34;</span>,
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;ipam&#34;</span>: <span class=o>{}</span>,
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;dns&#34;</span>: <span class=o>{}</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>}</span>root@kne-control-plane:/#</span></span></code></pre></div><p>So it is a simple Layer 3 CNI, and meshnet will be installed on top of it. Let&rsquo;s use a more common CNI, like flannel for our use case.</p><div class="details admonition note"><div class="details-summary admonition-title"><i class="icon fa-fw fa-solid fa-pencil-alt" aria-hidden=true></i>Using flannel<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>When using flannel, the main drawback was the interface MTU inside the device container, seen on srlinux. Flannel, since it uses VXLAN, will inherit the MTU of the main ethernet interface of the host and create its bridge interface flannel.1 with an MTU of minus 50, i.e. 1450 by default. When spinning up the containers, they use this MTU and from what I saw, srlinux cannot bring up its interfaces that need a minimum of 1500 MTU. The only way of mitigating this easily is to use higher MTU on the host interface, so flannel can inherit this, which I presume in a <em>production</em> environment should be something common and the network underlay would of course support jumbo&rsquo;s. More on this during final part.</div></div></div><p>Let&rsquo;s change gears now and deploy the k8s cluster on the three VMs that are running on the two EVE-NG servers. Here&rsquo;s what we have up and running:</p><table><thead><tr><th style=text-align:center>EVE-NG node</th><th style=text-align:center>Role</th><th style=text-align:center>VM name</th><th style=text-align:center>IP address</th><th style=text-align:center>CPU</th><th style=text-align:center>RAM</th></tr></thead><tbody><tr><td style=text-align:center>eve-01</td><td style=text-align:center>control-node</td><td style=text-align:center>kates-control</td><td style=text-align:center>192.168.1.30</td><td style=text-align:center>4</td><td style=text-align:center>4096</td></tr><tr><td style=text-align:center>eve-01</td><td style=text-align:center>worker</td><td style=text-align:center>kates-node-01</td><td style=text-align:center>192.168.1.31</td><td style=text-align:center>8</td><td style=text-align:center>28672</td></tr><tr><td style=text-align:center>eve-02</td><td style=text-align:center>worker</td><td style=text-align:center>kates-node-02</td><td style=text-align:center>192.168.1.32</td><td style=text-align:center>8</td><td style=text-align:center>28672</td></tr></tbody></table><p>We are going to deploy a single control node with two workers using kubeadm and also use the containerd container runtime.</p><hr><h3 class=heading-element id=prepare-all-nodes-for-kubeadm><span>Prepare all nodes for kubeadm</span>
<a href=#prepare-all-nodes-for-kubeadm class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><hr><p>In all nodes, fix the <mark class=mark-default>/etc/hosts</mark> since we are not using proper DNS resolution and we need to statically be able to resolve.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl>$ diff /etc/hosts.orig /etc/hosts -p
</span></span><span class=line><span class=cl>*** /etc/hosts.orig     2022-05-30 19:28:32.679321412 +0000
</span></span><span class=line><span class=cl><span class=gd>--- /etc/hosts  2022-05-30 19:29:04.931472825 +0000
</span></span></span><span class=line><span class=cl><span class=gd></span>***************
</span></span><span class=line><span class=cl>*** 1,4 ****
</span></span><span class=line><span class=cl><span class=gd>--- 1,7 ----
</span></span></span><span class=line><span class=cl><span class=gd></span>  127.0.0.1 localhost
</span></span><span class=line><span class=cl><span class=gi>+ 192.168.1.30 kates-control
</span></span></span><span class=line><span class=cl><span class=gi>+ 192.168.1.31 kates-node-01
</span></span></span><span class=line><span class=cl><span class=gi>+ 192.168.1.32 kates-node-02
</span></span></span></code></pre></div><p>Install the pre-requisite packages if missing and add the k8s sources in apt.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ sudo apt -y install vim git curl wget apt-transport-https ca-certificates
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg <span class=p>|</span> sudo apt-key add -
</span></span><span class=line><span class=cl>OK
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ <span class=nb>echo</span> <span class=s2>&#34;deb https://apt.kubernetes.io/ kubernetes-xenial main&#34;</span> <span class=p>|</span> sudo tee /etc/apt/sources.list.d/kubernetes.list
</span></span><span class=line><span class=cl>deb https://apt.kubernetes.io/ kubernetes-xenial main
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ sudo apt update</span></span></code></pre></div><p>You may upgrade any packages needed after the last apt update.</p><p>Next, we are now ready to install <strong>kubeadm</strong> along with <strong>kubelet</strong> and <strong>kubectl</strong> packages</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ sudo apt -y install kubeadm kubelet kubectl
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Lock the software version on these packages to avoid any accidental upgrade</span>
</span></span><span class=line><span class=cl>$ sudo apt-mark hold kubelet kubeadm kubectl
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># This is the version used while I was deploying</span>
</span></span><span class=line><span class=cl>$ kubectl version --output<span class=o>=</span>yaml --client <span class=o>&amp;&amp;</span> kubeadm version -o yaml
</span></span><span class=line><span class=cl>clientVersion:
</span></span><span class=line><span class=cl>  buildDate: <span class=s2>&#34;2022-05-24T12:26:19Z&#34;</span>
</span></span><span class=line><span class=cl>  compiler: gc
</span></span><span class=line><span class=cl>  gitCommit: 3ddd0f45aa91e2f30c70734b175631bec5b5825a
</span></span><span class=line><span class=cl>  gitTreeState: clean
</span></span><span class=line><span class=cl>  gitVersion: v1.24.1
</span></span><span class=line><span class=cl>  goVersion: go1.18.2
</span></span><span class=line><span class=cl>  major: <span class=s2>&#34;1&#34;</span>
</span></span><span class=line><span class=cl>  minor: <span class=s2>&#34;24&#34;</span>
</span></span><span class=line><span class=cl>  platform: linux/amd64
</span></span><span class=line><span class=cl>kustomizeVersion: v4.5.4
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>clientVersion:
</span></span><span class=line><span class=cl>  buildDate: <span class=s2>&#34;2022-05-24T12:24:38Z&#34;</span>
</span></span><span class=line><span class=cl>  compiler: gc
</span></span><span class=line><span class=cl>  gitCommit: 3ddd0f45aa91e2f30c70734b175631bec5b5825a
</span></span><span class=line><span class=cl>  gitTreeState: clean
</span></span><span class=line><span class=cl>  gitVersion: v1.24.1
</span></span><span class=line><span class=cl>  goVersion: go1.18.2
</span></span><span class=line><span class=cl>  major: <span class=s2>&#34;1&#34;</span>
</span></span><span class=line><span class=cl>  minor: <span class=s2>&#34;24&#34;</span>
</span></span><span class=line><span class=cl>  platform: linux/amd64</span></span></code></pre></div><div class="details admonition note"><div class="details-summary admonition-title"><i class="icon fa-fw fa-solid fa-pencil-alt" aria-hidden=true></i>Specific Version<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content><p>If you want to deploy a specific version of the packages and not the latest available you could execute:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ sudo apt list -a kubelet kubeadm kubectl <span class=p>|</span> grep 1.22.2
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>WARNING: apt does not have a stable CLI interface. Use with caution in scripts.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>kubeadm/kubernetes-xenial 1.22.2-00 amd64
</span></span><span class=line><span class=cl>kubectl/kubernetes-xenial 1.22.2-00 amd64
</span></span><span class=line><span class=cl>kubelet/kubernetes-xenial 1.22.2-00 amd64</span></span></code></pre></div><p>And then install with:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo apt -y install <span class=nv>kubeadm</span><span class=o>=</span>1.22.2-00 <span class=nv>kubelet</span><span class=o>=</span>1.22.2-00 <span class=nv>kubectl</span><span class=o>=</span>1.22.2-00</span></span></code></pre></div><p>Remember that if you are using a specific version you will have to specify that while downloading the k8s images and/or during kubeadm init bootstrap of the control node.</p></div></div></div><p>We now need to disable swap if we are using any (cloud images do not by default), since kubelet will not run unless swap is disabled.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ sudo swapoff -a
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Comment out the relevant line in fstab to disable swap from loading on boot (usually last line)</span>
</span></span><span class=line><span class=cl>$ sudo vi /etc/fstab</span></span></code></pre></div><p>Enable kernel modules and bridge NF to iptables chains.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ubuntu@kates-control:~$ sudo modprobe overlay
</span></span><span class=line><span class=cl>ubuntu@kates-control:~$ sudo modprobe br_netfilter
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ubuntu@kates-control:~$ cat <span class=s>&lt;&lt;EOF | sudo tee /etc/modules-load.d/k8s-cri.conf
</span></span></span><span class=line><span class=cl><span class=s>&gt; overlay
</span></span></span><span class=line><span class=cl><span class=s>&gt; br_netfilter
</span></span></span><span class=line><span class=cl><span class=s>&gt; EOF</span>
</span></span><span class=line><span class=cl>overlay
</span></span><span class=line><span class=cl>br_netfilter
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ubuntu@kates-control:~$ sudo tee /etc/sysctl.d/99-k8s-cri.conf<span class=s>&lt;&lt;EOF
</span></span></span><span class=line><span class=cl><span class=s>&gt; net.bridge.bridge-nf-call-ip6tables = 1
</span></span></span><span class=line><span class=cl><span class=s>&gt; net.bridge.bridge-nf-call-iptables = 1
</span></span></span><span class=line><span class=cl><span class=s>&gt; net.ipv4.ip_forward = 1
</span></span></span><span class=line><span class=cl><span class=s>&gt; EOF</span>
</span></span><span class=line><span class=cl>net.bridge.bridge-nf-call-ip6tables <span class=o>=</span> <span class=m>1</span>
</span></span><span class=line><span class=cl>net.bridge.bridge-nf-call-iptables <span class=o>=</span> <span class=m>1</span>
</span></span><span class=line><span class=cl>net.ipv4.ip_forward <span class=o>=</span> <span class=m>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Reload sysctl to apply changes</span>
</span></span><span class=line><span class=cl>ubuntu@kates-control:~$ sudo sysctl --system</span></span></code></pre></div><hr><h3 class=heading-element id=install-a-container-runtime><span>Install a container runtime</span>
<a href=#install-a-container-runtime class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><hr><p>As far as CRI, there are three options available. Go with either <strong>docker</strong>, <strong>containerd</strong> or use <strong>CRI-O</strong>. For this post we are going with containerd, so the first step is to add the repo to our nodes and install the service.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ubuntu@kates-control:~$ curl -fsSL https://download.docker.com/linux/ubuntu/gpg <span class=p>|</span> sudo apt-key add -
</span></span><span class=line><span class=cl>OK
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ubuntu@kates-control:~$ sudo add-apt-repository <span class=s2>&#34;deb [arch=amd64] https://download.docker.com/linux/ubuntu </span><span class=k>$(</span>lsb_release -cs<span class=k>)</span><span class=s2> stable&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ubuntu@kates-control:~$ sudo apt update -y
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ubuntu@kates-control:~$ sudo apt install -y containerd.io</span></span></code></pre></div><p>Next, put in place a default configuration.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ubuntu@kates-control:~$ sudo mv /etc/containerd/config.toml /etc/containerd/config.toml.orig
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ubuntu@kates-control:~$ containerd config default <span class=p>|</span> sudo tee /etc/containerd/config.toml</span></span></code></pre></div><p>Next, set the cgroup to use systemd and re-start the service.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ubuntu@kates-control:~$ sudo sed -i s/<span class=s2>&#34;SystemdCgroup = false&#34;</span>/<span class=s2>&#34;SystemdCgroup = true&#34;</span>/g /etc/containerd/config.toml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ubuntu@kates-control:~$ sudo systemctl restart containerd</span></span></code></pre></div><p>Test that pulling images works.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ubuntu@kates-control:~$ sudo ctr image pull docker.io/library/nginx:latest
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ubuntu@kates-control:~$ sudo ctr image ls -q
</span></span><span class=line><span class=cl>docker.io/library/nginx:latest
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Delete the image</span>
</span></span><span class=line><span class=cl>ubuntu@kates-control:~$ sudo ctr image rm docker.io/library/nginx:latest
</span></span><span class=line><span class=cl>docker.io/library/nginx:latest</span></span></code></pre></div><div class="details admonition note"><div class="details-summary admonition-title"><i class="icon fa-fw fa-solid fa-pencil-alt" aria-hidden=true></i>Access via proxy<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content><p>If you are behind a proxy, you can expose the proxy environment variables to the daemon.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ sudo mkdir /etc/systemd/system/containerd.service.d/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ sudo tee /etc/systemd/system/containerd.service.d/http-proxy.conf<span class=s>&lt;&lt;EOF
</span></span></span><span class=line><span class=cl><span class=s>&gt; [Service]
</span></span></span><span class=line><span class=cl><span class=s>&gt; Environment=&#34;HTTP_PROXY=http://&lt;your_proxy&gt;:&lt;port&gt;&#34;
</span></span></span><span class=line><span class=cl><span class=s>&gt; Environment=&#34;HTTPS_PROXY=http://&lt;your_proxy&gt;:&lt;port&gt;&#34;
</span></span></span><span class=line><span class=cl><span class=s>&gt; Environment=&#34;NO_PROXY=localhost,127.0.0.1,.domain.com&#34;
</span></span></span><span class=line><span class=cl><span class=s>&gt; EOF</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ sudo systemctl daemon-reload
</span></span><span class=line><span class=cl>$ sudo systemctl restart containerd</span></span></code></pre></div><p><strong>NOTE:</strong> The <strong>no_proxy</strong> variable will not accept subnet masks, only full /32 ip addresses.</p></div></div></div><hr><h3 class=heading-element id=bootstrap-k8s-control-node><span>Bootstrap k8s control node</span>
<a href=#bootstrap-k8s-control-node class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><hr><p>We are ready now to initialise the control node on the first VM. First we need to enable the <strong>kubelet</strong> service if not already on.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ubuntu@kates-control:~$ systemctl is-enabled kubelet &gt;/dev/null <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>                <span class=o>&amp;&amp;</span> <span class=nb>echo</span> Service is already enabled <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>                <span class=o>||</span> <span class=nb>echo</span> Enabling kubelet <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>                <span class=o>&amp;&amp;</span> sudo systemctl <span class=nb>enable</span> kubelet
</span></span><span class=line><span class=cl>Service is already enabled</span></span></code></pre></div><p>No worries if the service does not load correctly, it will, after kubeadm finishes configuring the control node.
Download k8s images from the registry, optionally, specifying the k8s version.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Check for the images first</span>
</span></span><span class=line><span class=cl>ubuntu@kates-control:~$ sudo kubeadm config images list --kubernetes-version stable-1.24
</span></span><span class=line><span class=cl>k8s.gcr.io/kube-apiserver:v1.24.1
</span></span><span class=line><span class=cl>k8s.gcr.io/kube-controller-manager:v1.24.1
</span></span><span class=line><span class=cl>k8s.gcr.io/kube-scheduler:v1.24.1
</span></span><span class=line><span class=cl>k8s.gcr.io/kube-proxy:v1.24.1
</span></span><span class=line><span class=cl>k8s.gcr.io/pause:3.7
</span></span><span class=line><span class=cl>k8s.gcr.io/etcd:3.5.3-0
</span></span><span class=line><span class=cl>k8s.gcr.io/coredns/coredns:v1.8.6
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># and then pull them</span>
</span></span><span class=line><span class=cl>ubuntu@kates-control:~$ sudo kubeadm config images pull --kubernetes-version stable-1.24 --cri-socket unix:///run/containerd/containerd.sock
</span></span><span class=line><span class=cl><span class=o>[</span>config/images<span class=o>]</span> Pulled k8s.gcr.io/kube-apiserver:v1.24.1
</span></span><span class=line><span class=cl><span class=o>[</span>config/images<span class=o>]</span> Pulled k8s.gcr.io/kube-controller-manager:v1.24.1
</span></span><span class=line><span class=cl><span class=o>[</span>config/images<span class=o>]</span> Pulled k8s.gcr.io/kube-scheduler:v1.24.1
</span></span><span class=line><span class=cl><span class=o>[</span>config/images<span class=o>]</span> Pulled k8s.gcr.io/kube-proxy:v1.24.1
</span></span><span class=line><span class=cl><span class=o>[</span>config/images<span class=o>]</span> Pulled k8s.gcr.io/pause:3.7
</span></span><span class=line><span class=cl><span class=o>[</span>config/images<span class=o>]</span> Pulled k8s.gcr.io/etcd:3.5.3-0
</span></span><span class=line><span class=cl><span class=o>[</span>config/images<span class=o>]</span> Pulled k8s.gcr.io/coredns/coredns:v1.8.6
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ubuntu@kates-control:~$ sudo ctr -n k8s.io image ls -q <span class=p>|</span> grep -v sha
</span></span><span class=line><span class=cl>k8s.gcr.io/coredns/coredns:v1.8.6
</span></span><span class=line><span class=cl>k8s.gcr.io/etcd:3.5.3-0
</span></span><span class=line><span class=cl>k8s.gcr.io/kube-apiserver:v1.24.1
</span></span><span class=line><span class=cl>k8s.gcr.io/kube-controller-manager:v1.24.1
</span></span><span class=line><span class=cl>k8s.gcr.io/kube-proxy:v1.24.1
</span></span><span class=line><span class=cl>k8s.gcr.io/kube-scheduler:v1.24.1
</span></span><span class=line><span class=cl>k8s.gcr.io/pause:3.7</span></span></code></pre></div><div class="details admonition note"><div class="details-summary admonition-title"><i class="icon fa-fw fa-solid fa-pencil-alt" aria-hidden=true></i>Using crictl instead<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content><p>If you prefer to use crictl, you can create a configuration file for containerd to avoid the warnings</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ubuntu@kates-control:~$ sudo tee cat /etc/crictl.yaml <span class=s>&lt;&lt;EOF
</span></span></span><span class=line><span class=cl><span class=s>&gt; runtime-endpoint: unix:///var/run/containerd/containerd.sock
</span></span></span><span class=line><span class=cl><span class=s>&gt; image-endpoint: unix:///run/containerd/containerd.sock
</span></span></span><span class=line><span class=cl><span class=s>&gt; timeout: 10
</span></span></span><span class=line><span class=cl><span class=s>&gt; debug: false
</span></span></span><span class=line><span class=cl><span class=s>&gt; EOF</span>
</span></span><span class=line><span class=cl>runtime-endpoint: unix:///var/run/containerd/containerd.sock
</span></span><span class=line><span class=cl>image-endpoint: unix:///run/containerd/containerd.sock
</span></span><span class=line><span class=cl>timeout: <span class=m>10</span>
</span></span><span class=line><span class=cl>debug: <span class=nb>false</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ubuntu@kates-control:~$ sudo crictl images
</span></span><span class=line><span class=cl>IMAGE                                TAG                 IMAGE ID            SIZE
</span></span><span class=line><span class=cl>k8s.gcr.io/coredns/coredns           v1.8.6              a4ca41631cc7a       13.6MB
</span></span><span class=line><span class=cl>k8s.gcr.io/etcd                      3.5.3-0             aebe758cef4cd       102MB
</span></span><span class=line><span class=cl>k8s.gcr.io/kube-apiserver            v1.24.1             e9f4b425f9192       33.8MB
</span></span><span class=line><span class=cl>k8s.gcr.io/kube-controller-manager   v1.24.1             b4ea7e648530d       31MB
</span></span><span class=line><span class=cl>k8s.gcr.io/kube-proxy                v1.24.1             beb86f5d8e6cd       39.5MB
</span></span><span class=line><span class=cl>k8s.gcr.io/kube-scheduler            v1.24.1             18688a72645c5       15.5MB
</span></span><span class=line><span class=cl>k8s.gcr.io/pause                     3.7                 221177c6082a8       311kB</span></span></code></pre></div></div></div></div><p>Now we can use kubeadm to bootstrap the node setting the POD network and, again, by optionally specifying the version. The init process will get the appropriate images if they do not exist locally already.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ubuntu@kates-control:~$ sudo kubeadm init --pod-network-cidr<span class=o>=</span>10.244.0.0/16 --cri-socket /run/containerd/containerd.sock --kubernetes-version stable-1.24
</span></span><span class=line><span class=cl>W0606 09:39:22.344649   <span class=m>33934</span> initconfiguration.go:120<span class=o>]</span> Usage of CRI endpoints without URL scheme is deprecated and can cause kubelet errors in the future. Automatically prepending scheme <span class=s2>&#34;unix&#34;</span> to the <span class=s2>&#34;criSocket&#34;</span> with value <span class=s2>&#34;/run/containerd/containerd.sock&#34;</span>. Please update your configuration!
</span></span><span class=line><span class=cl><span class=o>[</span>init<span class=o>]</span> Using Kubernetes version: v1.24.1
</span></span><span class=line><span class=cl><span class=o>[</span>preflight<span class=o>]</span> Running pre-flight checks
</span></span><span class=line><span class=cl><span class=o>[</span>preflight<span class=o>]</span> Pulling images required <span class=k>for</span> setting up a Kubernetes cluster
</span></span><span class=line><span class=cl><span class=o>[</span>preflight<span class=o>]</span> This might take a minute or two, depending on the speed of your internet connection
</span></span><span class=line><span class=cl><span class=o>[</span>preflight<span class=o>]</span> You can also perform this action in beforehand using <span class=s1>&#39;kubeadm config images pull&#39;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>certs<span class=o>]</span> Using certificateDir folder <span class=s2>&#34;/etc/kubernetes/pki&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>certs<span class=o>]</span> Generating <span class=s2>&#34;ca&#34;</span> certificate and key
</span></span><span class=line><span class=cl><span class=o>[</span>certs<span class=o>]</span> Generating <span class=s2>&#34;apiserver&#34;</span> certificate and key
</span></span><span class=line><span class=cl><span class=o>[</span>certs<span class=o>]</span> apiserver serving cert is signed <span class=k>for</span> DNS names <span class=o>[</span>kates-control kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local<span class=o>]</span> and IPs <span class=o>[</span>10.96.0.1 192.168.1.30<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>[</span>certs<span class=o>]</span> Generating <span class=s2>&#34;apiserver-kubelet-client&#34;</span> certificate and key
</span></span><span class=line><span class=cl><span class=o>[</span>certs<span class=o>]</span> Generating <span class=s2>&#34;front-proxy-ca&#34;</span> certificate and key
</span></span><span class=line><span class=cl><span class=o>[</span>certs<span class=o>]</span> Generating <span class=s2>&#34;front-proxy-client&#34;</span> certificate and key
</span></span><span class=line><span class=cl><span class=o>[</span>certs<span class=o>]</span> Generating <span class=s2>&#34;etcd/ca&#34;</span> certificate and key
</span></span><span class=line><span class=cl><span class=o>[</span>certs<span class=o>]</span> Generating <span class=s2>&#34;etcd/server&#34;</span> certificate and key
</span></span><span class=line><span class=cl><span class=o>[</span>certs<span class=o>]</span> etcd/server serving cert is signed <span class=k>for</span> DNS names <span class=o>[</span>kates-control localhost<span class=o>]</span> and IPs <span class=o>[</span>192.168.1.30 127.0.0.1 ::1<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>[</span>certs<span class=o>]</span> Generating <span class=s2>&#34;etcd/peer&#34;</span> certificate and key
</span></span><span class=line><span class=cl><span class=o>[</span>certs<span class=o>]</span> etcd/peer serving cert is signed <span class=k>for</span> DNS names <span class=o>[</span>kates-control localhost<span class=o>]</span> and IPs <span class=o>[</span>192.168.1.30 127.0.0.1 ::1<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>[</span>certs<span class=o>]</span> Generating <span class=s2>&#34;etcd/healthcheck-client&#34;</span> certificate and key
</span></span><span class=line><span class=cl><span class=o>[</span>certs<span class=o>]</span> Generating <span class=s2>&#34;apiserver-etcd-client&#34;</span> certificate and key
</span></span><span class=line><span class=cl><span class=o>[</span>certs<span class=o>]</span> Generating <span class=s2>&#34;sa&#34;</span> key and public key
</span></span><span class=line><span class=cl><span class=o>[</span>kubeconfig<span class=o>]</span> Using kubeconfig folder <span class=s2>&#34;/etc/kubernetes&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>kubeconfig<span class=o>]</span> Writing <span class=s2>&#34;admin.conf&#34;</span> kubeconfig file
</span></span><span class=line><span class=cl><span class=o>[</span>kubeconfig<span class=o>]</span> Writing <span class=s2>&#34;kubelet.conf&#34;</span> kubeconfig file
</span></span><span class=line><span class=cl><span class=o>[</span>kubeconfig<span class=o>]</span> Writing <span class=s2>&#34;controller-manager.conf&#34;</span> kubeconfig file
</span></span><span class=line><span class=cl><span class=o>[</span>kubeconfig<span class=o>]</span> Writing <span class=s2>&#34;scheduler.conf&#34;</span> kubeconfig file
</span></span><span class=line><span class=cl><span class=o>[</span>kubelet-start<span class=o>]</span> Writing kubelet environment file with flags to file <span class=s2>&#34;/var/lib/kubelet/kubeadm-flags.env&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>kubelet-start<span class=o>]</span> Writing kubelet configuration to file <span class=s2>&#34;/var/lib/kubelet/config.yaml&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>kubelet-start<span class=o>]</span> Starting the kubelet
</span></span><span class=line><span class=cl><span class=o>[</span>control-plane<span class=o>]</span> Using manifest folder <span class=s2>&#34;/etc/kubernetes/manifests&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>control-plane<span class=o>]</span> Creating static Pod manifest <span class=k>for</span> <span class=s2>&#34;kube-apiserver&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>control-plane<span class=o>]</span> Creating static Pod manifest <span class=k>for</span> <span class=s2>&#34;kube-controller-manager&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>control-plane<span class=o>]</span> Creating static Pod manifest <span class=k>for</span> <span class=s2>&#34;kube-scheduler&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>etcd<span class=o>]</span> Creating static Pod manifest <span class=k>for</span> <span class=nb>local</span> etcd in <span class=s2>&#34;/etc/kubernetes/manifests&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>wait-control-plane<span class=o>]</span> Waiting <span class=k>for</span> the kubelet to boot up the control plane as static Pods from directory <span class=s2>&#34;/etc/kubernetes/manifests&#34;</span>. This can take up to 4m0s
</span></span><span class=line><span class=cl><span class=o>[</span>apiclient<span class=o>]</span> All control plane components are healthy after 9.004673 seconds
</span></span><span class=line><span class=cl><span class=o>[</span>upload-config<span class=o>]</span> Storing the configuration used in ConfigMap <span class=s2>&#34;kubeadm-config&#34;</span> in the <span class=s2>&#34;kube-system&#34;</span> Namespace
</span></span><span class=line><span class=cl><span class=o>[</span>kubelet<span class=o>]</span> Creating a ConfigMap <span class=s2>&#34;kubelet-config&#34;</span> in namespace kube-system with the configuration <span class=k>for</span> the kubelets in the cluster
</span></span><span class=line><span class=cl><span class=o>[</span>upload-certs<span class=o>]</span> Skipping phase. Please see --upload-certs
</span></span><span class=line><span class=cl><span class=o>[</span>mark-control-plane<span class=o>]</span> Marking the node kates-control as control-plane by adding the labels: <span class=o>[</span>node-role.kubernetes.io/control-plane node.kubernetes.io/exclude-from-external-load-balancers<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>[</span>mark-control-plane<span class=o>]</span> Marking the node kates-control as control-plane by adding the taints <span class=o>[</span>node-role.kubernetes.io/master:NoSchedule node-role.kubernetes.io/control-plane:NoSchedule<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>[</span>bootstrap-token<span class=o>]</span> Using token: kggzqq.5vz1esxhxfw1wgxf
</span></span><span class=line><span class=cl><span class=o>[</span>bootstrap-token<span class=o>]</span> Configuring bootstrap tokens, cluster-info ConfigMap, RBAC Roles
</span></span><span class=line><span class=cl><span class=o>[</span>bootstrap-token<span class=o>]</span> Configured RBAC rules to allow Node Bootstrap tokens to get nodes
</span></span><span class=line><span class=cl><span class=o>[</span>bootstrap-token<span class=o>]</span> Configured RBAC rules to allow Node Bootstrap tokens to post CSRs in order <span class=k>for</span> nodes to get long term certificate credentials
</span></span><span class=line><span class=cl><span class=o>[</span>bootstrap-token<span class=o>]</span> Configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token
</span></span><span class=line><span class=cl><span class=o>[</span>bootstrap-token<span class=o>]</span> Configured RBAC rules to allow certificate rotation <span class=k>for</span> all node client certificates in the cluster
</span></span><span class=line><span class=cl><span class=o>[</span>bootstrap-token<span class=o>]</span> Creating the <span class=s2>&#34;cluster-info&#34;</span> ConfigMap in the <span class=s2>&#34;kube-public&#34;</span> namespace
</span></span><span class=line><span class=cl><span class=o>[</span>kubelet-finalize<span class=o>]</span> Updating <span class=s2>&#34;/etc/kubernetes/kubelet.conf&#34;</span> to point to a rotatable kubelet client certificate and key
</span></span><span class=line><span class=cl><span class=o>[</span>addons<span class=o>]</span> Applied essential addon: CoreDNS
</span></span><span class=line><span class=cl><span class=o>[</span>addons<span class=o>]</span> Applied essential addon: kube-proxy
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Your Kubernetes control-plane has initialized successfully!
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>To start using your cluster, you need to run the following as a regular user:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  mkdir -p <span class=nv>$HOME</span>/.kube
</span></span><span class=line><span class=cl>  sudo cp -i /etc/kubernetes/admin.conf <span class=nv>$HOME</span>/.kube/config
</span></span><span class=line><span class=cl>  sudo chown <span class=k>$(</span>id -u<span class=k>)</span>:<span class=k>$(</span>id -g<span class=k>)</span> <span class=nv>$HOME</span>/.kube/config
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Alternatively, <span class=k>if</span> you are the root user, you can run:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nb>export</span> <span class=nv>KUBECONFIG</span><span class=o>=</span>/etc/kubernetes/admin.conf
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>You should now deploy a pod network to the cluster.
</span></span><span class=line><span class=cl>Run <span class=s2>&#34;kubectl apply -f [podnetwork].yaml&#34;</span> with one of the options listed at:
</span></span><span class=line><span class=cl>  https://kubernetes.io/docs/concepts/cluster-administration/addons/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Then you can join any number of worker nodes by running the following on each as root:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>kubeadm join 192.168.1.30:6443 --token kggzqq.5vz1esxhxfw1wgxf <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>        --discovery-token-ca-cert-hash sha256:d83d4dd95515623997f68d12a5bb19adda871ba8d81dc389ac787746d49ea9e2</span></span></code></pre></div><p><div class="details admonition tip open"><div class="details-summary admonition-title"><i class="icon fa-fw fa-regular fa-lightbulb" aria-hidden=true></i>Join Token<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>The join token created by kubeadm will last I think for 24hrs, so if you are joining workers sooner you could copy the join command in a text pad or something for later use.</div></div></div>Now as instructed by the init process, copy the admin.conf into your users directory in order to be able to use kubectl to operate your cluster.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ubuntu@kates-control:~$ mkdir -p <span class=nv>$HOME</span>/.kube
</span></span><span class=line><span class=cl>ubuntu@kates-control:~$ sudo cp -i /etc/kubernetes/admin.conf <span class=nv>$HOME</span>/.kube/config
</span></span><span class=line><span class=cl>ubuntu@kates-control:~$ sudo chown <span class=k>$(</span>id -u<span class=k>)</span>:<span class=k>$(</span>id -g<span class=k>)</span> <span class=nv>$HOME</span>/.kube/config</span></span></code></pre></div><p>And run some kubectl to check your control-plane.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ubuntu@kates-control:~$ kubectl cluster-info
</span></span><span class=line><span class=cl>Kubernetes control plane is running at https://192.168.1.30:6443
</span></span><span class=line><span class=cl>CoreDNS is running at https://192.168.1.30:6443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>To further debug and diagnose cluster problems, use <span class=s1>&#39;kubectl cluster-info dump&#39;</span>.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ubuntu@kates-control:~$ kubectl get nodes -owide
</span></span><span class=line><span class=cl>NAME            STATUS     ROLES           AGE    VERSION   INTERNAL-IP    EXTERNAL-IP   OS-IMAGE             KERNEL-VERSION      CONTAINER-RUNTIME
</span></span><span class=line><span class=cl>kates-control   NotReady   control-plane   104s   v1.24.1   192.168.1.30   &lt;none&gt;        Ubuntu 20.04.4 LTS   5.4.0-117-generic   containerd://1.6.6
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ubuntu@kates-control:~$ kubectl get all -A
</span></span><span class=line><span class=cl>NAMESPACE     NAME                                        READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>kube-system   pod/coredns-6d4b75cb6d-r5k7h                0/1     Pending   <span class=m>0</span>          2m8s
</span></span><span class=line><span class=cl>kube-system   pod/coredns-6d4b75cb6d-xwfnq                0/1     Pending   <span class=m>0</span>          2m8s
</span></span><span class=line><span class=cl>kube-system   pod/etcd-kates-control                      1/1     Running   <span class=m>0</span>          2m23s
</span></span><span class=line><span class=cl>kube-system   pod/kube-apiserver-kates-control            1/1     Running   <span class=m>0</span>          2m23s
</span></span><span class=line><span class=cl>kube-system   pod/kube-controller-manager-kates-control   1/1     Running   <span class=m>0</span>          2m25s
</span></span><span class=line><span class=cl>kube-system   pod/kube-proxy-gnq29                        1/1     Running   <span class=m>0</span>          2m8s
</span></span><span class=line><span class=cl>kube-system   pod/kube-scheduler-kates-control            1/1     Running   <span class=m>0</span>          2m23s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAMESPACE     NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT<span class=o>(</span>S<span class=o>)</span>                  AGE
</span></span><span class=line><span class=cl>default       service/kubernetes   ClusterIP   10.96.0.1    &lt;none&gt;        443/TCP                  2m25s
</span></span><span class=line><span class=cl>kube-system   service/kube-dns     ClusterIP   10.96.0.10   &lt;none&gt;        53/UDP,53/TCP,9153/TCP   2m23s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAMESPACE     NAME                        DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR            AGE
</span></span><span class=line><span class=cl>kube-system   daemonset.apps/kube-proxy   <span class=m>1</span>         <span class=m>1</span>         <span class=m>1</span>       <span class=m>1</span>            <span class=m>1</span>           kubernetes.io/os<span class=o>=</span>linux   2m23s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAMESPACE     NAME                      READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span class=line><span class=cl>kube-system   deployment.apps/coredns   0/2     <span class=m>2</span>            <span class=m>0</span>           2m23s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAMESPACE     NAME                                 DESIRED   CURRENT   READY   AGE
</span></span><span class=line><span class=cl>kube-system   replicaset.apps/coredns-6d4b75cb6d   <span class=m>2</span>         <span class=m>2</span>         <span class=m>0</span>       2m9s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># componentstatus seems old :smile:</span>
</span></span><span class=line><span class=cl>ubuntu@kates-control:~$  kubectl get cs -A
</span></span><span class=line><span class=cl>Warning: v1 ComponentStatus is deprecated in v1.19+
</span></span><span class=line><span class=cl>NAME                 STATUS    MESSAGE                         ERROR
</span></span><span class=line><span class=cl>scheduler            Healthy   ok
</span></span><span class=line><span class=cl>controller-manager   Healthy   ok
</span></span><span class=line><span class=cl>etcd-0               Healthy   <span class=o>{</span><span class=s2>&#34;health&#34;</span>:<span class=s2>&#34;true&#34;</span>,<span class=s2>&#34;reason&#34;</span>:<span class=s2>&#34;&#34;</span><span class=o>}</span></span></span></code></pre></div><hr><h3 class=heading-element id=install-network-cni><span>Install network CNI</span>
<a href=#install-network-cni class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><hr><p>Now, still on the control node, we are going to deploy the Flannel CNI plugin.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ubuntu@kates-control:~$ kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml
</span></span><span class=line><span class=cl>Warning: policy/v1beta1 PodSecurityPolicy is deprecated in v1.21+, unavailable in v1.25+
</span></span><span class=line><span class=cl>podsecuritypolicy.policy/psp.flannel.unprivileged created
</span></span><span class=line><span class=cl>clusterrole.rbac.authorization.k8s.io/flannel created
</span></span><span class=line><span class=cl>clusterrolebinding.rbac.authorization.k8s.io/flannel created
</span></span><span class=line><span class=cl>serviceaccount/flannel created
</span></span><span class=line><span class=cl>configmap/kube-flannel-cfg created
</span></span><span class=line><span class=cl>daemonset.apps/kube-flannel-ds created</span></span></code></pre></div><p>Check how it looks on control-plane.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ubuntu@kates-control:~$ kubectl get all -A
</span></span><span class=line><span class=cl>NAMESPACE     NAME                                        READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>kube-system   pod/coredns-6d4b75cb6d-fvskj                1/1     Running   <span class=m>0</span>          8m12s
</span></span><span class=line><span class=cl>kube-system   pod/coredns-6d4b75cb6d-xrflm                1/1     Running   <span class=m>0</span>          8m12s
</span></span><span class=line><span class=cl>kube-system   pod/etcd-kates-control                      1/1     Running   <span class=m>0</span>          8m25s
</span></span><span class=line><span class=cl>kube-system   pod/kube-apiserver-kates-control            1/1     Running   <span class=m>0</span>          8m27s
</span></span><span class=line><span class=cl>kube-system   pod/kube-controller-manager-kates-control   1/1     Running   <span class=m>0</span>          8m25s
</span></span><span class=line><span class=cl>kube-system   pod/kube-flannel-ds-55st2                   1/1     Running   <span class=m>0</span>          65s
</span></span><span class=line><span class=cl>kube-system   pod/kube-proxy-8wjpp                        1/1     Running   <span class=m>0</span>          8m13s
</span></span><span class=line><span class=cl>kube-system   pod/kube-scheduler-kates-control            1/1     Running   <span class=m>0</span>          8m25s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAMESPACE     NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT<span class=o>(</span>S<span class=o>)</span>                  AGE
</span></span><span class=line><span class=cl>default       service/kubernetes   ClusterIP   10.96.0.1    &lt;none&gt;        443/TCP                  8m27s
</span></span><span class=line><span class=cl>kube-system   service/kube-dns     ClusterIP   10.96.0.10   &lt;none&gt;        53/UDP,53/TCP,9153/TCP   8m25s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAMESPACE     NAME                             DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR            AGE
</span></span><span class=line><span class=cl>kube-system   daemonset.apps/kube-flannel-ds   <span class=m>1</span>         <span class=m>1</span>         <span class=m>1</span>       <span class=m>1</span>            <span class=m>1</span>           &lt;none&gt;                   65s
</span></span><span class=line><span class=cl>kube-system   daemonset.apps/kube-proxy        <span class=m>1</span>         <span class=m>1</span>         <span class=m>1</span>       <span class=m>1</span>            <span class=m>1</span>           kubernetes.io/os<span class=o>=</span>linux   8m25s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAMESPACE     NAME                      READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span class=line><span class=cl>kube-system   deployment.apps/coredns   2/2     <span class=m>2</span>            <span class=m>2</span>           8m25s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAMESPACE     NAME                                 DESIRED   CURRENT   READY   AGE
</span></span><span class=line><span class=cl>kube-system   replicaset.apps/coredns-6d4b75cb6d   <span class=m>2</span>         <span class=m>2</span>         <span class=m>2</span>       8m13s</span></span></code></pre></div><p>And from the network side.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ubuntu@kates-control:~$ ip ro <span class=p>;</span> ip add
</span></span><span class=line><span class=cl>default via 192.168.1.1 dev ens3 proto static
</span></span><span class=line><span class=cl>10.244.0.0/24 dev cni0 proto kernel scope link src 10.244.0.1
</span></span><span class=line><span class=cl>192.168.1.0/24 dev ens3 proto kernel scope link src 192.168.1.30
</span></span><span class=line><span class=cl>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu <span class=m>65536</span> qdisc noqueue state UNKNOWN group default qlen <span class=m>1000</span>
</span></span><span class=line><span class=cl>    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
</span></span><span class=line><span class=cl>    inet 127.0.0.1/8 scope host lo
</span></span><span class=line><span class=cl>       valid_lft forever preferred_lft forever
</span></span><span class=line><span class=cl>    inet6 ::1/128 scope host
</span></span><span class=line><span class=cl>       valid_lft forever preferred_lft forever
</span></span><span class=line><span class=cl>2: ens3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class=m>1500</span> qdisc fq_codel state UP group default qlen <span class=m>1000</span>
</span></span><span class=line><span class=cl>    link/ether 00:50:02:00:01:00 brd ff:ff:ff:ff:ff:ff
</span></span><span class=line><span class=cl>    inet 192.168.1.30/24 brd 192.168.1.255 scope global ens3
</span></span><span class=line><span class=cl>       valid_lft forever preferred_lft forever
</span></span><span class=line><span class=cl>    inet6 2a02:587:e44a:d37:250:2ff:fe00:100/64 scope global dynamic mngtmpaddr noprefixroute
</span></span><span class=line><span class=cl>       valid_lft 604763sec preferred_lft 86363sec
</span></span><span class=line><span class=cl>    inet6 fe80::250:2ff:fe00:100/64 scope link
</span></span><span class=line><span class=cl>       valid_lft forever preferred_lft forever
</span></span><span class=line><span class=cl>3: flannel.1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class=m>1450</span> qdisc noqueue state UNKNOWN group default
</span></span><span class=line><span class=cl>    link/ether f2:64:03:ac:1f:68 brd ff:ff:ff:ff:ff:ff
</span></span><span class=line><span class=cl>    inet 10.244.0.0/32 scope global flannel.1
</span></span><span class=line><span class=cl>       valid_lft forever preferred_lft forever
</span></span><span class=line><span class=cl>    inet6 fe80::f064:3ff:feac:1f68/64 scope link
</span></span><span class=line><span class=cl>       valid_lft forever preferred_lft forever
</span></span><span class=line><span class=cl>4: cni0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class=m>1450</span> qdisc noqueue state UP group default qlen <span class=m>1000</span>
</span></span><span class=line><span class=cl>    link/ether e2:92:cd:73:85:3d brd ff:ff:ff:ff:ff:ff
</span></span><span class=line><span class=cl>    inet 10.244.0.1/24 brd 10.244.0.255 scope global cni0
</span></span><span class=line><span class=cl>       valid_lft forever preferred_lft forever
</span></span><span class=line><span class=cl>    inet6 fe80::e092:cdff:fe73:853d/64 scope link
</span></span><span class=line><span class=cl>       valid_lft forever preferred_lft forever
</span></span><span class=line><span class=cl>5: vethdc5600c6@if3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class=m>1450</span> qdisc noqueue master cni0 state UP group default
</span></span><span class=line><span class=cl>    link/ether f2:8f:bd:a7:dc:82 brd ff:ff:ff:ff:ff:ff link-netns cni-0155810e-5cb5-58a5-22c4-dc8038081174
</span></span><span class=line><span class=cl>    inet6 fe80::f08f:bdff:fea7:dc82/64 scope link
</span></span><span class=line><span class=cl>       valid_lft forever preferred_lft forever
</span></span><span class=line><span class=cl>6: vethe9a1a648@if3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class=m>1450</span> qdisc noqueue master cni0 state UP group default
</span></span><span class=line><span class=cl>    link/ether aa:09:c5:8c:bb:66 brd ff:ff:ff:ff:ff:ff link-netns cni-d71bf00b-ba62-2a8d-548a-9430a25d8dcd
</span></span><span class=line><span class=cl>    inet6 fe80::a809:c5ff:fe8c:bb66/64 scope link
</span></span><span class=line><span class=cl>       valid_lft forever preferred_lft forever</span></span></code></pre></div><hr><h3 class=heading-element id=add-worker-nodes><span>Add worker nodes</span>
<a href=#add-worker-nodes class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><hr><p>Let&rsquo;s go and add the two other nodes to our cluster now. We can do this either by using the init token or we could create a new one.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ubuntu@kates-control:~$ kubeadm token create --print-join-command
</span></span><span class=line><span class=cl>kubeadm join 192.168.1.30:6443 --token r8ydn9.nkbo1b94w7a6s8em --discovery-token-ca-cert-hash sha256:42a47eb0e4872ebdd7ebbd6935a6e1c42f51a67d29d80fd53098d27323c59b2e</span></span></code></pre></div><p>Now on both worker nodes.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ubuntu@kates-node-01:~$ sudo kubeadm join 192.168.1.30:6443 --token r8ydn9.nkbo1b94w7a6s8em --discovery-token-ca-cert-hash sha256:42a47eb0e4872ebdd7ebbd6935a6e1c42f51a67d29d80fd53098d27323c59b2e
</span></span><span class=line><span class=cl><span class=o>[</span>preflight<span class=o>]</span> Running pre-flight checks
</span></span><span class=line><span class=cl><span class=o>[</span>preflight<span class=o>]</span> Reading configuration from the cluster...
</span></span><span class=line><span class=cl><span class=o>[</span>preflight<span class=o>]</span> FYI: You can look at this config file with <span class=s1>&#39;kubectl -n kube-system get cm kubeadm-config -o yaml&#39;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>kubelet-start<span class=o>]</span> Writing kubelet configuration to file <span class=s2>&#34;/var/lib/kubelet/config.yaml&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>kubelet-start<span class=o>]</span> Writing kubelet environment file with flags to file <span class=s2>&#34;/var/lib/kubelet/kubeadm-flags.env&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>kubelet-start<span class=o>]</span> Starting the kubelet
</span></span><span class=line><span class=cl><span class=o>[</span>kubelet-start<span class=o>]</span> Waiting <span class=k>for</span> the kubelet to perform the TLS Bootstrap...
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>This node has joined the cluster:
</span></span><span class=line><span class=cl>* Certificate signing request was sent to apiserver and a response was received.
</span></span><span class=line><span class=cl>* The Kubelet was informed of the new secure connection details.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Run <span class=s1>&#39;kubectl get nodes&#39;</span> on the control-plane to see this node join the cluster.</span></span></code></pre></div><p>If all went well then we should have a 3 node k8s cluster &#x1f604;</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ubuntu@kates-control:~$ kubectl get nodes -owide
</span></span><span class=line><span class=cl>NAME            STATUS   ROLES           AGE   VERSION   INTERNAL-IP    EXTERNAL-IP   OS-IMAGE             KERNEL-VERSION      CONTAINER-RUNTIME
</span></span><span class=line><span class=cl>kates-control   Ready    control-plane   11m   v1.24.1   192.168.1.30   &lt;none&gt;        Ubuntu 20.04.4 LTS   5.4.0-117-generic   containerd://1.6.6
</span></span><span class=line><span class=cl>kates-node-01   Ready    &lt;none&gt;          66s   v1.24.1   192.168.1.31   &lt;none&gt;        Ubuntu 20.04.4 LTS   5.4.0-117-generic   containerd://1.6.6
</span></span><span class=line><span class=cl>kates-node-02   Ready    &lt;none&gt;          59s   v1.24.1   192.168.1.32   &lt;none&gt;        Ubuntu 20.04.4 LTS   5.4.0-117-generic   containerd://1.6.6</span></span></code></pre></div><p>Final touch is to set the <em>worker</em> role to the workers and, if you like to run pods on the control node as well, untaint the node.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ubuntu@kates-control:~$ kubectl get nodes
</span></span><span class=line><span class=cl>NAME            STATUS   ROLES           AGE     VERSION
</span></span><span class=line><span class=cl>kates-control   Ready    control-plane   4h37m   v1.24.1
</span></span><span class=line><span class=cl>kates-node-01   Ready    &lt;none&gt;          139m    v1.24.1
</span></span><span class=line><span class=cl>kates-node-02   Ready    &lt;none&gt;          138m    v1.24.1
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ubuntu@kates-control:~$ kubectl label nodes kates-node-01 kubernetes.io/role<span class=o>=</span>worker
</span></span><span class=line><span class=cl>node/kates-node-01 labeled
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ubuntu@kates-control:~$ kubectl label nodes kates-node-02 kubernetes.io/role<span class=o>=</span>worker
</span></span><span class=line><span class=cl>node/kates-node-02 labeled
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ubuntu@kates-control:~$ kubectl get nodes
</span></span><span class=line><span class=cl>NAME            STATUS   ROLES           AGE     VERSION
</span></span><span class=line><span class=cl>kates-control   Ready    control-plane   4h37m   v1.24.1
</span></span><span class=line><span class=cl>kates-node-01   Ready    worker          140m    v1.24.1
</span></span><span class=line><span class=cl>kates-node-02   Ready    worker          138m    v1.24.1
</span></span><span class=line><span class=cl>ubuntu@kates-control:~$
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Untaint the control plane to run pods if you wish</span>
</span></span><span class=line><span class=cl>ubuntu@kates-control:~$ kubectl taint nodes kates-control node-role.kubernetes.io/control-plane<span class=o>=</span>:NoSchedule- node-role.kubernetes.io/master<span class=o>=</span>:NoSchedule-
</span></span><span class=line><span class=cl>node/kates-control untainted</span></span></code></pre></div><hr><h3 class=heading-element id=testing-applications><span>Testing applications</span>
<a href=#testing-applications class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><hr><p>Let&rsquo;s deploy a test application to verify the cluster is running fine. We can create a deployment of nginx demo image with three replicas and test connectivity. The three pods will normaly be distributed across the three nodes, so we can use a Loadbalancer service to expose the deployment and check the operation.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Create a 3 replica deployment of nginx demo image</span>
</span></span><span class=line><span class=cl>ubuntu@kates-control:~$ kubectl create deployment web --image<span class=o>=</span>nginxdemos/hello  --replicas<span class=o>=</span><span class=m>3</span>  --port <span class=m>80</span>
</span></span><span class=line><span class=cl>deployment.apps/web created
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Check to see that pods are distributed across the three nodes</span>
</span></span><span class=line><span class=cl>ubuntu@kates-control:~$ kubectl get all -owide
</span></span><span class=line><span class=cl>NAME                       READY   STATUS    RESTARTS   AGE   IP           NODE            NOMINATED NODE   READINESS GATES
</span></span><span class="line hl"><span class=cl>pod/web-54b75887bb-2glrx   1/1     Running   <span class=m>0</span>          11s   10.244.2.3   kates-node-02   &lt;none&gt;           &lt;none&gt;
</span></span><span class="line hl"><span class=cl>pod/web-54b75887bb-7jrf4   1/1     Running   <span class=m>0</span>          11s   10.244.1.2   kates-node-01   &lt;none&gt;           &lt;none&gt;
</span></span><span class="line hl"><span class=cl>pod/web-54b75887bb-j76kz   1/1     Running   <span class=m>0</span>          11s   10.244.2.2   kates-node-02   &lt;none&gt;           &lt;none&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT<span class=o>(</span>S<span class=o>)</span>   AGE   SELECTOR
</span></span><span class=line><span class=cl>service/kubernetes   ClusterIP   10.96.0.1    &lt;none&gt;        443/TCP   12m   &lt;none&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                  READY   UP-TO-DATE   AVAILABLE   AGE   CONTAINERS   IMAGES             SELECTOR
</span></span><span class=line><span class=cl>deployment.apps/web   3/3     <span class=m>3</span>            <span class=m>3</span>           11s   hello        nginxdemos/hello   <span class=nv>app</span><span class=o>=</span>web
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                             DESIRED   CURRENT   READY   AGE   CONTAINERS   IMAGES             SELECTOR
</span></span><span class=line><span class=cl>replicaset.apps/web-54b75887bb   <span class=m>3</span>         <span class=m>3</span>         <span class=m>3</span>       11s   hello        nginxdemos/hello   <span class=nv>app</span><span class=o>=</span>web,pod-template-hash<span class=o>=</span>54b75887bb
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Create a LoadBalancer service</span>
</span></span><span class=line><span class=cl>ubuntu@kates-control:~$ kubectl expose deployment web --type<span class=o>=</span>LoadBalancer --name<span class=o>=</span>web-service
</span></span><span class=line><span class=cl>service/web-service exposed
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ubuntu@kates-control:~$ kubectl get svc -o wide
</span></span><span class=line><span class=cl>NAME          TYPE           CLUSTER-IP       EXTERNAL-IP   PORT<span class=o>(</span>S<span class=o>)</span>        AGE   SELECTOR
</span></span><span class=line><span class=cl>kubernetes    ClusterIP      10.96.0.1        &lt;none&gt;        443/TCP        13m   &lt;none&gt;
</span></span><span class="line hl"><span class=cl>web-service   LoadBalancer   10.101.141.116   &lt;pending&gt;     80:30721/TCP   10s   <span class=nv>app</span><span class=o>=</span>web
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Test communication to each pod</span>
</span></span><span class=line><span class=cl>ubuntu@kates-control:~$ curl -s 10.244.2.3 <span class=p>|</span> grep Server
</span></span><span class=line><span class=cl>&lt;p&gt;&lt;span&gt;Server<span class=p>&amp;</span>nbsp<span class=p>;</span>address:&lt;/span&gt; &lt;span&gt;10.244.2.3:80&lt;/span&gt;&lt;/p&gt;
</span></span><span class=line><span class=cl>&lt;p&gt;&lt;span&gt;Server<span class=p>&amp;</span>nbsp<span class=p>;</span>name:&lt;/span&gt; &lt;span&gt;web-54b75887bb-2glrx&lt;/span&gt;&lt;/p&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ubuntu@kates-control:~$ curl -s 10.244.1.2 <span class=p>|</span> grep Server
</span></span><span class=line><span class=cl>&lt;p&gt;&lt;span&gt;Server<span class=p>&amp;</span>nbsp<span class=p>;</span>address:&lt;/span&gt; &lt;span&gt;10.244.1.2:80&lt;/span&gt;&lt;/p&gt;
</span></span><span class=line><span class=cl>&lt;p&gt;&lt;span&gt;Server<span class=p>&amp;</span>nbsp<span class=p>;</span>name:&lt;/span&gt; &lt;span&gt;web-54b75887bb-7jrf4&lt;/span&gt;&lt;/p&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ubuntu@kates-control:~$ curl -s 10.244.2.2 <span class=p>|</span> grep Server
</span></span><span class=line><span class=cl>&lt;p&gt;&lt;span&gt;Server<span class=p>&amp;</span>nbsp<span class=p>;</span>address:&lt;/span&gt; &lt;span&gt;10.244.2.2:80&lt;/span&gt;&lt;/p&gt;
</span></span><span class=line><span class=cl>&lt;p&gt;&lt;span&gt;Server<span class=p>&amp;</span>nbsp<span class=p>;</span>name:&lt;/span&gt; &lt;span&gt;web-54b75887bb-j76kz&lt;/span&gt;&lt;/p&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Now test on the exposed port on the k8s hosts </span>
</span></span><span class=line><span class=cl>ubuntu@kates-control:~$ <span class=k>for</span> server in kates-control kates-node-01 kates-node-02 <span class=p>;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>&gt;     <span class=k>do</span>  <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>&gt;         <span class=nb>echo</span> <span class=s2>&#34;*** </span><span class=nv>$server</span><span class=s2> ***&#34;</span> <span class=p>;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>&gt;         <span class=k>for</span> i in <span class=o>{</span>1..5<span class=o>}</span><span class=p>;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>&gt;         <span class=k>do</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>&gt;             curl -s <span class=nv>$server</span>:30721 <span class=p>|</span> grep address <span class=p>;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>&gt;         <span class=k>done</span> <span class=p>;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>&gt;     <span class=k>done</span>
</span></span><span class=line><span class=cl>*** kates-control ***
</span></span><span class=line><span class=cl>&lt;p&gt;&lt;span&gt;Server<span class=p>&amp;</span>nbsp<span class=p>;</span>address:&lt;/span&gt; &lt;span&gt;10.244.2.3:80&lt;/span&gt;&lt;/p&gt;
</span></span><span class=line><span class=cl>&lt;p&gt;&lt;span&gt;Server<span class=p>&amp;</span>nbsp<span class=p>;</span>address:&lt;/span&gt; &lt;span&gt;10.244.2.3:80&lt;/span&gt;&lt;/p&gt;
</span></span><span class=line><span class=cl>&lt;p&gt;&lt;span&gt;Server<span class=p>&amp;</span>nbsp<span class=p>;</span>address:&lt;/span&gt; &lt;span&gt;10.244.2.2:80&lt;/span&gt;&lt;/p&gt;
</span></span><span class=line><span class=cl>&lt;p&gt;&lt;span&gt;Server<span class=p>&amp;</span>nbsp<span class=p>;</span>address:&lt;/span&gt; &lt;span&gt;10.244.2.2:80&lt;/span&gt;&lt;/p&gt;
</span></span><span class=line><span class=cl>&lt;p&gt;&lt;span&gt;Server<span class=p>&amp;</span>nbsp<span class=p>;</span>address:&lt;/span&gt; &lt;span&gt;10.244.2.3:80&lt;/span&gt;&lt;/p&gt;
</span></span><span class=line><span class=cl>*** kates-node-01 ***
</span></span><span class=line><span class=cl>&lt;p&gt;&lt;span&gt;Server<span class=p>&amp;</span>nbsp<span class=p>;</span>address:&lt;/span&gt; &lt;span&gt;10.244.2.3:80&lt;/span&gt;&lt;/p&gt;
</span></span><span class=line><span class=cl>&lt;p&gt;&lt;span&gt;Server<span class=p>&amp;</span>nbsp<span class=p>;</span>address:&lt;/span&gt; &lt;span&gt;10.244.2.3:80&lt;/span&gt;&lt;/p&gt;
</span></span><span class=line><span class=cl>&lt;p&gt;&lt;span&gt;Server<span class=p>&amp;</span>nbsp<span class=p>;</span>address:&lt;/span&gt; &lt;span&gt;10.244.1.2:80&lt;/span&gt;&lt;/p&gt;
</span></span><span class=line><span class=cl>&lt;p&gt;&lt;span&gt;Server<span class=p>&amp;</span>nbsp<span class=p>;</span>address:&lt;/span&gt; &lt;span&gt;10.244.1.2:80&lt;/span&gt;&lt;/p&gt;
</span></span><span class=line><span class=cl>&lt;p&gt;&lt;span&gt;Server<span class=p>&amp;</span>nbsp<span class=p>;</span>address:&lt;/span&gt; &lt;span&gt;10.244.2.2:80&lt;/span&gt;&lt;/p&gt;
</span></span><span class=line><span class=cl>*** kates-node-02 ***
</span></span><span class=line><span class=cl>&lt;p&gt;&lt;span&gt;Server<span class=p>&amp;</span>nbsp<span class=p>;</span>address:&lt;/span&gt; &lt;span&gt;10.244.1.2:80&lt;/span&gt;&lt;/p&gt;
</span></span><span class=line><span class=cl>&lt;p&gt;&lt;span&gt;Server<span class=p>&amp;</span>nbsp<span class=p>;</span>address:&lt;/span&gt; &lt;span&gt;10.244.2.3:80&lt;/span&gt;&lt;/p&gt;
</span></span><span class=line><span class=cl>&lt;p&gt;&lt;span&gt;Server<span class=p>&amp;</span>nbsp<span class=p>;</span>address:&lt;/span&gt; &lt;span&gt;10.244.1.2:80&lt;/span&gt;&lt;/p&gt;
</span></span><span class=line><span class=cl>&lt;p&gt;&lt;span&gt;Server<span class=p>&amp;</span>nbsp<span class=p>;</span>address:&lt;/span&gt; &lt;span&gt;10.244.2.2:80&lt;/span&gt;&lt;/p&gt;
</span></span><span class=line><span class=cl>&lt;p&gt;&lt;span&gt;Server<span class=p>&amp;</span>nbsp<span class=p>;</span>address:&lt;/span&gt; &lt;span&gt;10.244.2.2:80&lt;/span&gt;&lt;/p&gt;</span></span></code></pre></div><p>Perfect! It is working &#x1f604;
You can always test it from multiple web browser tabs pointing to <strong>http://&lt;k8s-node>:30721/</strong> and refreshing several times</p><hr><figure><a class=lightgallery href=/posts/kube-my-router-pt2/nginx.png title=/posts/kube-my-router-pt2/nginx.png data-thumbnail=/posts/kube-my-router-pt2/nginx.png data-sub-html="<h2>LoadBalancer testing of nginxdemos images</h2>"><img loading=lazy src=/posts/kube-my-router-pt2/nginx.png alt=/posts/kube-my-router-pt2/nginx.png height=895 width=400></a><figcaption class=image-caption>LoadBalancer testing of nginxdemos images</figcaption></figure><hr><h3 class=heading-element id=references-and-influences><span>References and influences</span>
<a href=#references-and-influences class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><ul><li><a href=https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/ target=_blank rel="external nofollow noopener noreferrer">Bootstrapping clusters with kubeadm</a></li><li><a href=https://computingforgeeks.com/deploy-kubernetes-cluster-on-ubuntu-with-kubeadm/ target=_blank rel="external nofollow noopener noreferrer">Install Kubernetes Cluster on Ubuntu 20.04 with kubeadm</a></li><li><a href=https://kubesimplify.com/kubernetes-containerd-setup target=_blank rel="external nofollow noopener noreferrer">Kubernetes 1.23 + containerd</a></li><li><a href=https://learnk8s.io/kubernetes-network-packets target=_blank rel="external nofollow noopener noreferrer">Tracing the path of network traffic in Kubernetes</a></li><li><a href=https://kubernetes.io/docs/tutorials/stateless-application/expose-external-ip-address/ target=_blank rel="external nofollow noopener noreferrer">Exposing an External IP Address to Access an Application in a Cluster</a></li></ul><hr><h2 class=heading-element id=last-part---installing-and-testing-kne><span><a href=/posts/kube-my-router-pt3/>Last Part - Installing and testing KNE</a></span>
<a href=#last-part---installing-and-testing-kne class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><hr><h2 class=heading-element id=outro><span><a href=/posts/kube-my-router-pt3/#outro>Outro</a></span>
<a href=#outro class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><hr></div><hr class=awesome-hr><h2 id=see-also>Related Content</h2><ul><li><a href=/posts/kube-my-router-pt1/ title="Kube My Router Up! - Part One">Kube My Router Up! - Part One</a></li></ul><div class=collection-card><div class="collection-title text-secondary">Included in <a href=/collections/kube-my-router-up/><i class="fa-solid fa-layer-group fa-fw" aria-hidden=true></i> <span>Collection・Kube My Router Up!</span></span></a> 3</div><div class=collection-nav><a href=/posts/kube-my-router-pt1/ class=collection-nav-item rel=prev title="Kube My Router Up! - Part One"><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i><span>Kube My Router Up! - Part One</span>
</a><a href=/posts/kube-my-router-pt3/ class=collection-nav-item rel=next title="Kube My Router Up! - Last Part"><span>Kube My Router Up! - Last Part</span><i class="fa-solid fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="Updated on 2022-05-31 12:40:24">Updated on 2022-05-31&nbsp;</span></div><div class=post-info-license><span><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank>CC BY-NC-SA 4.0</a></span></div></div><div class=post-info-line><div class=post-info-md><span><a href=/posts/kube-my-router-pt2/index.md title="Read Markdown" class=link-to-markdown>Read Markdown</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on X" data-sharer=twitter data-url=https://net4fungr.github.io/posts/kube-my-router-pt2/ data-title="Kube My Router Up! - Part Two" data-via=mkaliotis data-hashtags=k8s,kubeadm,Ubuntu><i class="fa-brands fa-x-twitter fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="Share on Linkedin" data-sharer=linkedin data-url=https://net4fungr.github.io/posts/kube-my-router-pt2/><i class="fa-brands fa-linkedin fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="Share on Reddit" data-sharer=reddit data-url=https://net4fungr.github.io/posts/kube-my-router-pt2/><i class="fa-brands fa-reddit fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fa-solid fa-tags fa-fw me-1" aria-hidden=true></i><a href=/tags/k8s/ class=post-tag title="Tags - K8s">K8s</a><a href=/tags/kubeadm/ class=post-tag title="Tags - Kubeadm">Kubeadm</a><a href=/tags/ubuntu/ class=post-tag title="Tags - Ubuntu">Ubuntu</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/kube-my-router-pt1/ class=post-nav-item rel=prev title="Kube My Router Up! - Part One"><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i>Kube My Router Up! - Part One</a><a href=/posts/kube-my-router-pt3/ class=post-nav-item rel=next title="Kube My Router Up! - Last Part">Kube My Router Up! - Last Part<i class="fa-solid fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div id=comments><div id=giscus class=comment><script src=https://giscus.app/client.js data-repo=Net4FunGR/net4fungr.github.io data-repo-id=R_kgDOGLZFKQ data-category="Blog Comments" data-category-id=DIC_kwDOGLZFKc4Cf1aA data-mapping=title data-strict=0 data-theme=preferred_color_scheme data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-lang=en data-loading=lazy crossorigin=anonymous async defer></script></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://giscus.app/ rel="external nofollow noopener noreferrer">giscus</a>.</noscript></div></article><aside class=toc id=toc-auto aria-label=Contents><h2 class=toc-title>Contents&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden=true></i></h2><div class="toc-content always-active" id=toc-content-auto></div></aside></main><footer class=footer><div class=footer-container><div class="footer-line powered">Powered by <a href=https://gohugo.io/ target=_blank rel="external nofollow noopener noreferrer" title="Hugo 0.147.2"><img class=hugo-icon src=/images/hugo.min.svg alt="Hugo logo"> Hugo</a> | Theme - <a href=https://github.com/hugo-fixit/FixIt target=_blank rel=external title="FixIt v0.3.20"><img class=fixit-icon src=/images/fixit.min.svg alt="FixIt logo"> FixIt</a></div><div class="footer-line copyright" itemscope itemtype=http://schema.org/CreativeWork><i class="fa-regular fa-copyright fa-fw" aria-hidden=true></i>
<span itemprop=copyrightYear>2021 - 2025</span><span class=author itemprop=copyrightHolder>
<a href=https://github.com/becos76 target=_blank rel="external nofollow noopener noreferrer">becos76</a></span><span class="license footer-divider"><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div class=widgets><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role=button aria-label="Back to Top"><i class="fa-solid fa-arrow-up fa-fw" aria-hidden=true></i><span class=variant-numeric>0%</span></div><div class="fixed-button view-comments d-none" role=button aria-label="View Comments"><i class="fa-solid fa-comment fa-fw" aria-hidden=true></i></div></div><a href=https://github.com/becos76/ title="Visit my GitHub" target=_blank rel="external nofollow" class="github-corner right d-none-mobile"><svg viewBox="0 0 250 250" aria-hidden="true" width="56" height="56"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><div id=mask></div><div class=reading-progress-bar style=left:0;top:0;--bg-progress:orange;--bg-progress-dark:grey></div><noscript><div class=noscript-warning>This website works best with JavaScript enabled.</div></noscript></div><link rel=stylesheet href=/lib/lightgallery/css/lightgallery-bundle.min.css><link rel=preload href=/lib/katex/katex.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/katex/katex.min.css></noscript><link rel=stylesheet href=/lib/pace/themes/blue/pace-theme-minimal.css><script src=/lib/autocomplete/autocomplete.min.js defer></script><script src=/lib/fuse/fuse.min.js defer></script><script src=/lib/twemoji/twemoji.min.js defer></script><script src=/lib/lightgallery/lightgallery.min.js defer></script><script src=/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.js defer></script><script src=/lib/lightgallery/plugins/zoom/lg-zoom.min.js defer></script><script src=/lib/sharer/sharer.min.js async defer></script><script src=/lib/typeit/index.umd.js defer></script><script src=/lib/katex/katex.min.js defer></script><script src=/lib/katex/auto-render.min.js defer></script><script src=/lib/katex/copy-tex.min.js defer></script><script src=/lib/katex/mhchem.min.js defer></script><script src=/lib/pace/pace.min.js async defer></script><script>window.config={code:{maxShownLines:-1},comment:{enable:!0,expired:!1,giscus:{darkTheme:"dark",lightTheme:"light",origin:"https://giscus.app"}},lightgallery:!0,math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{distance:100,findAllMatches:!1,fuseIndexURL:"/search.json",highlightTag:"em",ignoreFieldNorm:!1,ignoreLocation:!1,isCaseSensitive:!1,location:0,maxResultLength:10,minMatchCharLength:3,noResultsFound:"No results found",snippetLength:30,threshold:.3,type:"fuse",useExtendedSearch:!1},twemoji:!0,typeit:{cursorChar:"|",cursorSpeed:1e3,duration:-1,loop:!1,speed:50},version:"v0.3.20"}</script><script src=/js/theme.min.js defer></script></body></html>