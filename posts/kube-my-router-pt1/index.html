<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><title>Kube My Router Up! - Part One</title><meta name=author content=" "><meta name=description content="This is the first part of a three-part blog post around google&rsquo;s Kubernetes based Network Emulation (KNE) software. In this part, I am showing how to create the VM nodes in EVE-NG using cloud images that will later host the k8s cluster."><meta name=keywords content='EVE-NG,Ubuntu'><meta itemprop=name content="Kube my router up! - Part One"><meta itemprop=description content="This is the first part of a three-part blog post around google’s Kubernetes based Network Emulation (KNE) software. In this part, I am showing how to create the VM nodes in EVE-NG using cloud images that will later host the k8s cluster."><meta itemprop=datePublished content="2022-05-28T10:36:24+03:00"><meta itemprop=dateModified content="2022-05-28T10:36:24+03:00"><meta itemprop=wordCount content="1466"><meta itemprop=image content="https://net4fungr.github.io/posts/kube-my-router-pt1/featured-image.png"><meta itemprop=keywords content="EVE-NG,Ubuntu"><meta property="og:url" content="https://net4fungr.github.io/posts/kube-my-router-pt1/"><meta property="og:site_name" content="Becos :: Back Blog"><meta property="og:title" content="Kube my router up! - Part One"><meta property="og:description" content="This is the first part of a three-part blog post around google’s Kubernetes based Network Emulation (KNE) software. In this part, I am showing how to create the VM nodes in EVE-NG using cloud images that will later host the k8s cluster."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-05-28T10:36:24+03:00"><meta property="article:modified_time" content="2022-05-28T10:36:24+03:00"><meta property="article:tag" content="EVE-NG"><meta property="article:tag" content="Ubuntu"><meta property="og:image" content="https://net4fungr.github.io/posts/kube-my-router-pt1/featured-image.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://net4fungr.github.io/posts/kube-my-router-pt1/featured-image.png"><meta name=twitter:title content="Kube my router up! - Part One"><meta name=twitter:description content="This is the first part of a three-part blog post around google’s Kubernetes based Network Emulation (KNE) software. In this part, I am showing how to create the VM nodes in EVE-NG using cloud images that will later host the k8s cluster."><meta name=twitter:site content="@mkaliotis"><meta name=twitter:creator content="@mkaliotis"><meta name=application-name content="Becos :: Back Blog"><meta name=apple-mobile-web-app-title content="Becos :: Back Blog"><meta name=theme-color data-light=#f8f8f8 data-dark=#252627 content="#f8f8f8"><meta name=msapplication-TileColor content="#da532c"><link rel=canonical type=text/html href=https://net4fungr.github.io/posts/kube-my-router-pt1/ title="Kube my router up! - Part One - Becos :: Back Blog"><link rel=prev type=text/html href=https://net4fungr.github.io/posts/mutable-immutable/ title="Mutable vs. Immutable"><link rel=next type=text/html href=https://net4fungr.github.io/posts/kube-my-router-pt2/ title="Kube my router up! - Part Two"><link rel=alternate type=text/markdown href=https://net4fungr.github.io/posts/kube-my-router-pt1/index.md title="Kube my router up! - Part One - Becos :: Back Blog"><link rel=stylesheet href=/css/config.min.css><link rel=stylesheet href=/css/style.min.css><link rel=preload href=/lib/fontawesome-free/all.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/fontawesome-free/all.min.css></noscript><link rel=preload href=/lib/animate/animate.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/animate/animate.min.css></noscript><meta name=google-site-verification content="m_enMQYWx1a1cSKPfRT_00wHfqT8ir4PZSBPyeaIH-o"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Kube my router up! - Part One","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/net4fungr.github.io\/posts\/kube-my-router-pt1\/"},"image":[{"@type":"ImageObject","url":"https:\/\/net4fungr.github.io\/posts\/kube-my-router-pt1\/featured-image.png","width":310,"height":163}],"genre":"posts","keywords":"EVE-NG, Ubuntu","wordcount":1466,"url":"https:\/\/net4fungr.github.io\/posts\/kube-my-router-pt1\/","datePublished":"2022-05-28T10:36:24+03:00","dateModified":"2022-05-28T10:36:24+03:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":" "},"description":""}</script><script src=/js/head/color-scheme.min.js></script></head><body data-instant-intensity=viewport data-header-desktop=sticky data-header-mobile=auto><div class=wrapper data-page-style=narrow><header class="desktop animate__faster" id=header-desktop><div class=header-wrapper data-github-corner=right><div class=header-title><a href=/ title="Becos :: Back Blog"><img class=logo src=/images/pyrtr_small.png alt="Becos :: Back Blog" height=32 width=32><span class=header-title-pre><</span><span class=header-title-text>...ssh and blog...</span><span class=header-title-post>/></span></a><span class="typeit header-subtitle"><template>revamped!</template></span></div><nav><ul class=menu><li class=menu-item><a class=menu-link href=/categories/ title="Posts Organised by Category"><i class="fa-solid fa-folder-tree fa-sm" aria-hidden=true></i> Categories</a></li><li class=menu-item><a class=menu-link href=/collections/ title="Multipart Posts"><i class="fa-solid fa-layer-group fa-sm" aria-hidden=true></i> Collections</a></li><li class=menu-item><a class=menu-link href=/archives/ title="All My Posts"><i class="fa-solid fa-archive fa-sm" aria-hidden=true></i> Archives</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-sm" aria-hidden=true></i> Tags</a></li><li class=menu-item><a class=menu-link href=https://becos76.github.io title="About Me" rel="noopener noreferrer" target=_blank><i class="fa-solid fa-signature fa-sm" aria-hidden=true></i> About</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id=search-desktop><input type=text placeholder="Search titles or contents ..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fa-solid fa-search" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fa-solid fa-times-circle" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-spin" aria-hidden=true></i></span></li><li class="menu-item theme-switch" role=button aria-label="Switch Theme" title="Switch Theme"><i class="fa-solid fa-adjust" aria-hidden=true></i></li></ul></nav></div></header><header class="mobile animate__faster" id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Becos :: Back Blog"><img class=logo src=/images/pyrtr_small.png alt="Becos :: Back Blog" height=26 width=26><span class=header-title-pre><</span><span class=header-title-text>...ssh and blog...</span><span class=header-title-post>/></span></a><span class="typeit header-subtitle"><template>revamped!</template></span></div><div class=theme-switch role=button aria-label="Switch Theme"><i class="fa-solid fa-adjust" aria-hidden=true></i></div><div class=menu-toggle id=menu-toggle-mobile role=button aria-labelledby=menu-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents ..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fa-solid fa-search" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fa-solid fa-times-circle" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></li><li class=menu-item><a class=menu-link href=/categories/ title="Posts Organised by Category"><i class="fa-solid fa-folder-tree fa-sm" aria-hidden=true></i> Categories</a></li><li class=menu-item><a class=menu-link href=/collections/ title="Multipart Posts"><i class="fa-solid fa-layer-group fa-sm" aria-hidden=true></i> Collections</a></li><li class=menu-item><a class=menu-link href=/archives/ title="All My Posts"><i class="fa-solid fa-archive fa-sm" aria-hidden=true></i> Archives</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-sm" aria-hidden=true></i> Tags</a></li><li class=menu-item><a class=menu-link href=https://becos76.github.io title="About Me" rel="noopener noreferrer" target=_blank><i class="fa-solid fa-signature fa-sm" aria-hidden=true></i> About</a></li><li class="menu-item menu-system"></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=fi-container><aside class="aside-collection animate__animated animate__fadeIn animate__faster" aria-label=Collections><div class="details collection-details open"><div class="details-summary collection-summary"><i class="fa-solid fa-layer-group" aria-hidden=true></i>
<span class=collection-name title=Collections>Kube My Router Up!</span>
<span class=collection-count>3</span><i class="details-icon fa-solid fa-angle-right" aria-hidden=true></i></div><div class="details-content collection-content"><nav><ul class=collection-list><li class=collection-item><span class=active title="Kube My Router Up! - Part One">Kube My Router Up! - Part One</span></li><li class=collection-item><a href=/posts/kube-my-router-pt2/ title="Kube My Router Up! - Part Two">Kube My Router Up! - Part Two</a></li><li class=collection-item><a href=/posts/kube-my-router-pt3/ title="Kube My Router Up! - Last Part">Kube My Router Up! - Last Part</a></li></ul><div class=collection-nav-simple><i class="fa-solid fa-angle-left collection-nav-item text-secondary" aria-hidden=true></i><span class=text-secondary>1/3</span><a href=/posts/kube-my-router-pt2/ class=collection-nav-item rel=next title="Kube My Router Up! - Part Two"><i class="fa-solid fa-angle-right" aria-hidden=true></i></a></div></nav></div></div></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span>Kube My Router Up! - Part One</span></h1><p class="single-subtitle animate__animated animate__fadeIn">Deploy cloud image in EVE-NG and prepare VMs</p></div><div class=post-meta><div class=post-meta-line><span class=post-author><span class=author><i class="fa-solid fa-user-circle" aria-hidden=true></i>
</span></span><span class=post-included-in>&nbsp;included in <a href=/categories/art-of-labbing/ class=post-category title="Category - Art of Labbing"><i class="fa-regular fa-folder" aria-hidden=true></i> Art of Labbing</a> and <a href=/collections/kube-my-router-up/ class=post-collection title="Collection - Kube My Router Up!"><i class="fa-solid fa-layer-group" aria-hidden=true></i> Kube My Router Up!</a></span></div><div class=post-meta-line><span title="published on 2022-05-28 10:36:24"><i class="fa-solid fa-calendar-days me-1" aria-hidden=true></i><time datetime=2022-05-28>2022-05-28</time></span>&nbsp;<span title="1466 words"><i class="fa-solid fa-pencil-alt me-1" aria-hidden=true></i>About 1500 words</span>&nbsp;<span><i class="fa-regular fa-clock me-1" aria-hidden=true></i>7 minutes</span>&nbsp;</div></div><div class=featured-image><img loading=eager src=/posts/kube-my-router-pt1/featured-image.png sizes="(max-width: 680px) 100vw, (max-width: 960px) 80vw, (max-width: 1440px) 56vw, 800px" alt=/posts/kube-my-router-pt1/featured-image.png height=163 width=310></div><div class="details toc" id=toc-static data-kept=false><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fa-solid fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#intro>Intro</a></li><li><a href=#part-one---setting-up-the-vms>Part One - Setting up the VMs</a><ul><li><a href=#the-intent>The Intent</a></li><li><a href=#prepare-ubuntu-base-image-in-eve-ng>Prepare Ubuntu base image in EVE-NG</a></li><li><a href=#install-cloud-image-utilities-and-prepare-the-seed-file>Install cloud-image utilities and prepare the seed file</a></li><li><a href=#build-the-vm-topology-in-eve-ng>Build the VM topology in EVE-NG</a></li><li><a href=#start-the-labs-and-perform-initial-configuration>Start the labs and perform initial configuration</a></li><li><a href=#references-and-influences>References and influences</a></li></ul></li><li><a href=#part-two---deploying-the-k8s-cluster-with-kubeadm>Part Two - Deploying the k8s cluster with kubeadm</a></li><li><a href=#last-part---installing-and-testing-kne>Last Part - Installing and testing KNE</a></li><li><a href=#outro>Outro</a></li></ul></nav></div></div><div class=content id=content><h2 class=heading-element id=intro><span>Intro</span>
<a href=#intro class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><hr><p>While I was ramping up my skills in k8s, I bumped into google&rsquo;s Kubernetes based Network Emulation (<a href=https://github.com/google/kne target=_blank rel="external nofollow noopener noreferrer">KNE</a>), and since I&rsquo;ve been a fool for network emulation software over the last twenty years, I knew I had to give it a go and see where it can get me. I first heard of KNE during episode #015 of this <a href=https://anchor.fm/netauto-hangout target=_blank rel="external nofollow noopener noreferrer">podcast</a> and it seemed very promising to me since it is a way to spin up network topologies from devices running in containers orchestrated by a kubernetes cluster that, guess what, can span more than one host.</p><p>So, in these series of posts I will try to document my experiences setting it up and having fun with it &#x1f604; since up to now there is too little documentation around it and also I think this <a href=https://blog.itsalwaysthe.network/posts/kubernetes-based-network-emulation/ target=_blank rel="external nofollow noopener noreferrer">blog post</a> was the first to cover a basic orientation but still it covers running it inside a kind k8s node, i.e. in a container, where as my intent was to have the k8s spanning more than one machine since network devices are expensive in resources and my home lab is limited to 2x32GB EVE-NG servers.</p><ul><li><a href=/posts/kube-my-router-pt1/>Part One - Setting up the k8s VMs in EVE-NG</a></li><li><a href=/posts/kube-my-router-pt2/>Part Two - Deploying the k8s cluster with kubeadm</a></li><li><a href=/posts/kube-my-router-pt3/>Last Part - Installing and testing KNE</a></li></ul><hr><h2 class=heading-element id=part-one---setting-up-the-vms><span>Part One - Setting up the VMs</span>
<a href=#part-one---setting-up-the-vms class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><hr><h3 class=heading-element id=the-intent><span>The Intent</span>
<a href=#the-intent class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><ul><li>EVE-NG for hosting linux VMs</li><li>Ubuntu 20.04 cloud image as base</li><li>2xEVE-NG servers, 2.0.3-112 community edition - 3 VMs in total</li><li>Deployment of 3xLinux VMs for our k8s cluster</li></ul><hr><p>Well the first step towards testing KNE is to set up a k8s cluster. I have two EVE-NG bare metal servers at home so I could spin up three VMs split in those two servers of 32GM RAM each. I&rsquo;ve chosen Ubuntu 20.04 linux flavor and decided to start by deploying the VMs using the cloud-image files. The approach followed here is to download the cloud image in both EVE-NG servers and create a seed file in order to pass the user password during first boot. This will be used as the base ubuntu image for all VMs. Finally, once the base VM is ready, the topology can be created and all the VMs can be brought up and configured with the appropriate settings.</p><hr><h3 class=heading-element id=prepare-ubuntu-base-image-in-eve-ng><span>Prepare Ubuntu base image in EVE-NG</span>
<a href=#prepare-ubuntu-base-image-in-eve-ng class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><hr><p>Download Ubuntu 20.04 cloud image and place it into a temporary directory on the first server, optionally, verifying the md5sum.</p><div class="code-block highlight line-nos-hidden" data-mode=classic data-copyable=true><div class="code-header language-bash"><span class=code-title><i class="arrow fa-solid fa-chevron-down" aria-hidden=true></i></span><span class=ellipses-btn aria-label="Show more options" role=button><i class="fa-solid fa-ellipsis-h" aria-hidden=true></i></span><span class=line-nos-btn aria-label="Toggle line numbers" role=button title="Toggle line numbers"><i class="fa-solid fa-list-ol" aria-hidden=true></i></span><span class=line-wrap-btn aria-label="Toggle code wrap" role=button title="Toggle code wrap"><i class="fa-solid fa-right-left" aria-hidden=true></i></span><span class=copy-btn aria-label="Copy to clipboard" role=button title="Copy to clipboard"><i class="fa-regular fa-clone" aria-hidden=true></i></span></div><div class=code-wrapper data-max=10 data-line-digit=2 style=--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>root@eve-01# mkdir -p /opt/cloud <span class=o>&amp;&amp;</span> <span class=nb>cd</span> !$
</span></span><span class=line><span class=cl>mkdir -p /opt/cloud <span class=o>&amp;&amp;</span> <span class=nb>cd</span> /opt/cloud/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>root@eve-01# wget https://cloud-images.ubuntu.com/focal/current/focal-server-cloudimg-amd64.img
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt; ...omitted... &gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>root@eve-01# ll
</span></span><span class=line><span class=cl>total <span class=m>581388</span>
</span></span><span class=line><span class=cl>drwxr-xr-x  <span class=m>2</span> root root      <span class=m>4096</span> May <span class=m>29</span> 21:19 ./
</span></span><span class=line><span class=cl>drwxr-xr-x <span class=m>16</span> root root      <span class=m>4096</span> May <span class=m>29</span> 21:19 ../
</span></span><span class=line><span class=cl>-rw-r--r--  <span class=m>1</span> root root <span class=m>595329024</span> May <span class=m>24</span> 01:51 focal-server-cloudimg-amd64.img
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>root@eve-01# curl -ks https://cloud-images.ubuntu.com/focal/current/MD5SUMS  <span class=p>|</span> md5sum -c --ignore-missing
</span></span><span class=line><span class=cl>focal-server-cloudimg-amd64.img: OK</span></span></code></pre></div><div class=code-expand-btn aria-label="Expand or collapse code block" role=button><i class="fa-solid fa-angles-down" aria-hidden=true></i></div></div><p>Copy the image to the appropriate <strong>linux-</strong> directory of EVE-NG in so that is categorised as a linux image. You can resize the image to your linking as well.</p><div class="code-block highlight line-nos-hidden" data-mode=classic data-copyable=true><div class="code-header language-bash"><span class=code-title><i class="arrow fa-solid fa-chevron-down" aria-hidden=true></i></span><span class=ellipses-btn aria-label="Show more options" role=button><i class="fa-solid fa-ellipsis-h" aria-hidden=true></i></span><span class=line-nos-btn aria-label="Toggle line numbers" role=button title="Toggle line numbers"><i class="fa-solid fa-list-ol" aria-hidden=true></i></span><span class=line-wrap-btn aria-label="Toggle code wrap" role=button title="Toggle code wrap"><i class="fa-solid fa-right-left" aria-hidden=true></i></span><span class=copy-btn aria-label="Copy to clipboard" role=button title="Copy to clipboard"><i class="fa-regular fa-clone" aria-hidden=true></i></span></div><div class=code-wrapper data-max=10 data-line-digit=2 style=--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>root@eve-01# mkdir -p /opt/unetlab/addons/qemu/linux-focal-server-cloudimg/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>root@eve-01# cp focal-server-cloudimg-amd64.img !<span class=nv>$hda</span>.qcow2
</span></span><span class=line><span class=cl>cp focal-server-cloudimg-amd64.img /opt/unetlab/addons/qemu/linux-focal-server-cloudimg/hda.qcow2
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>root@eve-01# <span class=nb>cd</span> /opt/unetlab/addons/qemu/linux-focal-server-cloudimg/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>root@eve-01# ll
</span></span><span class=line><span class=cl>total <span class=m>581384</span>
</span></span><span class=line><span class=cl>drwxr-xr-x  <span class=m>2</span> root root      <span class=m>4096</span> May <span class=m>29</span> 21:46 ./
</span></span><span class=line><span class=cl>drwxr-xr-x <span class=m>12</span> root root      <span class=m>4096</span> May <span class=m>29</span> 21:45 ../
</span></span><span class=line><span class=cl>-rw-r--r--  <span class=m>1</span> root root <span class=m>595329024</span> May <span class=m>29</span> 21:46 hda.qcow2
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>root@eve-01# qemu-img info hda.qcow2
</span></span><span class=line><span class=cl>image: hda.qcow2
</span></span><span class=line><span class=cl>file format: qcow2
</span></span><span class=line><span class=cl>virtual size: 2.2G <span class=o>(</span><span class=m>2361393152</span> bytes<span class=o>)</span>
</span></span><span class=line><span class=cl>disk size: 568M
</span></span><span class=line><span class=cl>cluster_size: <span class=m>65536</span>
</span></span><span class=line><span class=cl>Format specific information:
</span></span><span class=line><span class=cl>    compat: 0.10
</span></span><span class=line><span class=cl>    refcount bits: <span class=m>16</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>root@eve-01# qemu-img resize hda.qcow2 50G
</span></span><span class=line><span class=cl>Image resized.
</span></span><span class=line><span class=cl>root@eve-01# qemu-img info hda.qcow2
</span></span><span class=line><span class=cl>image: hda.qcow2
</span></span><span class=line><span class=cl>file format: qcow2
</span></span><span class=line><span class=cl>virtual size: 50G <span class=o>(</span><span class=m>53687091200</span> bytes<span class=o>)</span>
</span></span><span class=line><span class=cl>disk size: 568M
</span></span><span class=line><span class=cl>cluster_size: <span class=m>65536</span>
</span></span><span class=line><span class=cl>Format specific information:
</span></span><span class=line><span class=cl>    compat: 0.10
</span></span><span class=line><span class=cl>    refcount bits: <span class=m>16</span></span></span></code></pre></div><div class=code-expand-btn aria-label="Expand or collapse code block" role=button><i class="fa-solid fa-angles-down" aria-hidden=true></i></div></div><hr><h3 class=heading-element id=install-cloud-image-utilities-and-prepare-the-seed-file><span>Install cloud-image utilities and prepare the seed file</span>
<a href=#install-cloud-image-utilities-and-prepare-the-seed-file class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><hr><p>Install the required package.</p><div class="code-block highlight line-nos-hidden" data-mode=classic data-copyable=true><div class="code-header language-bash"><span class=code-title><i class="arrow fa-solid fa-chevron-down" aria-hidden=true></i></span><span class=ellipses-btn aria-label="Show more options" role=button><i class="fa-solid fa-ellipsis-h" aria-hidden=true></i></span><span class=line-nos-btn aria-label="Toggle line numbers" role=button title="Toggle line numbers"><i class="fa-solid fa-list-ol" aria-hidden=true></i></span><span class=line-wrap-btn aria-label="Toggle code wrap" role=button title="Toggle code wrap"><i class="fa-solid fa-right-left" aria-hidden=true></i></span><span class=copy-btn aria-label="Copy to clipboard" role=button title="Copy to clipboard"><i class="fa-regular fa-clone" aria-hidden=true></i></span></div><div class=code-wrapper data-max=10 data-line-digit=1 style=--fi-max-shown-lines:10;--fi-line-digit:1;--fi-line-start:1><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>root@eve-01# <span class=nb>cd</span> /opt/cloud/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>root@eve-01# apt install cloud-image-utils
</span></span><span class=line><span class=cl>&lt; ...omitted...&gt;</span></span></code></pre></div></div><p>Prepare the seed file and copy it to the base image location.</p><div class="code-block highlight line-nos-hidden" data-mode=classic data-copyable=true><div class="code-header language-bash"><span class=code-title><i class="arrow fa-solid fa-chevron-down" aria-hidden=true></i></span><span class=ellipses-btn aria-label="Show more options" role=button><i class="fa-solid fa-ellipsis-h" aria-hidden=true></i></span><span class=line-nos-btn aria-label="Toggle line numbers" role=button title="Toggle line numbers"><i class="fa-solid fa-list-ol" aria-hidden=true></i></span><span class=line-wrap-btn aria-label="Toggle code wrap" role=button title="Toggle code wrap"><i class="fa-solid fa-right-left" aria-hidden=true></i></span><span class=copy-btn aria-label="Copy to clipboard" role=button title="Copy to clipboard"><i class="fa-regular fa-clone" aria-hidden=true></i></span></div><div class=code-wrapper data-max=10 data-line-digit=2 style=--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>root@eve-01# cat <span class=s>&lt;&lt;EOF &gt; cloud-config
</span></span></span><span class=line><span class=cl><span class=s>#cloud-config
</span></span></span><span class=line><span class=cl><span class=s>system_info:
</span></span></span><span class=line><span class=cl><span class=s>  default_user:
</span></span></span><span class=line><span class=cl><span class=s>    name: &#34;ubuntu&#34;
</span></span></span><span class=line><span class=cl><span class=s>    home: /home/ubuntu
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>password: &#34;ubuntu123&#34;
</span></span></span><span class=line><span class=cl><span class=s>chpasswd: { expire: False }
</span></span></span><span class=line><span class=cl><span class=s>hostname: &#34;ubuntu&#34;
</span></span></span><span class=line><span class=cl><span class=s>ssh_pwauth: True
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>root@eve-01# cloud-localds seed cloud-config
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>root@eve-01# qemu-img info seed
</span></span><span class=line><span class=cl>image: seed
</span></span><span class=line><span class=cl>file format: raw
</span></span><span class=line><span class=cl>virtual size: 366K <span class=o>(</span><span class=m>374784</span> bytes<span class=o>)</span>
</span></span><span class=line><span class=cl>disk size: 368K
</span></span><span class=line><span class=cl>root@eve-01# cp seed /opt/unetlab/addons/qemu/linux-focal-server-cloudimg/cdrom.iso</span></span></code></pre></div><div class=code-expand-btn aria-label="Expand or collapse code block" role=button><i class="fa-solid fa-angles-down" aria-hidden=true></i></div></div><div class="details admonition warning open"><div class="details-summary admonition-title"><i class="icon fa-solid fa-exclamation-triangle" aria-hidden=true></i>Heads Up<i class="details-icon fa-solid fa-angle-right" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>Make sure you include the comment #cloud-config in the seed file</div></div></div><hr><h3 class=heading-element id=build-the-vm-topology-in-eve-ng><span>Build the VM topology in EVE-NG</span>
<a href=#build-the-vm-topology-in-eve-ng class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><hr><p>Once both boot disk and seed cdrom files are in place, copy them onto the other node and run the <strong>fixpermissions</strong> script.</p><div class="code-block highlight line-nos-hidden" data-mode=classic data-copyable=true><div class="code-header language-bash"><span class=code-title><i class="arrow fa-solid fa-chevron-down" aria-hidden=true></i></span><span class=ellipses-btn aria-label="Show more options" role=button><i class="fa-solid fa-ellipsis-h" aria-hidden=true></i></span><span class=line-nos-btn aria-label="Toggle line numbers" role=button title="Toggle line numbers"><i class="fa-solid fa-list-ol" aria-hidden=true></i></span><span class=line-wrap-btn aria-label="Toggle code wrap" role=button title="Toggle code wrap"><i class="fa-solid fa-right-left" aria-hidden=true></i></span><span class=copy-btn aria-label="Copy to clipboard" role=button title="Copy to clipboard"><i class="fa-regular fa-clone" aria-hidden=true></i></span></div><div class=code-wrapper data-max=10 data-line-digit=2 style=--fi-max-shown-lines:10;--fi-line-digit:2;--fi-line-start:1><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl>root@eve-01# <span class=nb>cd</span> /opt/unetlab/addons/qemu/linux-focal-server-cloudimg/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>root@eve-01# ll
</span></span><span class=line><span class=cl>total <span class=m>581760</span>
</span></span><span class=line><span class=cl>drwxr-xr-x  <span class=m>2</span> root root      <span class=m>4096</span> May <span class=m>29</span> 22:02 ./
</span></span><span class=line><span class=cl>drwxr-xr-x <span class=m>12</span> root root      <span class=m>4096</span> May <span class=m>29</span> 21:45 ../
</span></span><span class=line><span class=cl>-rw-r--r--  <span class=m>1</span> root root    <span class=m>374784</span> May <span class=m>29</span> 22:02 cdrom.iso
</span></span><span class=line><span class=cl>-rw-r--r--  <span class=m>1</span> root root <span class=m>595330048</span> May <span class=m>29</span> 21:47 hda.qcow2
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>root@eve-01# /opt/unetlab/wrappers/unl_wrapper -a fixpermissions
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>root@eve-01# ssh eve-02 <span class=s2>&#34;mkdir -p /opt/unetlab/addons/qemu/linux-focal-server-cloudimg&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>root@eve-01# scp hda.qcow2 eve-02:/opt/unetlab/addons/qemu/linux-focal-server-cloudimg/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>root@eve-01# scp cdrom.iso 192.168.1.22:/opt/unetlab/addons/qemu/linux-focal-server-cloudimg/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>root@eve-01# ssh eve-02 <span class=s2>&#34;/opt/unetlab/wrappers/unl_wrapper -a fixpermissions&#34;</span></span></span></code></pre></div><div class=code-expand-btn aria-label="Expand or collapse code block" role=button><i class="fa-solid fa-angles-down" aria-hidden=true></i></div></div><p>Now everything is ready to start creating the topology via the GUI. The following table lists the planning for my deployment:</p><div class=table-wrapper><table><thead><tr><th style=text-align:center>EVE-NG node</th><th style=text-align:center>Role</th><th style=text-align:center>VM name</th><th style=text-align:center>IP address</th><th style=text-align:center>CPU</th><th style=text-align:center>RAM</th></tr></thead><tbody><tr><td style=text-align:center>eve-01</td><td style=text-align:center>control-node</td><td style=text-align:center>kates-control</td><td style=text-align:center>192.168.1.30</td><td style=text-align:center>4</td><td style=text-align:center>4096</td></tr><tr><td style=text-align:center>eve-01</td><td style=text-align:center>worker</td><td style=text-align:center>kates-node-01</td><td style=text-align:center>192.168.1.31</td><td style=text-align:center>8</td><td style=text-align:center>28672</td></tr><tr><td style=text-align:center>eve-02</td><td style=text-align:center>worker</td><td style=text-align:center>kates-node-02</td><td style=text-align:center>192.168.1.32</td><td style=text-align:center>8</td><td style=text-align:center>28672</td></tr></tbody></table></div><p>Here is how it looks like from GUI perspective:</p><p><figure><a class=lightgallery target=_blank href=/posts/kube-my-router-pt1/eve-01.png title=/posts/kube-my-router-pt1/eve-01.png data-thumbnail=/posts/kube-my-router-pt1/eve-01.png data-sub-html="<h2>EVE-01 Topology</h2>"><img loading=lazy src=/posts/kube-my-router-pt1/eve-01.png alt=/posts/kube-my-router-pt1/eve-01.png height=507 width=500></a><figcaption class=image-caption>EVE-01 Topology</figcaption></figure><figure><a class=lightgallery target=_blank href=/posts/kube-my-router-pt1/eve-02.png title=/posts/kube-my-router-pt1/eve-02.png data-thumbnail=/posts/kube-my-router-pt1/eve-02.png data-sub-html="<h2>EVE-02 Topology</h2>"><img loading=lazy src=/posts/kube-my-router-pt1/eve-02.png alt=/posts/kube-my-router-pt1/eve-02.png height=406 width=500></a><figcaption class=image-caption>EVE-02 Topology</figcaption></figure></p><p>You can also download the lab exports for <a href=/posts/kube-my-router-pt1/eve-01.zip>eve-01</a> and <a href=/posts/kube-my-router-pt1/eve-02.zip>eve-02</a></p><div class="details admonition danger open"><div class="details-summary admonition-title"><i class="icon fa-solid fa-bolt" aria-hidden=true></i>Heads Up<i class="details-icon fa-solid fa-angle-right" aria-hidden=true></i></div><div class=details-content><div class=admonition-content><p>Due to the fact that EVE-NG allocates MAC addresses sequentially from a pool which is allocated per-POD and if you are using the same LAB POD on both servers, <strong>kates-control</strong> and <strong>kates-node-02</strong> (i.e. the first VMs on each node, since only EVE-01 has two nodes) will end up having the same MAC address. In order to avoid this, we can either use <em>dummy</em> VMs, i.e. powered off VMs or we can specify the value for the first MAC address on the <strong>kates-node-02</strong> VM to cause EVE-NG to allocate a different MAC to the NIC, or simply we can use different EVE-NG PODs across the two servers to create the lab &#x1f604;. I went for the latter and simpler method.</p><figure><a class=lightgallery target=_blank href=/posts/kube-my-router-pt1/kates2.png title=/posts/kube-my-router-pt1/kates2.png data-thumbnail=/posts/kube-my-router-pt1/kates2.png data-sub-html="<h2>Change MAC address of VM on second EVE server</h2>"><img loading=lazy src=/posts/kube-my-router-pt1/kates2.png alt=/posts/kube-my-router-pt1/kates2.png height=950 width=400></a><figcaption class=image-caption>Change MAC address of VM on second EVE server</figcaption></figure>Have this also in mind for all your other labs and topologies. The MAC allocation is per lab POD.</div></div></div><hr><h3 class=heading-element id=start-the-labs-and-perform-initial-configuration><span>Start the labs and perform initial configuration</span>
<a href=#start-the-labs-and-perform-initial-configuration class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><hr><p>All VMs are ready to start. Once all nodes are booted you can access them from the VNC or HTML5 console and perform the initial configuration, which includes:</p><ul><li>Disabling cloud-init</li><li>Setting the hostname</li><li>Configuring network addresses</li><li>Updating and Upgrading</li></ul><p>But, let&rsquo;s first check that all VMs are different and also the MAC addresses are not the same. The outputs shown are when using the same LAB POD in EVE-NG.</p><div class="code-block highlight line-nos-hidden" data-mode=classic data-copyable=true><div class="code-header language-bash"><span class=code-title><i class="arrow fa-solid fa-chevron-down" aria-hidden=true></i></span><span class=ellipses-btn aria-label="Show more options" role=button><i class="fa-solid fa-ellipsis-h" aria-hidden=true></i></span><span class=line-nos-btn aria-label="Toggle line numbers" role=button title="Toggle line numbers"><i class="fa-solid fa-list-ol" aria-hidden=true></i></span><span class=line-wrap-btn aria-label="Toggle code wrap" role=button title="Toggle code wrap"><i class="fa-solid fa-right-left" aria-hidden=true></i></span><span class=copy-btn aria-label="Copy to clipboard" role=button title="Copy to clipboard"><i class="fa-regular fa-clone" aria-hidden=true></i></span></div><div class=code-wrapper data-max=10 data-line-digit=1 style=--fi-max-shown-lines:10;--fi-line-digit:1;--fi-line-start:1><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># On kates-control</span>
</span></span><span class=line><span class=cl>ubuntu@ubuntu:~$ sudo dmidecode -s system-uuid <span class=o>&amp;&amp;</span> cat /etc/machine-id <span class=o>&amp;&amp;</span> ip link
</span></span><span class=line><span class=cl>df8f1876-080b-4bb0-b000-f63819c781f3
</span></span><span class=line><span class=cl>df8f1876080b4bb0b000f63819c781f3
</span></span><span class=line><span class=cl>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu <span class=m>65536</span> qdisc noqueue state UNKNOWN mode DEFAULT group default qlen <span class=m>1000</span>
</span></span><span class=line><span class=cl>    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
</span></span><span class=line><span class=cl>2: ens3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class=m>1500</span> qdisc fq_codel state UP mode DEFAULT group default qlen <span class=m>1000</span>
</span></span><span class="line hl"><span class=cl>    link/ether 00:50:00:00:01:00 brd ff:ff:ff:ff:ff:ff</span></span></code></pre></div></div><div class="code-block highlight line-nos-hidden" data-mode=classic data-copyable=true><div class="code-header language-bash"><span class=code-title><i class="arrow fa-solid fa-chevron-down" aria-hidden=true></i></span><span class=ellipses-btn aria-label="Show more options" role=button><i class="fa-solid fa-ellipsis-h" aria-hidden=true></i></span><span class=line-nos-btn aria-label="Toggle line numbers" role=button title="Toggle line numbers"><i class="fa-solid fa-list-ol" aria-hidden=true></i></span><span class=line-wrap-btn aria-label="Toggle code wrap" role=button title="Toggle code wrap"><i class="fa-solid fa-right-left" aria-hidden=true></i></span><span class=copy-btn aria-label="Copy to clipboard" role=button title="Copy to clipboard"><i class="fa-regular fa-clone" aria-hidden=true></i></span></div><div class=code-wrapper data-max=10 data-line-digit=1 style=--fi-max-shown-lines:10;--fi-line-digit:1;--fi-line-start:1><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># On kates-node-01</span>
</span></span><span class=line><span class=cl>ubuntu@ubuntu:~$ sudo dmidecode -s system-uuid <span class=o>&amp;&amp;</span> cat /etc/machine-id <span class=o>&amp;&amp;</span> ip link
</span></span><span class=line><span class=cl>2b748bae-16c2-4abe-b65e-21a359658480
</span></span><span class=line><span class=cl>2b748bae16c24abeb65e21a359658480
</span></span><span class=line><span class=cl>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu <span class=m>65536</span> qdisc noqueue state UNKNOWN mode DEFAULT group default qlen <span class=m>1000</span>
</span></span><span class=line><span class=cl>    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
</span></span><span class=line><span class=cl>2: ens3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class=m>1500</span> qdisc fq_codel state UP mode DEFAULT group default qlen <span class=m>1000</span>
</span></span><span class="line hl"><span class=cl>    link/ether 00:50:00:00:02:00 brd ff:ff:ff:ff:ff:ff</span></span></code></pre></div></div><div class="code-block highlight line-nos-hidden" data-mode=classic data-copyable=true><div class="code-header language-bash"><span class=code-title><i class="arrow fa-solid fa-chevron-down" aria-hidden=true></i></span><span class=ellipses-btn aria-label="Show more options" role=button><i class="fa-solid fa-ellipsis-h" aria-hidden=true></i></span><span class=line-nos-btn aria-label="Toggle line numbers" role=button title="Toggle line numbers"><i class="fa-solid fa-list-ol" aria-hidden=true></i></span><span class=line-wrap-btn aria-label="Toggle code wrap" role=button title="Toggle code wrap"><i class="fa-solid fa-right-left" aria-hidden=true></i></span><span class=copy-btn aria-label="Copy to clipboard" role=button title="Copy to clipboard"><i class="fa-regular fa-clone" aria-hidden=true></i></span></div><div class=code-wrapper data-max=10 data-line-digit=1 style=--fi-max-shown-lines:10;--fi-line-digit:1;--fi-line-start:1><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># On kates-node-02</span>
</span></span><span class=line><span class=cl>ubuntu@ubuntu:~$ sudo dmidecode -s system-uuid <span class=o>&amp;&amp;</span> cat /etc/machine-id <span class=o>&amp;&amp;</span> ip link
</span></span><span class=line><span class=cl>9ba9c500-5d18-40e8-98e4-3e027f84e971
</span></span><span class=line><span class=cl>9ba9c5005d1840e898e43e027f84e971
</span></span><span class=line><span class=cl>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu <span class=m>65536</span> qdisc noqueue state UNKNOWN mode DEFAULT group default qlen <span class=m>1000</span>
</span></span><span class=line><span class=cl>    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
</span></span><span class=line><span class=cl>2: ens3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class=m>1500</span> qdisc fq_codel state UP mode DEFAULT group default qlen <span class=m>1000</span>
</span></span><span class="line hl"><span class=cl>    link/ether 00:60:00:00:01:00 brd ff:ff:ff:ff:ff:ff</span></span></code></pre></div></div><p>Okay, now it is time to perform the initial configuration by disabling first the cloud-init service and then moving on.</p><div class="details admonition note open"><div class="details-summary admonition-title"><i class="icon fa-solid fa-pencil-alt" aria-hidden=true></i>Note that<i class="details-icon fa-solid fa-angle-right" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>If the cloud-init service is not disabled, then we will not be able to change the hostname, so either we disable cloud init or modify the appropriate config file in order not to reset the hostname according to the seed file</div></div></div><p>So from the VM console:</p><div class="code-block highlight line-nos-hidden" data-mode=classic data-copyable=true><div class="code-header language-bash"><span class=code-title><i class="arrow fa-solid fa-chevron-down" aria-hidden=true></i></span><span class=ellipses-btn aria-label="Show more options" role=button><i class="fa-solid fa-ellipsis-h" aria-hidden=true></i></span><span class=line-nos-btn aria-label="Toggle line numbers" role=button title="Toggle line numbers"><i class="fa-solid fa-list-ol" aria-hidden=true></i></span><span class=line-wrap-btn aria-label="Toggle code wrap" role=button title="Toggle code wrap"><i class="fa-solid fa-right-left" aria-hidden=true></i></span><span class=copy-btn aria-label="Copy to clipboard" role=button title="Copy to clipboard"><i class="fa-regular fa-clone" aria-hidden=true></i></span></div><div class=code-wrapper data-max=10 data-line-digit=1 style=--fi-max-shown-lines:10;--fi-line-digit:1;--fi-line-start:1><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ubuntu@ubuntu:~$ sudo touch /etc/cloud/cloud-init.disabled
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ubuntu@ubuntu:~$ sudo hostnamectl set-hostname kates-control</span></span></code></pre></div></div><p>Adjust the netplan file according to your environment and apply the configuration. I prefer to remove the static MAC assignment to the NIC</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ubuntu@ubuntu:~$ sudo vi /etc/netplan/50-cloud-init.yaml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ubuntu@ubuntu:~$ cat /etc/netplan/50-cloud-init.yaml
</span></span><span class=line><span class=cl>network:
</span></span><span class=line><span class=cl>    ethernets:
</span></span><span class=line><span class=cl>        ens3:
</span></span><span class=line><span class=cl>            dhcp4: <span class=nb>false</span>
</span></span><span class=line><span class=cl>            dhcp6: <span class=nb>false</span>
</span></span><span class=line><span class=cl>            addresses: <span class=o>[</span>192.168.1.30/24<span class=o>]</span>
</span></span><span class=line><span class=cl>            gateway4: 192.168.1.1
</span></span><span class=line><span class=cl>            nameservers:
</span></span><span class=line><span class=cl>                    addresses: <span class=o>[</span>192.168.1.1, 8.8.8.8<span class=o>]</span>
</span></span><span class=line><span class=cl>    version: <span class=m>2</span>
</span></span><span class=line><span class=cl>ubuntu@ubuntu:~$ sudo netplan apply</span></span></code></pre></div><p>Now that the basic config has been done for all 3 nodes, we can reboot and login from a proper SSH terminal &#x1f604; to verify network connectivity and by the next single command we perform any upgrade available and reboot the nodes if needed.</p><div class="code-block highlight line-nos-hidden" data-mode=classic data-copyable=true><div class="code-header language-bash"><span class=code-title><i class="arrow fa-solid fa-chevron-down" aria-hidden=true></i></span><span class=ellipses-btn aria-label="Show more options" role=button><i class="fa-solid fa-ellipsis-h" aria-hidden=true></i></span><span class=line-nos-btn aria-label="Toggle line numbers" role=button title="Toggle line numbers"><i class="fa-solid fa-list-ol" aria-hidden=true></i></span><span class=line-wrap-btn aria-label="Toggle code wrap" role=button title="Toggle code wrap"><i class="fa-solid fa-right-left" aria-hidden=true></i></span><span class=copy-btn aria-label="Copy to clipboard" role=button title="Copy to clipboard"><i class="fa-regular fa-clone" aria-hidden=true></i></span></div><div class=code-wrapper data-max=10 data-line-digit=1 style=--fi-max-shown-lines:10;--fi-line-digit:1;--fi-line-start:1><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ubuntu@kates-*:~$ sudo apt update <span class=se>\
</span></span></span><span class=line><span class=cl>                  <span class=o>&amp;&amp;</span> sudo apt -y full-upgrade <span class=se>\
</span></span></span><span class=line><span class=cl>                  <span class=o>&amp;&amp;</span> <span class=o>[</span> -f /var/run/reboot-required <span class=o>]</span> <span class=se>\
</span></span></span><span class=line><span class=cl>                  <span class=o>&amp;&amp;</span> sudo reboot -f</span></span></code></pre></div></div><hr><h3 class=heading-element id=references-and-influences><span>References and influences</span>
<a href=#references-and-influences class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><hr><ul><li><a href=https://www.eve-ng.net/ target=_blank rel="external nofollow noopener noreferrer">EVE-NG official site</a></li><li><a href=https://cloudinit.readthedocs.io/en/latest/topics/examples.html target=_blank rel="external nofollow noopener noreferrer">Cloud config examples</a></li><li><a href=https://www.theurbanpenguin.com/using-cloud-images-in-kvm/ target=_blank rel="external nofollow noopener noreferrer">Using Cloud Images in KVM</a></li></ul><hr><h2 class=heading-element id=part-two---deploying-the-k8s-cluster-with-kubeadm><span><a href=/posts/kube-my-router-pt2/>Part Two - Deploying the k8s cluster with kubeadm</a></span>
<a href=#part-two---deploying-the-k8s-cluster-with-kubeadm class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><hr><h2 class=heading-element id=last-part---installing-and-testing-kne><span><a href=/posts/kube-my-router-pt3/>Last Part - Installing and testing KNE</a></span>
<a href=#last-part---installing-and-testing-kne class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><hr><h2 class=heading-element id=outro><span><a href=/posts/kube-my-router-pt3/#outro>Outro</a></span>
<a href=#outro class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><hr></div><div class=collection-card><div class="collection-title text-secondary">Included in <a href=/collections/kube-my-router-up/><i class="fa-solid fa-layer-group" aria-hidden=true></i> <span>Collection・Kube My Router Up!</span></span></a> 3</div><div class=collection-nav><a href=/posts/kube-my-router-pt2/ class=collection-nav-item rel=next title="Kube My Router Up! - Part Two"><span>Kube My Router Up! - Part Two</span><i class="fa-solid fa-angle-right" aria-hidden=true></i></a></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="Updated on 2022-05-28 10:36:24">Updated on 2022-05-28&nbsp;</span></div><div class=post-info-license><span><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank>CC BY-NC-SA 4.0</a></span></div></div><div class=post-info-line><div class=post-info-md><span><a href=/posts/kube-my-router-pt1/index.md title="Read Markdown" class=link-to-markdown>Read Markdown</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on X" data-sharer=twitter data-url=https://net4fungr.github.io/posts/kube-my-router-pt1/ data-title="Kube My Router Up! - Part One" data-via=mkaliotis data-hashtags=EVE-NG,Ubuntu><i class="fa-brands fa-x-twitter" aria-hidden=true></i></a>
<a href=javascript:void(0); title="Share on Linkedin" data-sharer=linkedin data-url=https://net4fungr.github.io/posts/kube-my-router-pt1/><i class="fa-brands fa-linkedin" aria-hidden=true></i></a>
<a href=javascript:void(0); title="Share on Reddit" data-sharer=reddit data-url=https://net4fungr.github.io/posts/kube-my-router-pt1/><i class="fa-brands fa-reddit" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fa-solid fa-tags me-1" aria-hidden=true></i><a href=/tags/eve-ng/ class=post-tag title="Tags - EVE-NG">EVE-NG</a><a href=/tags/ubuntu/ class=post-tag title="Tags - Ubuntu">Ubuntu</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/mutable-immutable/ class=post-nav-item rel=prev title="Mutable vs. Immutable"><i class="fa-solid fa-angle-left" aria-hidden=true></i>Mutable vs. Immutable</a><a href=/posts/kube-my-router-pt2/ class=post-nav-item rel=next title="Kube My Router Up! - Part Two">Kube My Router Up! - Part Two<i class="fa-solid fa-angle-right" aria-hidden=true></i></a></div></div><div id=comments><div id=giscus class=comment><script src=https://giscus.app/client.js data-repo=Net4FunGR/net4fungr.github.io data-repo-id=R_kgDOGLZFKQ data-category="Blog Comments" data-category-id=DIC_kwDOGLZFKc4Cf1aA data-mapping=title data-strict=0 data-theme=preferred_color_scheme data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-lang=en data-loading=lazy crossorigin=anonymous async defer></script></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://giscus.app/ rel="external nofollow noopener noreferrer">giscus</a>.</noscript></div></article><aside class=toc id=toc-auto aria-label=Contents><h2 class=toc-title>Contents&nbsp;<i class="toc-icon fa-solid fa-angle-down" aria-hidden=true></i></h2><div class="toc-content always-active" id=toc-content-auto></div></aside><dialog id=toc-dialog aria-labelledby=toc-dialog-title role=dialog><div class=toc><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-drawer><nav><ul><li><a href=#intro>Intro</a></li><li><a href=#part-one---setting-up-the-vms>Part One - Setting up the VMs</a><ul><li><a href=#the-intent>The Intent</a></li><li><a href=#prepare-ubuntu-base-image-in-eve-ng>Prepare Ubuntu base image in EVE-NG</a></li><li><a href=#install-cloud-image-utilities-and-prepare-the-seed-file>Install cloud-image utilities and prepare the seed file</a></li><li><a href=#build-the-vm-topology-in-eve-ng>Build the VM topology in EVE-NG</a></li><li><a href=#start-the-labs-and-perform-initial-configuration>Start the labs and perform initial configuration</a></li><li><a href=#references-and-influences>References and influences</a></li></ul></li><li><a href=#part-two---deploying-the-k8s-cluster-with-kubeadm>Part Two - Deploying the k8s cluster with kubeadm</a></li><li><a href=#last-part---installing-and-testing-kne>Last Part - Installing and testing KNE</a></li><li><a href=#outro>Outro</a></li></ul></nav></div></div></dialog></main><footer class=footer><div class=footer-container><div class="footer-line powered">Powered by <a href=https://gohugo.io/ target=_blank rel="external nofollow noopener noreferrer" title="Hugo 0.157.0"><img class=hugo-icon src=/images/hugo.min.svg alt="Hugo logo"> Hugo</a> | Theme - <a href=https://github.com/hugo-fixit/FixIt target=_blank rel=external title="FixIt v0.4.2"><img class=fixit-icon src=/images/fixit.min.svg alt="FixIt logo"> FixIt</a></div><div class="footer-line copyright" itemscope itemtype=http://schema.org/CreativeWork><i class="fa-regular fa-copyright" aria-hidden=true></i>
<span itemprop=copyrightYear>2021 - 2026</span><span class=author itemprop=copyrightHolder>
<a href=https://github.com/becos76 target=_blank rel="external nofollow noopener noreferrer">becos76</a></span><span class="license footer-divider"><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div class=widgets><div class=fixed-buttons><div class="fixed-button back-to-top animate__faster d-none" role=button aria-label="Back to Top"><i class="fa-solid fa-arrow-up" aria-hidden=true></i><svg viewBox="0 0 100 100"><circle class="bg" cx="50" cy="50" r="50"/><circle class="progress" cx="50" cy="50" r="50"/></svg></div><div id=toc-drawer-button class="fixed-button toc-drawer-button d-none" role=button aria-label=Contents><i class="fa-solid fa-bars" aria-hidden=true></i></div><div class="fixed-button view-comments d-none" role=button aria-label="View Comments"><i class="fa-solid fa-comment" aria-hidden=true></i></div></div><a href=https://github.com/becos76/ title="Visit my GitHub" target=_blank rel="external nofollow" class="github-corner right d-none-mobile"><svg viewBox="0 0 250 250" aria-hidden="true" width="56" height="56"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentColor" class="octo-body"/></svg></a><div id=mask></div><div class=reading-progress-bar style=left:0;top:0;--bg-progress:orange;--bg-progress-dark:grey></div><noscript><div class=noscript-warning>This website works best with JavaScript enabled.</div></noscript></div><link rel=stylesheet href=/lib/lightgallery/css/lightgallery-bundle.min.css><link rel=stylesheet href=/lib/pace/themes/blue/pace-theme-minimal.css><script src=/lib/autocomplete/autocomplete.min.js defer></script><script src=/lib/fuse/fuse.min.js defer></script><script src=/lib/twemoji/twemoji.min.js defer></script><script src=/lib/lightgallery/lightgallery.min.js defer></script><script src=/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.js defer></script><script src=/lib/lightgallery/plugins/zoom/lg-zoom.min.js defer></script><script src=/lib/sharer/sharer.min.js async defer></script><script src=/lib/typeit/index.umd.js defer></script><script src=/lib/pace/pace.min.js async defer></script><script src=/js/config/c43f36afe0516006da8edd9f43719887.js defer></script><script src=/js/theme.min.js defer></script></body></html>