<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><title>K~ustom Metrics in Kentik NMS</title><meta name=author content=" ">
<meta name=description content="Showcasing the capabilities of Kentik NMS to define custom metrics and display them in the Portal. We are going to see how to configure Kentik&rsquo;s Universal agent to poll custom SNMP and ST metrics from devices and display them in Metrics Explorer in the Portal"><meta name=keywords content='network,monitoring,telemetry,snmp'><meta itemprop=name content="K~ustom Metrics in Kentik NMS"><meta itemprop=description content="Showcasing the capabilities of Kentik NMS to define custom metrics and display them in the Portal. We are going to see how to configure Kentik’s Universal agent to poll custom SNMP and ST metrics from devices and display them in Metrics Explorer in the Portal"><meta itemprop=datePublished content="2024-05-04T00:00:00+00:00"><meta itemprop=dateModified content="2024-05-04T00:00:00+00:00"><meta itemprop=wordCount content="3730"><meta itemprop=image content="https://net4fungr.github.io/images/pyrtr_small.png"><meta itemprop=keywords content="Network,Monitoring,Telemetry,Snmp"><meta property="og:url" content="https://net4fungr.github.io/posts/kustom-metrics/"><meta property="og:site_name" content="Becos :: Back Blog"><meta property="og:title" content="K~ustom Metrics in Kentik NMS"><meta property="og:description" content="Showcasing the capabilities of Kentik NMS to define custom metrics and display them in the Portal. We are going to see how to configure Kentik’s Universal agent to poll custom SNMP and ST metrics from devices and display them in Metrics Explorer in the Portal"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-05-04T00:00:00+00:00"><meta property="article:modified_time" content="2024-05-04T00:00:00+00:00"><meta property="article:tag" content="Network"><meta property="article:tag" content="Monitoring"><meta property="article:tag" content="Telemetry"><meta property="article:tag" content="Snmp"><meta property="og:image" content="https://net4fungr.github.io/images/pyrtr_small.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://net4fungr.github.io/images/pyrtr_small.png"><meta name=twitter:title content="K~ustom Metrics in Kentik NMS"><meta name=twitter:description content="Showcasing the capabilities of Kentik NMS to define custom metrics and display them in the Portal. We are going to see how to configure Kentik’s Universal agent to poll custom SNMP and ST metrics from devices and display them in Metrics Explorer in the Portal"><meta name=twitter:site content="@mkaliotis"><meta name=twitter:creator content="@mkaliotis"><meta name=application-name content="Becos :: Back Blog"><meta name=apple-mobile-web-app-title content="Becos :: Back Blog"><meta name=theme-color data-light=#f8f8f8 data-dark=#252627 content="#f8f8f8"><meta name=msapplication-TileColor content="#da532c"><link rel=canonical type=text/html href=https://net4fungr.github.io/posts/kustom-metrics/ title="K~ustom Metrics in Kentik NMS - Becos :: Back Blog"><link rel=prev type=text/html href=https://net4fungr.github.io/posts/xr-get-xpath/ title="IOS-XR :: Get Your XPATHs, Get Your XPATHs Honey"><link rel=next type=text/html href=https://net4fungr.github.io/posts/modern-nms/ title="If this ain't a modern NMS, then what is?"><link rel=alternate type=text/markdown href=https://net4fungr.github.io/posts/kustom-metrics/index.md title="K~ustom Metrics in Kentik NMS - Becos :: Back Blog"><link rel=stylesheet href=/css/style.min.css><link rel=preload href=/lib/fontawesome-free/all.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/fontawesome-free/all.min.css></noscript><link rel=preload href=/lib/animate/animate.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/animate/animate.min.css></noscript><meta name=google-site-verification content="m_enMQYWx1a1cSKPfRT_00wHfqT8ir4PZSBPyeaIH-o"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"K~ustom Metrics in Kentik NMS","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/net4fungr.github.io\/posts\/kustom-metrics\/"},"genre":"posts","keywords":"network, monitoring, telemetry, snmp","wordcount":3730,"url":"https:\/\/net4fungr.github.io\/posts\/kustom-metrics\/","datePublished":"2024-05-04T00:00:00+00:00","dateModified":"2024-05-04T00:00:00+00:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":" "},"description":""}</script><script src=/js/head/color-scheme.min.js></script></head><body data-header-desktop=sticky data-header-mobile=auto><div class=wrapper data-page-style=narrow><header class="desktop animate__faster" id=header-desktop><div class=header-wrapper data-github-corner=right><div class=header-title><a href=/ title="Becos :: Back Blog"><img class=logo src=/images/pyrtr_small.png alt="Becos :: Back Blog" height=32 width=32><span class=header-title-pre><</span><span class=header-title-text>...ssh and blog...</span><span class=header-title-post>/></span></a><span class="typeit header-subtitle"><template>revamped!</template></span></div><nav><ul class=menu><li class=menu-item><a class=menu-link href=/categories/ title="Posts Organised by Category"><i class="fa-solid fa-folder-tree fa-fw fa-sm" aria-hidden=true></i> Categories</a></li><li class=menu-item><a class=menu-link href=/collections/ title="Multipart Posts"><i class="fa-solid fa-layer-group fa-fw fa-sm" aria-hidden=true></i> Collections</a></li><li class=menu-item><a class=menu-link href=/archives/ title="All My Posts"><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> Archives</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> Tags</a></li><li class=menu-item><a class=menu-link href=https://becos76.github.io title="About Me" rel="noopener noreferrer" target=_blank><i class="fa-solid fa-signature fa-fw fa-sm" aria-hidden=true></i> About</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id=search-desktop><input type=text placeholder="Search titles or contents ..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></li><li class="menu-item theme-switch" title="Switch Theme"><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></li></ul></nav></div></header><header class="mobile animate__faster" id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Becos :: Back Blog"><img class=logo src=/images/pyrtr_small.png alt="Becos :: Back Blog" height=26 width=26><span class=header-title-pre><</span><span class=header-title-text>...ssh and blog...</span><span class=header-title-post>/></span></a><span class="typeit header-subtitle"><template>revamped!</template></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents ..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></li><li class=menu-item><a class=menu-link href=/categories/ title="Posts Organised by Category"><i class="fa-solid fa-folder-tree fa-fw fa-sm" aria-hidden=true></i> Categories</a></li><li class=menu-item><a class=menu-link href=/collections/ title="Multipart Posts"><i class="fa-solid fa-layer-group fa-fw fa-sm" aria-hidden=true></i> Collections</a></li><li class=menu-item><a class=menu-link href=/archives/ title="All My Posts"><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> Archives</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> Tags</a></li><li class=menu-item><a class=menu-link href=https://becos76.github.io title="About Me" rel="noopener noreferrer" target=_blank><i class="fa-solid fa-signature fa-fw fa-sm" aria-hidden=true></i> About</a></li><li class="menu-item menu-system"><span class="menu-system-item theme-switch" title="Switch Theme"><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></span></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=container><aside class="aside-collection animate__animated animate__fadeIn animate__faster" aria-label=Collections><div class="details related-details open"><div class="details-summary related-summary"><i class="fa-solid fa-fire fa-fade text-danger fa-fw" aria-hidden=true></i>
<span class=related-title>Related Content</span><i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class="details-content related-content"><ul class=related-list><li class=related-item><a href=/posts/kube-my-router-pt3/ title="Kube My Router Up! - Last Part">Kube My Router Up! - Last Part</a></li><li class=related-item><a href=/posts/kube-my-router-pt2/ title="Kube My Router Up! - Part Two">Kube My Router Up! - Part Two</a></li><li class=related-item><a href=/posts/kube-my-router-pt1/ title="Kube My Router Up! - Part One">Kube My Router Up! - Part One</a></li><li class=related-item><a href=/posts/xr-get-xpath/ title="IOS-XR :: Get Your XPATHs, Get Your XPATHs Honey">IOS-XR :: Get Your XPATHs, Get Your XPATHs Honey</a></li><li class=related-item><a href=/posts/k8s-ansible/ title="K8s Ansible">K8s Ansible</a></li></ul></div></div></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span>K~ustom Metrics in Kentik NMS</span></h1><p class="single-subtitle animate__animated animate__fadeIn">Feeding Kentik NMS with custom SNMP and ST metrics</p></div><div class=post-meta><div class=post-meta-line><span class=post-author><span class=author><i class="fa-solid fa-user-circle" aria-hidden=true></i>
</span></span><span class=post-included-in>&nbsp;included in <a href=/categories/network-monitoring/ class=post-category title="Category - Network Monitoring"><i class="fa-regular fa-folder fa-fw" aria-hidden=true></i> Network Monitoring</a></span></div><div class=post-meta-line><span title="published on 2024-05-04 00:00:00"><i class="fa-solid fa-calendar-days fa-fw me-1" aria-hidden=true></i><time datetime=2024-05-04>2024-05-04</time></span>&nbsp;<span title="3730 words"><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden=true></i>About 3800 words</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden=true></i>18 minutes</span>&nbsp;</div></div><div class="details toc" id=toc-static data-kept=false><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fa-solid fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#intro>Intro</a></li><li><a href=#kentik-universal-agent-kagent>Kentik Universal Agent (kagent)</a><ul><li><a href=#kagent-container>Kagent container</a></li></ul></li><li><a href=#junos-firewall-filters>Junos Firewall Filters</a><ul><li><a href=#snmp>SNMP</a><ul><li><a href=#local-configuration>Local Configuration</a></li><li><a href=#kagent-bring-up>Kagent Bring Up</a></li><li><a href=#kentik-portal>Kentik Portal</a></li></ul></li><li><a href=#grpc>GRPC</a><ul><li><a href=#local-configuration-take-1>Local Configuration (take 1)</a></li><li><a href=#local-configuration-take-2>Local Configuration (take 2)</a></li><li><a href=#kentik-portal-1>Kentik Portal</a></li></ul></li></ul></li><li><a href=#ios-xr-flowspec>IOS-XR Flowspec</a><ul><li><ul><li><a href=#local-configuration-1>Local Configuration</a></li><li><a href=#kentik-portal-2>Kentik Portal</a></li></ul></li></ul></li><li><a href=#outro>Outro</a></li><li><a href=#influences-and-reference>Influences and Reference</a></li></ul></nav></div></div><div class=content id=content><hr><h2 class=heading-element id=intro><span>Intro</span>
<a href=#intro class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>Since the launch of Kentik NMS, it it is possible to ingest and display custom metrics in the Portal. In this post we will be going over a walkthrough of how we can enable Kentik&rsquo;s Universal Agent to poll custom SNMP and Streaming Telemetry metrics from devices and report them back to the Portal. The use case is about having visibility into BGP Flowspec counters to see what our mitigations are reporting on the devices.</p><p>We are going to address this through SNMP as well as ST for both Junos and IOS-XR devices. For Junos, the flowspec rules are translated into firewall filters which have counters and policers depending on the action. We have two possible ways to extract those, either via SNMP or via streaming telemetry and we are going to use both. For IOS-XR, on the other-hand, there are no SNMP flowspec related OIDs, but there is a dedicated flowspec YANG model we can use to extract the counters via streaming telemetry.</p><p>The various tools and device versions used throughout the use case are listed below:</p><ul><li>Kentik kagent docker container</li><li>snmpwalk and snmptable</li><li>gnmic</li><li>Junos vMX on 21.3R1.9</li><li>Cisco IOS-XRv 9000 on 7.9.1</li></ul><p>You may find all relevant files in my <a href=https://github.com/becos76/kentik-custom-metrics target=_blank rel="external nofollow noopener noreferrer">repo</a>.</p><hr><h2 class=heading-element id=kentik-universal-agent-kagent><span>Kentik Universal Agent (kagent)</span>
<a href=#kentik-universal-agent-kagent class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>In order to use the custom metrics feature on the kagent we need some local configuration to be picked up by the agent on startup so it can be processed. In summary, we need three configuration files to exist localy in a specific directory structure that we can call the <em>override</em> directory.</p><p>Below is the structure along with a brief explanation on the purpose of each one.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl>/opt/kentik/components/ranger/local/
</span></span><span class=line><span class=cl>└── config
</span></span><span class=line><span class=cl>    ├── profiles        <span class=c1># Holds the configuration yaml files for &#39;binding&#39; the sources to specific &#39;device&#39; types</span>
</span></span><span class=line><span class=cl>    ├── reports         <span class=c1># Holds the configuration yaml files for &#39;how&#39; we want to report what is collected from the sources in the portal</span>
</span></span><span class=line><span class=cl>    └── sources         <span class=c1># Holds the configuration yaml files for &#39;what&#39; we want to poll from the device</span></span></span></code></pre></div><p>So once kagent starts it looks for the <code>local</code> folder and it processes those files in the structure. For example, if we want to poll an SNMP OID for a device, we would need to create a configuration file under the <code>sources</code> directory specifying which OID to poll and how often. Then we need to <em>bind</em> this source to only get polled if say the device is of a specific sysObjectID, and we do that in the <code>profiles</code> directory. Lastly, in the <code>reports</code> directory we define the path to present the data in the portal, how the data is represented and polled from the MIB, i.e. metrics or dimensions, and how often to update the values in the database. Additionally, in the <code>reports</code> directory we can use <code>starlark</code> scripts to add additional logic to our reporting capabilities.</p><h3 class=heading-element id=kagent-container><span>Kagent container</span>
<a href=#kagent-container class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>We are going to be running our kagent instance as a container through compose. Here is how our directory structure looks like:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl>/opt/dev/kentik/
</span></span><span class=line><span class=cl>├── docker-compose.yml     <span class=c1># How to bring up the container</span>
</span></span><span class=line><span class=cl>├── kagent-data            <span class=c1># Local dir mount so kagent data persists -&gt; /opt/kentik in the container</span>
</span></span><span class=line><span class=cl>└── override-data          <span class=c1># Local overrides directory with custom definitions -&gt; /opt/kentik/components/ranger/local in the container</span>
</span></span><span class=line><span class=cl>    └── config
</span></span><span class=line><span class=cl>        ├── profiles
</span></span><span class=line><span class=cl>        ├── reports
</span></span><span class=line><span class=cl>        └── sources</span></span></code></pre></div><p>And here is the docker compose file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-YAML data-lang=YAML><span class=line><span class=cl><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>kagent</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>hostname</span><span class=p>:</span><span class=w> </span><span class=l>kagent03</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>kentik/kagent:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class=l>unless-stopped</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>pull_policy</span><span class=p>:</span><span class=w> </span><span class=l>always</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>cap_add</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>NET_RAW</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>K_COMPANY_ID=&lt;REDACTED&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>K_API_ROOT=grpc.api.kentik.eu:443</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c>#- K_LOG_LEVEL=debug</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>/opt/dev/kentik/kagent-data:/opt/kentik</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>/opt/dev/kentik/override-data:/opt/kentik/components/ranger/local/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span></span></span></code></pre></div><hr><h2 class=heading-element id=junos-firewall-filters><span>Junos Firewall Filters</span>
<a href=#junos-firewall-filters class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>In Junos the flowspec rules create relevant ad-hoc firewall filters and policers that are applied to the linecards and can be examined via the show firewall detail command. Here is what we get with nothing configured:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl>netops@ATH-POP1-VMX1&gt; show configuration firewall
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>netops@ATH-POP1-VMX1&gt; show firewall detail
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Filter: __default_bpdu_filter__</span></span></code></pre></div><p>And here is what we get if we configure a filter to count SSH packets destined to the management IP of the device and two manual mitigations from the portal, one to block traffic and one to rate limit:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl>netops@ATH-POP1-VMX1&gt; show firewall detail
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Filter: __default_bpdu_filter__
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Filter: TEST-FIREWALL
</span></span><span class=line><span class=cl>Counters:
</span></span><span class=line><span class=cl>Name                                                Bytes              Packets
</span></span><span class=line><span class=cl>SSH-PACKETS                                         <span class=m>74932</span>                 <span class=m>1153</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Filter: __flowspec_default_inet__
</span></span><span class=line><span class=cl>Counters:
</span></span><span class=line><span class=cl>Name                                                Bytes              Packets
</span></span><span class=line><span class=cl>10.11.10.10,*,icmp-type<span class=o>=</span><span class=m>8</span>                           <span class=m>41496</span>                   <span class=m>30</span>
</span></span><span class=line><span class=cl>10.11.10.10,*,proto<span class=o>=</span>6,dstport<span class=o>=</span><span class=m>5201</span>                 <span class=m>172233</span>                  <span class=m>184</span>
</span></span><span class=line><span class=cl>Policers:
</span></span><span class=line><span class=cl>Name                                                Bytes              Packets
</span></span><span class=line><span class=cl>40K_10.11.10.10,*,proto<span class=o>=</span>6,dstport<span class=o>=</span><span class=m>5201</span>               <span class=m>402000</span>                  <span class=m>268</span></span></span></code></pre></div><p>So any flowpsec rule received is reported under the <code>__flowspec_default_inet__</code> filter. The one that blocks ICMP traffic is a counter and the one that limits IPERF is both a counter and a policer.</p><h3 class=heading-element id=snmp><span>SNMP</span>
<a href=#snmp class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>It seems that Juniper has a dedicated MIB for reporting those firewall metrics, the <em>JUNOS-FIREWALL-MIB</em> and after downloading all juniper MIBs in my <code>~/.snmp/mibs</code> directory and grepping for Firewall I got this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl>jnxFirewallsTable   OBJECT-TYPE
</span></span><span class=line><span class=cl>        SYNTAX      SEQUENCE OF JnxFirewallsEntry
</span></span><span class=line><span class=cl>        MAX-ACCESS  not-accessible
</span></span><span class=line><span class=cl>        STATUS      deprecated
</span></span><span class=line><span class=cl>        DESCRIPTION
</span></span><span class=line><span class=cl>                <span class=s2>&#34;A list of firewalls entries.
</span></span></span><span class=line><span class=cl><span class=s2>                NOTE:  This table is deprecated and exists for backward
</span></span></span><span class=line><span class=cl><span class=s2>                compatibility.  The user is encouraged to use
</span></span></span><span class=line><span class=cl><span class=s2>                jnxFirewallCounterTable.  This table does not handle:
</span></span></span><span class=line><span class=cl><span class=s2>                1) counter and filter names greater than 24 characters
</span></span></span><span class=line><span class=cl><span class=s2>                2) counters with same names but different types (the first
</span></span></span><span class=line><span class=cl><span class=s2>                  duplicate is returned only)&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        ::<span class=o>=</span> <span class=o>{</span> jnxFirewalls <span class=m>1</span> <span class=o>}</span></span></span></code></pre></div><p>So the interesting OID to be polled is the <code>jnxFirewallCounterTable</code> at <strong>1.3.6.1.4.1.2636.3.5.2</strong>. Let’s use snmptable to see what we get:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl>$ snmptable -v2c -c kentik -m all 10.11.255.1 jnxFirewallCounterTable
</span></span><span class=line><span class=cl>SNMP table: JUNIPER-FIREWALL-MIB::jnxFirewallCounterTable
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> jnxFWCounterPacketCount jnxFWCounterByteCount jnxFWCounterDisplayFilterName                jnxFWCounterDisplayName jnxFWCounterDisplayType
</span></span><span class=line><span class=cl>                    <span class=m>1118</span>                 <span class=m>72508</span>                 TEST-FIREWALL                            SSH-PACKETS                 counter
</span></span><span class=line><span class=cl>                       <span class=m>0</span>                     <span class=m>0</span>       __default_arp_policer__                __default_arp_policer__                 policer
</span></span><span class=line><span class=cl>                      <span class=m>30</span>                 <span class=m>41496</span>     __flowspec_default_inet__              10.11.10.10,*,icmp-type<span class=o>=</span><span class=m>8</span>                 counter
</span></span><span class=line><span class=cl>                     <span class=m>184</span>                <span class=m>172233</span>     __flowspec_default_inet__     10.11.10.10,*,proto<span class=o>=</span>6,dstport<span class=o>=</span><span class=m>5201</span>                 counter
</span></span><span class=line><span class=cl>                     <span class=m>268</span>                <span class=m>402000</span>     __flowspec_default_inet__ 40K_10.11.10.10,*,proto<span class=o>=</span>6,dstport<span class=o>=</span><span class=m>5201</span>                 policer</span></span></code></pre></div><h4 class=heading-element id=local-configuration><span>Local Configuration</span>
<a href=#local-configuration class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>From this point onward we can define our custom metrics in the relevant <em>overrides</em> sub-directories</p><p style=background-color:skyblue;text-align:center><b>Sources file</b></p><p>We are going to poll the table every 1 minute.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-YAML data-lang=YAML><span class=line><span class=cl><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>junos-fw-snmp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>sources</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>sources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>junos-fw-snmp</span><span class=p>:</span><span class=w> </span>!<span class=l>snmp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>table</span><span class=p>:</span><span class=w> </span><span class=m>1.3.6.1.4.1.2636.3.5.2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class=l>60s</span></span></span></code></pre></div><p style=background-color:skyblue;text-align:center><b>Profiles file</b></p><p>We will bind the source to the vMX sysObjectId</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-YAML data-lang=YAML><span class=line><span class=cl><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>junos-fw-snmp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>profile</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>profile</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>match</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>sysobjectid</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=m>1.3.6.1.4.1.2636.1.1.1.2.108</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>reports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>junos-fw-snmp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>include</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>device_name_ip</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>sources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>junos-fw-snmp</span></span></span></code></pre></div><p style=background-color:skyblue;text-align:center><b>Reports file</b></p><p>We are going to report those under the <code>/junos/firewall/snmp</code> schema path in the Portal and we define the mapping on the table fields identifying the metrics:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-YAML data-lang=YAML><span class=line><span class=cl><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>junos-fw-snmp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>reports</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>reports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>/junos/firewall/snmp</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>combine</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>table0</span><span class=p>:</span><span class=w> </span>!<span class=l>snmp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>table</span><span class=p>:</span><span class=w> </span><span class=m>1.3.6.1.4.1.2636.3.5.2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>index</span><span class=p>:</span><span class=w> </span><span class=l>$index0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>fields</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>packets</span><span class=p>:</span><span class=w> </span>!<span class=l>snmp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>table</span><span class=p>:</span><span class=w> </span><span class=m>1.3.6.1.4.1.2636.3.5.2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=m>1.3.6.1.4.1.2636.3.5.2.1.4</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>metric</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>bytes</span><span class=p>:</span><span class=w> </span>!<span class=l>snmp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>table</span><span class=p>:</span><span class=w> </span><span class=m>1.3.6.1.4.1.2636.3.5.2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=m>1.3.6.1.4.1.2636.3.5.2.1.5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>metric</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>filter_name</span><span class=p>:</span><span class=w> </span>!<span class=l>snmp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>table</span><span class=p>:</span><span class=w> </span><span class=m>1.3.6.1.4.1.2636.3.5.2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=m>1.3.6.1.4.1.2636.3.5.2.1.6</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>metric</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>counter_name</span><span class=p>:</span><span class=w> </span>!<span class=l>snmp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>table</span><span class=p>:</span><span class=w> </span><span class=m>1.3.6.1.4.1.2636.3.5.2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=m>1.3.6.1.4.1.2636.3.5.2.1.7</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>metric</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>counter_type</span><span class=p>:</span><span class=w> </span>!<span class=l>snmp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>table</span><span class=p>:</span><span class=w> </span><span class=m>1.3.6.1.4.1.2636.3.5.2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=m>1.3.6.1.4.1.2636.3.5.2.1.8</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>metric</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>tweak</span><span class=p>:</span><span class=w> </span>!<span class=l>enum</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>1</span><span class=p>:</span><span class=w> </span><span class=l>other</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>2</span><span class=p>:</span><span class=w> </span><span class=l>counter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>3</span><span class=p>:</span><span class=w> </span><span class=l>policer</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class=l>60s</span></span></span></code></pre></div><p>Here is how our <em>overrides</em> directory structure looks like:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl>override-data/
</span></span><span class=line><span class=cl>└── config
</span></span><span class=line><span class=cl>    ├── profiles
</span></span><span class=line><span class=cl>    │   ├── junos-fw-snmp.yml
</span></span><span class=line><span class=cl>    ├── reports
</span></span><span class=line><span class=cl>    │   ├── junos-fw-snmp.yml
</span></span><span class=line><span class=cl>    └── sources
</span></span><span class=line><span class=cl>        └── junos-fw-snmp.yml</span></span></code></pre></div><p>I&rsquo;ve used the same file name for these but it could be anything. Resources are referenced via the metadata name key and not by the filename.</p><h4 class=heading-element id=kagent-bring-up><span>Kagent Bring Up</span>
<a href=#kagent-bring-up class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>Next step is to bring up the container and see what we get, but it seems there is an error:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-JSON data-lang=JSON><span class=line><span class=cl><span class=p>{</span><span class=nt>&#34;level&#34;</span><span class=p>:</span><span class=s2>&#34;error&#34;</span><span class=p>,</span><span class=nt>&#34;error&#34;</span><span class=p>:</span><span class=s2>&#34;OID 1.3.6.1.4.1.2636.3.5.2 in table source jnxFirewallCounterTable 
</span></span></span><span class=line><span class=cl><span class=s2> loaded from config/sources/snmp/juniper.yml also appears in table source junos-fw-snmp 
</span></span></span><span class=line><span class=cl><span class=s2> loaded from sources/junos-fw-snmp.yml&#34;</span><span class=p>,</span><span class=nt>&#34;time&#34;</span><span class=p>:</span><span class=s2>&#34;2024-05-03T16:51:41Z&#34;</span><span class=p>,</span><span class=nt>&#34;message&#34;</span><span class=p>:</span><span class=s2>&#34;invalid config&#34;</span><span class=p>}</span></span></span></code></pre></div><p>This means that kagent is already configured to poll this OID from the file mentioned.<div class="details admonition note open"><div class="details-summary admonition-title"><i class="icon fa-fw fa-solid fa-pencil-alt" aria-hidden=true></i>Kagent Default Config<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>Kagent is pulling its <em>default configuration</em> each time is brought up and this is in the <code>/opt/kentik/components/ranger/current/LATEST.zip</code> file</div></div></div>So after unziping the file and looking into the file mentioned we see that the definition is there and the table is polled every five minutes:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl>$ cat config/sources/snmp/juniper.yml <span class=p>|</span> grep FirewallCounter -A3
</span></span><span class=line><span class=cl>  jnxFirewallCounterTable: !snmp
</span></span><span class=line><span class=cl>    table: 1.3.6.1.4.1.2636.3.5.2
</span></span><span class=line><span class=cl>    interval: 5m</span></span></code></pre></div><p>In this case, since we can have reports and profiles referring to existing sources in the <code>LATEST.zip</code> file we are going to remove the sources definition file and remove the reference in the profiles. Furthermore, we are going to adjust the interval in the profile definition since there is no reason to report more frequently than we gather the data at this point.</p><p>Upon restarting kagent, the <em>overrides</em> directory is picked up with no errors:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-JSON data-lang=JSON><span class=line><span class=cl><span class=p>{</span><span class=nt>&#34;level&#34;</span><span class=p>:</span><span class=s2>&#34;info&#34;</span><span class=p>,</span><span class=nt>&#34;path&#34;</span><span class=p>:</span><span class=s2>&#34;../local/config&#34;</span><span class=p>,</span><span class=nt>&#34;time&#34;</span><span class=p>:</span><span class=s2>&#34;2024-05-03T17:12:58Z&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl> <span class=nt>&#34;message&#34;</span><span class=p>:</span><span class=s2>&#34;optional/override config directory exists, using&#34;</span><span class=p>}</span></span></span></code></pre></div><h4 class=heading-element id=kentik-portal><span>Kentik Portal</span>
<a href=#kentik-portal class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>In the portal, the metrics are available under the configured path:</p><figure><a class=lightgallery href=/posts/kustom-metrics/img_001.png title=/posts/kustom-metrics/img_001.png data-thumbnail=/posts/kustom-metrics/img_001.png data-sub-html="<h2>SCHEMA path</h2>"><img loading=lazy src=/posts/kustom-metrics/img_001.png alt=/posts/kustom-metrics/img_001.png height=1098 width=400></a><figcaption class=image-caption>SCHEMA path</figcaption></figure><p>The table is populating:<figure><a class=lightgallery href=/posts/kustom-metrics/img_002.png title=/posts/kustom-metrics/img_002.png data-thumbnail=/posts/kustom-metrics/img_002.png data-sub-html="<h2>Junos Metrics Table</h2>"><img loading=lazy src=/posts/kustom-metrics/img_002.png alt=/posts/kustom-metrics/img_002.png height=311 width=2000></a><figcaption class=image-caption>Junos Metrics Table</figcaption></figure></p><p>After a while the chart started graphing as well<figure><a class=lightgallery href=/posts/kustom-metrics/img_003.png title=/posts/kustom-metrics/img_003.png data-thumbnail=/posts/kustom-metrics/img_003.png data-sub-html="<h2>Junos Metrics Chart</h2>"><img loading=lazy src=/posts/kustom-metrics/img_003.png alt=/posts/kustom-metrics/img_003.png height=711 width=2000></a><figcaption class=image-caption>Junos Metrics Chart</figcaption></figure></p><h3 class=heading-element id=grpc><span>GRPC</span>
<a href=#grpc class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>Let’s try now to get the same via streaming telemetry and GRPC. According to <a href=https://www.juniper.net/documentation/us/en/software/junos/interfaces-telemetry/topics/concept/junos-telemetry-interface-grpc-sensors.html target=_blank rel="external nofollow noopener noreferrer">this</a> we can get those metrics under the <code>/junos/system/linecard/firewall</code> path.</p><p>Using gnmic (I could only get data via subscriptions and not get rpc calls):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-JSON data-lang=JSON><span class=line><span class=cl><span class=err>$</span> <span class=err>gnmic</span> <span class=err>-a</span> <span class=mf>10.11</span><span class=err>.</span><span class=mf>255.1</span><span class=err>:</span><span class=mi>32767</span> <span class=err>-u</span> <span class=err>&lt;username&gt;-p</span> <span class=err>&lt;password&gt;</span> <span class=err>--skip-verify</span> <span class=err>sub</span> <span class=err>--mode</span> <span class=err>once</span> <span class=err>--path</span> <span class=err>/junos/system/linecard/firewall</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;source&#34;</span><span class=p>:</span> <span class=s2>&#34;10.11.255.1:32767&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;subscription-name&#34;</span><span class=p>:</span> <span class=s2>&#34;default-1714758367&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;timestamp&#34;</span><span class=p>:</span> <span class=mi>1714758371632000000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;time&#34;</span><span class=p>:</span> <span class=s2>&#34;2024-05-03T20:46:11.632+03:00&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;prefix&#34;</span><span class=p>:</span> <span class=s2>&#34;junos/firewall[name=__default_bpdu_filter__]/state&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;updates&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Path&#34;</span><span class=p>:</span> <span class=s2>&#34;timestamp&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;values&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;timestamp&#34;</span><span class=p>:</span> <span class=mi>1714746658</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Path&#34;</span><span class=p>:</span> <span class=s2>&#34;memory-usage[name=HEAP]/allocated&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;values&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;memory-usage/allocated&#34;</span><span class=p>:</span> <span class=mi>2596</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;source&#34;</span><span class=p>:</span> <span class=s2>&#34;10.11.255.1:32767&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;subscription-name&#34;</span><span class=p>:</span> <span class=s2>&#34;default-1714758367&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;timestamp&#34;</span><span class=p>:</span> <span class=mi>1714758371632000000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;time&#34;</span><span class=p>:</span> <span class=s2>&#34;2024-05-03T20:46:11.632+03:00&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;prefix&#34;</span><span class=p>:</span> <span class=s2>&#34;junos/firewall[name=TEST-FIREWALL]/state&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;updates&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Path&#34;</span><span class=p>:</span> <span class=s2>&#34;timestamp&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;values&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;timestamp&#34;</span><span class=p>:</span> <span class=mi>1714746658</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Path&#34;</span><span class=p>:</span> <span class=s2>&#34;memory-usage[name=HEAP]/allocated&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;values&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;memory-usage/allocated&#34;</span><span class=p>:</span> <span class=mi>4004</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Path&#34;</span><span class=p>:</span> <span class=s2>&#34;counter[name=SSH-PACKETS]/packets&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;values&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;counter/packets&#34;</span><span class=p>:</span> <span class=mi>1162</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Path&#34;</span><span class=p>:</span> <span class=s2>&#34;counter[name=SSH-PACKETS]/bytes&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;values&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;counter/bytes&#34;</span><span class=p>:</span> <span class=mi>75400</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;source&#34;</span><span class=p>:</span> <span class=s2>&#34;10.11.255.1:32767&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;subscription-name&#34;</span><span class=p>:</span> <span class=s2>&#34;default-1714758367&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;timestamp&#34;</span><span class=p>:</span> <span class=mi>1714758371632000000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;time&#34;</span><span class=p>:</span> <span class=s2>&#34;2024-05-03T20:46:11.632+03:00&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;prefix&#34;</span><span class=p>:</span> <span class=s2>&#34;junos/firewall[name=__default_arp_policer__]/state&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;updates&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Path&#34;</span><span class=p>:</span> <span class=s2>&#34;timestamp&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;values&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;timestamp&#34;</span><span class=p>:</span> <span class=mi>1714403887</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Path&#34;</span><span class=p>:</span> <span class=s2>&#34;memory-usage[name=HEAP]/allocated&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;values&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;memory-usage/allocated&#34;</span><span class=p>:</span> <span class=mi>1652</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Path&#34;</span><span class=p>:</span> <span class=s2>&#34;policer[name=__default_arp_policer__]/out-of-spec-packets&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;values&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;policer/out-of-spec-packets&#34;</span><span class=p>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Path&#34;</span><span class=p>:</span> <span class=s2>&#34;policer[name=__default_arp_policer__]/out-of-spec-bytes&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;values&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;policer/out-of-spec-bytes&#34;</span><span class=p>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Path&#34;</span><span class=p>:</span> <span class=s2>&#34;policer[name=__default_arp_policer__]/offered-packets&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;values&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;policer/offered-packets&#34;</span><span class=p>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Path&#34;</span><span class=p>:</span> <span class=s2>&#34;policer[name=__default_arp_policer__]/offered-bytes&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;values&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;policer/offered-bytes&#34;</span><span class=p>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Path&#34;</span><span class=p>:</span> <span class=s2>&#34;policer[name=__default_arp_policer__]/transmitted-packets&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;values&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;policer/transmitted-packets&#34;</span><span class=p>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Path&#34;</span><span class=p>:</span> <span class=s2>&#34;policer[name=__default_arp_policer__]/transmitted-bytes&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;values&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;policer/transmitted-bytes&#34;</span><span class=p>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;source&#34;</span><span class=p>:</span> <span class=s2>&#34;10.11.255.1:32767&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;subscription-name&#34;</span><span class=p>:</span> <span class=s2>&#34;default-1714758367&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;timestamp&#34;</span><span class=p>:</span> <span class=mi>1714758371632000000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;time&#34;</span><span class=p>:</span> <span class=s2>&#34;2024-05-03T20:46:11.632+03:00&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;prefix&#34;</span><span class=p>:</span> <span class=s2>&#34;junos/firewall[name=__flowspec_default_inet__]/state&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;updates&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Path&#34;</span><span class=p>:</span> <span class=s2>&#34;timestamp&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;values&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;timestamp&#34;</span><span class=p>:</span> <span class=mi>1714753321</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Path&#34;</span><span class=p>:</span> <span class=s2>&#34;memory-usage[name=HEAP]/allocated&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;values&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;memory-usage/allocated&#34;</span><span class=p>:</span> <span class=mi>7172</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Path&#34;</span><span class=p>:</span> <span class=s2>&#34;counter[name=10.11.10.10,*,icmp-type=8]/packets&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;values&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;counter/packets&#34;</span><span class=p>:</span> <span class=mi>1315</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Path&#34;</span><span class=p>:</span> <span class=s2>&#34;counter[name=10.11.10.10,*,icmp-type=8]/bytes&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;values&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;counter/bytes&#34;</span><span class=p>:</span> <span class=mi>1876476</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Path&#34;</span><span class=p>:</span> <span class=s2>&#34;counter[name=10.11.10.10,*,proto=6,dstport=5201]/packets&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;values&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;counter/packets&#34;</span><span class=p>:</span> <span class=mi>3311</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Path&#34;</span><span class=p>:</span> <span class=s2>&#34;counter[name=10.11.10.10,*,proto=6,dstport=5201]/bytes&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;values&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;counter/bytes&#34;</span><span class=p>:</span> <span class=mi>4738920</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Path&#34;</span><span class=p>:</span> <span class=s2>&#34;policer[name=40K_10.11.10.10,*,proto=6,dstport=5201]/out-of-spec-packets&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;values&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;policer/out-of-spec-packets&#34;</span><span class=p>:</span> <span class=mi>6891</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Path&#34;</span><span class=p>:</span> <span class=s2>&#34;policer[name=40K_10.11.10.10,*,proto=6,dstport=5201]/out-of-spec-bytes&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;values&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;policer/out-of-spec-bytes&#34;</span><span class=p>:</span> <span class=mi>10336500</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Path&#34;</span><span class=p>:</span> <span class=s2>&#34;policer[name=40K_10.11.10.10,*,proto=6,dstport=5201]/offered-packets&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;values&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;policer/offered-packets&#34;</span><span class=p>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Path&#34;</span><span class=p>:</span> <span class=s2>&#34;policer[name=40K_10.11.10.10,*,proto=6,dstport=5201]/offered-bytes&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;values&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;policer/offered-bytes&#34;</span><span class=p>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Path&#34;</span><span class=p>:</span> <span class=s2>&#34;policer[name=40K_10.11.10.10,*,proto=6,dstport=5201]/transmitted-packets&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;values&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;policer/transmitted-packets&#34;</span><span class=p>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Path&#34;</span><span class=p>:</span> <span class=s2>&#34;policer[name=40K_10.11.10.10,*,proto=6,dstport=5201]/transmitted-bytes&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;values&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;policer/transmitted-bytes&#34;</span><span class=p>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;source&#34;</span><span class=p>:</span> <span class=s2>&#34;10.11.255.1:32767&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;subscription-name&#34;</span><span class=p>:</span> <span class=s2>&#34;default-1714758367&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;timestamp&#34;</span><span class=p>:</span> <span class=mi>1714758371633000000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;time&#34;</span><span class=p>:</span> <span class=s2>&#34;2024-05-03T20:46:11.633+03:00&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;prefix&#34;</span><span class=p>:</span> <span class=s2>&#34;junos/firewall[name=__default_bpdu_filter__]/state&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;updates&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Path&#34;</span><span class=p>:</span> <span class=s2>&#34;timestamp&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;values&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;timestamp&#34;</span><span class=p>:</span> <span class=mi>1714746658</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Path&#34;</span><span class=p>:</span> <span class=s2>&#34;memory-usage[name=HEAP]/allocated&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;values&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;memory-usage/allocated&#34;</span><span class=p>:</span> <span class=mi>2596</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;source&#34;</span><span class=p>:</span> <span class=s2>&#34;10.11.255.1:32767&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;subscription-name&#34;</span><span class=p>:</span> <span class=s2>&#34;default-1714758367&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;timestamp&#34;</span><span class=p>:</span> <span class=mi>1714758371633000000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;time&#34;</span><span class=p>:</span> <span class=s2>&#34;2024-05-03T20:46:11.633+03:00&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;prefix&#34;</span><span class=p>:</span> <span class=s2>&#34;junos/firewall[name=TEST-FIREWALL]/state&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;updates&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Path&#34;</span><span class=p>:</span> <span class=s2>&#34;timestamp&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;values&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;timestamp&#34;</span><span class=p>:</span> <span class=mi>1714746658</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Path&#34;</span><span class=p>:</span> <span class=s2>&#34;memory-usage[name=HEAP]/allocated&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;values&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;memory-usage/allocated&#34;</span><span class=p>:</span> <span class=mi>4004</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Path&#34;</span><span class=p>:</span> <span class=s2>&#34;counter[name=SSH-PACKETS]/packets&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;values&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;counter/packets&#34;</span><span class=p>:</span> <span class=mi>1162</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Path&#34;</span><span class=p>:</span> <span class=s2>&#34;counter[name=SSH-PACKETS]/bytes&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;values&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;counter/bytes&#34;</span><span class=p>:</span> <span class=mi>75400</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;source&#34;</span><span class=p>:</span> <span class=s2>&#34;10.11.255.1:32767&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;subscription-name&#34;</span><span class=p>:</span> <span class=s2>&#34;default-1714758367&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;timestamp&#34;</span><span class=p>:</span> <span class=mi>1714758371633000000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;time&#34;</span><span class=p>:</span> <span class=s2>&#34;2024-05-03T20:46:11.633+03:00&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;prefix&#34;</span><span class=p>:</span> <span class=s2>&#34;junos/firewall[name=__default_arp_policer__]/state&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;updates&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Path&#34;</span><span class=p>:</span> <span class=s2>&#34;timestamp&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;values&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;timestamp&#34;</span><span class=p>:</span> <span class=mi>1714403887</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Path&#34;</span><span class=p>:</span> <span class=s2>&#34;memory-usage[name=HEAP]/allocated&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;values&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;memory-usage/allocated&#34;</span><span class=p>:</span> <span class=mi>1652</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;source&#34;</span><span class=p>:</span> <span class=s2>&#34;10.11.255.1:32767&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;subscription-name&#34;</span><span class=p>:</span> <span class=s2>&#34;default-1714758367&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;timestamp&#34;</span><span class=p>:</span> <span class=mi>1714758371633000000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;time&#34;</span><span class=p>:</span> <span class=s2>&#34;2024-05-03T20:46:11.633+03:00&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;prefix&#34;</span><span class=p>:</span> <span class=s2>&#34;junos/firewall[name=__flowspec_default_inet__]/state&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;updates&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Path&#34;</span><span class=p>:</span> <span class=s2>&#34;timestamp&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;values&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;timestamp&#34;</span><span class=p>:</span> <span class=mi>1714753321</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Path&#34;</span><span class=p>:</span> <span class=s2>&#34;memory-usage[name=HEAP]/allocated&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;values&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;memory-usage/allocated&#34;</span><span class=p>:</span> <span class=mi>7172</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Path&#34;</span><span class=p>:</span> <span class=s2>&#34;counter[name=10.11.10.10,*,icmp-type=8]/packets&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;values&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;counter/packets&#34;</span><span class=p>:</span> <span class=mi>1315</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Path&#34;</span><span class=p>:</span> <span class=s2>&#34;counter[name=10.11.10.10,*,icmp-type=8]/bytes&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;values&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;counter/bytes&#34;</span><span class=p>:</span> <span class=mi>1876476</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Path&#34;</span><span class=p>:</span> <span class=s2>&#34;counter[name=10.11.10.10,*,proto=6,dstport=5201]/packets&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;values&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;counter/packets&#34;</span><span class=p>:</span> <span class=mi>3311</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Path&#34;</span><span class=p>:</span> <span class=s2>&#34;counter[name=10.11.10.10,*,proto=6,dstport=5201]/bytes&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;values&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;counter/bytes&#34;</span><span class=p>:</span> <span class=mi>4738920</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Path&#34;</span><span class=p>:</span> <span class=s2>&#34;policer[name=40K_10.11.10.10,*,proto=6,dstport=5201]/out-of-spec-packets&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;values&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;policer/out-of-spec-packets&#34;</span><span class=p>:</span> <span class=mi>6891</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Path&#34;</span><span class=p>:</span> <span class=s2>&#34;policer[name=40K_10.11.10.10,*,proto=6,dstport=5201]/out-of-spec-bytes&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;values&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;policer/out-of-spec-bytes&#34;</span><span class=p>:</span> <span class=mi>10336500</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Let&rsquo;s briefly look at the paths returned to better understand what we are getting via this subscription:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-YAML data-lang=YAML><span class=line><span class=cl><span class=l>$ gnmic -a 10.11.255.1:32767 -u &lt;username&gt; -p &lt;password&gt; --skip-verify sub --mode once --path /junos/system/linecard/firewall | grep -e prefix -e Path</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>&#34;prefix&#34;: </span><span class=s2>&#34;junos/firewall[name=__default_bpdu_filter__]/state&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;Path&#34;: </span><span class=s2>&#34;timestamp&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;Path&#34;: </span><span class=s2>&#34;memory-usage[name=HEAP]/allocated&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>&#34;prefix&#34;: </span><span class=s2>&#34;junos/firewall[name=TEST-FIREWALL]/state&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;Path&#34;: </span><span class=s2>&#34;timestamp&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;Path&#34;: </span><span class=s2>&#34;memory-usage[name=HEAP]/allocated&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;Path&#34;: </span><span class=s2>&#34;counter[name=SSH-PACKETS]/packets&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;Path&#34;: </span><span class=s2>&#34;counter[name=SSH-PACKETS]/bytes&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>&#34;prefix&#34;: </span><span class=s2>&#34;junos/firewall[name=__default_arp_policer__]/state&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;Path&#34;: </span><span class=s2>&#34;timestamp&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;Path&#34;: </span><span class=s2>&#34;memory-usage[name=HEAP]/allocated&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;Path&#34;: </span><span class=s2>&#34;policer[name=__default_arp_policer__]/out-of-spec-packets&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;Path&#34;: </span><span class=s2>&#34;policer[name=__default_arp_policer__]/out-of-spec-bytes&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;Path&#34;: </span><span class=s2>&#34;policer[name=__default_arp_policer__]/offered-packets&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;Path&#34;: </span><span class=s2>&#34;policer[name=__default_arp_policer__]/offered-bytes&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;Path&#34;: </span><span class=s2>&#34;policer[name=__default_arp_policer__]/transmitted-packets&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;Path&#34;: </span><span class=s2>&#34;policer[name=__default_arp_policer__]/transmitted-bytes&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>&#34;prefix&#34;: </span><span class=s2>&#34;junos/firewall[name=__flowspec_default_inet__]/state&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;Path&#34;: </span><span class=s2>&#34;timestamp&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;Path&#34;: </span><span class=s2>&#34;memory-usage[name=HEAP]/allocated&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;Path&#34;: </span><span class=s2>&#34;counter[name=10.11.10.10,*,icmp-type=8]/packets&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;Path&#34;: </span><span class=s2>&#34;counter[name=10.11.10.10,*,icmp-type=8]/bytes&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;Path&#34;: </span><span class=s2>&#34;counter[name=10.11.10.10,*,proto=6,dstport=5201]/packets&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;Path&#34;: </span><span class=s2>&#34;counter[name=10.11.10.10,*,proto=6,dstport=5201]/bytes&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;Path&#34;: </span><span class=s2>&#34;policer[name=40K_10.11.10.10,*,proto=6,dstport=5201]/out-of-spec-packets&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;Path&#34;: </span><span class=s2>&#34;policer[name=40K_10.11.10.10,*,proto=6,dstport=5201]/out-of-spec-bytes&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;Path&#34;: </span><span class=s2>&#34;policer[name=40K_10.11.10.10,*,proto=6,dstport=5201]/offered-packets&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;Path&#34;: </span><span class=s2>&#34;policer[name=40K_10.11.10.10,*,proto=6,dstport=5201]/offered-bytes&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;Path&#34;: </span><span class=s2>&#34;policer[name=40K_10.11.10.10,*,proto=6,dstport=5201]/transmitted-packets&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;Path&#34;: </span><span class=s2>&#34;policer[name=40K_10.11.10.10,*,proto=6,dstport=5201]/transmitted-bytes&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>&#34;prefix&#34;: </span><span class=s2>&#34;junos/firewall[name=__default_bpdu_filter__]/state&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;Path&#34;: </span><span class=s2>&#34;timestamp&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;Path&#34;: </span><span class=s2>&#34;memory-usage[name=HEAP]/allocated&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>&#34;prefix&#34;: </span><span class=s2>&#34;junos/firewall[name=TEST-FIREWALL]/state&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;Path&#34;: </span><span class=s2>&#34;timestamp&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;Path&#34;: </span><span class=s2>&#34;memory-usage[name=HEAP]/allocated&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;Path&#34;: </span><span class=s2>&#34;counter[name=SSH-PACKETS]/packets&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;Path&#34;: </span><span class=s2>&#34;counter[name=SSH-PACKETS]/bytes&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>&#34;prefix&#34;: </span><span class=s2>&#34;junos/firewall[name=__default_arp_policer__]/state&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;Path&#34;: </span><span class=s2>&#34;timestamp&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;Path&#34;: </span><span class=s2>&#34;memory-usage[name=HEAP]/allocated&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>&#34;prefix&#34;: </span><span class=s2>&#34;junos/firewall[name=__flowspec_default_inet__]/state&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;Path&#34;: </span><span class=s2>&#34;timestamp&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;Path&#34;: </span><span class=s2>&#34;memory-usage[name=HEAP]/allocated&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;Path&#34;: </span><span class=s2>&#34;counter[name=10.11.10.10,*,icmp-type=8]/packets&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;Path&#34;: </span><span class=s2>&#34;counter[name=10.11.10.10,*,icmp-type=8]/bytes&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;Path&#34;: </span><span class=s2>&#34;counter[name=10.11.10.10,*,proto=6,dstport=5201]/packets&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;Path&#34;: </span><span class=s2>&#34;counter[name=10.11.10.10,*,proto=6,dstport=5201]/bytes&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;Path&#34;: </span><span class=s2>&#34;policer[name=40K_10.11.10.10,*,proto=6,dstport=5201]/out-of-spec-packets&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;Path&#34;: </span><span class=s2>&#34;policer[name=40K_10.11.10.10,*,proto=6,dstport=5201]/out-of-spec-bytes&#34;</span><span class=p>,</span></span></span></code></pre></div><p>It looks like we are getting the allocated memory per filter and the relevant metrics according to if the filter is a counter or policer. Let&rsquo;s create the relevant local overrides files. In the reports file we need extra processing on the data returned from the subscription before it is stored in the database and this is done via the use of starlark scripts.</p><h4 class=heading-element id=local-configuration-take-1><span>Local Configuration (take 1)</span>
<a href=#local-configuration-take-1 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p style=background-color:skyblue;text-align:center><b>Sources file</b></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-YAML data-lang=YAML><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>junos-fw-grpc</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>sources</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>sources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>junos-fw-grpc</span><span class=p>:</span><span class=w> </span>!<span class=l>gnmi</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>/junos/system/linecard/firewall/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>mode</span><span class=p>:</span><span class=w> </span><span class=l>SAMPLE</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>extra</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>sample_interval</span><span class=p>:</span><span class=w> </span><span class=l>30s</span></span></span></code></pre></div><p style=background-color:skyblue;text-align:center><b>Profiles file</b></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-YAML data-lang=YAML><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>junos-fw-grpc</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>profile</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>profile</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>match</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>sysobjectid</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=m>1.3.6.1.4.1.2636.1.1.1.2.108</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>features</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>gnmi</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>reports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>junos-fw-grpc</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>include</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>device_name_ip</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>sources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>junos-fw-grpc</span></span></span></code></pre></div><p style=background-color:skyblue;text-align:center><b>Reports file</b></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-YAML data-lang=YAML><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>junos-fw-grpc</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>reports</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>reports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>/junos/firewall/grpc</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>script</span><span class=p>:</span><span class=w> </span>!<span class=l>external</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>starlark</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>file</span><span class=p>:</span><span class=w> </span><span class=l>junos-fw-grpc.star</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class=l>30s</span></span></span></code></pre></div><p>The starlark script acts as a pre-processor to the data before forming it to influx line protocol and ingesting it in the database. So we have options to manipulate the data according to the use case.</p><p>From the rpc we see that all information is returned under the <code>/junos/firewall/</code> path so lets see what we get from this. We are going to use the log method to output the dictionary we receive from gnmi in the container logs using a basic starlark script:</p><p style=background-color:skyblue;text-align:center><b>Basic Starlark Script</b></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>load</span><span class=p>(</span><span class=s2>&#34;ranger&#34;</span><span class=p>,</span> <span class=s2>&#34;source&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>load</span><span class=p>(</span><span class=s2>&#34;ranger&#34;</span><span class=p>,</span> <span class=s2>&#34;metric&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>load</span><span class=p>(</span><span class=s2>&#34;ranger&#34;</span><span class=p>,</span> <span class=s2>&#34;device&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>load</span><span class=p>(</span><span class=s2>&#34;ranger&#34;</span><span class=p>,</span> <span class=s2>&#34;log&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>execute</span><span class=p>(</span><span class=n>report</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>log</span><span class=p>(</span><span class=s2>&#34;###### STARTING STRALARK #######&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span> <span class=o>=</span> <span class=n>source</span><span class=o>.</span><span class=n>select</span><span class=p>(</span><span class=s2>&#34;junos/firewall&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>log</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>log</span><span class=p>(</span><span class=s2>&#34;###### STRALARK FINISHED #######&#34;</span><span class=p>)</span></span></span></code></pre></div><p>Here is how our overrides directory look like:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl>override-data/
</span></span><span class=line><span class=cl>└── config
</span></span><span class=line><span class=cl>    ├── profiles
</span></span><span class=line><span class=cl>    │   ├── junos-fw-grpc.yml
</span></span><span class=line><span class=cl>    │   └── junos-fw-snmp.yml
</span></span><span class=line><span class=cl>    ├── reports
</span></span><span class=line><span class=cl>    │   ├── junos-fw-grpc.star
</span></span><span class=line><span class=cl>    │   ├── junos-fw-grpc.yml
</span></span><span class=line><span class=cl>    │   └── junos-fw-snmp.yml
</span></span><span class=line><span class=cl>    └── sources
</span></span><span class=line><span class=cl>        └── junos-fw-grpc.yml</span></span></code></pre></div><p>And here is what is returned from starlark when we dump it as a dictionary:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-JSON data-lang=JSON><span class=line><span class=cl><span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;state&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;timestamp&#34;</span><span class=p>:</span> <span class=mi>1714746658</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;memory-usage&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;allocated&#34;</span><span class=p>:</span> <span class=mi>2596</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;HEAP&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;__default_bpdu_filter__&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;state&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;timestamp&#34;</span><span class=p>:</span> <span class=mi>1714746658</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;memory-usage&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;allocated&#34;</span><span class=p>:</span> <span class=mi>4004</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;HEAP&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;counter&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;packets&#34;</span><span class=p>:</span> <span class=mi>1341</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;bytes&#34;</span><span class=p>:</span> <span class=mi>88064</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;SSH-PACKETS&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;TEST-FIREWALL&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;state&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;policer&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;out-of-spec-packets&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;out-of-spec-bytes&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;offered-packets&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;offered-bytes&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;transmitted-packets&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;transmitted-bytes&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;__default_arp_policer__&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;timestamp&#34;</span><span class=p>:</span> <span class=mi>1714403887</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;memory-usage&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;allocated&#34;</span><span class=p>:</span> <span class=mi>1652</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;HEAP&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;__default_arp_policer__&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;state&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;timestamp&#34;</span><span class=p>:</span> <span class=mi>1714753321</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;memory-usage&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;allocated&#34;</span><span class=p>:</span> <span class=mi>7172</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;HEAP&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;counter&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;packets&#34;</span><span class=p>:</span> <span class=mi>36574</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;bytes&#34;</span><span class=p>:</span> <span class=mi>52226328</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;10.11.10.10,*,icmp-type=8&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;packets&#34;</span><span class=p>:</span> <span class=mi>6336</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;bytes&#34;</span><span class=p>:</span> <span class=mi>9216704</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;10.11.10.10,*,proto=6,dstport=5201&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;policer&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;out-of-spec-packets&#34;</span><span class=p>:</span> <span class=mi>13378</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;out-of-spec-bytes&#34;</span><span class=p>:</span> <span class=mi>20067000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;offered-packets&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;offered-bytes&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;transmitted-packets&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;transmitted-bytes&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;40K_10.11.10.10,*,proto=6,dstport=5201&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;__flowspec_default_inet__&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>]</span></span></span></code></pre></div><p>So we got a list of dictionaries. One dictionary per firewall filter containing the allocated memory and the counter or policer names and metrics. Now since the counter metrics are different from the policer one&rsquo;s, it seems wise to report them in different paths on the portal schema. For example:</p><ul><li><code>/junos/firewall/filter/memory/</code> → will hold the allocated memory for each filter</li><li><code>/junos/firewall/filter/counters/</code> → will hold the counter metrics</li><li><code>/junos/firewall/filter/policers/</code> → will hold the policer metrics</li></ul><h4 class=heading-element id=local-configuration-take-2><span>Local Configuration (take 2)</span>
<a href=#local-configuration-take-2 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p style=background-color:skyblue;text-align:center><b>Reports - different paths</b></p>In order to achieve this we are going to adjust our reports file to specify those three different configs, paths and scripts.<div class=highlight><pre tabindex=0 class=chroma><code class=language-YAML data-lang=YAML><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>junos-fw-grpc</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>reports</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>reports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>/junos/firewall/filter/memory</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>script</span><span class=p>:</span><span class=w> </span>!<span class=l>external</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>starlark</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>file</span><span class=p>:</span><span class=w> </span><span class=l>junos-fw-grpc-memory.star</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class=l>30s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>/junos/firewall/filter/counters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>script</span><span class=p>:</span><span class=w> </span>!<span class=l>external</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>starlark</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>file</span><span class=p>:</span><span class=w> </span><span class=l>junos-fw-grpc-counters.star</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class=l>30s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>/junos/firewall/filter/policers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>script</span><span class=p>:</span><span class=w> </span>!<span class=l>external</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>starlark</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>file</span><span class=p>:</span><span class=w> </span><span class=l>junos-fw-grpc-policers.star</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class=l>30s</span></span></span></code></pre></div><p style=background-color:skyblue;text-align:center><b>Starlark - Memory</b></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>load</span><span class=p>(</span><span class=s2>&#34;ranger&#34;</span><span class=p>,</span> <span class=s2>&#34;source&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>load</span><span class=p>(</span><span class=s2>&#34;ranger&#34;</span><span class=p>,</span> <span class=s2>&#34;metric&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>load</span><span class=p>(</span><span class=s2>&#34;ranger&#34;</span><span class=p>,</span> <span class=s2>&#34;device&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>load</span><span class=p>(</span><span class=s2>&#34;ranger&#34;</span><span class=p>,</span> <span class=s2>&#34;log&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>execute</span><span class=p>(</span><span class=n>report</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>log</span><span class=p>(</span><span class=s2>&#34;###### STLRK - MEMORY START #######&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span> <span class=o>=</span> <span class=n>source</span><span class=o>.</span><span class=n>select</span><span class=p>(</span><span class=s2>&#34;junos/firewall&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>data</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># iterate over non empty dicts in the list</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>name</span><span class=p>,</span> <span class=n>memory</span> <span class=ow>in</span>  <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=p>(</span><span class=n>_</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;name&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>             <span class=n>_</span><span class=p>[</span><span class=s1>&#39;state&#39;</span><span class=p>][</span><span class=s1>&#39;memory-usage&#39;</span><span class=p>][</span><span class=mi>0</span><span class=p>][</span><span class=s1>&#39;allocated&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>             <span class=p>)</span> <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=n>data</span> <span class=k>if</span> <span class=n>_</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>            <span class=n>record</span> <span class=o>=</span> <span class=n>report</span><span class=o>.</span><span class=n>append</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>record</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&#34;filter_name&#34;</span><span class=p>,</span> <span class=n>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>record</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&#34;allocated_memory&#34;</span><span class=p>,</span> <span class=n>memory</span><span class=p>,</span> <span class=n>metric</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>record</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&#34;device_name&#34;</span><span class=p>,</span> <span class=n>device</span><span class=p>()</span><span class=o>.</span><span class=n>config</span><span class=o>.</span><span class=n>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>record</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&#34;device_ip&#34;</span><span class=p>,</span> <span class=n>device</span><span class=p>()</span><span class=o>.</span><span class=n>config</span><span class=o>.</span><span class=n>host</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>log</span><span class=p>(</span><span class=s2>&#34;###### STLRK - MEMORY END #######&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>log</span><span class=p>(</span><span class=s2>&#34;###### STLRK - MEMORY *** EMPTY **** #######&#34;</span><span class=p>)</span></span></span></code></pre></div><p style=background-color:skyblue;text-align:center><b>Starlark - Counters</b></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>load</span><span class=p>(</span><span class=s2>&#34;ranger&#34;</span><span class=p>,</span> <span class=s2>&#34;source&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>load</span><span class=p>(</span><span class=s2>&#34;ranger&#34;</span><span class=p>,</span> <span class=s2>&#34;metric&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>load</span><span class=p>(</span><span class=s2>&#34;ranger&#34;</span><span class=p>,</span> <span class=s2>&#34;device&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>load</span><span class=p>(</span><span class=s2>&#34;ranger&#34;</span><span class=p>,</span> <span class=s2>&#34;log&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>execute</span><span class=p>(</span><span class=n>report</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>log</span><span class=p>(</span><span class=s2>&#34;###### STLRK - COUNTERS START #######&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span> <span class=o>=</span> <span class=n>source</span><span class=o>.</span><span class=n>select</span><span class=p>(</span><span class=s2>&#34;junos/firewall&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>data</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># iterate over non empty dicts that have counter key</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>fname</span><span class=p>,</span> <span class=n>state</span> <span class=ow>in</span>  <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=p>(</span><span class=n>_</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;name&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>             <span class=n>_</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;state&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>             <span class=p>)</span> <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=n>data</span> <span class=k>if</span> <span class=n>_</span> <span class=ow>and</span> <span class=n>_</span><span class=p>[</span><span class=s1>&#39;state&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;counter&#39;</span><span class=p>)]</span> <span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>cname</span><span class=p>,</span> <span class=n>packets</span><span class=p>,</span> <span class=nb>bytes</span> <span class=ow>in</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>(</span><span class=n>_</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;name&#39;</span><span class=p>)</span> <span class=p>,</span>
</span></span><span class=line><span class=cl>                 <span class=n>_</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;packets&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                 <span class=n>_</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;bytes&#39;</span><span class=p>))</span> <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=n>state</span><span class=p>[</span><span class=s1>&#39;counter&#39;</span><span class=p>]</span> <span class=p>]:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>record</span> <span class=o>=</span> <span class=n>report</span><span class=o>.</span><span class=n>append</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=n>record</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&#34;filter_name&#34;</span><span class=p>,</span> <span class=n>fname</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>record</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&#34;counter_name&#34;</span><span class=p>,</span> <span class=n>cname</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>record</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&#34;packets&#34;</span><span class=p>,</span> <span class=n>packets</span><span class=p>,</span> <span class=n>metric</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>record</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&#34;bytes&#34;</span><span class=p>,</span> <span class=nb>bytes</span><span class=p>,</span> <span class=n>metric</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>record</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&#34;device_name&#34;</span><span class=p>,</span> <span class=n>device</span><span class=p>()</span><span class=o>.</span><span class=n>config</span><span class=o>.</span><span class=n>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>record</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&#34;device_ip&#34;</span><span class=p>,</span> <span class=n>device</span><span class=p>()</span><span class=o>.</span><span class=n>config</span><span class=o>.</span><span class=n>host</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>log</span><span class=p>(</span><span class=s2>&#34;###### STLRK - COUNTERS END #######&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>log</span><span class=p>(</span><span class=s2>&#34;###### STLRK - COUNTERS *** EMPTY **** #######&#34;</span><span class=p>)</span></span></span></code></pre></div><p style=background-color:skyblue;text-align:center><b>Starlark - Policers</b></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>load</span><span class=p>(</span><span class=s2>&#34;ranger&#34;</span><span class=p>,</span> <span class=s2>&#34;source&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>load</span><span class=p>(</span><span class=s2>&#34;ranger&#34;</span><span class=p>,</span> <span class=s2>&#34;metric&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>load</span><span class=p>(</span><span class=s2>&#34;ranger&#34;</span><span class=p>,</span> <span class=s2>&#34;device&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>load</span><span class=p>(</span><span class=s2>&#34;ranger&#34;</span><span class=p>,</span> <span class=s2>&#34;log&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>metrics</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;offered-bytes&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;offered-packets&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;out-of-spec-bytes&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;out-of-spec-packets&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;transmitted-bytes&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;transmitted-packets&#39;</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>execute</span><span class=p>(</span><span class=n>report</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>log</span><span class=p>(</span><span class=s2>&#34;###### STLRK - POLICER START #######&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span> <span class=o>=</span> <span class=n>source</span><span class=o>.</span><span class=n>select</span><span class=p>(</span><span class=s2>&#34;junos/firewall&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>data</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># iterate over non empty dicts that have policer key</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>fname</span><span class=p>,</span> <span class=n>state</span> <span class=ow>in</span>  <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=p>(</span><span class=n>_</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;name&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>             <span class=n>_</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;state&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>             <span class=p>)</span> <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=n>data</span> <span class=k>if</span> <span class=n>_</span> <span class=ow>and</span> <span class=n>_</span><span class=p>[</span><span class=s1>&#39;state&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;policer&#39;</span><span class=p>)]:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>policer</span> <span class=ow>in</span> <span class=n>state</span><span class=p>[</span><span class=s1>&#39;policer&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>                <span class=n>record</span> <span class=o>=</span> <span class=n>report</span><span class=o>.</span><span class=n>append</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=n>record</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&#34;filter_name&#34;</span><span class=p>,</span> <span class=n>fname</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>record</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&#34;policer_name&#34;</span><span class=p>,</span> <span class=n>policer</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=s1>&#39;name&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>                <span class=c1># Get metrics defined statically above</span>
</span></span><span class=line><span class=cl>                <span class=k>for</span> <span class=n>key</span> <span class=ow>in</span> <span class=n>metrics</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>record</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>policer</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>key</span><span class=p>)</span> <span class=p>,</span> <span class=n>metric</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>record</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&#34;device_name&#34;</span><span class=p>,</span> <span class=n>device</span><span class=p>()</span><span class=o>.</span><span class=n>config</span><span class=o>.</span><span class=n>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>record</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&#34;device_ip&#34;</span><span class=p>,</span> <span class=n>device</span><span class=p>()</span><span class=o>.</span><span class=n>config</span><span class=o>.</span><span class=n>host</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>log</span><span class=p>(</span><span class=s2>&#34;###### STLRK - POLICER END #######&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>log</span><span class=p>(</span><span class=s2>&#34;###### STLRK - POLICER *** EMPTY **** #######&#34;</span><span class=p>)</span></span></span></code></pre></div><p>And this is our <em>overrides</em> structure now:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl>override-data/
</span></span><span class=line><span class=cl>└── config
</span></span><span class=line><span class=cl>    ├── profiles
</span></span><span class=line><span class=cl>    │   ├── junos-fw-grpc.yml
</span></span><span class=line><span class=cl>    │   └── junos-fw-snmp.yml
</span></span><span class=line><span class=cl>    ├── reports
</span></span><span class=line><span class=cl>    │   ├── junos-fw-grpc-counters.star
</span></span><span class=line><span class=cl>    │   ├── junos-fw-grpc-memory.star
</span></span><span class=line><span class=cl>    │   ├── junos-fw-grpc-policers.star
</span></span><span class=line><span class=cl>    │   ├── junos-fw-grpc.yml
</span></span><span class=line><span class=cl>    │   └── junos-fw-snmp.yml
</span></span><span class=line><span class=cl>    └── sources
</span></span><span class=line><span class=cl>        └── junos-fw-grpc.yml</span></span></code></pre></div><h4 class=heading-element id=kentik-portal-1><span>Kentik Portal</span>
<a href=#kentik-portal-1 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>After restarting kagent, we look at the Portal for the results in the three different paths.</p><p>Here are the <strong>Memory</strong> metrics for our fitlers:<figure><a class=lightgallery href=/posts/kustom-metrics/img_004.png title=/posts/kustom-metrics/img_004.png data-thumbnail=/posts/kustom-metrics/img_004.png data-sub-html="<h2>GRPC Memory metrics</h2>"><img loading=lazy src=/posts/kustom-metrics/img_004.png alt=/posts/kustom-metrics/img_004.png height=653 width=2000></a><figcaption class=image-caption>GRPC Memory metrics</figcaption></figure></p><p>The <strong>Counter</strong> metrics:<figure><a class=lightgallery href=/posts/kustom-metrics/img_005.png title=/posts/kustom-metrics/img_005.png data-thumbnail=/posts/kustom-metrics/img_005.png data-sub-html="<h2>GRPC Counter metrics</h2>"><img loading=lazy src=/posts/kustom-metrics/img_005.png alt=/posts/kustom-metrics/img_005.png height=610 width=2000></a><figcaption class=image-caption>GRPC Counter metrics</figcaption></figure></p><p>And the <strong>Policer</strong> one&rsquo;s:<figure><a class=lightgallery href=/posts/kustom-metrics/img_006.png title=/posts/kustom-metrics/img_006.png data-thumbnail=/posts/kustom-metrics/img_006.png data-sub-html="<h2>GRPC Policer metrics</h2>"><img loading=lazy src=/posts/kustom-metrics/img_006.png alt=/posts/kustom-metrics/img_006.png height=555 width=2000></a><figcaption class=image-caption>GRPC Policer metrics</figcaption></figure></p><hr><h2 class=heading-element id=ios-xr-flowspec><span>IOS-XR Flowspec</span>
<a href=#ios-xr-flowspec class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>Let&rsquo;s do the same now for the XRs. Since there is no SNMP for flowspec but there is a dedicated yang model for it let’s see what gnmic has to say:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-JSON data-lang=JSON><span class=line><span class=cl><span class=err>get</span> <span class=err>-e</span> <span class=err>json_ietf</span> <span class=err>--path</span> <span class=err>Cisco-IOS-XR-flowspec-oper:flow-spec/vrfs/vrf/afs/af/flows/flow/</span>
</span></span><span class=line><span class=cl><span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;source&#34;</span><span class=p>:</span> <span class=s2>&#34;10.12.255.1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;timestamp&#34;</span><span class=p>:</span> <span class=mi>1714928869517180944</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;time&#34;</span><span class=p>:</span> <span class=s2>&#34;2024-05-05T20:07:49.517180944+03:00&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;updates&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;Path&#34;</span><span class=p>:</span> <span class=s2>&#34;Cisco-IOS-XR-flowspec-oper:flow-spec/vrfs/vrf[vrf-name=default]/afs/af[af-name=IPv4]/flows/flow[flow-notation=Dest:10.11.10.10/32,Proto:=6,DPort:=5201]&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;values&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;flow-spec/vrfs/vrf/afs/af/flows/flow&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;active-flow-client&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;action&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;dscp&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;ipv4-nh&#34;</span><span class=p>:</span> <span class=s2>&#34;0.0.0.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;ipv6-nh&#34;</span><span class=p>:</span> <span class=s2>&#34;::&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;rate&#34;</span><span class=p>:</span> <span class=s2>&#34;40000&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;flow-notation&#34;</span><span class=p>:</span> <span class=s2>&#34;Dest:10.11.10.10/32,Proto:=6,DPort:=5201&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;flow-statistics&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;classified&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;bytes&#34;</span><span class=p>:</span> <span class=s2>&#34;0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;packets&#34;</span><span class=p>:</span> <span class=s2>&#34;0&#34;</span>
</span></span><span class=line><span class=cl>              <span class=p>},</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;dropped&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;bytes&#34;</span><span class=p>:</span> <span class=s2>&#34;0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;packets&#34;</span><span class=p>:</span> <span class=s2>&#34;0&#34;</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;matches&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;destination-port&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;uint16_rng_array&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                  <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;max&#34;</span><span class=p>:</span> <span class=mi>5201</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;min&#34;</span><span class=p>:</span> <span class=mi>5201</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>]</span>
</span></span><span class=line><span class=cl>              <span class=p>},</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;destination-prefix-ipv4&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;mask&#34;</span><span class=p>:</span> <span class=s2>&#34;255.255.255.255&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;prefix&#34;</span><span class=p>:</span> <span class=s2>&#34;10.11.10.10&#34;</span>
</span></span><span class=line><span class=cl>              <span class=p>},</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;destination-prefix-ipv6&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;mask&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;prefix&#34;</span><span class=p>:</span> <span class=s2>&#34;::&#34;</span>
</span></span><span class=line><span class=cl>              <span class=p>},</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;icmp&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;code&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>              <span class=p>},</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;ip-protocol&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;uint16_rng_array&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                  <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;max&#34;</span><span class=p>:</span> <span class=mi>6</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;min&#34;</span><span class=p>:</span> <span class=mi>6</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>]</span>
</span></span><span class=line><span class=cl>              <span class=p>},</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;source-prefix-ipv4&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;mask&#34;</span><span class=p>:</span> <span class=s2>&#34;0.0.0.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;prefix&#34;</span><span class=p>:</span> <span class=s2>&#34;0.0.0.0&#34;</span>
</span></span><span class=line><span class=cl>              <span class=p>},</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;source-prefix-ipv6&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;mask&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;prefix&#34;</span><span class=p>:</span> <span class=s2>&#34;::&#34;</span>
</span></span><span class=line><span class=cl>              <span class=p>},</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;tcp-flag&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;match-any&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;Path&#34;</span><span class=p>:</span> <span class=s2>&#34;Cisco-IOS-XR-flowspec-oper:flow-spec/vrfs/vrf[vrf-name=default]/afs/af[af-name=IPv4]/flows/flow[flow-notation=Dest:10.11.10.10/32,ICMPType:=8]&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;values&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;flow-spec/vrfs/vrf/afs/af/flows/flow&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;active-flow-client&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;action&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;dscp&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;ipv4-nh&#34;</span><span class=p>:</span> <span class=s2>&#34;0.0.0.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;ipv6-nh&#34;</span><span class=p>:</span> <span class=s2>&#34;::&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;rate&#34;</span><span class=p>:</span> <span class=s2>&#34;0&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;flow-notation&#34;</span><span class=p>:</span> <span class=s2>&#34;Dest:10.11.10.10/32,ICMPType:=8&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;flow-statistics&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;classified&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;bytes&#34;</span><span class=p>:</span> <span class=s2>&#34;0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;packets&#34;</span><span class=p>:</span> <span class=s2>&#34;0&#34;</span>
</span></span><span class=line><span class=cl>              <span class=p>},</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;dropped&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;bytes&#34;</span><span class=p>:</span> <span class=s2>&#34;0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;packets&#34;</span><span class=p>:</span> <span class=s2>&#34;0&#34;</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;matches&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;destination-prefix-ipv4&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;mask&#34;</span><span class=p>:</span> <span class=s2>&#34;255.255.255.255&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;prefix&#34;</span><span class=p>:</span> <span class=s2>&#34;10.11.10.10&#34;</span>
</span></span><span class=line><span class=cl>              <span class=p>},</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;destination-prefix-ipv6&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;mask&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;prefix&#34;</span><span class=p>:</span> <span class=s2>&#34;::&#34;</span>
</span></span><span class=line><span class=cl>              <span class=p>},</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;icmp&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;code&#34;</span><span class=p>:</span> <span class=mi>255</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=mi>8</span>
</span></span><span class=line><span class=cl>              <span class=p>},</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;source-prefix-ipv4&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;mask&#34;</span><span class=p>:</span> <span class=s2>&#34;0.0.0.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;prefix&#34;</span><span class=p>:</span> <span class=s2>&#34;0.0.0.0&#34;</span>
</span></span><span class=line><span class=cl>              <span class=p>},</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;source-prefix-ipv6&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;mask&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;prefix&#34;</span><span class=p>:</span> <span class=s2>&#34;::&#34;</span>
</span></span><span class=line><span class=cl>              <span class=p>},</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;tcp-flag&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;match-any&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>]</span></span></span></code></pre></div><p>And the equivalent list of paths:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-JSON data-lang=JSON><span class=line><span class=cl><span class=err>sub</span> <span class=err>--mode</span> <span class=err>once</span> <span class=err>-e</span> <span class=err>json_ietf</span> <span class=err>--path</span> <span class=err>Cisco-IOS-XR-flowspec-oper:flow-spec/vrfs/vrf/afs/af/flows/flow/</span> <span class=err>--format</span> <span class=err>event</span>
</span></span><span class=line><span class=cl><span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;default-1714934425&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;timestamp&#34;</span><span class=p>:</span> <span class=mi>1714934426719000000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;tags&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;af_af-name&#34;</span><span class=p>:</span> <span class=s2>&#34;IPv4&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;flow_flow-notation&#34;</span><span class=p>:</span> <span class=s2>&#34;Dest:10.11.10.10/32,Proto:=6,DPort:=5201&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;source&#34;</span><span class=p>:</span> <span class=s2>&#34;10.12.255.1:57344&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;subscription-name&#34;</span><span class=p>:</span> <span class=s2>&#34;default-1714934425&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;vrf_vrf-name&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;values&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/active-flow-client/action.0/dscp&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/active-flow-client/action.0/ipv4-nh&#34;</span><span class=p>:</span> <span class=s2>&#34;0.0.0.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/active-flow-client/action.0/ipv6-nh&#34;</span><span class=p>:</span> <span class=s2>&#34;::&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/active-flow-client/action.0/rate&#34;</span><span class=p>:</span> <span class=s2>&#34;40000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/flow-statistics/classified/bytes&#34;</span><span class=p>:</span> <span class=s2>&#34;0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/flow-statistics/classified/packets&#34;</span><span class=p>:</span> <span class=s2>&#34;0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/flow-statistics/dropped/bytes&#34;</span><span class=p>:</span> <span class=s2>&#34;0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/flow-statistics/dropped/packets&#34;</span><span class=p>:</span> <span class=s2>&#34;0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/destination-port.0/max&#34;</span><span class=p>:</span> <span class=mi>5201</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/destination-port.0/min&#34;</span><span class=p>:</span> <span class=mi>5201</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/destination-prefix-ipv4/mask&#34;</span><span class=p>:</span> <span class=s2>&#34;255.255.255.255&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/destination-prefix-ipv4/prefix&#34;</span><span class=p>:</span> <span class=s2>&#34;10.11.10.10&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/destination-prefix-ipv6/mask&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/destination-prefix-ipv6/prefix&#34;</span><span class=p>:</span> <span class=s2>&#34;::&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/icmp/code&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/icmp/type&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/ip-protocol.0/max&#34;</span><span class=p>:</span> <span class=mi>6</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/ip-protocol.0/min&#34;</span><span class=p>:</span> <span class=mi>6</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/source-prefix-ipv4/mask&#34;</span><span class=p>:</span> <span class=s2>&#34;0.0.0.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/source-prefix-ipv4/prefix&#34;</span><span class=p>:</span> <span class=s2>&#34;0.0.0.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/source-prefix-ipv6/mask&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/source-prefix-ipv6/prefix&#34;</span><span class=p>:</span> <span class=s2>&#34;::&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/tcp-flag/match-any&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/tcp-flag/value&#34;</span><span class=p>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;default-1714934425&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;timestamp&#34;</span><span class=p>:</span> <span class=mi>1714934426719000000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;tags&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;af_af-name&#34;</span><span class=p>:</span> <span class=s2>&#34;IPv4&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;flow_flow-notation&#34;</span><span class=p>:</span> <span class=s2>&#34;Dest:10.11.10.10/32,ICMPType:=8&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;source&#34;</span><span class=p>:</span> <span class=s2>&#34;10.12.255.1:57344&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;subscription-name&#34;</span><span class=p>:</span> <span class=s2>&#34;default-1714934425&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;vrf_vrf-name&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;values&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/active-flow-client/action.0/dscp&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/active-flow-client/action.0/ipv4-nh&#34;</span><span class=p>:</span> <span class=s2>&#34;0.0.0.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/active-flow-client/action.0/ipv6-nh&#34;</span><span class=p>:</span> <span class=s2>&#34;::&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/active-flow-client/action.0/rate&#34;</span><span class=p>:</span> <span class=s2>&#34;0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/flow-statistics/classified/bytes&#34;</span><span class=p>:</span> <span class=s2>&#34;0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/flow-statistics/classified/packets&#34;</span><span class=p>:</span> <span class=s2>&#34;0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/flow-statistics/dropped/bytes&#34;</span><span class=p>:</span> <span class=s2>&#34;0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/flow-statistics/dropped/packets&#34;</span><span class=p>:</span> <span class=s2>&#34;0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/destination-prefix-ipv4/mask&#34;</span><span class=p>:</span> <span class=s2>&#34;255.255.255.255&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/destination-prefix-ipv4/prefix&#34;</span><span class=p>:</span> <span class=s2>&#34;10.11.10.10&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/destination-prefix-ipv6/mask&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/destination-prefix-ipv6/prefix&#34;</span><span class=p>:</span> <span class=s2>&#34;::&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/icmp/code&#34;</span><span class=p>:</span> <span class=mi>255</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/icmp/type&#34;</span><span class=p>:</span> <span class=mi>8</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/source-prefix-ipv4/mask&#34;</span><span class=p>:</span> <span class=s2>&#34;0.0.0.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/source-prefix-ipv4/prefix&#34;</span><span class=p>:</span> <span class=s2>&#34;0.0.0.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/source-prefix-ipv6/mask&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/source-prefix-ipv6/prefix&#34;</span><span class=p>:</span> <span class=s2>&#34;::&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/tcp-flag/match-any&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/tcp-flag/value&#34;</span><span class=p>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=err>}</span></span></span></code></pre></div><p>So we get the <strong>actions</strong> of the rule, the <strong>statistics</strong>, as well as the <strong>match configuration</strong> under the respective paths:</p><ul><li><code>/flow-spec/vrfs/vrf/afs/af/flows/flow/active-flow-client/</code></li><li><code>/flow-spec/vrfs/vrf/afs/af/flows/flow/flow-statistics/</code></li><li><code>/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/</code></li></ul><h4 class=heading-element id=local-configuration-1><span>Local Configuration</span>
<a href=#local-configuration-1 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>The <em>interesting</em> metrics are under <code>/flow-statistics</code> and we get the tags for the <code>vrf</code> and the <code>address-family</code>. Let&rsquo;s configure <em>our</em> local files.</p><p style=background-color:skyblue;text-align:center><b>Sources file</b></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-YAML data-lang=YAML><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>xrv-fspec-grpc</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>sources</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>sources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>xrv-fspec-grpc</span><span class=p>:</span><span class=w> </span>!<span class=l>gnmi</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>Cisco-IOS-XR-flowspec-oper:flow-spec/vrfs/vrf/afs/af/flows/flow/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>mode</span><span class=p>:</span><span class=w> </span><span class=l>SAMPLE</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>extra</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>sample_interval</span><span class=p>:</span><span class=w> </span><span class=l>30s</span></span></span></code></pre></div><p style=background-color:skyblue;text-align:center><b>Profiles file</b></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-YAML data-lang=YAML><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>xrv-fspec-grpc</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>profile</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>profile</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>match</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>sysobjectid</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=m>1.3.6.1.4.1.9.1.2264</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>features</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>gnmi</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>reports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>xrv-fspec-grpc</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>include</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>device_name_ip</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>sources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>xrv-fspec-grpc</span></span></span></code></pre></div><p style=background-color:skyblue;text-align:center><b>Reports file</b></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-YAML data-lang=YAML><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>xrv-fspec-grpc</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>reports</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>reports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>/xrv/flowspec/statistics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>script</span><span class=p>:</span><span class=w> </span>!<span class=l>external</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>starlark</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>file</span><span class=p>:</span><span class=w> </span><span class=l>xrv-fspec-grpc.star</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class=l>30s</span></span></span></code></pre></div><p style=background-color:skyblue;text-align:center><b>XR Starlark Script</b></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>load</span><span class=p>(</span><span class=s2>&#34;ranger&#34;</span><span class=p>,</span> <span class=s2>&#34;source&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>load</span><span class=p>(</span><span class=s2>&#34;ranger&#34;</span><span class=p>,</span> <span class=s2>&#34;metric&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>load</span><span class=p>(</span><span class=s2>&#34;ranger&#34;</span><span class=p>,</span> <span class=s2>&#34;device&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>load</span><span class=p>(</span><span class=s2>&#34;ranger&#34;</span><span class=p>,</span> <span class=s2>&#34;log&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>execute</span><span class=p>(</span><span class=n>report</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span> <span class=o>=</span> <span class=n>source</span><span class=o>.</span><span class=n>select</span><span class=p>(</span><span class=s2>&#34;flow-spec/vrfs/vrf&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>vrf_name</span><span class=p>,</span> <span class=n>af_name</span><span class=p>,</span> <span class=n>flow</span><span class=p>,</span> <span class=n>statistics</span> <span class=ow>in</span> <span class=p>[(</span>
</span></span><span class=line><span class=cl>            <span class=n>i</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;vrf-name&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>y</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;af-name&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>z</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;flow-notation&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>z</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;flow-statistics&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>data</span> <span class=k>for</span> <span class=n>y</span> <span class=ow>in</span> <span class=n>i</span><span class=p>[</span><span class=s1>&#39;afs&#39;</span><span class=p>][</span><span class=s1>&#39;af&#39;</span><span class=p>]</span> <span class=k>for</span> <span class=n>z</span> <span class=ow>in</span> <span class=n>y</span><span class=p>[</span><span class=s1>&#39;flows&#39;</span><span class=p>][</span><span class=s1>&#39;flow&#39;</span><span class=p>]</span> <span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>vrf_name</span> <span class=o>==</span> <span class=s2>&#34;&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>vrf_name</span> <span class=o>=</span> <span class=s2>&#34;default&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>record</span> <span class=o>=</span> <span class=n>report</span><span class=o>.</span><span class=n>append</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>record</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&#34;vrf_name&#34;</span><span class=p>,</span> <span class=n>vrf_name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>record</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&#34;af_name&#34;</span><span class=p>,</span> <span class=n>af_name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>record</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&#34;flow_rule&#34;</span><span class=p>,</span> <span class=n>flow</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>record</span><span class=o>.</span><span class=n>append</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;classified_bytes&#34;</span><span class=p>,</span> <span class=n>statistics</span><span class=p>[</span><span class=s1>&#39;classified&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;bytes&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>metric</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>record</span><span class=o>.</span><span class=n>append</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;classified_packets&#34;</span><span class=p>,</span> <span class=n>statistics</span><span class=p>[</span><span class=s1>&#39;classified&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;packets&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>metric</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>record</span><span class=o>.</span><span class=n>append</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;dropped_bytes&#34;</span><span class=p>,</span> <span class=n>statistics</span><span class=p>[</span><span class=s1>&#39;dropped&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;bytes&#39;</span><span class=p>),</span> <span class=n>metric</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>record</span><span class=o>.</span><span class=n>append</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;dropped_packets&#34;</span><span class=p>,</span> <span class=n>statistics</span><span class=p>[</span><span class=s1>&#39;dropped&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;packets&#39;</span><span class=p>),</span> <span class=n>metric</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>record</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&#34;device_name&#34;</span><span class=p>,</span> <span class=n>device</span><span class=p>()</span><span class=o>.</span><span class=n>config</span><span class=o>.</span><span class=n>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>record</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&#34;device_ip&#34;</span><span class=p>,</span> <span class=n>device</span><span class=p>()</span><span class=o>.</span><span class=n>config</span><span class=o>.</span><span class=n>host</span><span class=p>)</span></span></span></code></pre></div><p>Here is our directory structure now with the new files added for XR:<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>override-data/
</span></span><span class=line><span class=cl>└── config
</span></span><span class=line><span class=cl>    ├── profiles
</span></span><span class=line><span class=cl>    │   ├── junos-fw-grpc.yml
</span></span><span class=line><span class=cl>    │   ├── junos-fw-snmp.yml
</span></span><span class="line hl"><span class=cl>    │   └── xrv-fspec-grpc.yml
</span></span><span class=line><span class=cl>    ├── reports
</span></span><span class=line><span class=cl>    │   ├── junos-fw-grpc-counters.star
</span></span><span class=line><span class=cl>    │   ├── junos-fw-grpc-memory.star
</span></span><span class=line><span class=cl>    │   ├── junos-fw-grpc-policers.star
</span></span><span class=line><span class=cl>    │   ├── junos-fw-grpc.yml
</span></span><span class=line><span class=cl>    │   ├── junos-fw-snmp.yml
</span></span><span class="line hl"><span class=cl>    │   ├── xrv-fspec-grpc.star
</span></span><span class="line hl"><span class=cl>    │   └── xrv-fspec-grpc.yml
</span></span><span class=line><span class=cl>    └── sources
</span></span><span class=line><span class=cl>        ├── junos-fw-grpc.yml
</span></span><span class="line hl"><span class=cl>        └── xrv-fspec-grpc.yml</span></span></code></pre></div></p><h4 class=heading-element id=kentik-portal-2><span>Kentik Portal</span>
<a href=#kentik-portal-2 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>Restarting kagent to pick up the new configuration and here is what we get in the Portal under <code>/xrv/flowspec/statistics</code>, the configured path in our Reports file:</p><figure><a class=lightgallery href=/posts/kustom-metrics/img_007.png title=/posts/kustom-metrics/img_007.png data-thumbnail=/posts/kustom-metrics/img_007.png data-sub-html="<h2>XR Flowspec metrics</h2>"><img loading=lazy src=/posts/kustom-metrics/img_007.png alt=/posts/kustom-metrics/img_007.png height=701 width=2544></a><figcaption class=image-caption>XR Flowspec metrics</figcaption></figure><div class="details admonition note open"><div class="details-summary admonition-title"><i class="icon fa-fw fa-solid fa-pencil-alt" aria-hidden=true></i>No XRv counters<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>Unfortunately, XRv does not report those due to limitations of its virtual dataplane &#x1f622;, but you get the picture</div></div></div><hr><h2 class=heading-element id=outro><span>Outro</span>
<a href=#outro class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>Well we covered enough ground to demonstrate what is possible currently with Kentik NMS when it comes to custom metrics:</p><ul><li>How to enable Kentik Universal Agent to poll for specific metrics from devices</li><li>Polling and reporting on a custom SNMP Table</li><li>Polling and reporting on a custom ST path via GRPC</li><li>Associating custom metrics to specific device types</li></ul><p align=right><br><br><i>...till next time...have fun!!!</i></p><hr><h2 class=heading-element id=influences-and-reference><span>Influences and Reference</span>
<a href=#influences-and-reference class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><ul><li><a href=https://www.kentik.com/blog/how-to-configure-kentik-nms-to-collect-custom-snmp-metrics/ target=_blank rel="external nofollow noopener noreferrer">How to Configure Kentik NMS to Collect Custom SNMP Metrics</a></li><li><a href=https://www.kentik.com/blog/adding-multiple-custom-metrics-to-kentik-nms/ target=_blank rel="external nofollow noopener noreferrer">Adding Multiple Custom Metrics to Kentik NMS</a></li><li><a href=https://www.kentik.com/blog/adjusting-data-before-sending-it-to-kentik-nms/ target=_blank rel="external nofollow noopener noreferrer">Adjusting Data Before Sending It to Kentik NMS</a></li><li><a href=https://github.com/becos76/kentik-custom-metrics target=_blank rel="external nofollow noopener noreferrer">Repo for this post</a></li></ul></div><hr class=awesome-hr><h2 id=see-also>Related Content</h2><ul><li><a href=/posts/kube-my-router-pt3/ title="Kube My Router Up! - Last Part">Kube My Router Up! - Last Part</a></li><li><a href=/posts/kube-my-router-pt2/ title="Kube My Router Up! - Part Two">Kube My Router Up! - Part Two</a></li><li><a href=/posts/kube-my-router-pt1/ title="Kube My Router Up! - Part One">Kube My Router Up! - Part One</a></li><li><a href=/posts/xr-get-xpath/ title="IOS-XR :: Get Your XPATHs, Get Your XPATHs Honey">IOS-XR :: Get Your XPATHs, Get Your XPATHs Honey</a></li><li><a href=/posts/k8s-ansible/ title="K8s Ansible">K8s Ansible</a></li></ul><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="Updated on 2024-05-04 00:00:00">Updated on 2024-05-04&nbsp;</span></div><div class=post-info-license><span><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank>CC BY-NC-SA 4.0</a></span></div></div><div class=post-info-line><div class=post-info-md><span><a href=/posts/kustom-metrics/index.md title="Read Markdown" class=link-to-markdown>Read Markdown</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on X" data-sharer=twitter data-url=https://net4fungr.github.io/posts/kustom-metrics/ data-title="K~ustom Metrics in Kentik NMS" data-via=mkaliotis data-hashtags=network,monitoring,telemetry,snmp><i class="fa-brands fa-x-twitter fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="Share on Linkedin" data-sharer=linkedin data-url=https://net4fungr.github.io/posts/kustom-metrics/><i class="fa-brands fa-linkedin fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="Share on Reddit" data-sharer=reddit data-url=https://net4fungr.github.io/posts/kustom-metrics/><i class="fa-brands fa-reddit fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fa-solid fa-tags fa-fw me-1" aria-hidden=true></i><a href=/tags/network/ class=post-tag title="Tags - Network">Network</a><a href=/tags/monitoring/ class=post-tag title="Tags - Monitoring">Monitoring</a><a href=/tags/telemetry/ class=post-tag title="Tags - Telemetry">Telemetry</a><a href=/tags/snmp/ class=post-tag title="Tags - Snmp">Snmp</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/xr-get-xpath/ class=post-nav-item rel=prev title="IOS-XR :: Get Your XPATHs, Get Your XPATHs Honey"><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i>IOS-XR :: Get Your XPATHs, Get Your XPATHs Honey</a><a href=/posts/modern-nms/ class=post-nav-item rel=next title="If This Ain't a Modern NMS, Then What Is?">If This Ain't a Modern NMS, Then What Is?<i class="fa-solid fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div id=comments><div id=giscus class=comment><script src=https://giscus.app/client.js data-repo=Net4FunGR/net4fungr.github.io data-repo-id=R_kgDOGLZFKQ data-category="Blog Comments" data-category-id=DIC_kwDOGLZFKc4Cf1aA data-mapping=title data-strict=0 data-theme=preferred_color_scheme data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-lang=en data-loading=lazy crossorigin=anonymous async defer></script></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://giscus.app/ rel="external nofollow noopener noreferrer">giscus</a>.</noscript></div></article><aside class=toc id=toc-auto aria-label=Contents><h2 class=toc-title>Contents&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden=true></i></h2><div class="toc-content always-active" id=toc-content-auto></div></aside></main><footer class=footer><div class=footer-container><div class="footer-line powered">Powered by <a href=https://gohugo.io/ target=_blank rel="external nofollow noopener noreferrer" title="Hugo 0.147.2"><img class=hugo-icon src=/images/hugo.min.svg alt="Hugo logo"> Hugo</a> | Theme - <a href=https://github.com/hugo-fixit/FixIt target=_blank rel=external title="FixIt v0.3.20"><img class=fixit-icon src=/images/fixit.min.svg alt="FixIt logo"> FixIt</a></div><div class="footer-line copyright" itemscope itemtype=http://schema.org/CreativeWork><i class="fa-regular fa-copyright fa-fw" aria-hidden=true></i>
<span itemprop=copyrightYear>2021 - 2025</span><span class=author itemprop=copyrightHolder>
<a href=https://github.com/becos76 target=_blank rel="external nofollow noopener noreferrer">becos76</a></span><span class="license footer-divider"><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div class=widgets><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role=button aria-label="Back to Top"><i class="fa-solid fa-arrow-up fa-fw" aria-hidden=true></i><span class=variant-numeric>0%</span></div><div class="fixed-button view-comments d-none" role=button aria-label="View Comments"><i class="fa-solid fa-comment fa-fw" aria-hidden=true></i></div></div><a href=https://github.com/becos76/ title="Visit my GitHub" target=_blank rel="external nofollow" class="github-corner right d-none-mobile"><svg viewBox="0 0 250 250" aria-hidden="true" width="56" height="56"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><div id=mask></div><div class=reading-progress-bar style=left:0;top:0;--bg-progress:orange;--bg-progress-dark:grey></div><noscript><div class=noscript-warning>This website works best with JavaScript enabled.</div></noscript></div><link rel=stylesheet href=/lib/lightgallery/css/lightgallery-bundle.min.css><link rel=preload href=/lib/katex/katex.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/katex/katex.min.css></noscript><link rel=stylesheet href=/lib/pace/themes/blue/pace-theme-minimal.css><script src=/lib/autocomplete/autocomplete.min.js defer></script><script src=/lib/fuse/fuse.min.js defer></script><script src=/lib/twemoji/twemoji.min.js defer></script><script src=/lib/lightgallery/lightgallery.min.js defer></script><script src=/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.js defer></script><script src=/lib/lightgallery/plugins/zoom/lg-zoom.min.js defer></script><script src=/lib/sharer/sharer.min.js async defer></script><script src=/lib/typeit/index.umd.js defer></script><script src=/lib/katex/katex.min.js defer></script><script src=/lib/katex/auto-render.min.js defer></script><script src=/lib/katex/copy-tex.min.js defer></script><script src=/lib/katex/mhchem.min.js defer></script><script src=/lib/pace/pace.min.js async defer></script><script>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:40},comment:{enable:!0,expired:!1,giscus:{darkTheme:"dark",lightTheme:"light",origin:"https://giscus.app"}},lightgallery:!0,math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{distance:100,findAllMatches:!1,fuseIndexURL:"/search.json",highlightTag:"em",ignoreFieldNorm:!1,ignoreLocation:!1,isCaseSensitive:!1,location:0,maxResultLength:10,minMatchCharLength:3,noResultsFound:"No results found",snippetLength:30,threshold:.3,type:"fuse",useExtendedSearch:!1},twemoji:!0,typeit:{cursorChar:"|",cursorSpeed:1e3,duration:-1,loop:!1,speed:50},version:"v0.3.20"}</script><script src=/js/theme.min.js defer></script></body></html>