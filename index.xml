<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Becos :: Back Blog</title><link>https://net4fungr.github.io/</link><description>Becos :: Back Blog</description><generator>Hugo 0.147.2 &amp; FixIt v0.3.20</generator><language>en</language><managingEditor>mkaliotis(at)gmail(dot)com (becos76)</managingEditor><webMaster>mkaliotis(at)gmail(dot)com (becos76)</webMaster><lastBuildDate>Sun, 08 Dec 2024 00:00:00 +0000</lastBuildDate><atom:link href="https://net4fungr.github.io/index.xml" rel="self" type="application/rss+xml"/><item><title>For those about to LAB...⚡</title><link>https://net4fungr.github.io/posts/iou-love/</link><pubDate>Tue, 05 Nov 2024 00:00:00 +0000</pubDate><guid>https://net4fungr.github.io/posts/iou-love/</guid><category domain="https://net4fungr.github.io/categories/art-of-labbing/">Art of Labbing</category><description>&lt;hr>
&lt;h2 class="heading-element" id="intro">&lt;span>Intro&lt;/span>
 &lt;a href="#intro" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h2>&lt;p>Cisco IOL, aka IOU, and I go back a long way. Back in the day, when I decided to sit for the CCIE R&amp;amp;S v4 exam, there weren&amp;rsquo;t many options to get hands on on the cli other than having access to real devices or using dynamips and GNS3 for simulating routers and switches, but with limited feature support, especially on the S side.&lt;/p>
&lt;p>Hence, since I have also been known as a big time pack rat, I decided to go for a real LAB. So, after spending nearly over $6k, I managed to build a real home lab with all the quirks. Terminal server, AUI converters , x-over and serial cables, remote managed PSUs, I remember being so happy!&lt;/p>
&lt;p>The joy went on for a couple of months, while I was setting up the scenarios, practicing the theory, re-configuring and starting over. Then one day, as I was googling for something, I bumped to some news that Cisco IOS-on-Unix has been leaked to the public and people were already using it to build virtual labs. Then an IOS-on-Linux version was also leaked and you can imagine how stupid I felt after this.&lt;/p>
&lt;p>I, of course, ended up in using it and even got a refurb SPARCstation to run IOU in the interim before I could get my hands on a &lt;em>stable&lt;/em> IOL version without major issues. Anyway, this was just to give you the context of my history with IOL. I never sat for the lab in the end, but that&amp;rsquo;s another story.&lt;/p>
&lt;p>So, imagine my excitement when the recent news of IOL support in &lt;a href="https://containerlab.dev/rn/0.58/#cisco-iol"target="_blank" rel="external nofollow noopener noreferrer">containerlab&lt;/a> and &lt;a href="https://netlab.tools/release/1.9/#release-1-9-2"target="_blank" rel="external nofollow noopener noreferrer">netlab&lt;/a> reached my eyes. It brought back so many reminisces, that I had to write something about it. Containerlab and netlab have always been in my back-blog, and I wanted to post about them, but I feel that the community is doing such a great job on them, whilst in this case I felt that the time is right for me as well.&lt;/p>
&lt;p>As a bottom line here, IOL has always been the preferred choice due to its low demand on resources for the supported and relevant use cases, and the fact that it can now be supported in containerised topologies increases its network automation friendliness (NAFness :)) level, not too much though, since it is lacking some features as we will see later on.&lt;/p>
&lt;h2 class="heading-element" id="use-case-brief">&lt;span>Use Case Brief&lt;/span>
 &lt;a href="#use-case-brief" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h2>&lt;p>Everything starts with a use case, the intent! In my case, I want to spin up topologies and test different things in Kentik. The idea came from the &lt;a href="https://github.com/srl-labs/srl-telemetry-lab"target="_blank" rel="external nofollow noopener noreferrer">srl-telemetry-lab&lt;/a>, so we will be following the same approach but for Kentik related use cases. Hence,&lt;/p>
&lt;ul>
&lt;li>Dynamic topology that is sending netflow to Kentik via the kproxy agent&lt;/li>
&lt;li>Traffic simulation using iperf3 on the devices&lt;/li>
&lt;li>Kentik Synthetic agents attached to the topology performing tests&lt;/li>
&lt;li>Devices registered in Kentik NMS for monitoring&lt;/li>
&lt;/ul>
&lt;h3 class="heading-element" id="why-containerlab">&lt;span>Why containerlab?&lt;/span>
 &lt;a href="#why-containerlab" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h3>&lt;ul>
&lt;li>Dynamic topology: support CRUDs on the infrastructure&lt;/li>
&lt;li>IaC model support: everything defined in structured format&lt;/li>
&lt;li>Integrates well with netlab as a provider&lt;/li>
&lt;li>Minimal effort on the above / more focus on the use cases&lt;/li>
&lt;/ul>
&lt;h3 class="heading-element" id="why-netlab">&lt;span>Why netlab?&lt;/span>
 &lt;a href="#why-netlab" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h3>&lt;ul>
&lt;li>Automatic provisioning of underlay connectivity details and protocols&lt;/li>
&lt;li>Flexibility in adding custom templates and using custom playbooks based on a common ansible inventory file&lt;/li>
&lt;li>Good integration with containerlab&lt;/li>
&lt;li>Minimal effort on the above / more focus on the use cases&lt;/li>
&lt;/ul>
&lt;p>I think netlab is the perfect example of &lt;em>Automating the Boring Stuff&lt;/em>. I never counted the times or will ever forget that I had to type those commands &amp;#x1f604; :
&lt;div class="details admonition quote open">
 &lt;div class="details-summary admonition-title">&lt;i class="icon fa-fw fa-solid fa-quote-right" aria-hidden="true">&lt;/i>Boring Stuff&lt;i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true">&lt;/i>&lt;/div>
 &lt;div class="details-content">
 &lt;div class="admonition-content">conf t ⏎ no ip do lo ⏎ line con 0 ⏎ logg syn ⏎ exec-t 0 ⏎ ^Z wr ⏎&lt;/div>
 &lt;/div>
&lt;/div>&lt;/p>
&lt;h3 class="heading-element" id="why-iol">&lt;span>Why IOL?&lt;/span>
 &lt;a href="#why-iol" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h3>&lt;ul>
&lt;li>Demand on resources is very low&lt;/li>
&lt;li>Fit my use case since netflow export is supported&lt;/li>
&lt;li>No licensing limits on traffic volumes&lt;/li>
&lt;li>Seems IOL reports interface errors when traffic is pushed. A bug or a feature, don&amp;rsquo;t care at the moment since it has always been a burden to fire up synthetic errors on interface counters.&lt;/li>
&lt;/ul>
&lt;h3 class="heading-element" id="things-covered">&lt;span>Things Covered&lt;/span>
 &lt;a href="#things-covered" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h3>&lt;p>Now that we have picked up the correct tools for the job, let&amp;rsquo;s see what we are going to cover so you can assess if this is still interesting enough to carry on reading.&lt;/p>
&lt;ul>
&lt;li>Using &lt;em>netlab&lt;/em> to provision a lab by using &lt;em>containerlab&lt;/em> for spinning up the nodes&lt;/li>
&lt;li>Using IOL for the network device type&lt;/li>
&lt;li>Using various containers to integrate with the topology as the linux device type&lt;/li>
&lt;li>Using &lt;em>iperf3&lt;/em> for generating traffic load on the topology&lt;/li>
&lt;li>Using OSPF, BGP, MPLS and VRF modules in &lt;em>netlab&lt;/em>&lt;/li>
&lt;li>Using jinja templates to provision additional commands to the nodes either ad-hoc or during lab bring-up.&lt;/li>
&lt;li>Defining custom variables in the topology so we can use them later on either in the templates or in &lt;em>ansible&lt;/em> plays.&lt;/li>
&lt;li>We will be using &lt;em>Windows Subsystem for Linux&lt;/em> (WSL) for this use case.&lt;/li>
&lt;/ul>
&lt;p>So by using all the above we can deploy a topology like the one depicted in the following section, register the devices in Kentik, produce traffic and explore how to visualise, monitor, and run synthetic tests on it via Kentik. And all this by using automated tasks on the way.&lt;/p>
&lt;h3 class="heading-element" id="topology-walk-through">&lt;span>Topology Walk-through&lt;/span>
 &lt;a href="#topology-walk-through" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h3>&lt;figure>&lt;a class="lightgallery" href="https://net4fungr.github.io/posts/iou-love/topology.png" title="/posts/iou-love/topology.png" data-thumbnail="/posts/iou-love/topology.png" data-sub-html="&lt;h2>LAB Topology&lt;/h2>">&lt;img loading="lazy" src='https://net4fungr.github.io/posts/iou-love/topology.png' alt="/posts/iou-love/topology.png" height="722" width="1213">&lt;/a>&lt;figcaption class="image-caption">LAB Topology&lt;/figcaption>
 &lt;/figure>
&lt;p>As you see, the topology is rather simple. We have four core devices (rcX) running an MPLS-LDP backbone and offering L3VPN services over MP-BGP to four CE devices (ceX). The PC nodes are used to generate traffic and the &lt;em>ksynth&lt;/em> nodes are Kentik private synthetics agents. As you may have guessed, we have two VPNs, &lt;strong style="color: red;">&lt;em>red&lt;/em>&lt;/strong> and &lt;strong style="color: blue;">&lt;em>blue&lt;/em>&lt;/strong>.&lt;/p>
&lt;p>Network devices are IOL containers and PC&amp;rsquo;s are based on the &lt;a href="https://github.com/srl-labs/network-multitool/pkgs/container/network-multitool"target="_blank" rel="external nofollow noopener noreferrer">network-multitool&lt;/a> container image. Of course, we also have additional containers running and I like to call them service containers, since they are there to interact with the topology and report data back to Kentik, realising our use case.&lt;/p>
&lt;p>The basic idea behind connectivity in &lt;em>netlab/containerlab&lt;/em> is that there is a &lt;em>management&lt;/em> docker bridge network that all nodes connect. Each node connects to the management network, usually by its first interface, and &lt;em>netlab&lt;/em> uses this to provision commands to it. All other node links are formed based on the desired configuration by bridging the relevant node interfaces.&lt;/p>
&lt;p>Hence, the service containers, do not have to connect in-line to the topology and all communications go via the management network. But, let&amp;rsquo;s see them one by one:&lt;/p>
&lt;ul>
&lt;li>&lt;strong>kproxy&lt;/strong>: Kentik agent that listens to netflow from the devices and reports to Kentik. This agent also polls devices for SNMP metrics and metadata. All communications are going via the management network, from/to the devices in the isolated management VRF. In addition, since this is a container attached to a docker network inside the host machine, it has access to the Internet by default, so it is able to go out to Kentik and report the data.&lt;/li>
&lt;li>&lt;strong>kbgp&lt;/strong>: Kentik agent that tunnels bgp sessions from the devices all the way up to Kentik. This agent actually needs an inline connection so all other nodes can form the session. In our case, it is connected to &lt;strong>rc1&lt;/strong> so all others can reach it. Communication with Kentik is done via the container&amp;rsquo;s first interface that belongs to the management network, the same way as &lt;strong>kproxy&lt;/strong> does.&lt;/li>
&lt;li>&lt;strong>kagent&lt;/strong>: Kentik&amp;rsquo;s Universal Agent that is part of the Kentik NMS product and is polling the devices for SNMP data and reporting it into the NMS part. Here, I have chosen to deploy this as a standard container on the host machine (WSL) and it is not included in the topology. Thus, &lt;em>netlab&lt;/em> is not aware of it at all, but still &lt;strong>kagent&lt;/strong> can communicate with the devices via the management network since they are part of the same host, just in a different docker bridge network. So communication is possible since this agent is only polling the devices via their management interfaces and there is no need to expose anything (or should I say ingress path) from its side.&lt;/li>
&lt;/ul>
&lt;p>We will expand more on the connectivity details as we build the topology further on, but for now, the three basic things to ask yourself regarding how to run your service containers are:&lt;/p>
&lt;ul>
&lt;li>Do they need to be &lt;em>controlled&lt;/em> somehow via &lt;em>netlab&lt;/em>?&lt;/li>
&lt;li>Does &lt;em>netlab&lt;/em> need to know any detail about them?&lt;/li>
&lt;li>Are your devices capable to communicate with them via their management VRF for their purpose?&lt;/li>
&lt;/ul>
&lt;h2 class="heading-element" id="setting-things-up">&lt;span>Setting Things Up&lt;/span>
 &lt;a href="#setting-things-up" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h2>&lt;p>In this section we are going to focus on how to set things up in WSL. We will start by building the IOL containers for our use case and then see a typical installation of &lt;em>netlab&lt;/em>.&lt;/p>
&lt;h3 class="heading-element" id="building-the-iol-containers">&lt;span>Building the IOL containers&lt;/span>
 &lt;a href="#building-the-iol-containers" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h3>&lt;p>IOL containers are supported in &lt;em>containerlab&lt;/em> via their &lt;a href="https://containerlab.dev/manual/vrnetlab/#vrnetlab"target="_blank" rel="external nofollow noopener noreferrer">&lt;em>vrnetlab&lt;/em>&lt;/a> fork. The current IOL &lt;a href="https://developer.cisco.com/docs/modeling-labs/iol/"target="_blank" rel="external nofollow noopener noreferrer">images&lt;/a> are those included with the Cisco CML image reference collection (refplat), so you have to get hold of them and copy them to the relevant build directory in &lt;em>vrnetlab&lt;/em> in order to build them. Here are the steps:&lt;/p>
&lt;p>&lt;strong>&amp;gt;&amp;gt;&amp;gt;&lt;/strong> Clone the repo:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>wsl&lt;span class="o">)&lt;/span>&amp;lt;&amp;lt;· git clone https://github.com/hellt/vrnetlab
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Cloning into &lt;span class="s1">&amp;#39;vrnetlab&amp;#39;&lt;/span>...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">remote: Enumerating objects: 5363, &lt;span class="k">done&lt;/span>.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">remote: Counting objects: 100% &lt;span class="o">(&lt;/span>2011/2011&lt;span class="o">)&lt;/span>, &lt;span class="k">done&lt;/span>.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">remote: Compressing objects: 100% &lt;span class="o">(&lt;/span>660/660&lt;span class="o">)&lt;/span>, &lt;span class="k">done&lt;/span>.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">remote: Total &lt;span class="m">5363&lt;/span> &lt;span class="o">(&lt;/span>delta 1542&lt;span class="o">)&lt;/span>, reused &lt;span class="m">1649&lt;/span> &lt;span class="o">(&lt;/span>delta 1348&lt;span class="o">)&lt;/span>, pack-reused &lt;span class="m">3352&lt;/span> &lt;span class="o">(&lt;/span>from 1&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Receiving objects: 100% &lt;span class="o">(&lt;/span>5363/5363&lt;span class="o">)&lt;/span>, 2.27 MiB &lt;span class="p">|&lt;/span> 664.00 KiB/s, &lt;span class="k">done&lt;/span>.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Resolving deltas: 100% &lt;span class="o">(&lt;/span>3245/3245&lt;span class="o">)&lt;/span>, &lt;span class="k">done&lt;/span>.&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>&amp;gt;&amp;gt;&amp;gt;&lt;/strong> Copy the images to the appropriate folder and rename them according to the README. I chose to make links to them instead:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>wsl&lt;span class="o">)&lt;/span>&amp;lt;&amp;lt;· &lt;span class="nb">cd&lt;/span> vrnetlab/cisco/iol/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>wsl&lt;span class="o">)&lt;/span>&amp;lt;&amp;lt;· lll
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">total &lt;span class="m">516920&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> &lt;span class="m">289&lt;/span> Makefile
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> &lt;span class="m">1721&lt;/span> README.md
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lrwxrwxrwx &lt;span class="m">1&lt;/span> &lt;span class="m">35&lt;/span> cisco_iol-17.12.1.bin -&amp;gt; x86_64_crb_linux-adventerprisek9-ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lrwxrwxrwx &lt;span class="m">1&lt;/span> &lt;span class="m">38&lt;/span> cisco_iol-L2-17.12.1.bin -&amp;gt; x86_64_crb_linux_l2-adventerprisek9-ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxr-xr-x &lt;span class="m">2&lt;/span> &lt;span class="m">4096&lt;/span> docker
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rwxr-xr-x &lt;span class="m">1&lt;/span> &lt;span class="m">288947184&lt;/span> x86_64_crb_linux-adventerprisek9-ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rwxr-xr-x &lt;span class="m">1&lt;/span> &lt;span class="m">240355720&lt;/span> x86_64_crb_linux_l2-adventerprisek9-ms&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>&amp;gt;&amp;gt;&amp;gt;&lt;/strong> Build with &lt;code>make docker-image&lt;/code> and check in docker. You should end up having the two IOL images in the registry. One for the &lt;em>router&lt;/em> and one for the &lt;em>switch&lt;/em>.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>wsl&lt;span class="o">)&lt;/span>&amp;lt;&amp;lt;· make docker-image
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt; build output &amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>wsl&lt;span class="o">)&lt;/span>&amp;lt;&amp;lt;· docker images vrnetlab/cisco_iol*
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">REPOSITORY TAG IMAGE ID CREATED SIZE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vrnetlab/cisco_iol L2-17.12.1 15d363218573 About a minute ago 607MB
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vrnetlab/cisco_iol 17.12.1 1d44f7fa6252 About a minute ago 704MB&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>&amp;gt;&amp;gt;&amp;gt;&lt;/strong> You can test with the following command to see if they are &lt;em>booting&lt;/em>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>wsl&lt;span class="o">)&lt;/span>&amp;lt;&amp;lt;· docker run -it --rm -e &lt;span class="nv">IOL_PID&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">1&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>	--mount &lt;span class="nv">type&lt;/span>&lt;span class="o">=&lt;/span>bind,source&lt;span class="o">=&lt;/span>/dev/null,target&lt;span class="o">=&lt;/span>/iol/NETMAP vrnetlab/cisco_iol:17.12.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Launching IOL with PID &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Failed to send flush request: Operation not permitted
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Flushed eth0 addresses
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/entrypoint.sh: line 14: /usr/bin/iouyap: Operation not permitted
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/entrypoint.sh: line 14: /usr/bin/iouyap: Success
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOS On Unix - Cisco Systems confidential, internal use only
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> IOURC: Could not open iourc file
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Warning: configuration file &lt;span class="o">(&lt;/span>config.txt&lt;span class="o">)&lt;/span> does not exist
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Warning: Abnormal ciscoversion string, please notify the IOU team
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">with the name of this branch
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Warning: we parsed - NULL
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Restricted Rights Legend
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Use, duplication, or disclosure by the Government is
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">subject to restrictions as &lt;span class="nb">set&lt;/span> forth in subparagraph
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>c&lt;span class="o">)&lt;/span> of the Commercial Computer Software - Restricted
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Rights clause at FAR sec. 52.227-19 and subparagraph
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>c&lt;span class="o">)&lt;/span> &lt;span class="o">(&lt;/span>1&lt;span class="o">)&lt;/span> &lt;span class="o">(&lt;/span>ii&lt;span class="o">)&lt;/span> of the Rights in Technical Data and Computer
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Software clause at DFARS sec. 252.227-7013.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Cisco Systems, Inc.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">170&lt;/span> West Tasman Drive
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> San Jose, California 95134-1706
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Cisco IOS Software &lt;span class="o">[&lt;/span>Dublin&lt;span class="o">]&lt;/span>, Linux Software &lt;span class="o">(&lt;/span>X86_64BI_LINUX-ADVENTERPRISEK9-M&lt;span class="o">)&lt;/span>, Version 17.12.1, RELEASE SOFTWARE &lt;span class="o">(&lt;/span>fc5&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Technical Support: http://www.cisco.com/techsupport
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Copyright &lt;span class="o">(&lt;/span>c&lt;span class="o">)&lt;/span> 1986-2023 by Cisco Systems, Inc.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Compiled Thu 27-Jul-23 22:33 by mcpre
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PM unix notify udp ports APP_ID:0 DISABLE Port1:0 Port2:0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PM unix notify udp ports APP_ID:1 DISABLE Port1:0 Port2:0Linux Unix &lt;span class="o">(&lt;/span>i686&lt;span class="o">)&lt;/span> processor with 550115K bytes of memory.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Processor board ID &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">4&lt;/span> Ethernet interfaces
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">1024K bytes of NVRAM.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">No startup-config, starting autoinstall/pnp/ztp...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Autoinstall will terminate &lt;span class="k">if&lt;/span> any input is detected on console
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Autoinstall trying DHCPv4 on Ethernet0/0,Ethernet0/1,Ethernet0/2,Ethernet0/3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt; snipped &amp;gt;&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>They are based on XE 17.12.1 release so they are more feature rich than the past IOL ones (IOS 15.x), they do &lt;strong>not&lt;/strong> support any of the automation goodies as well as streaming telemetry, but they can push traffic without any licensing restriction.&lt;/p>
&lt;h3 class="heading-element" id="installing-netlab-in-wsl">&lt;span>Installing Netlab in WSL&lt;/span>
 &lt;a href="#installing-netlab-in-wsl" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h3>&lt;p>Now that we have our devices, let&amp;rsquo;s go ahead and install &lt;em>netlab&lt;/em> in WSL. I am using the following versions and linux flavour:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>wsl&lt;span class="o">)&lt;/span>·&amp;gt;&amp;gt; wsl.exe -v
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">WSL version: 2.3.26.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Kernel version: 5.15.167.4-1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">WSLg version: 1.0.65
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">MSRDC version: 1.2.5620
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Direct3D version: 1.611.1-81528511
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">DXCore version: 10.0.26100.1-240331-1435.ge-release
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Windows version: 10.0.19045.5131
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>wsl&lt;span class="o">)&lt;/span>&amp;lt;&amp;lt;· cat /etc/os-release
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">PRETTY_NAME&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Ubuntu 22.04.5 LTS&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">NAME&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Ubuntu&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">VERSION_ID&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;22.04&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">VERSION&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;22.04.5 LTS (Jammy Jellyfish)&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">VERSION_CODENAME&lt;/span>&lt;span class="o">=&lt;/span>jammy
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">ID&lt;/span>&lt;span class="o">=&lt;/span>ubuntu
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">ID_LIKE&lt;/span>&lt;span class="o">=&lt;/span>debian
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">HOME_URL&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;https://www.ubuntu.com/&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">SUPPORT_URL&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;https://help.ubuntu.com/&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">BUG_REPORT_URL&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;https://bugs.launchpad.net/ubuntu/&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">PRIVACY_POLICY_URL&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;https://www.ubuntu.com/legal/terms-and-policies/privacy-policy&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">UBUNTU_CODENAME&lt;/span>&lt;span class="o">=&lt;/span>jammy&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>&amp;gt;&amp;gt;&amp;gt;&lt;/strong> I chose to install &lt;em>netlab&lt;/em> in a virtual env:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>wsl&lt;span class="o">)&lt;/span>&amp;lt;&amp;lt;· sudo apt install python-is-python3 python3-pip python3-venv
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt; snipped &amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>wsl&lt;span class="o">)&lt;/span>&amp;lt;&amp;lt;· mkdir -p netlab/iol
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>wsl&lt;span class="o">)&lt;/span>&amp;lt;&amp;lt;· &lt;span class="nb">cd&lt;/span> netlab/iol
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>wsl&lt;span class="o">)&lt;/span>&amp;lt;&amp;lt;· python -m venv .venv
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>wsl&lt;span class="o">)&lt;/span>&amp;lt;&amp;lt;· &lt;span class="nb">source&lt;/span> .venv/bin/activate&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>&amp;gt;&amp;gt;&amp;gt;&lt;/strong> Install &lt;em>netlab&lt;/em> via pip and then all dependencies:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>wsl&lt;span class="o">)&lt;/span>&amp;lt;&amp;lt;· pip install networklab
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt; snipped &amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>wsl&lt;span class="o">)&lt;/span>&amp;lt;&amp;lt;· netlab install ubuntu ansible containerlab
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt; snipped &amp;gt;&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>&amp;gt;&amp;gt;&amp;gt;&lt;/strong> Open another terminal to cause re-login and bring up the test topology to verify everything is set up correctly:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">(wsl)&amp;lt;&amp;lt;· cd netlab/iol
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">(wsl)&amp;lt;&amp;lt;· source .venv/bin/activate
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">(wsl)&amp;lt;&amp;lt;· netlab test clab
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt; snipped &amp;gt;&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;em>Netalab&lt;/em> will provision a 3 node topology based on &lt;em>frr&lt;/em> and test if everything is working as expected. Finally it will cleanup after itself.&lt;/p>
&lt;h2 class="heading-element" id="topology-definition">&lt;span>Topology Definition&lt;/span>
 &lt;a href="#topology-definition" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h2>&lt;p>Let&amp;rsquo;s now start the fun part by exploring how to define our LAB so &lt;em>netlab&lt;/em> can spin it up and provision it the way we want it. &lt;em>Netlab&lt;/em> expects us to define everything in a single topology definition file, by default &lt;code>topology.yml&lt;/code>. We are going to build the base topology that includes just the routers and the PC&amp;rsquo;s, and then move on with adding the service containers.&lt;/p>
&lt;h3 class="heading-element" id="building-the-base-topology---step-by-step">&lt;span>Building the Base Topology - Step-by-step&lt;/span>
 &lt;a href="#building-the-base-topology---step-by-step" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h3>&lt;p>The first thing to do in the topology file is to declare which virtualisation provider we are going to be using. For our case this is &lt;code>clab&lt;/code> and here is how to check what others are supported along with their status in the current installation:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>wsl&lt;span class="o">)&lt;/span>&amp;lt;&amp;lt;· netlab show providers
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Supported virtualization providers
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">┏━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">┃ provider ┃ description ┃ status ┃
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">┡━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ clab │ containerlab with Docker │ OK │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ external │ External devices │ OK │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ libvirt │ Vagrant with libvirt/KVM │ N/A │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ virtualbox │ Vagrant with Virtualbox │ N/A │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└────────────┴──────────────────────────┴────────┘&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>The minimum sections that &lt;em>netlab&lt;/em> expects to find in the topology file is the &lt;code>provider&lt;/code>, the &lt;code>nodes&lt;/code> and the &lt;code>links&lt;/code>. And the minimum attributes that it needs to know about a node before provisioning it is the device type we want to use. Here are the supported device types:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>wsl&lt;span class="o">)&lt;/span>&amp;lt;&amp;lt;· netlab show devices
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Virtual network devices supported by netlab
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">┏━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">┃ device ┃ description ┃
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">┡━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ arubacx │ ArubaOS-CX │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ asav │ Cisco ASAv │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ cat8000v │ Cisco CSR 1000v │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ csr │ Cisco CSR 1000v │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ cumulus │ Cumulus VX 4.x or 5.x configured without NVUE │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ cumulus_nvue │ Cumulus VX 5.x configured with NVUE │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ dellos10 │ Dell OS10 │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ eos │ Arista vEOS VM or cEOS container │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ fortios │ Fortinet FortiOS firewall │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ frr │ FRR container │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ iol │ Cisco IOL │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ioll2 │ IOSv L2 image │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ iosv │ Cisco IOSv │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ iosvl2 │ IOSv L2 image │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ iosxr │ Cisco IOS XRv │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ linux │ Generic Linux host │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ nxos │ Cisco Nexus 9300v │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ routeros │ Mikrotik RouterOS version &lt;span class="m">6&lt;/span> │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ routeros7 │ Mikrotik RouterOS version &lt;span class="m">7&lt;/span> │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ sonic │ Sonic VM │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ srlinux │ Nokia SR Linux container │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ sros │ Nokia SR OS container │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ vjunos-switch │ vJunos Switch │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ vmx │ Juniper vMX container │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ vptx │ Juniper vPTX │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ vsrx │ Juniper vSRX 3.0 │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ vyos │ VyOS VM/container │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└───────────────┴───────────────────────────────────────────────┘
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Networking daemons supported by netlab
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">┏━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">┃ daemon ┃ description ┃
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">┡━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ bird │ BIRD Internet Routing Daemon │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ dnsmasq │ BIRD Internet Routing Daemon │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─────────┴──────────────────────────────┘&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>So &lt;code>iol&lt;/code> for the routers and &lt;code>linux&lt;/code> for the PC&amp;rsquo;s and as you may have guessed &lt;em>netlab&lt;/em> has a &lt;code>defaults&lt;/code> &lt;em>dictionary&lt;/em> that is pre-populated for us that we can of course override with custom values. For example, let&amp;rsquo;s see which images will be used if we specify device type as &lt;code>iol&lt;/code> and &lt;code>linux&lt;/code> by using the &lt;code>netlab show&lt;/code> command:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>wsl&lt;span class="o">)&lt;/span>&amp;lt;&amp;lt;· netlab show images -d iol
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iol image names by virtualization provider
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">┏━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━┳━━━━━━━━━━━━┓
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">┃ device ┃ clab ┃ libvirt ┃ virtualbox ┃
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">┡━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━╇━━━━━━━━━━━━┩
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ iol │ vrnetlab/cisco_iol:17.12.01 │ │ │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└────────┴─────────────────────────────┴─────────┴────────────┘
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>wsl&lt;span class="o">)&lt;/span>&amp;lt;&amp;lt;· netlab show images -d linux
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">linux image names by virtualization provider
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">┏━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━┓
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">┃ device ┃ clab ┃ libvirt ┃ virtualbox ┃
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">┡━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━┩
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ linux │ python:3.9-alpine │ generic/ubuntu2004 │ generic/ubuntu2004 │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└────────┴───────────────────┴────────────────────┴────────────────────┘&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>So these container images will be picked up by default if we specify the respective device type in the topology. Of course, we want to override those since our images are different, and here is how we can do this in the topology file by utilising a separate &lt;code>defaults&lt;/code> section prior to defining our &lt;code>nodes&lt;/code> and their interconnection &lt;code>links&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">provider&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">clab&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">defaults&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">  &lt;/span>&lt;span class="nt">device&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">iol&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">  &lt;/span>&lt;span class="nt">devices.iol.clab.image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">vrnetlab/cisco_iol:17.12.1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">  &lt;/span>&lt;span class="nt">devices.linux.clab.image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ghcr.io/srl-labs/network-multitool&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">nodes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">  &lt;/span>&lt;span class="nt">rc1&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">    &lt;/span>&lt;span class="nt">device&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">iol&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">  &lt;/span>&lt;span class="nt">rc2&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">    &lt;/span>&lt;span class="nt">device&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">iol&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">  &lt;/span>&lt;span class="nt">rc3&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">    &lt;/span>&lt;span class="nt">device&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">iol&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">  &lt;/span>&lt;span class="nt">rc4&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">    &lt;/span>&lt;span class="nt">device&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">iol&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">  &lt;/span>&lt;span class="nt">pc1&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">    &lt;/span>&lt;span class="nt">device&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">linux&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">  &lt;/span>&lt;span class="nt">pc2&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">    &lt;/span>&lt;span class="nt">device&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">linux&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">  &lt;/span>&lt;span class="nt">pc3&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">    &lt;/span>&lt;span class="nt">device&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">linux&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">  &lt;/span>&lt;span class="nt">pc4&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">    &lt;/span>&lt;span class="nt">device&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">linux&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">links&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">  &lt;/span>- &lt;span class="l">rc1-rc2&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">  &lt;/span>- &lt;span class="l">rc1-rc3&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">  &lt;/span>- &lt;span class="l">rc2-rc4&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">  &lt;/span>- &lt;span class="l">rc3-rc4&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">  &lt;/span>- &lt;span class="l">rc1-pc1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">  &lt;/span>- &lt;span class="l">rc2-pc2&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">  &lt;/span>- &lt;span class="l">rc3-pc3&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">  &lt;/span>- &lt;span class="l">rc4-pc4&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Now, let&amp;rsquo;s bring up the topology to see the real power of &lt;em>netlab&lt;/em>. To start the lab we can use the &lt;code>netlab up&lt;/code> command and after some scripts are executed and some ansible plays, everything is up and running. We can check this with &lt;code>netlab status&lt;/code> command:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>wsl&lt;span class="o">)&lt;/span>&amp;lt;&amp;lt;· netlab status
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">┏━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┓
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">┃ node ┃ device ┃ image ┃ mgmt IPv4 ┃ connection ┃ provider ┃ VM/container ┃ status ┃
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">┡━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━┩
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ pc1 │ linux │ ghcr.io/srl-labs/network-mult… │ 192.168.121.105 │ docker │ clab │ clab-iol-pc1 │ Up &lt;span class="m">2&lt;/span> minutes │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├──────┼────────┼────────────────────────────────┼─────────────────┼─────────────┼──────────┼──────────────┼──────────────┤
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ pc2 │ linux │ ghcr.io/srl-labs/network-mult… │ 192.168.121.106 │ docker │ clab │ clab-iol-pc2 │ Up &lt;span class="m">2&lt;/span> minutes │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├──────┼────────┼────────────────────────────────┼─────────────────┼─────────────┼──────────┼──────────────┼──────────────┤
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ pc3 │ linux │ ghcr.io/srl-labs/network-mult… │ 192.168.121.107 │ docker │ clab │ clab-iol-pc3 │ Up &lt;span class="m">2&lt;/span> minutes │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├──────┼────────┼────────────────────────────────┼─────────────────┼─────────────┼──────────┼──────────────┼──────────────┤
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ pc4 │ linux │ ghcr.io/srl-labs/network-mult… │ 192.168.121.108 │ docker │ clab │ clab-iol-pc4 │ Up &lt;span class="m">2&lt;/span> minutes │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├──────┼────────┼────────────────────────────────┼─────────────────┼─────────────┼──────────┼──────────────┼──────────────┤
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ rc1 │ iol │ vrnetlab/cisco_iol:17.12.1 │ 192.168.121.101 │ network_cli │ clab │ clab-iol-rc1 │ Up &lt;span class="m">2&lt;/span> minutes │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├──────┼────────┼────────────────────────────────┼─────────────────┼─────────────┼──────────┼──────────────┼──────────────┤
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ rc2 │ iol │ vrnetlab/cisco_iol:17.12.1 │ 192.168.121.102 │ network_cli │ clab │ clab-iol-rc2 │ Up &lt;span class="m">2&lt;/span> minutes │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├──────┼────────┼────────────────────────────────┼─────────────────┼─────────────┼──────────┼──────────────┼──────────────┤
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ rc3 │ iol │ vrnetlab/cisco_iol:17.12.1 │ 192.168.121.103 │ network_cli │ clab │ clab-iol-rc3 │ Up &lt;span class="m">2&lt;/span> minutes │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├──────┼────────┼────────────────────────────────┼─────────────────┼─────────────┼──────────┼──────────────┼──────────────┤
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ rc4 │ iol │ vrnetlab/cisco_iol:17.12.1 │ 192.168.121.104 │ network_cli │ clab │ clab-iol-rc4 │ Up &lt;span class="m">2&lt;/span> minutes │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└──────┴────────┴────────────────────────────────┴─────────────────┴─────────────┴──────────┴──────────────┴──────────────┘&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Seems everything is up and running, but how is this different than just bringing up the topology with &lt;em>containerlab&lt;/em>? Well, &lt;em>netlab&lt;/em> goes one step further and configures the devices with basic ip connectivity and also with any other protocol that is supported as we will see later on. We can check on a device for example:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>wsl&lt;span class="o">)&lt;/span>&amp;lt;&amp;lt;· netlab &lt;span class="nb">exec&lt;/span> rc1 show ip int br
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Connecting to clab-iol-rc1 using SSH port 22, executing show ip int br
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Interface IP-Address OK? Method Status Protocol
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Ethernet0/0 192.168.121.101 YES TFTP up up
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Ethernet0/1 10.1.0.1 YES manual up up
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Ethernet0/2 10.1.0.5 YES manual up up
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Ethernet0/3 172.16.0.1 YES manual up up
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Loopback0 10.0.0.1 YES manual up up Connection to clab-iol-rc1 closed by remote host.&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Or on a PC:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>wsl&lt;span class="o">)&lt;/span>&amp;lt;&amp;lt;· netlab &lt;span class="nb">exec&lt;/span> pc1 ip -c -br a
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Connecting to container clab-iol-pc1, executing ip -c -br a
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lo UNKNOWN 127.0.0.1/8 ::1/128
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">eth0@if1052 UP 192.168.121.105/24 fe80::42:c0ff:fea8:7969/64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">eth1@if1065 UP 172.16.0.5/24 fe80::a8c1:abff:fe5d:19e2/64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>wsl&lt;span class="o">)&lt;/span>&amp;lt;&amp;lt;· netlab &lt;span class="nb">exec&lt;/span> pc1 ip -c -br r
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Connecting to container clab-iol-pc1, executing ip -c -br r
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">default via 192.168.121.1 dev eth0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">10.0.0.0/24 via 172.16.0.1 dev eth1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">10.1.0.0/16 via 172.16.0.1 dev eth1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">10.2.0.0/24 via 172.16.0.1 dev eth1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">172.16.0.0/24 dev eth1 proto kernel scope link src 172.16.0.5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">172.16.0.0/16 via 172.16.0.1 dev eth1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.121.0/24 dev eth0 proto kernel scope link src 192.168.121.105&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>So apart from bringing up the nodes, &lt;em>netlab&lt;/em> using its defaults dictionary and attributes, parsed the topology and provisioned IP addresses for every link and also configured the routing in linux to point to the blocks used in the topology via the containers&amp;rsquo; second interface attached to the router. In this way, we can define our topology and protocols and &lt;em>netlab&lt;/em> will take care of the commands needed to be provisioned and pushed to the nodes.&lt;/p>
&lt;p>Let&amp;rsquo;s see now the default addressing scheme:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>wsl&lt;span class="o">)&lt;/span>·&amp;gt;&amp;gt; netlab show defaults addressing
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">netlab default settings within the addressing &lt;span class="nv">subtree&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">=============================================================================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">l2only: null
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lan:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4: 172.16.0.0/16
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">loopback:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4: 10.0.0.0/24
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mgmt:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4: 192.168.121.0/24
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mac: 08-4F-A9-00-00-00
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> start: &lt;span class="m">100&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">p2p:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4: 10.1.0.0/16
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router_id:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4: 10.0.0.0/24
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> prefix: &lt;span class="m">32&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vrf_loopback:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4: 10.2.0.0/24
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> prefix: &lt;span class="m">32&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>As you see, for any p2p link the 10.1/16 block will be used, whereas for any lan, &lt;em>netlab&lt;/em> will use the 172.16/16 one. 10.0.0/24 is used for the loopbacks and 10.2.0/24 for any loopback that belongs in a vrf and, of course, you may modify these as per your liking.&lt;/p>
&lt;p>Furthermore, in order to understand this behaviour a bit more, check on the directory structure to see the different directories and files created since we brought up the lab:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>wsl&lt;span class="o">)&lt;/span>&amp;lt;&amp;lt;· tree . -L &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── ansible.cfg &amp;lt;- Ansible configuration file
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── clab-iol &amp;lt;- clab related runtime directory
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── clab.yml &amp;lt;- Respective clab topology file
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── clab_files &amp;lt;- hosts files to mount at /etc/hosts &lt;span class="k">for&lt;/span> every linux container
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── group_vars &amp;lt;- Ansible group_vars after merging the defaults and topology specific variables
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── host_vars &amp;lt;- same &lt;span class="k">for&lt;/span> each host
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── hosts.yml &amp;lt;- Ansible inventory file
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── netlab.lock &amp;lt;- lock file when netlab is running
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── netlab.snapshot.yml &amp;lt;- snapshot of the whole dictionary
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└── topology.yml &amp;lt;- Original topology file that we started with&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>So we ended up having a full blown ansible structure for this lab that &lt;em>netlab&lt;/em> is using to provision commands and, guess what, we can also use it with our own plays.&lt;/p>
&lt;p>Two additional commands to help you in exploring the data structure and ansible variables available in the topology are &lt;code>netlab inspect&lt;/code> and &lt;code>ansible-inventory&lt;/code>.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>wsl&lt;span class="o">)&lt;/span>&amp;lt;&amp;lt;· netlab inspect --node rc1 loopback
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ifindex: &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ifname: Loopback0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ipv4: 10.0.0.1/32
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">neighbors: &lt;span class="o">[]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">type: loopback
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">virtual_interface: &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>wsl&lt;span class="o">)&lt;/span>&amp;lt;&amp;lt;· ansible-inventory --host rc1 &lt;span class="p">|&lt;/span> jq .loopback
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;ifindex&amp;#34;&lt;/span>: 0,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;ifname&amp;#34;&lt;/span>: &lt;span class="s2">&amp;#34;Loopback0&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;ipv4&amp;#34;&lt;/span>: &lt;span class="s2">&amp;#34;10.0.0.1/32&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;neighbors&amp;#34;&lt;/span>: &lt;span class="o">[]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;type&amp;#34;&lt;/span>: &lt;span class="s2">&amp;#34;loopback&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;virtual_interface&amp;#34;&lt;/span>: &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>OK, now that we got the hang of it, let&amp;rsquo;s bring down the topology and cleanup our directory structure in order to complete the basic topology definition.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>wsl&lt;span class="o">)&lt;/span>&amp;lt;&amp;lt;· netlab down --cleanup
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>SUCCESS&lt;span class="o">]&lt;/span> Read transformed lab topology from snapshot file netlab.snapshot.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">┌──────────────────────────────────────────────────────────────────────────────────┐
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ CHECKING virtualization provider installation │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└──────────────────────────────────────────────────────────────────────────────────┘
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>SUCCESS&lt;span class="o">]&lt;/span> clab installed and working correctly
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">┌──────────────────────────────────────────────────────────────────────────────────┐
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ STOPPING clab nodes │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└──────────────────────────────────────────────────────────────────────────────────┘
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Parsing &lt;span class="p">&amp;amp;&lt;/span> checking topology file: clab.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Parsing &lt;span class="p">&amp;amp;&lt;/span> checking topology file: clab.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">WARN&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> errors during iptables rules install: not available
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Destroying lab: iol
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0001&lt;span class="o">]&lt;/span> Removed container: clab-iol-pc4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0001&lt;span class="o">]&lt;/span> Removed container: clab-iol-rc2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0002&lt;span class="o">]&lt;/span> Removed container: clab-iol-pc1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0002&lt;span class="o">]&lt;/span> Removed container: clab-iol-pc3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0002&lt;span class="o">]&lt;/span> Removed container: clab-iol-pc2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0002&lt;span class="o">]&lt;/span> Removed container: clab-iol-rc4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0002&lt;span class="o">]&lt;/span> Removed container: clab-iol-rc1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0002&lt;span class="o">]&lt;/span> Removed container: clab-iol-rc3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0002&lt;span class="o">]&lt;/span> Removing containerlab host entries from /etc/hosts file
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0002&lt;span class="o">]&lt;/span> Removing ssh config &lt;span class="k">for&lt;/span> containerlab nodes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">WARN&lt;span class="o">[&lt;/span>0003&lt;span class="o">]&lt;/span> errors during iptables rules removal: not available
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">┌──────────────────────────────────────────────────────────────────────────────────┐
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ CLEANUP configuration files │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└──────────────────────────────────────────────────────────────────────────────────┘
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">... removing clab.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">... removing directory tree clab_files
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">... removing ansible.cfg
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">... removing hosts.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">... removing directory tree group_vars
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">... removing directory tree host_vars
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">... removing netlab.snapshot.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>wsl&lt;span class="o">)&lt;/span>&amp;lt;&amp;lt;· tree .
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└── topology.yml&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 class="heading-element" id="base-topology---complete">&lt;span>Base Topology - Complete&lt;/span>
 &lt;a href="#base-topology---complete" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h3>&lt;p>Here is the complete basic topology file with adding some extra quirks:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">provider&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">clab&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">defaults&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">  &lt;/span>&lt;span class="nt">device&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">iol&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">  &lt;/span>&lt;span class="nt">devices.iol.clab.image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">vrnetlab/cisco_iol:17.12.1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">  &lt;/span>&lt;span class="nt">devices.linux.clab.image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ghcr.io/srl-labs/network-multitool&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">  &lt;/span>&lt;span class="nt">providers.clab.lab_prefix&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">  &lt;/span>&lt;span class="nt">groups._auto_create&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">  &lt;/span>&lt;span class="nt">paths.append.custom.dirs&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">templates ]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">  &lt;/span>&lt;span class="nt">vrf.as&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">65515&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> 
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">groups&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">  &lt;/span>&lt;span class="nt">core&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">    &lt;/span>&lt;span class="nt">members&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">rc1, rc2, rc3, rc4 ]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">    &lt;/span>&lt;span class="nt">module&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ospf, bgp, mpls, vrf ]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">    &lt;/span>&lt;span class="nt">bgp.as&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">65515&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">    &lt;/span>&lt;span class="nt">mpls.vpn&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ibgp ]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">    &lt;/span>&lt;span class="nt">vrf.loopback&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">    &lt;/span>&lt;span class="nt">config&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">core_extras ]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">  &lt;/span>&lt;span class="nt">ces&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">    &lt;/span>&lt;span class="nt">members&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ce1, ce2, ce3, ce4 ]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">    &lt;/span>&lt;span class="nt">module&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">bgp ]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">  &lt;/span>&lt;span class="nt">pcs&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">    &lt;/span>&lt;span class="nt">members&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">pc1, pc2, pc3, pc4, pc11, pc12, pc13, pc14 ]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">    &lt;/span>&lt;span class="nt">device&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">linux&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">    &lt;/span>&lt;span class="nt">config&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">iperf3_server ]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">    &lt;/span>&lt;span class="nt">vars&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">      &lt;/span>&lt;span class="nt">IPERF3_TESTS&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">                &lt;/span>{&lt;span class="w"> &lt;/span>&lt;span class="nt">&amp;#34;src&amp;#34;:&amp;#34;pc1&amp;#34;, &amp;#34;dst&amp;#34;: &amp;#34;pc4&amp;#34;, &amp;#34;port&amp;#34;: &lt;/span>&lt;span class="s2">&amp;#34;5201&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>}&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">                &lt;/span>{&lt;span class="w"> &lt;/span>&lt;span class="nt">&amp;#34;src&amp;#34;:&amp;#34;pc2&amp;#34;, &amp;#34;dst&amp;#34;: &amp;#34;pc1&amp;#34;, &amp;#34;port&amp;#34;: &lt;/span>&lt;span class="s2">&amp;#34;5201&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>}&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">                &lt;/span>{&lt;span class="w"> &lt;/span>&lt;span class="nt">&amp;#34;src&amp;#34;:&amp;#34;pc3&amp;#34;, &amp;#34;dst&amp;#34;: &amp;#34;pc2&amp;#34;, &amp;#34;port&amp;#34;: &lt;/span>&lt;span class="s2">&amp;#34;5201&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>}&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">                &lt;/span>{&lt;span class="w"> &lt;/span>&lt;span class="nt">&amp;#34;src&amp;#34;:&amp;#34;pc4&amp;#34;, &amp;#34;dst&amp;#34;: &amp;#34;pc3&amp;#34;, &amp;#34;port&amp;#34;: &lt;/span>&lt;span class="s2">&amp;#34;5201&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>}&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">                &lt;/span>{&lt;span class="w"> &lt;/span>&lt;span class="nt">&amp;#34;src&amp;#34;:&amp;#34;pc1&amp;#34;, &amp;#34;dst&amp;#34;: &amp;#34;pc3&amp;#34;, &amp;#34;port&amp;#34;: &lt;/span>&lt;span class="s2">&amp;#34;5202&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>}&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">                &lt;/span>{&lt;span class="w"> &lt;/span>&lt;span class="nt">&amp;#34;src&amp;#34;:&amp;#34;pc2&amp;#34;, &amp;#34;dst&amp;#34;: &amp;#34;pc4&amp;#34;, &amp;#34;port&amp;#34;: &lt;/span>&lt;span class="s2">&amp;#34;5202&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>}&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">                &lt;/span>{&lt;span class="w"> &lt;/span>&lt;span class="nt">&amp;#34;src&amp;#34;:&amp;#34;pc11&amp;#34;, &amp;#34;dst&amp;#34;: &amp;#34;pc14&amp;#34;, &amp;#34;port&amp;#34;: &lt;/span>&lt;span class="s2">&amp;#34;5201&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>}&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">                &lt;/span>{&lt;span class="w"> &lt;/span>&lt;span class="nt">&amp;#34;src&amp;#34;:&amp;#34;pc14&amp;#34;, &amp;#34;dst&amp;#34;: &amp;#34;pc11&amp;#34;, &amp;#34;port&amp;#34;: &lt;/span>&lt;span class="s2">&amp;#34;5201&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>}&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">                &lt;/span>{&lt;span class="w"> &lt;/span>&lt;span class="nt">&amp;#34;src&amp;#34;:&amp;#34;pc12&amp;#34;, &amp;#34;dst&amp;#34;: &amp;#34;pc13&amp;#34;, &amp;#34;port&amp;#34;: &lt;/span>&lt;span class="s2">&amp;#34;5201&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>}&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">                &lt;/span>{&lt;span class="w"> &lt;/span>&lt;span class="nt">&amp;#34;src&amp;#34;:&amp;#34;pc13&amp;#34;, &amp;#34;dst&amp;#34;: &amp;#34;pc12&amp;#34;, &amp;#34;port&amp;#34;: &lt;/span>&lt;span class="s2">&amp;#34;5201&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>}&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">      &lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="w">        
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">vrfs&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">  &lt;/span>&lt;span class="nt">blue&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">    &lt;/span>&lt;span class="nt">rd&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;65515:101&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">nodes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">  &lt;/span>&lt;span class="nt">rc1&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">  &lt;/span>&lt;span class="nt">rc2&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">    &lt;/span>&lt;span class="nt">vrfs&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">      &lt;/span>&lt;span class="nt">red&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">       &lt;/span>&lt;span class="nt">rd&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;10.0.0.2:102&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">       &lt;/span>&lt;span class="nt">import&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;65515:102&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">       &lt;/span>&lt;span class="nt">export&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;65515:102&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">  &lt;/span>&lt;span class="nt">rc3&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">    &lt;/span>&lt;span class="nt">vrfs&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">      &lt;/span>&lt;span class="nt">red&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">       &lt;/span>&lt;span class="nt">rd&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;10.0.0.3:102&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">       &lt;/span>&lt;span class="nt">import&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;65515:102&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">       &lt;/span>&lt;span class="nt">export&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;65515:102&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">  &lt;/span>&lt;span class="nt">rc4&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">  &lt;/span>&lt;span class="nt">ce1&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">    &lt;/span>&lt;span class="nt">id&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">11&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">    &lt;/span>&lt;span class="nt">bgp.as&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">65101&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">  &lt;/span>&lt;span class="nt">ce2&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">    &lt;/span>&lt;span class="nt">id&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">12&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">    &lt;/span>&lt;span class="nt">bgp.as&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">65201&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">  &lt;/span>&lt;span class="nt">ce3&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">    &lt;/span>&lt;span class="nt">id&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">13&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">    &lt;/span>&lt;span class="nt">bgp.as&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">65202&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">  &lt;/span>&lt;span class="nt">ce4&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">    &lt;/span>&lt;span class="nt">id&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">14&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">    &lt;/span>&lt;span class="nt">bgp.as&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">65102&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> 
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">links&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">  &lt;/span>- &lt;span class="l">rc1-rc2&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">  &lt;/span>- &lt;span class="l">rc1-rc3&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">  &lt;/span>- &lt;span class="l">rc2-rc4&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">  &lt;/span>- &lt;span class="l">rc3-rc4&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">  &lt;/span>- &lt;span class="l">rc1-pc1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">  &lt;/span>- &lt;span class="l">rc2-pc2&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">  &lt;/span>- &lt;span class="l">rc3-pc3&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">  &lt;/span>- &lt;span class="l">rc4-pc4&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">  &lt;/span>- &lt;span class="nt">rc1&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>{&lt;span class="w"> &lt;/span>&lt;span class="nt">vrf&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">blue }&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">    &lt;/span>&lt;span class="nt">ce1&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">  &lt;/span>- &lt;span class="nt">rc2&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>{&lt;span class="w"> &lt;/span>&lt;span class="nt">vrf&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">red }&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">    &lt;/span>&lt;span class="nt">ce2&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">  &lt;/span>- &lt;span class="nt">rc3&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>{&lt;span class="w"> &lt;/span>&lt;span class="nt">vrf&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">red }&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">    &lt;/span>&lt;span class="nt">ce3&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">  &lt;/span>- &lt;span class="nt">rc4&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>{&lt;span class="w"> &lt;/span>&lt;span class="nt">vrf&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">blue }&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">    &lt;/span>&lt;span class="nt">ce4&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">  &lt;/span>- &lt;span class="l">ce1-pc11&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">  &lt;/span>- &lt;span class="l">ce2-pc12&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">  &lt;/span>- &lt;span class="l">ce3-pc13&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">  &lt;/span>- &lt;span class="l">ce4-pc14&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>OK, we have now added some things or two here that we will expand on.&lt;/p>
&lt;ul>
&lt;li>First of all, we have used the &lt;code>groups&lt;/code> section to group our nodes and apply attributes to them rather than having to replicate them for each one in the &lt;code>nodes&lt;/code> section.&lt;/li>
&lt;li>The &lt;code>groups._auto_create: True&lt;/code> allows for not having to define each node under the node section and create them ad-hoc from the members list under the &lt;code>groups&lt;/code>, but this does not guarantee the &lt;code>id&lt;/code> each node will have. Since the addressing considers those &lt;code>id's&lt;/code> and the order of specifying them under the &lt;code>nodes&lt;/code> section matters, we can have a mix of those two ways to auto-define nodes and also pin some to specific &lt;code>ids&lt;/code>. So rc&amp;rsquo;s get 1 to 4, ce&amp;rsquo;s 11 to 14 and for pc&amp;rsquo;s we don&amp;rsquo;t care.&lt;/li>
&lt;li>The desired protocols to be enabled on each node is done via the &lt;code>module&lt;/code> structure.&lt;/li>
&lt;li>We have used the &lt;code>defaults.providers.clab.lab_prefix: &amp;quot;&amp;quot;&lt;/code> in order for the containers not to include the default &lt;code>clab-&amp;lt;directoty&amp;gt;&lt;/code> prefix in their name.&lt;/li>
&lt;li>We are using jinja templates to provision additional commands to the nodes during start up and we define them in the &lt;code>config&lt;/code> section of our &lt;code>groups&lt;/code> definition. I have all my templates under a &lt;code>templates&lt;/code> folder in the directory structure, so we need a way to let &lt;em>netlab&lt;/em> &lt;em>know&lt;/em> where to search for them. This is done by the &lt;code>defaults.paths.append.custom.dirs: [ templates ]&lt;/code> key.&lt;/li>
&lt;li>For core devices, we are enabling dns server on them via the &lt;code>core_extras&lt;/code> template&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-jinja" data-lang="jinja">&lt;span class="line">&lt;span class="cl">&lt;span class="x">(wsl)&amp;lt;&amp;lt;· cat templates/core_extras.j2
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">&lt;/span>&lt;span class="c">{# Enable DNS server in both GRT and mgmt vrf #}&lt;/span>&lt;span class="x">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">!
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">ip dns server
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">ip dns view vrf clab-mgmt
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">!&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>For the PCs, we want them to run &lt;em>iperf3&lt;/em> as server and also have the ability to start and stop traffic generation after the lab is up. So here, we have defined all the tests in a structure as a variable, that we can decompose in jinja to get either the server ports that need to be listening on, or the actual client tests to be performed. The server template is executed during bring up and for each PC we are looking to listen to all target ports:&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-jinja" data-lang="jinja">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">{%&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="nv">test&lt;/span> &lt;span class="k">in&lt;/span> &lt;span class="nv">IPERF3_TESTS&lt;/span> &lt;span class="cp">%}{%&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="nv">test.dst&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="nv">hostname&lt;/span> &lt;span class="cp">%}&lt;/span>&lt;span class="x">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">iperf3 -s -p &lt;/span>&lt;span class="cp">{{&lt;/span> &lt;span class="nv">test.port&lt;/span> &lt;span class="cp">}}&lt;/span>&lt;span class="x"> -D
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">&lt;/span>&lt;span class="cp">{%&lt;/span> &lt;span class="k">endif&lt;/span> &lt;span class="cp">%}{%&lt;/span> &lt;span class="k">endfor&lt;/span> &lt;span class="cp">%}&lt;/span>&lt;span class="x">```&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>For the client tests we use the &lt;code>netlab config&lt;/code> command to render the template ad-hoc and run or stop the tests after the topology is brought up:&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-jinja" data-lang="jinja">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">{%&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="nv">ACTION&lt;/span> &lt;span class="k">is&lt;/span> &lt;span class="k">not&lt;/span> &lt;span class="nf">defined&lt;/span> &lt;span class="k">or&lt;/span> &lt;span class="nv">ACTION&lt;/span> &lt;span class="k">not&lt;/span> &lt;span class="k">in&lt;/span> &lt;span class="o">[&lt;/span>&lt;span class="s1">&amp;#39;run&amp;#39;&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="s1">&amp;#39;stop&amp;#39;&lt;/span>&lt;span class="o">]&lt;/span> &lt;span class="cp">%}&lt;/span>&lt;span class="x">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> &lt;/span>&lt;span class="cp">{{&lt;/span>&lt;span class="kp">_&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="nf">mandatory&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s2">&amp;#34;ACTION is mandatoy - run or stop&amp;#34;&lt;/span>&lt;span class="o">)&lt;/span>&lt;span class="cp">}}&lt;/span>&lt;span class="x">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">&lt;/span>&lt;span class="cp">{%&lt;/span> &lt;span class="k">elif&lt;/span> &lt;span class="nv">ACTION&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s2">&amp;#34;run&amp;#34;&lt;/span> &lt;span class="cp">%}&lt;/span>&lt;span class="x">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">&lt;/span>&lt;span class="cp">{%&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="nv">test&lt;/span> &lt;span class="k">in&lt;/span> &lt;span class="nv">IPERF3_TESTS&lt;/span> &lt;span class="cp">%}{%&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="nv">test.src&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="nv">hostname&lt;/span> &lt;span class="cp">%}&lt;/span>&lt;span class="x">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">iperf3 -c &lt;/span>&lt;span class="cp">{{&lt;/span> &lt;span class="nv">test.dst&lt;/span> &lt;span class="cp">}}&lt;/span>&lt;span class="x"> -p &lt;/span>&lt;span class="cp">{{&lt;/span> &lt;span class="nv">test.port&lt;/span>&lt;span class="cp">}}&lt;/span>&lt;span class="x"> -t0 -P 5 -b 5M  &amp;gt; iperf-&lt;/span>&lt;span class="cp">{{&lt;/span> &lt;span class="nv">test.dst&lt;/span> &lt;span class="cp">}}&lt;/span>&lt;span class="x">.log &amp;amp;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">&lt;/span>&lt;span class="cp">{%&lt;/span> &lt;span class="k">endif&lt;/span> &lt;span class="cp">%}{%&lt;/span> &lt;span class="k">endfor&lt;/span> &lt;span class="cp">%}&lt;/span>&lt;span class="x">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">&lt;/span>&lt;span class="cp">{%&lt;/span> &lt;span class="k">elif&lt;/span> &lt;span class="nv">ACTION&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s2">&amp;#34;stop&amp;#34;&lt;/span> &lt;span class="cp">%}&lt;/span>&lt;span class="x">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">ps aux | grep &amp;#39;iperf3 -c&amp;#39; | grep -v grep | awk &amp;#39;{print $2}&amp;#39; | xargs kill -9
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">&lt;/span>&lt;span class="cp">{%&lt;/span> &lt;span class="k">endif&lt;/span> &lt;span class="cp">%}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="nv">ANSIBLE_NOCOWS&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">1&lt;/span> netlab config iperf3_clients -l pc1 -e &lt;span class="nv">ACTION&lt;/span>&lt;span class="o">=&lt;/span>run --check -v
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt; snipped &amp;gt; 
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">TASK &lt;span class="o">[&lt;/span>Process template /home/netlab/iol/templates/iperf3_clients.j2 &lt;span class="k">for&lt;/span> pc1&lt;span class="o">]&lt;/span> **********
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ok: &lt;span class="o">[&lt;/span>pc1&lt;span class="o">]&lt;/span> &lt;span class="o">=&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> msg: &lt;span class="p">|&lt;/span>-
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> /home/netlab/iol/templates/iperf3_clients.j2 configuration &lt;span class="k">for&lt;/span> &lt;span class="nv">pc1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">=========================================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> iperf3 -c pc4 -p &lt;span class="m">5201&lt;/span> -t0 -P &lt;span class="m">5&lt;/span> -b 5M &amp;gt; iperf-pc4.log &lt;span class="p">&amp;amp;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> iperf3 -c pc3 -p &lt;span class="m">5202&lt;/span> -t0 -P &lt;span class="m">5&lt;/span> -b 5M &amp;gt; iperf-pc3.log &lt;span class="p">&amp;amp;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt; snipped &amp;gt; &lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>We could be more granular here on the parallel streams, time, bandwidth or whatever else is required.&lt;/p>
&lt;ul>
&lt;li>Lastly, for the &lt;code>vrf&lt;/code> module, we wanted one VPN to use IPv4:Number format so we had to manually specify the RDs/RTs under the nodes.&lt;/li>
&lt;/ul>
&lt;p>Let&amp;rsquo;s issue a &lt;code>netlab create&lt;/code> first to check if we are syntactically correct or we missed some logic, and then bring it up.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>wsl&lt;span class="o">)&lt;/span>&amp;lt;&amp;lt;· netlab create
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>CREATED&lt;span class="o">]&lt;/span> provider configuration file: clab.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>MAPPED&lt;span class="o">]&lt;/span> clab_files/pc1/hosts to pc1:/etc/hosts &lt;span class="o">(&lt;/span>from templates/provider/clab/linux/hosts.j2&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>MAPPED&lt;span class="o">]&lt;/span> clab_files/pc2/hosts to pc2:/etc/hosts &lt;span class="o">(&lt;/span>from templates/provider/clab/linux/hosts.j2&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>MAPPED&lt;span class="o">]&lt;/span> clab_files/pc3/hosts to pc3:/etc/hosts &lt;span class="o">(&lt;/span>from templates/provider/clab/linux/hosts.j2&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>MAPPED&lt;span class="o">]&lt;/span> clab_files/pc4/hosts to pc4:/etc/hosts &lt;span class="o">(&lt;/span>from templates/provider/clab/linux/hosts.j2&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>MAPPED&lt;span class="o">]&lt;/span> clab_files/pc11/hosts to pc11:/etc/hosts &lt;span class="o">(&lt;/span>from templates/provider/clab/linux/hosts.j2&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>MAPPED&lt;span class="o">]&lt;/span> clab_files/pc12/hosts to pc12:/etc/hosts &lt;span class="o">(&lt;/span>from templates/provider/clab/linux/hosts.j2&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>MAPPED&lt;span class="o">]&lt;/span> clab_files/pc13/hosts to pc13:/etc/hosts &lt;span class="o">(&lt;/span>from templates/provider/clab/linux/hosts.j2&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>MAPPED&lt;span class="o">]&lt;/span> clab_files/pc14/hosts to pc14:/etc/hosts &lt;span class="o">(&lt;/span>from templates/provider/clab/linux/hosts.j2&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>CREATED&lt;span class="o">]&lt;/span> transformed topology dump in YAML format in netlab.snapshot.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>GROUPS&lt;span class="o">]&lt;/span> group_vars &lt;span class="k">for&lt;/span> all
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>GROUPS&lt;span class="o">]&lt;/span> group_vars &lt;span class="k">for&lt;/span> modules
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>GROUPS&lt;span class="o">]&lt;/span> group_vars &lt;span class="k">for&lt;/span> custom_configs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>GROUPS&lt;span class="o">]&lt;/span> group_vars &lt;span class="k">for&lt;/span> iol
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>HOSTS&lt;span class="o">]&lt;/span> host_vars &lt;span class="k">for&lt;/span> rc1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>HOSTS&lt;span class="o">]&lt;/span> host_vars &lt;span class="k">for&lt;/span> rc2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>HOSTS&lt;span class="o">]&lt;/span> host_vars &lt;span class="k">for&lt;/span> rc3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>HOSTS&lt;span class="o">]&lt;/span> host_vars &lt;span class="k">for&lt;/span> rc4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>HOSTS&lt;span class="o">]&lt;/span> host_vars &lt;span class="k">for&lt;/span> ce1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>HOSTS&lt;span class="o">]&lt;/span> host_vars &lt;span class="k">for&lt;/span> ce2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>HOSTS&lt;span class="o">]&lt;/span> host_vars &lt;span class="k">for&lt;/span> ce3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>HOSTS&lt;span class="o">]&lt;/span> host_vars &lt;span class="k">for&lt;/span> ce4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>GROUPS&lt;span class="o">]&lt;/span> group_vars &lt;span class="k">for&lt;/span> linux
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>HOSTS&lt;span class="o">]&lt;/span> host_vars &lt;span class="k">for&lt;/span> pc1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>HOSTS&lt;span class="o">]&lt;/span> host_vars &lt;span class="k">for&lt;/span> pc2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>HOSTS&lt;span class="o">]&lt;/span> host_vars &lt;span class="k">for&lt;/span> pc3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>HOSTS&lt;span class="o">]&lt;/span> host_vars &lt;span class="k">for&lt;/span> pc4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>HOSTS&lt;span class="o">]&lt;/span> host_vars &lt;span class="k">for&lt;/span> pc11
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>HOSTS&lt;span class="o">]&lt;/span> host_vars &lt;span class="k">for&lt;/span> pc12
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>HOSTS&lt;span class="o">]&lt;/span> host_vars &lt;span class="k">for&lt;/span> pc13
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>HOSTS&lt;span class="o">]&lt;/span> host_vars &lt;span class="k">for&lt;/span> pc14
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>GROUPS&lt;span class="o">]&lt;/span> group_vars &lt;span class="k">for&lt;/span> pcs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>CREATED&lt;span class="o">]&lt;/span> minimized Ansible inventory hosts.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>CREATED&lt;span class="o">]&lt;/span> Ansible configuration file: ansible.cfg&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>wsl&lt;span class="o">)&lt;/span>&amp;lt;&amp;lt;· &lt;span class="nv">ANSIBLE_NOCOWS&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">1&lt;/span> netlab up
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt; snipped &amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PLAY RECAP ****************************************************************************************************************
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ce1 : &lt;span class="nv">ok&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">25&lt;/span> &lt;span class="nv">changed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">4&lt;/span> &lt;span class="nv">unreachable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">failed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">skipped&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">14&lt;/span> &lt;span class="nv">rescued&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">ignored&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ce2 : &lt;span class="nv">ok&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">24&lt;/span> &lt;span class="nv">changed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">3&lt;/span> &lt;span class="nv">unreachable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">failed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">skipped&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">14&lt;/span> &lt;span class="nv">rescued&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">ignored&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ce3 : &lt;span class="nv">ok&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">24&lt;/span> &lt;span class="nv">changed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">3&lt;/span> &lt;span class="nv">unreachable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">failed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">skipped&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">14&lt;/span> &lt;span class="nv">rescued&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">ignored&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ce4 : &lt;span class="nv">ok&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">24&lt;/span> &lt;span class="nv">changed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">3&lt;/span> &lt;span class="nv">unreachable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">failed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">skipped&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">14&lt;/span> &lt;span class="nv">rescued&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">ignored&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pc1 : &lt;span class="nv">ok&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">19&lt;/span> &lt;span class="nv">changed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">5&lt;/span> &lt;span class="nv">unreachable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">failed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">skipped&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">5&lt;/span> &lt;span class="nv">rescued&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">ignored&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pc11 : &lt;span class="nv">ok&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">19&lt;/span> &lt;span class="nv">changed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">5&lt;/span> &lt;span class="nv">unreachable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">failed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">skipped&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">5&lt;/span> &lt;span class="nv">rescued&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">ignored&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pc12 : &lt;span class="nv">ok&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">19&lt;/span> &lt;span class="nv">changed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">5&lt;/span> &lt;span class="nv">unreachable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">failed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">skipped&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">5&lt;/span> &lt;span class="nv">rescued&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">ignored&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pc13 : &lt;span class="nv">ok&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">19&lt;/span> &lt;span class="nv">changed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">5&lt;/span> &lt;span class="nv">unreachable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">failed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">skipped&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">5&lt;/span> &lt;span class="nv">rescued&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">ignored&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pc14 : &lt;span class="nv">ok&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">19&lt;/span> &lt;span class="nv">changed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">5&lt;/span> &lt;span class="nv">unreachable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">failed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">skipped&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">5&lt;/span> &lt;span class="nv">rescued&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">ignored&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pc2 : &lt;span class="nv">ok&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">19&lt;/span> &lt;span class="nv">changed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">5&lt;/span> &lt;span class="nv">unreachable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">failed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">skipped&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">5&lt;/span> &lt;span class="nv">rescued&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">ignored&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pc3 : &lt;span class="nv">ok&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">19&lt;/span> &lt;span class="nv">changed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">5&lt;/span> &lt;span class="nv">unreachable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">failed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">skipped&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">5&lt;/span> &lt;span class="nv">rescued&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">ignored&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pc4 : &lt;span class="nv">ok&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">19&lt;/span> &lt;span class="nv">changed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">5&lt;/span> &lt;span class="nv">unreachable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">failed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">skipped&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">5&lt;/span> &lt;span class="nv">rescued&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">ignored&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rc1 : &lt;span class="nv">ok&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">42&lt;/span> &lt;span class="nv">changed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">7&lt;/span> &lt;span class="nv">unreachable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">failed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">skipped&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">8&lt;/span> &lt;span class="nv">rescued&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">ignored&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rc2 : &lt;span class="nv">ok&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">42&lt;/span> &lt;span class="nv">changed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">7&lt;/span> &lt;span class="nv">unreachable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">failed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">skipped&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">8&lt;/span> &lt;span class="nv">rescued&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">ignored&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rc3 : &lt;span class="nv">ok&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">42&lt;/span> &lt;span class="nv">changed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">7&lt;/span> &lt;span class="nv">unreachable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">failed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">skipped&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">8&lt;/span> &lt;span class="nv">rescued&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">ignored&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rc4 : &lt;span class="nv">ok&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">42&lt;/span> &lt;span class="nv">changed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">7&lt;/span> &lt;span class="nv">unreachable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">failed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">skipped&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">8&lt;/span> &lt;span class="nv">rescued&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">ignored&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>SUCCESS&lt;span class="o">]&lt;/span> Lab devices configured
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>wsl&lt;span class="o">)&lt;/span>&amp;lt;&amp;lt;· netlab status
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">┏━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┓
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">┃ node ┃ device ┃ image ┃ mgmt IPv4 ┃ connection ┃ provider ┃ VM/container ┃ status ┃
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">┡━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━┩
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ce1 │ iol │ vrnetlab/cisco_iol:17.12… │ 192.168.121.111 │ network_cli │ clab │ ce1 │ Up About a minute │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├──────┼────────┼───────────────────────────┼─────────────────┼─────────────┼──────────┼──────────────┼───────────────────┤
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ce2 │ iol │ vrnetlab/cisco_iol:17.12… │ 192.168.121.112 │ network_cli │ clab │ ce2 │ Up About a minute │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├──────┼────────┼───────────────────────────┼─────────────────┼─────────────┼──────────┼──────────────┼───────────────────┤
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ce3 │ iol │ vrnetlab/cisco_iol:17.12… │ 192.168.121.113 │ network_cli │ clab │ ce3 │ Up About a minute │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├──────┼────────┼───────────────────────────┼─────────────────┼─────────────┼──────────┼──────────────┼───────────────────┤
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ce4 │ iol │ vrnetlab/cisco_iol:17.12… │ 192.168.121.114 │ network_cli │ clab │ ce4 │ Up About a minute │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├──────┼────────┼───────────────────────────┼─────────────────┼─────────────┼──────────┼──────────────┼───────────────────┤
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ pc1 │ linux │ ghcr.io/srl-labs/network… │ 192.168.121.105 │ docker │ clab │ pc1 │ Up About a minute │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├──────┼────────┼───────────────────────────┼─────────────────┼─────────────┼──────────┼──────────────┼───────────────────┤
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ pc11 │ linux │ ghcr.io/srl-labs/network… │ 192.168.121.109 │ docker │ clab │ pc11 │ Up About a minute │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├──────┼────────┼───────────────────────────┼─────────────────┼─────────────┼──────────┼──────────────┼───────────────────┤
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ pc12 │ linux │ ghcr.io/srl-labs/network… │ 192.168.121.110 │ docker │ clab │ pc12 │ Up About a minute │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├──────┼────────┼───────────────────────────┼─────────────────┼─────────────┼──────────┼──────────────┼───────────────────┤
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ pc13 │ linux │ ghcr.io/srl-labs/network… │ 192.168.121.115 │ docker │ clab │ pc13 │ Up About a minute │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├──────┼────────┼───────────────────────────┼─────────────────┼─────────────┼──────────┼──────────────┼───────────────────┤
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ pc14 │ linux │ ghcr.io/srl-labs/network… │ 192.168.121.116 │ docker │ clab │ pc14 │ Up About a minute │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├──────┼────────┼───────────────────────────┼─────────────────┼─────────────┼──────────┼──────────────┼───────────────────┤
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ pc2 │ linux │ ghcr.io/srl-labs/network… │ 192.168.121.106 │ docker │ clab │ pc2 │ Up About a minute │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├──────┼────────┼───────────────────────────┼─────────────────┼─────────────┼──────────┼──────────────┼───────────────────┤
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ pc3 │ linux │ ghcr.io/srl-labs/network… │ 192.168.121.107 │ docker │ clab │ pc3 │ Up About a minute │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├──────┼────────┼───────────────────────────┼─────────────────┼─────────────┼──────────┼──────────────┼───────────────────┤
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ pc4 │ linux │ ghcr.io/srl-labs/network… │ 192.168.121.108 │ docker │ clab │ pc4 │ Up About a minute │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├──────┼────────┼───────────────────────────┼─────────────────┼─────────────┼──────────┼──────────────┼───────────────────┤
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ rc1 │ iol │ vrnetlab/cisco_iol:17.12… │ 192.168.121.101 │ network_cli │ clab │ rc1 │ Up About a minute │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├──────┼────────┼───────────────────────────┼─────────────────┼─────────────┼──────────┼──────────────┼───────────────────┤
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ rc2 │ iol │ vrnetlab/cisco_iol:17.12… │ 192.168.121.102 │ network_cli │ clab │ rc2 │ Up About a minute │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├──────┼────────┼───────────────────────────┼─────────────────┼─────────────┼──────────┼──────────────┼───────────────────┤
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ rc3 │ iol │ vrnetlab/cisco_iol:17.12… │ 192.168.121.103 │ network_cli │ clab │ rc3 │ Up About a minute │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├──────┼────────┼───────────────────────────┼─────────────────┼─────────────┼──────────┼──────────────┼───────────────────┤
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ rc4 │ iol │ vrnetlab/cisco_iol:17.12… │ 192.168.121.104 │ network_cli │ clab │ rc4 │ Up About a minute │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└──────┴────────┴───────────────────────────┴─────────────────┴─────────────┴──────────┴──────────────┴───────────────────┘&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>All our nodes are up and as you can see from their management IP, their &lt;code>id's&lt;/code> are following either the order of their definition in the topology file or the &lt;code>id&lt;/code> value defined for them.&lt;/p>
&lt;h3 class="heading-element" id="service-containers">&lt;span>Service Containers&lt;/span>
 &lt;a href="#service-containers" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h3>&lt;p>Let&amp;rsquo;s add now our additional containers based on our use case. We are going to be defining them in the topology as we did for our &lt;code>PC's&lt;/code>, but here we also need to pass some &lt;code>env&lt;/code> variables to them in order for &lt;em>containerlab&lt;/em> to bring them up properly. Some of these variables have common values for all but some have specific one&amp;rsquo;s. Hence, we are going to use the hierarchy to define them accordingly.&lt;/p>
&lt;p>Here is how the relevant &lt;code>groups&lt;/code> section looks like in the topology:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">groups&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">ksynth&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">members&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ksynth1, ksynth2, ksynth3, ksynth4 ]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">device&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">linux&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">clab&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">kentik/ksynth-agent:latest&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">kentik&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">members&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">kproxy, kbgp, ksynth1, ksynth2, ksynth3, ksynth4 ]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">clab&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">env&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">KENTIK_COMPANY&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">&amp;lt; Kentik Company ID &amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">KENTIK_REGION&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">EU&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">KENTIK_API_TOKEN&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">&amp;lt; Kentik User Token &amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">KENTIK_API_EMAIL&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">&amp;lt; Kentik User Email &amp;gt;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Here we have used one group to define the &lt;strong>ksynth&lt;/strong> agents that are based on the relevant image, and also, used the &lt;strong>kentik&lt;/strong> group to define the common variables that all the service containers need in order to communicate with Kentik.&lt;/p>
&lt;p>Now, let&amp;rsquo;s look at the &lt;code>nodes&lt;/code> section:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">nodes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">kproxy&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">device&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">linux&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">clab&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">kentik/kproxy:latest&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">cmd&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">&amp;gt;-&lt;/span>&lt;span class="sd">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> -api_email=&amp;lt; Kentik kproxy agent email address &amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> -region=EU
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> -healthcheck=0.0.0.0
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> -dns internal:192.168.121.101:53&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">ksynth1&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">clab.binds&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">mounts/ksynth1:/var/lib/ksynth-agent&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">ksynth2&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">clab.binds&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">mounts/ksynth2:/var/lib/ksynth-agent&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">ksynth3&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">clab.binds&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">mounts/ksynth3:/var/lib/ksynth-agent&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">ksynth4&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">clab.binds&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">mounts/ksynth4:/var/lib/ksynth-agent&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">kbgp&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">device&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">linux&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">clab&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">kentik/kbgp:latest&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">env&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">KENTIK_REGION&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">fra1&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Here we can observe the following:&lt;/p>
&lt;ul>
&lt;li>For &lt;strong>kproxy&lt;/strong>: We define the image and pass along the command line to be run on the container. All other &lt;code>env&lt;/code> variables defined in the &lt;code>groups&lt;/code> section are going to be available to the container as well. Unfortunately, I could not find a way to dynamically pass variables in the &lt;code>clab.cmd&lt;/code>&lt;/li>
&lt;li>For &lt;strong>ksynth&lt;/strong>: Since we want the agents to persist, we have to preserve the relevant directory across deployments, so we bind mount a local directory path for every instance. The relevant directories have to exist in our directory structure.&lt;/li>
&lt;li>For &lt;strong>kbgp&lt;/strong>: We specify the image and re-define the region variable to override the one defined in the &lt;code>groups&lt;/code> section since only &lt;strong>kbgp&lt;/strong> needs it to be like that.&lt;/li>
&lt;/ul>
&lt;p>We also create the additional connections in our &lt;code>links&lt;/code> section:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">links&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">rc1-ksynth1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">rc2-ksynth2&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">rc3-ksynth3&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">rc4-ksynth4&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">rc1-kbgp&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Now, for our last agent that will be part of Kentik NMS, we are going to bring this up as a standalone container not controlled via &lt;em>netlab&lt;/em>, and here is how the &lt;em>compose&lt;/em> file looks like:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">services&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">kagent&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">container_name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">kagent&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">hostname&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">iol_kagent&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">kentik/kagent:latest&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">restart&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">unless-stopped&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">network_mode&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">host&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">environment&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">K_COMPANY_ID&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">&amp;lt; Kentik Company ID &amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">K_API_ROOT&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">grpc.api.kentik.eu:443&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">cap_add&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">NET_RAW&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">volumes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">kagent-data:/opt/kentik&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">volumes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">kagent-data&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">driver&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">local&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Two points here worth exploring:&lt;/p>
&lt;ul>
&lt;li>&lt;strong>kagent&lt;/strong> is not part of the topology since currently there is no way to pass the capability to &lt;em>containerlab&lt;/em>&lt;/li>
&lt;li>The agent is going to poll the devices for SNMP so connectivity wise, this works by default since both agent network (host) and topology management networks are on the same host (WSL)&lt;/li>
&lt;/ul>
&lt;p>Now, this seems the case also for the &lt;strong>kproxy&lt;/strong> container, but here, &lt;em>netlab&lt;/em> is going to need its&amp;rsquo; IP address in order to add additional configuration to the devices exporting flows as we are going to see in the following paragraphs.&lt;/p>
&lt;p>One last part to cover here is the fact that we have to provision our network devices accordingly in order to be ready to integrate with Kentik. This means that:&lt;/p>
&lt;ol>
&lt;li>They need to be sending netflow to &lt;strong>kproxy&lt;/strong>&lt;/li>
&lt;li>They need to have snmp enabled in order to be polled by &lt;strong>kproxy&lt;/strong> and &lt;strong>kagent&lt;/strong>&lt;/li>
&lt;li>They need to be peering with &lt;strong>kbgp&lt;/strong> in order to send their BGP tables to Kentik&lt;/li>
&lt;/ol>
&lt;p>Well, it seems as a usual case of templating configurations and passing them on to devices via &lt;em>netlab&lt;/em>.&lt;/p>
&lt;p>For the snmp part, we just re-use our &lt;code>core-extras&lt;/code> template to add the config:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-jinja" data-lang="jinja">&lt;span class="line">&lt;span class="cl">&lt;span class="x">&amp;lt; snipped &amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">&lt;/span>&lt;span class="c">{# Enable SNMP #}&lt;/span>&lt;span class="x">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">!
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">snmp-server ifindex persist
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">snmp-server community &lt;/span>&lt;span class="cp">{{&lt;/span> &lt;span class="nv">KENTIK_SNMPV2_COMMUNITY&lt;/span> &lt;span class="cp">}}&lt;/span>&lt;span class="x">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">!&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>For the netflow part, IOL supports a feature called Flexible netflow and can do v9 and ipfix as well as standard netflow v9 exports. I have seen that with Flexible netflow configuration, there is no way to configure the active cache settings and we need this to be 1 min. for Kentik. In any case, here are the respective templates for all three variations of the netflow configurations needed.&lt;/p>
&lt;div class="highlight" title="Standard Netflow v9">&lt;pre tabindex="0" class="chroma">&lt;code class="language-jinja" data-lang="jinja">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">{%&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="nv">ACTION&lt;/span> &lt;span class="k">is&lt;/span> &lt;span class="k">not&lt;/span> &lt;span class="nf">defined&lt;/span> &lt;span class="k">or&lt;/span> &lt;span class="nv">ACTION&lt;/span> &lt;span class="k">not&lt;/span> &lt;span class="k">in&lt;/span> &lt;span class="o">[&lt;/span>&lt;span class="s1">&amp;#39;push&amp;#39;&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="s1">&amp;#39;remove&amp;#39;&lt;/span>&lt;span class="o">]&lt;/span> &lt;span class="cp">%}&lt;/span>&lt;span class="x">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">&lt;/span>&lt;span class="cp">{{&lt;/span>&lt;span class="kp">_&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="nf">mandatory&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s2">&amp;#34;ACTION is mandatoy - push or remove&amp;#34;&lt;/span>&lt;span class="o">)&lt;/span>&lt;span class="cp">}}&lt;/span>&lt;span class="x">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">&lt;/span>&lt;span class="cp">{%&lt;/span> &lt;span class="k">elif&lt;/span> &lt;span class="nv">ACTION&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s2">&amp;#34;remove&amp;#34;&lt;/span> &lt;span class="cp">%}&lt;/span>&lt;span class="x">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">!
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">interface range &lt;/span>&lt;span class="cp">{%&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="nv">interface&lt;/span> &lt;span class="k">in&lt;/span> &lt;span class="nv">netlab_interfaces&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="nv">interface.type&lt;/span> &lt;span class="p">!&lt;/span>&lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;loopback&amp;#39;&lt;/span> -&lt;span class="cp">%}&lt;/span>&lt;span class="x">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">&lt;/span>&lt;span class="cp">{{&lt;/span> &lt;span class="nv">interface.ifname&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s2">&amp;#34; , &amp;#34;&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="k">not&lt;/span> &lt;span class="nb">loop&lt;/span>&lt;span class="nv">.last&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="nv">interface.ifname&lt;/span> &lt;span class="cp">}}{%&lt;/span> &lt;span class="k">endfor&lt;/span> &lt;span class="cp">%}&lt;/span>&lt;span class="x">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> no flow-sampler KENTIK
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> !
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">!
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">no ip flow-export source Ethernet0/0
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">no ip flow-export version 9 origin-as bgp-nexthop
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">no ip flow-export template options sampler
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">no ip flow-export template timeout-rate
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">no ip flow-export template refresh-rate
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">no ip flow-export destination &lt;/span>&lt;span class="cp">{{&lt;/span> &lt;span class="nv">hostvars&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="s1">&amp;#39;kproxy&amp;#39;&lt;/span>&lt;span class="o">][&lt;/span>&lt;span class="s1">&amp;#39;mgmt&amp;#39;&lt;/span>&lt;span class="o">][&lt;/span>&lt;span class="s1">&amp;#39;ipv4&amp;#39;&lt;/span>&lt;span class="o">]&lt;/span> &lt;span class="cp">}}&lt;/span>&lt;span class="x"> 9995 vrf clab-mgmt
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">no flow-sampler-map KENTIK
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">no ip flow-cache timeout inactive
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">no ip flow-cache timeout active
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">!
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">&lt;/span>&lt;span class="cp">{%&lt;/span> &lt;span class="k">elif&lt;/span> &lt;span class="nv">ACTION&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s2">&amp;#34;push&amp;#34;&lt;/span> &lt;span class="cp">%}&lt;/span>&lt;span class="x">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">!
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">ip flow-cache timeout inactive 30
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">ip flow-cache timeout active 1
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">!
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">flow-sampler-map KENTIK
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> mode random one-out-of &lt;/span>&lt;span class="cp">{{&lt;/span> &lt;span class="nv">KENTIK_SAMPLE_RATE&lt;/span> &lt;span class="cp">}}&lt;/span>&lt;span class="x">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">!
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">ip flow-export source Ethernet0/0
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">ip flow-export version 9 origin-as bgp-nexthop
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">ip flow-export template options sampler
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">ip flow-export template timeout-rate 1
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">ip flow-export template refresh-rate 50
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">ip flow-export destination &lt;/span>&lt;span class="cp">{{&lt;/span> &lt;span class="nv">hostvars&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="s1">&amp;#39;kproxy&amp;#39;&lt;/span>&lt;span class="o">][&lt;/span>&lt;span class="s1">&amp;#39;mgmt&amp;#39;&lt;/span>&lt;span class="o">][&lt;/span>&lt;span class="s1">&amp;#39;ipv4&amp;#39;&lt;/span>&lt;span class="o">]&lt;/span> &lt;span class="cp">}}&lt;/span>&lt;span class="x"> 9995 vrf clab-mgmt
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">!
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">interface range &lt;/span>&lt;span class="cp">{%&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="nv">interface&lt;/span> &lt;span class="k">in&lt;/span> &lt;span class="nv">netlab_interfaces&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="nv">interface.type&lt;/span> &lt;span class="p">!&lt;/span>&lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;loopback&amp;#39;&lt;/span> -&lt;span class="cp">%}&lt;/span>&lt;span class="x">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">&lt;/span>&lt;span class="cp">{{&lt;/span> &lt;span class="nv">interface.ifname&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s2">&amp;#34; , &amp;#34;&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="k">not&lt;/span> &lt;span class="nb">loop&lt;/span>&lt;span class="nv">.last&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="nv">interface.ifname&lt;/span> &lt;span class="cp">}}{%&lt;/span> &lt;span class="k">endfor&lt;/span> &lt;span class="cp">%}&lt;/span>&lt;span class="x">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> flow-sampler KENTIK
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">!
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">&lt;/span>&lt;span class="cp">{%&lt;/span> &lt;span class="k">endif&lt;/span> &lt;span class="cp">%}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight" title="Flexible Netflow v9">&lt;pre tabindex="0" class="chroma">&lt;code class="language-jinja" data-lang="jinja">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">{%&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="nv">ACTION&lt;/span> &lt;span class="k">is&lt;/span> &lt;span class="k">not&lt;/span> &lt;span class="nf">defined&lt;/span> &lt;span class="k">or&lt;/span> &lt;span class="nv">ACTION&lt;/span> &lt;span class="k">not&lt;/span> &lt;span class="k">in&lt;/span> &lt;span class="o">[&lt;/span>&lt;span class="s1">&amp;#39;push&amp;#39;&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="s1">&amp;#39;remove&amp;#39;&lt;/span>&lt;span class="o">]&lt;/span> &lt;span class="cp">%}&lt;/span>&lt;span class="x">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> &lt;/span>&lt;span class="cp">{{&lt;/span>&lt;span class="kp">_&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="nf">mandatory&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s2">&amp;#34;ACTION is mandatoy - push or remove&amp;#34;&lt;/span>&lt;span class="o">)&lt;/span>&lt;span class="cp">}}&lt;/span>&lt;span class="x">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">&lt;/span>&lt;span class="cp">{%&lt;/span> &lt;span class="k">elif&lt;/span> &lt;span class="nv">ACTION&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s2">&amp;#34;remove&amp;#34;&lt;/span> &lt;span class="cp">%}&lt;/span>&lt;span class="x">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">!
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">interface range &lt;/span>&lt;span class="cp">{%&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="nv">interface&lt;/span> &lt;span class="k">in&lt;/span> &lt;span class="nv">netlab_interfaces&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="nv">interface.type&lt;/span> &lt;span class="p">!&lt;/span>&lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;loopback&amp;#39;&lt;/span> -&lt;span class="cp">%}&lt;/span>&lt;span class="x">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">&lt;/span>&lt;span class="cp">{{&lt;/span> &lt;span class="nv">interface.ifname&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s2">&amp;#34; , &amp;#34;&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="k">not&lt;/span> &lt;span class="nb">loop&lt;/span>&lt;span class="nv">.last&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="nv">interface.ifname&lt;/span> &lt;span class="cp">}}{%&lt;/span> &lt;span class="k">endfor&lt;/span> &lt;span class="cp">%}&lt;/span>&lt;span class="x">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> no ip flow monitor KENTIK sampler KENTIK input
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> !
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">!
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">no sampler KENTIK
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">no flow monitor KENTIK
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">no flow exporter KENTIK
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">no flow record KENTIK
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">!
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">&lt;/span>&lt;span class="cp">{%&lt;/span> &lt;span class="k">elif&lt;/span> &lt;span class="nv">ACTION&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s2">&amp;#34;push&amp;#34;&lt;/span> &lt;span class="cp">%}&lt;/span>&lt;span class="x">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">!
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">flow record KENTIK
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> match routing vrf input
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> match ipv4 tos
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> match ipv4 protocol
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> match ipv4 source address
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> match ipv4 destination address
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> match transport source-port
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> match transport destination-port
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> match interface input
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> collect routing source as
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> collect routing destination as
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> collect routing next-hop address ipv4
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> collect transport tcp flags
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> collect interface output
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> collect counter bytes
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> collect counter packets
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> collect timestamp sys-uptime first
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> collect timestamp sys-uptime last
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">!
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">flow exporter KENTIK
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> destination &lt;/span>&lt;span class="cp">{{&lt;/span> &lt;span class="nv">hostvars&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="s1">&amp;#39;kproxy&amp;#39;&lt;/span>&lt;span class="o">][&lt;/span>&lt;span class="s1">&amp;#39;mgmt&amp;#39;&lt;/span>&lt;span class="o">][&lt;/span>&lt;span class="s1">&amp;#39;ipv4&amp;#39;&lt;/span>&lt;span class="o">]&lt;/span> &lt;span class="cp">}}&lt;/span>&lt;span class="x"> vrf clab-mgmt
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> source Ethernet0/0
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> transport udp 9995
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line hl">&lt;span class="cl">&lt;span class="x"> export-protocol netflow-v9
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> template data timeout 60
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> option interface-table
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> option vrf-table
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> option sampler-table
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">!
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">flow monitor KENTIK
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> exporter KENTIK
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> statistics packet protocol
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> statistics packet size
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> record KENTIK
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">!
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">sampler KENTIK
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> mode random 1 out-of &lt;/span>&lt;span class="cp">{{&lt;/span> &lt;span class="nv">KENTIK_SAMPLE_RATE&lt;/span> &lt;span class="cp">}}&lt;/span>&lt;span class="x">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">!
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">interface range &lt;/span>&lt;span class="cp">{%&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="nv">interface&lt;/span> &lt;span class="k">in&lt;/span> &lt;span class="nv">netlab_interfaces&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="nv">interface.type&lt;/span> &lt;span class="p">!&lt;/span>&lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;loopback&amp;#39;&lt;/span> -&lt;span class="cp">%}&lt;/span>&lt;span class="x">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">&lt;/span>&lt;span class="cp">{{&lt;/span> &lt;span class="nv">interface.ifname&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s2">&amp;#34; , &amp;#34;&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="k">not&lt;/span> &lt;span class="nb">loop&lt;/span>&lt;span class="nv">.last&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="nv">interface.ifname&lt;/span> &lt;span class="cp">}}{%&lt;/span> &lt;span class="k">endfor&lt;/span> &lt;span class="cp">%}&lt;/span>&lt;span class="x">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> ip flow monitor KENTIK sampler KENTIK input
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">!
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">&lt;/span>&lt;span class="cp">{%&lt;/span> &lt;span class="k">endif&lt;/span> &lt;span class="cp">%}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight" title="Flexible IPFIX">&lt;pre tabindex="0" class="chroma">&lt;code class="language-jinja" data-lang="jinja">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">{%&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="nv">ACTION&lt;/span> &lt;span class="k">is&lt;/span> &lt;span class="k">not&lt;/span> &lt;span class="nf">defined&lt;/span> &lt;span class="k">or&lt;/span> &lt;span class="nv">ACTION&lt;/span> &lt;span class="k">not&lt;/span> &lt;span class="k">in&lt;/span> &lt;span class="o">[&lt;/span>&lt;span class="s1">&amp;#39;push&amp;#39;&lt;/span>&lt;span class="o">,&lt;/span>&lt;span class="s1">&amp;#39;remove&amp;#39;&lt;/span>&lt;span class="o">]&lt;/span> &lt;span class="cp">%}&lt;/span>&lt;span class="x">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> &lt;/span>&lt;span class="cp">{{&lt;/span>&lt;span class="kp">_&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="nf">mandatory&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s2">&amp;#34;ACTION is mandatoy - push or remove&amp;#34;&lt;/span>&lt;span class="o">)&lt;/span>&lt;span class="cp">}}&lt;/span>&lt;span class="x">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">&lt;/span>&lt;span class="cp">{%&lt;/span> &lt;span class="k">elif&lt;/span> &lt;span class="nv">ACTION&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s2">&amp;#34;remove&amp;#34;&lt;/span> &lt;span class="cp">%}&lt;/span>&lt;span class="x">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">!
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">interface range &lt;/span>&lt;span class="cp">{%&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="nv">interface&lt;/span> &lt;span class="k">in&lt;/span> &lt;span class="nv">netlab_interfaces&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="nv">interface.type&lt;/span> &lt;span class="p">!&lt;/span>&lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;loopback&amp;#39;&lt;/span> -&lt;span class="cp">%}&lt;/span>&lt;span class="x">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">&lt;/span>&lt;span class="cp">{{&lt;/span> &lt;span class="nv">interface.ifname&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s2">&amp;#34; , &amp;#34;&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="k">not&lt;/span> &lt;span class="nb">loop&lt;/span>&lt;span class="nv">.last&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="nv">interface.ifname&lt;/span> &lt;span class="cp">}}{%&lt;/span> &lt;span class="k">endfor&lt;/span> &lt;span class="cp">%}&lt;/span>&lt;span class="x">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> no ip flow monitor KENTIK sampler KENTIK input
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> !
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">!
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">no sampler KENTIK
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">no flow monitor KENTIK
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">no flow exporter KENTIK
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">no flow record KENTIK
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">!
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">&lt;/span>&lt;span class="cp">{%&lt;/span> &lt;span class="k">elif&lt;/span> &lt;span class="nv">ACTION&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s2">&amp;#34;push&amp;#34;&lt;/span> &lt;span class="cp">%}&lt;/span>&lt;span class="x">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">!
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">flow record KENTIK
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> match routing vrf input
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> match ipv4 tos
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> match ipv4 protocol
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> match ipv4 source address
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> match ipv4 destination address
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> match transport source-port
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> match transport destination-port
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> match interface input
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> collect routing source as
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> collect routing destination as
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> collect routing next-hop address ipv4
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> collect transport tcp flags
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> collect interface output
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> collect counter bytes
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> collect counter packets
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> collect timestamp sys-uptime first
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> collect timestamp sys-uptime last
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">!
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">flow exporter KENTIK
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> destination &lt;/span>&lt;span class="cp">{{&lt;/span> &lt;span class="nv">hostvars&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="s1">&amp;#39;kproxy&amp;#39;&lt;/span>&lt;span class="o">][&lt;/span>&lt;span class="s1">&amp;#39;mgmt&amp;#39;&lt;/span>&lt;span class="o">][&lt;/span>&lt;span class="s1">&amp;#39;ipv4&amp;#39;&lt;/span>&lt;span class="o">]&lt;/span> &lt;span class="cp">}}&lt;/span>&lt;span class="x"> vrf clab-mgmt
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> source Ethernet0/0
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> transport udp 9995
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line hl">&lt;span class="cl">&lt;span class="x"> export-protocol ipfix
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> template data timeout 60
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> option interface-table
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> option vrf-table
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> option sampler-table
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">!
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">flow monitor KENTIK
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> exporter KENTIK
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> statistics packet protocol
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> statistics packet size
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> record KENTIK
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">!
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">sampler KENTIK
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> mode random 1 out-of &lt;/span>&lt;span class="cp">{{&lt;/span> &lt;span class="nv">KENTIK_SAMPLE_RATE&lt;/span> &lt;span class="cp">}}&lt;/span>&lt;span class="x">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">!
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">interface range &lt;/span>&lt;span class="cp">{%&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="nv">interface&lt;/span> &lt;span class="k">in&lt;/span> &lt;span class="nv">netlab_interfaces&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="nv">interface.type&lt;/span> &lt;span class="p">!&lt;/span>&lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;loopback&amp;#39;&lt;/span> -&lt;span class="cp">%}&lt;/span>&lt;span class="x">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">&lt;/span>&lt;span class="cp">{{&lt;/span> &lt;span class="nv">interface.ifname&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s2">&amp;#34; , &amp;#34;&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="k">not&lt;/span> &lt;span class="nb">loop&lt;/span>&lt;span class="nv">.last&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="nv">interface.ifname&lt;/span> &lt;span class="cp">}}{%&lt;/span> &lt;span class="k">endfor&lt;/span> &lt;span class="cp">%}&lt;/span>&lt;span class="x">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> ip flow monitor KENTIK sampler KENTIK input
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">!
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">&lt;/span>&lt;span class="cp">{%&lt;/span> &lt;span class="k">endif&lt;/span> &lt;span class="cp">%}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>All three templates include the respective &lt;em>no&lt;/em> statements so you can provision them via the &lt;code>netlab config&lt;/code> command and switch between them on the devices.&lt;/p>
&lt;p>Now, last but not least, we have the BGP configuration. Kentik acts as a route reflector and we peer with the enabled address families via &lt;strong>kbgp&lt;/strong> to send both tables from each device.&lt;/p>
&lt;div class="highlight" title="BGP Configuration">&lt;pre tabindex="0" class="chroma">&lt;code class="language-jinja" data-lang="jinja">&lt;span class="line">&lt;span class="cl">&lt;span class="x">!
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">ip prefix-list PL_HOSTS seq 5 permit 0.0.0.0/0 ge 32
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">ip prefix-list PL_DEFAULT seq 5 permit 0.0.0.0/0
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">!
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">route-map RM_KENTIK_IN permit 5
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> match ip address prefix-list PL_HOSTS
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">!
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">route-map RM_KENTIK_OUT deny 5
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> match ip address prefix-list PL_DEFAULT
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">!
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">route-map RM_KENTIK_OUT permit 10
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> set community &lt;/span>&lt;span class="cp">{{&lt;/span> &lt;span class="nv">bgp.as&lt;/span> &lt;span class="cp">}}&lt;/span>&lt;span class="x">:&lt;/span>&lt;span class="cp">{{&lt;/span> &lt;span class="nv">id&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="m">100&lt;/span> &lt;span class="cp">}}&lt;/span>&lt;span class="x"> additive
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> set extcommunity color &lt;/span>&lt;span class="cp">{{&lt;/span> &lt;span class="nv">id&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="m">10&lt;/span> &lt;span class="cp">}}&lt;/span>&lt;span class="x"> additive
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">!
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">route-map RM_IBGP_OUT permit 5
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> set community &lt;/span>&lt;span class="cp">{{&lt;/span> &lt;span class="nv">bgp.as&lt;/span> &lt;span class="cp">}}&lt;/span>&lt;span class="x">:&lt;/span>&lt;span class="cp">{{&lt;/span> &lt;span class="nv">id&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="m">100&lt;/span> &lt;span class="cp">}}&lt;/span>&lt;span class="x"> additive
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> set extcommunity color &lt;/span>&lt;span class="cp">{{&lt;/span> &lt;span class="nv">id&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="m">10&lt;/span> &lt;span class="cp">}}&lt;/span>&lt;span class="x"> additive
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">!
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">router bgp &lt;/span>&lt;span class="cp">{{&lt;/span> &lt;span class="nv">bgp.as&lt;/span> &lt;span class="cp">}}&lt;/span>&lt;span class="x">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> neighbor &lt;/span>&lt;span class="cp">{{&lt;/span> &lt;span class="nv">hosts&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="s1">&amp;#39;kbgp&amp;#39;&lt;/span>&lt;span class="o">][&lt;/span>&lt;span class="s1">&amp;#39;ipv4&amp;#39;&lt;/span>&lt;span class="o">][&lt;/span>&lt;span class="m">0&lt;/span>&lt;span class="o">]&lt;/span> &lt;span class="cp">}}&lt;/span>&lt;span class="x"> remote-as &lt;/span>&lt;span class="cp">{{&lt;/span> &lt;span class="nv">bgp.as&lt;/span> &lt;span class="cp">}}&lt;/span>&lt;span class="x">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> neighbor &lt;/span>&lt;span class="cp">{{&lt;/span> &lt;span class="nv">hosts&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="s1">&amp;#39;kbgp&amp;#39;&lt;/span>&lt;span class="o">][&lt;/span>&lt;span class="s1">&amp;#39;ipv4&amp;#39;&lt;/span>&lt;span class="o">][&lt;/span>&lt;span class="m">0&lt;/span>&lt;span class="o">]&lt;/span> &lt;span class="cp">}}&lt;/span>&lt;span class="x"> description KENTIK
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> neighbor &lt;/span>&lt;span class="cp">{{&lt;/span> &lt;span class="nv">hosts&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="s1">&amp;#39;kbgp&amp;#39;&lt;/span>&lt;span class="o">][&lt;/span>&lt;span class="s1">&amp;#39;ipv4&amp;#39;&lt;/span>&lt;span class="o">][&lt;/span>&lt;span class="m">0&lt;/span>&lt;span class="o">]&lt;/span> &lt;span class="cp">}}&lt;/span>&lt;span class="x"> update-source &lt;/span>&lt;span class="cp">{{&lt;/span> &lt;span class="nv">loopback.ifname&lt;/span> &lt;span class="cp">}}&lt;/span>&lt;span class="x">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">!
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">address-family ipv4
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> neighbor &lt;/span>&lt;span class="cp">{{&lt;/span> &lt;span class="nv">hosts&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="s1">&amp;#39;kbgp&amp;#39;&lt;/span>&lt;span class="o">][&lt;/span>&lt;span class="s1">&amp;#39;ipv4&amp;#39;&lt;/span>&lt;span class="o">][&lt;/span>&lt;span class="m">0&lt;/span>&lt;span class="o">]&lt;/span> &lt;span class="cp">}}&lt;/span>&lt;span class="x"> activate
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> neighbor &lt;/span>&lt;span class="cp">{{&lt;/span> &lt;span class="nv">hosts&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="s1">&amp;#39;kbgp&amp;#39;&lt;/span>&lt;span class="o">][&lt;/span>&lt;span class="s1">&amp;#39;ipv4&amp;#39;&lt;/span>&lt;span class="o">][&lt;/span>&lt;span class="m">0&lt;/span>&lt;span class="o">]&lt;/span> &lt;span class="cp">}}&lt;/span>&lt;span class="x"> route-reflector-client
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> neighbor &lt;/span>&lt;span class="cp">{{&lt;/span> &lt;span class="nv">hosts&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="s1">&amp;#39;kbgp&amp;#39;&lt;/span>&lt;span class="o">][&lt;/span>&lt;span class="s1">&amp;#39;ipv4&amp;#39;&lt;/span>&lt;span class="o">][&lt;/span>&lt;span class="m">0&lt;/span>&lt;span class="o">]&lt;/span> &lt;span class="cp">}}&lt;/span>&lt;span class="x"> route-map RM_KENTIK_IN in
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> neighbor &lt;/span>&lt;span class="cp">{{&lt;/span> &lt;span class="nv">hosts&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="s1">&amp;#39;kbgp&amp;#39;&lt;/span>&lt;span class="o">][&lt;/span>&lt;span class="s1">&amp;#39;ipv4&amp;#39;&lt;/span>&lt;span class="o">][&lt;/span>&lt;span class="m">0&lt;/span>&lt;span class="o">]&lt;/span> &lt;span class="cp">}}&lt;/span>&lt;span class="x"> route-map RM_KENTIK_OUT out
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">&lt;/span>&lt;span class="cp">{%&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="nv">nei&lt;/span> &lt;span class="k">in&lt;/span> &lt;span class="nv">bgp.neighbors&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="nv">nei.type&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s1">&amp;#39;ibgp&amp;#39;&lt;/span> &lt;span class="cp">%}&lt;/span>&lt;span class="x">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> neighbor &lt;/span>&lt;span class="cp">{{&lt;/span> &lt;span class="nv">nei.ipv4&lt;/span> &lt;span class="cp">}}&lt;/span>&lt;span class="x"> route-map RM_IBGP_OUT out
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">&lt;/span>&lt;span class="cp">{%&lt;/span> &lt;span class="k">endfor&lt;/span> &lt;span class="cp">%}&lt;/span>&lt;span class="x">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">!
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">address-family vpnv4
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> neighbor &lt;/span>&lt;span class="cp">{{&lt;/span> &lt;span class="nv">hosts&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="s1">&amp;#39;kbgp&amp;#39;&lt;/span>&lt;span class="o">][&lt;/span>&lt;span class="s1">&amp;#39;ipv4&amp;#39;&lt;/span>&lt;span class="o">][&lt;/span>&lt;span class="m">0&lt;/span>&lt;span class="o">]&lt;/span> &lt;span class="cp">}}&lt;/span>&lt;span class="x"> activate
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> neighbor &lt;/span>&lt;span class="cp">{{&lt;/span> &lt;span class="nv">hosts&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="s1">&amp;#39;kbgp&amp;#39;&lt;/span>&lt;span class="o">][&lt;/span>&lt;span class="s1">&amp;#39;ipv4&amp;#39;&lt;/span>&lt;span class="o">][&lt;/span>&lt;span class="m">0&lt;/span>&lt;span class="o">]&lt;/span> &lt;span class="cp">}}&lt;/span>&lt;span class="x"> route-reflector-client
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x">!&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>The BGP template is provisioned to the devices during lab bring up, so it is defined in the &lt;code>config&lt;/code> section of the core devices.&lt;/p>
&lt;p>You see now how we can leverage the ansible variables available to us to produce the appropriate configuration. So we define those &lt;em>additional&lt;/em> variables in our topology file in the appropriate section.&lt;/p>
&lt;div class="highlight no-header">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">groups&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">core&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">members&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">rc1, rc2, rc3, rc4 ]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">module&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ospf, bgp, mpls, vrf ]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">bgp.as&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">65515&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">mpls.vpn&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ibgp ]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">vrf.loopback&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">config&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">core_extras, kentik_rrc ]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line hl">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">vars&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line hl">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">KENTIK_SNMPV2_COMMUNITY&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">&amp;lt; snmpv2 community &amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">KENTIK_SAMPLE_RATE&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">10&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">KENTIK_REGION&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">EU&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">KENTIK_PLAN_ID&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">&amp;lt; Flow Plan for devices &amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">KENTIK_SITE_ID&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">&amp;lt; Site to use for the devices &amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">KENTIK_NMS_AGENT_ID&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">&amp;lt; NMS agent to use for polling devices &amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">KENTIK_NMS_CREDS_NAME&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">&amp;lt; Credentials vault name &amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">KENTIK_API_TOKEN&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">&amp;lt; Kentik User Token &amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">KENTIK_API_EMAIL&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">&amp;lt; Kentik User Email &amp;gt;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>We have defined some additional variables here that we do not use during &lt;em>netlab&lt;/em> normal operations. The reason for this is that since &lt;em>netlab&lt;/em> will create a full ansible structure for the lab, we can re-use this to run our own plays based on the inventory that &lt;em>netlab&lt;/em> created. More on this in our next section.&lt;/p>
&lt;h2 class="heading-element" id="topology-bring-up-workflow">&lt;span>Topology Bring-Up Workflow&lt;/span>
 &lt;a href="#topology-bring-up-workflow" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h2>&lt;p>In this section we will cover the steps needed to bring up the LAB and start with our use-case. In a high-level here are the steps needed to accomplish this:&lt;/p>
&lt;ol>
&lt;li>Register the NMS agent&lt;/li>
&lt;li>Register the networking devices in the portal&lt;/li>
&lt;li>Bring Up the LAB&lt;/li>
&lt;li>Enable the desired netflow export&lt;/li>
&lt;li>Enable traffic&lt;/li>
&lt;li>Register the ksynth agents&lt;/li>
&lt;/ol>
&lt;p>In addition, here are the additional variables we are using in the topology file along with their description and their requirement for the above steps&lt;/p>
&lt;table>
 &lt;thead>
 &lt;tr>
 &lt;th>VARIABLE&lt;/th>
 &lt;th>USED IN&lt;/th>
 &lt;th>DESCRIPTION&lt;/th>
 &lt;/tr>
 &lt;/thead>
 &lt;tbody>
 &lt;tr>
 &lt;td>KENTIK_SNMPV2_COMMUNITY&lt;/td>
 &lt;td>2,3&lt;/td>
 &lt;td>SNMPv2 community used to poll the devices&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>KENTIK_SAMPLE_RATE&lt;/td>
 &lt;td>2,4&lt;/td>
 &lt;td>Netflow sample rate configured on the devices and in the portal&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>KENTIK_REGION&lt;/td>
 &lt;td>2,3&lt;/td>
 &lt;td>Portal Account region - US or EU&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>KENTIK_PLAN_ID&lt;/td>
 &lt;td>2&lt;/td>
 &lt;td>Portal flow plan to put the devices in&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>KENTIK_SITE_ID&lt;/td>
 &lt;td>2&lt;/td>
 &lt;td>Portal site to put the devices in&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>KENTIK_NMS_AGENT_ID&lt;/td>
 &lt;td>2&lt;/td>
 &lt;td>NMS agent to poll the devices&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>KENTIK_NMS_CREDS_NAME&lt;/td>
 &lt;td>2&lt;/td>
 &lt;td>Portal credential vault having the snmp community&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>KENTIK_API_TOKEN&lt;/td>
 &lt;td>2,3&lt;/td>
 &lt;td>Portal API token to authenticate to Kentik&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>KENTIK_API_EMAIL&lt;/td>
 &lt;td>2,3&lt;/td>
 &lt;td>Portal Email account to authenticate to Kentik&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>IPERF3_TESTS&lt;/td>
 &lt;td>3,5&lt;/td>
 &lt;td>List of dictionaries describing the iperf3 tests&lt;/td>
 &lt;/tr>
 &lt;/tbody>
&lt;/table>
&lt;h3 class="heading-element" id="1-register-nms-agent">&lt;span>1. Register NMS Agent&lt;/span>
 &lt;a href="#1-register-nms-agent" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h3>&lt;p>This an once-off action and it is decoupled from &lt;em>netlab&lt;/em>. We just need to run the &lt;strong>kagent&lt;/strong> and register it in the portal. This will allow us to get the &lt;code>AGENT_ID&lt;/code> for the next step.&lt;/p>
&lt;p>So, using the docker compose we bring up the agent and then access the portal to activate it and get the ID.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>wsl&lt;span class="o">)&lt;/span>&amp;lt;&amp;lt;· docker compose up -d
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>+&lt;span class="o">]&lt;/span> Running 2/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ✔ Volume &lt;span class="s2">&amp;#34;iol_kagent-data&amp;#34;&lt;/span> Created 0.0s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ✔ Container kagent Started 0.2s&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>In addition we can assign the agent to an existing site or create a new one in the portal that we will use for our LAB. This will also give us the &lt;code>SITE_ID&lt;/code> variable for the next step.&lt;/p>
&lt;h3 class="heading-element" id="2-register-devices-in-the-portal">&lt;span>2. Register Devices in the Portal&lt;/span>
 &lt;a href="#2-register-devices-in-the-portal" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h3>&lt;p>This is again an once-off task and we could do it manually, but since &lt;em>netlab&lt;/em> is able to give us an ansible inventory structure out of the topology file we can use this and create the devices via Kentik&amp;rsquo;s device API in our own playbook.&lt;/p>
&lt;p>Here is a playbook that accomplishes this task:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;Kentik Device Onboarding&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">hosts&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">core&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">gather_facts&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">vars&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">KENTIK_API_URL&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;https://grpc.api.kentik.{{ KENTIK_REGION|lower }}&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">KENTIK_DEVICE_API&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;{{ KENTIK_API_URL }}/device/v202308beta1/device/&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">KENTIK_HEADERS&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> 
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">X-CH-Auth-API-Token&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;{{ KENTIK_API_TOKEN }}&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">X-CH-Auth-Email&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;{{ KENTIK_API_EMAIL }}&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Content-Type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">application/json&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">tasks&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Get Current Devices&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">uri&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">url&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;{{ KENTIK_DEVICE_API }}&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">method&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">GET&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">headers&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;{{ KENTIK_HEADERS }}&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">status_code&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">200&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">register&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">devices &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">delegate_to&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">localhost&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">run_once&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> 
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Skipped Devices&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">debug&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">msg&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;Device name or IP addresses already existed in portal&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">when&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> 
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="s2">&amp;#34;netlab_name+&amp;#39;-&amp;#39;+hostname in devices.json | json_query(&amp;#39;devices[].deviceName&amp;#39;)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> or mgmt.ipv4 in devices.json | json_query(&amp;#39;devices[].sendingIps[]&amp;#39;)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> or bgp.router_id in devices.json | json_query(&amp;#39;devices[].deviceBgpNeighborIp&amp;#39;)&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">delegate_to&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">localhost&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Create Device OR Skip If Exists&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">block&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Create Device Call&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">ansible.builtin.uri&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">url&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;{{ KENTIK_DEVICE_API }}&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">method&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">POST&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">headers&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;{{ KENTIK_HEADERS }}&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">status_code&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">200&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">body&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;{{ lookup(&amp;#39;ansible.builtin.template&amp;#39;,&amp;#39;templates/kentik_device.j2&amp;#39;) }}&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">body_format&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">json&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">timeout&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">60&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">register&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">device_created&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">throttle&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Devices Created&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">debug&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> 
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">msg&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;Device created with id: {{ device_created.json.device.id }}&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">rescue&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Cannot Create Device&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">debug&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">msg&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;Failed to create device: {{ device_created.json.message }}&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">when&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> 
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="s2">&amp;#34;netlab_name+&amp;#39;-&amp;#39;+hostname not in devices.json | json_query(&amp;#39;devices[].deviceName&amp;#39;)&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="s2">&amp;#34;mgmt.ipv4 not in devices.json | json_query(&amp;#39;devices[].sendingIps[]&amp;#39;)&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="s2">&amp;#34;bgp.router_id not in devices.json | json_query(&amp;#39;devices[].deviceBgpNeighborIp&amp;#39;)&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">delegate_to&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">localhost&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>We are using the built in &lt;code>uri&lt;/code> module to interact with the API and create the devices we are interested in, i.e. the &lt;code>core&lt;/code> devices. The playbook will check if there is any existing device with the same name or having any relevant IP that we use in our LAB, and if not it will create the device in the portal.&lt;/p>
&lt;p>The &lt;em>json&lt;/em> payload is templated and looks like this:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;device&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;deviceName&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;{{ netlab_name }}-{{ hostname }}&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;deviceDescription&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Device {{ id }} of type {{ netlab_device_type}} using {{ netlab_provider}} provider.&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;deviceSubtype&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;router&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;sendingIps&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;{{ mgmt.ipv4}}&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;deviceSampleRate&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;{{ KENTIK_SAMPLE_RATE }}&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;planId&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="err">{&lt;/span> &lt;span class="err">KENTIK_PLAN_ID&lt;/span> &lt;span class="p">}},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;siteId&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="err">{&lt;/span> &lt;span class="err">KENTIK_SITE_ID&lt;/span> &lt;span class="p">}}&lt;/span>&lt;span class="err">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;minimizeSnmp&amp;#34;&lt;/span>&lt;span class="err">:&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="err">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;deviceSnmpIp&amp;#34;&lt;/span>&lt;span class="err">:&lt;/span> &lt;span class="s2">&amp;#34;{{ mgmt.ipv4}}&amp;#34;&lt;/span>&lt;span class="err">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;deviceSnmpCommunity&amp;#34;&lt;/span>&lt;span class="err">:&lt;/span> &lt;span class="s2">&amp;#34;{{ KENTIK_SNMPV2_COMMUNITY }}&amp;#34;&lt;/span>&lt;span class="err">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;deviceBgpType&amp;#34;&lt;/span>&lt;span class="err">:&lt;/span> &lt;span class="s2">&amp;#34;device&amp;#34;&lt;/span>&lt;span class="err">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;deviceBgpNeighborIp&amp;#34;&lt;/span>&lt;span class="err">:&lt;/span> &lt;span class="s2">&amp;#34;{{ bgp.router_id }}&amp;#34;&lt;/span>&lt;span class="err">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;deviceBgpNeighborAsn&amp;#34;&lt;/span>&lt;span class="err">:&lt;/span> &lt;span class="s2">&amp;#34;{{ bgp.as }}&amp;#34;&lt;/span>&lt;span class="err">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;nms&amp;#34;&lt;/span>&lt;span class="err">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;agentId&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;{{ KENTIK_NMS_AGENT_ID }}&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;ipAddress&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;{{ mgmt.ipv4 }}&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;snmp&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;credentialName&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;{{ KENTIK_NMS_CREDS_NAME }}&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="err">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>So we are going to need to provide the remaining values for the variables used in our topology file and once all variables are filled in, we can execute the &lt;code>netlab create&lt;/code> command in order for the ansible inventory to be produced.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>wsl&lt;span class="o">)&lt;/span>&amp;lt;&amp;lt;· netlab create
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>CREATED&lt;span class="o">]&lt;/span> provider configuration file: clab.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>MAPPED&lt;span class="o">]&lt;/span> clab_files/kproxy/hosts to kproxy:/etc/hosts &lt;span class="o">(&lt;/span>from templates/provider/clab/linux/hosts.j2&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>MAPPED&lt;span class="o">]&lt;/span> clab_files/ksynth1/hosts to ksynth1:/etc/hosts &lt;span class="o">(&lt;/span>from templates/provider/clab/linux/hosts.j2&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>MAPPED&lt;span class="o">]&lt;/span> clab_files/ksynth2/hosts to ksynth2:/etc/hosts &lt;span class="o">(&lt;/span>from templates/provider/clab/linux/hosts.j2&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>MAPPED&lt;span class="o">]&lt;/span> clab_files/ksynth3/hosts to ksynth3:/etc/hosts &lt;span class="o">(&lt;/span>from templates/provider/clab/linux/hosts.j2&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>MAPPED&lt;span class="o">]&lt;/span> clab_files/ksynth4/hosts to ksynth4:/etc/hosts &lt;span class="o">(&lt;/span>from templates/provider/clab/linux/hosts.j2&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>MAPPED&lt;span class="o">]&lt;/span> clab_files/kbgp/hosts to kbgp:/etc/hosts &lt;span class="o">(&lt;/span>from templates/provider/clab/linux/hosts.j2&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>MAPPED&lt;span class="o">]&lt;/span> clab_files/pc1/hosts to pc1:/etc/hosts &lt;span class="o">(&lt;/span>from templates/provider/clab/linux/hosts.j2&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>MAPPED&lt;span class="o">]&lt;/span> clab_files/pc2/hosts to pc2:/etc/hosts &lt;span class="o">(&lt;/span>from templates/provider/clab/linux/hosts.j2&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>MAPPED&lt;span class="o">]&lt;/span> clab_files/pc3/hosts to pc3:/etc/hosts &lt;span class="o">(&lt;/span>from templates/provider/clab/linux/hosts.j2&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>MAPPED&lt;span class="o">]&lt;/span> clab_files/pc4/hosts to pc4:/etc/hosts &lt;span class="o">(&lt;/span>from templates/provider/clab/linux/hosts.j2&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>MAPPED&lt;span class="o">]&lt;/span> clab_files/pc11/hosts to pc11:/etc/hosts &lt;span class="o">(&lt;/span>from templates/provider/clab/linux/hosts.j2&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>MAPPED&lt;span class="o">]&lt;/span> clab_files/pc12/hosts to pc12:/etc/hosts &lt;span class="o">(&lt;/span>from templates/provider/clab/linux/hosts.j2&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>MAPPED&lt;span class="o">]&lt;/span> clab_files/pc13/hosts to pc13:/etc/hosts &lt;span class="o">(&lt;/span>from templates/provider/clab/linux/hosts.j2&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>MAPPED&lt;span class="o">]&lt;/span> clab_files/pc14/hosts to pc14:/etc/hosts &lt;span class="o">(&lt;/span>from templates/provider/clab/linux/hosts.j2&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>CREATED&lt;span class="o">]&lt;/span> transformed topology dump in YAML format in netlab.snapshot.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>GROUPS&lt;span class="o">]&lt;/span> group_vars &lt;span class="k">for&lt;/span> all
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>GROUPS&lt;span class="o">]&lt;/span> group_vars &lt;span class="k">for&lt;/span> modules
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>GROUPS&lt;span class="o">]&lt;/span> group_vars &lt;span class="k">for&lt;/span> custom_configs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>GROUPS&lt;span class="o">]&lt;/span> group_vars &lt;span class="k">for&lt;/span> iol
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>HOSTS&lt;span class="o">]&lt;/span> host_vars &lt;span class="k">for&lt;/span> rc1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>HOSTS&lt;span class="o">]&lt;/span> host_vars &lt;span class="k">for&lt;/span> rc2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>HOSTS&lt;span class="o">]&lt;/span> host_vars &lt;span class="k">for&lt;/span> rc3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>HOSTS&lt;span class="o">]&lt;/span> host_vars &lt;span class="k">for&lt;/span> rc4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>HOSTS&lt;span class="o">]&lt;/span> host_vars &lt;span class="k">for&lt;/span> ce1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>HOSTS&lt;span class="o">]&lt;/span> host_vars &lt;span class="k">for&lt;/span> ce2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>HOSTS&lt;span class="o">]&lt;/span> host_vars &lt;span class="k">for&lt;/span> ce3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>HOSTS&lt;span class="o">]&lt;/span> host_vars &lt;span class="k">for&lt;/span> ce4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>GROUPS&lt;span class="o">]&lt;/span> group_vars &lt;span class="k">for&lt;/span> linux
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>HOSTS&lt;span class="o">]&lt;/span> host_vars &lt;span class="k">for&lt;/span> kproxy
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>HOSTS&lt;span class="o">]&lt;/span> host_vars &lt;span class="k">for&lt;/span> ksynth1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>HOSTS&lt;span class="o">]&lt;/span> host_vars &lt;span class="k">for&lt;/span> ksynth2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>HOSTS&lt;span class="o">]&lt;/span> host_vars &lt;span class="k">for&lt;/span> ksynth3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>HOSTS&lt;span class="o">]&lt;/span> host_vars &lt;span class="k">for&lt;/span> ksynth4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>HOSTS&lt;span class="o">]&lt;/span> host_vars &lt;span class="k">for&lt;/span> kbgp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>HOSTS&lt;span class="o">]&lt;/span> host_vars &lt;span class="k">for&lt;/span> pc1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>HOSTS&lt;span class="o">]&lt;/span> host_vars &lt;span class="k">for&lt;/span> pc2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>HOSTS&lt;span class="o">]&lt;/span> host_vars &lt;span class="k">for&lt;/span> pc3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>HOSTS&lt;span class="o">]&lt;/span> host_vars &lt;span class="k">for&lt;/span> pc4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>HOSTS&lt;span class="o">]&lt;/span> host_vars &lt;span class="k">for&lt;/span> pc11
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>HOSTS&lt;span class="o">]&lt;/span> host_vars &lt;span class="k">for&lt;/span> pc12
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>HOSTS&lt;span class="o">]&lt;/span> host_vars &lt;span class="k">for&lt;/span> pc13
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>HOSTS&lt;span class="o">]&lt;/span> host_vars &lt;span class="k">for&lt;/span> pc14
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>GROUPS&lt;span class="o">]&lt;/span> group_vars &lt;span class="k">for&lt;/span> core
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>GROUPS&lt;span class="o">]&lt;/span> group_vars &lt;span class="k">for&lt;/span> pcs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>CREATED&lt;span class="o">]&lt;/span> minimized Ansible inventory hosts.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>CREATED&lt;span class="o">]&lt;/span> Ansible configuration file: ansible.cfg&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Now we can run our playbook to onboard the core devices into Kentik.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>wsl&lt;span class="o">)&lt;/span>&amp;lt;&amp;lt;· &lt;span class="nv">ANSIBLE_NOCOWS&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">1&lt;/span> ansible-playbook kentik.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PLAY &lt;span class="o">[&lt;/span>Kentik Device Onboarding&lt;span class="o">]&lt;/span> *******************************************************************************************
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">TASK &lt;span class="o">[&lt;/span>Get Current Devices&lt;span class="o">]&lt;/span> ************************************************************************************************
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ok: &lt;span class="o">[&lt;/span>rc1 -&amp;gt; localhost&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">TASK &lt;span class="o">[&lt;/span>Skipped Devices&lt;span class="o">]&lt;/span> ****************************************************************************************************
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">skipping: &lt;span class="o">[&lt;/span>rc1&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">skipping: &lt;span class="o">[&lt;/span>rc2&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">skipping: &lt;span class="o">[&lt;/span>rc3&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">skipping: &lt;span class="o">[&lt;/span>rc4&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">TASK &lt;span class="o">[&lt;/span>Create Device Call&lt;span class="o">]&lt;/span> *************************************************************************************************
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ok: &lt;span class="o">[&lt;/span>rc1 -&amp;gt; localhost&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ok: &lt;span class="o">[&lt;/span>rc2 -&amp;gt; localhost&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ok: &lt;span class="o">[&lt;/span>rc3 -&amp;gt; localhost&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ok: &lt;span class="o">[&lt;/span>rc4 -&amp;gt; localhost&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">TASK &lt;span class="o">[&lt;/span>Devices Created&lt;span class="o">]&lt;/span> ****************************************************************************************************
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ok: &lt;span class="o">[&lt;/span>rc1 -&amp;gt; localhost&lt;span class="o">]&lt;/span> &lt;span class="o">=&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> msg: &lt;span class="s1">&amp;#39;Device created with id: 115531&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ok: &lt;span class="o">[&lt;/span>rc2 -&amp;gt; localhost&lt;span class="o">]&lt;/span> &lt;span class="o">=&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> msg: &lt;span class="s1">&amp;#39;Device created with id: 115536&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ok: &lt;span class="o">[&lt;/span>rc3 -&amp;gt; localhost&lt;span class="o">]&lt;/span> &lt;span class="o">=&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> msg: &lt;span class="s1">&amp;#39;Device created with id: 115541&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ok: &lt;span class="o">[&lt;/span>rc4 -&amp;gt; localhost&lt;span class="o">]&lt;/span> &lt;span class="o">=&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> msg: &lt;span class="s1">&amp;#39;Device created with id: 115546&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PLAY RECAP ****************************************************************************************************************
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rc1 : &lt;span class="nv">ok&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">3&lt;/span> &lt;span class="nv">changed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">unreachable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">failed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">skipped&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">1&lt;/span> &lt;span class="nv">rescued&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">ignored&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rc2 : &lt;span class="nv">ok&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">2&lt;/span> &lt;span class="nv">changed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">unreachable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">failed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">skipped&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">1&lt;/span> &lt;span class="nv">rescued&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">ignored&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rc3 : &lt;span class="nv">ok&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">2&lt;/span> &lt;span class="nv">changed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">unreachable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">failed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">skipped&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">1&lt;/span> &lt;span class="nv">rescued&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">ignored&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rc4 : &lt;span class="nv">ok&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">2&lt;/span> &lt;span class="nv">changed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">unreachable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">failed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">skipped&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">1&lt;/span> &lt;span class="nv">rescued&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">ignored&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 class="heading-element" id="3-bring-up-the-lab">&lt;span>3. Bring Up the LAB&lt;/span>
 &lt;a href="#3-bring-up-the-lab" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h3>&lt;p>We are ready now to bring up the topology. We have seen that during &lt;code>netlab create&lt;/code> &lt;em>netlab&lt;/em> will create the required &lt;em>containerlab&lt;/em> topology file and populate our ansible inventory with the appropriate files and values. Using the &lt;code>netlab up&lt;/code> command it will execute the create phase as well as spin up the nodes and start provisioning them with the appropriate configurations we defined in the topology file.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>wsl&lt;span class="o">)&lt;/span>&amp;lt;&amp;lt;· &lt;span class="nv">ANSIBLE_NOCOWS&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">1&lt;/span> netlab up
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt; snipped &amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PLAY RECAP ****************************************************************************************************************
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ce1 : &lt;span class="nv">ok&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">25&lt;/span> &lt;span class="nv">changed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">4&lt;/span> &lt;span class="nv">unreachable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">failed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">skipped&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">14&lt;/span> &lt;span class="nv">rescued&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">ignored&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ce2 : &lt;span class="nv">ok&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">24&lt;/span> &lt;span class="nv">changed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">3&lt;/span> &lt;span class="nv">unreachable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">failed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">skipped&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">14&lt;/span> &lt;span class="nv">rescued&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">ignored&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ce3 : &lt;span class="nv">ok&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">24&lt;/span> &lt;span class="nv">changed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">3&lt;/span> &lt;span class="nv">unreachable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">failed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">skipped&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">14&lt;/span> &lt;span class="nv">rescued&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">ignored&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ce4 : &lt;span class="nv">ok&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">24&lt;/span> &lt;span class="nv">changed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">3&lt;/span> &lt;span class="nv">unreachable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">failed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">skipped&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">14&lt;/span> &lt;span class="nv">rescued&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">ignored&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kbgp : &lt;span class="nv">ok&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">11&lt;/span> &lt;span class="nv">changed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">3&lt;/span> &lt;span class="nv">unreachable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">failed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">skipped&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">2&lt;/span> &lt;span class="nv">rescued&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">ignored&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kproxy : &lt;span class="nv">ok&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">11&lt;/span> &lt;span class="nv">changed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">3&lt;/span> &lt;span class="nv">unreachable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">failed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">skipped&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">2&lt;/span> &lt;span class="nv">rescued&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">ignored&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ksynth1 : &lt;span class="nv">ok&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">11&lt;/span> &lt;span class="nv">changed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">3&lt;/span> &lt;span class="nv">unreachable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">failed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">skipped&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">2&lt;/span> &lt;span class="nv">rescued&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">ignored&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ksynth2 : &lt;span class="nv">ok&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">11&lt;/span> &lt;span class="nv">changed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">3&lt;/span> &lt;span class="nv">unreachable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">failed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">skipped&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">2&lt;/span> &lt;span class="nv">rescued&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">ignored&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ksynth3 : &lt;span class="nv">ok&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">11&lt;/span> &lt;span class="nv">changed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">3&lt;/span> &lt;span class="nv">unreachable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">failed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">skipped&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">2&lt;/span> &lt;span class="nv">rescued&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">ignored&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ksynth4 : &lt;span class="nv">ok&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">11&lt;/span> &lt;span class="nv">changed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">3&lt;/span> &lt;span class="nv">unreachable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">failed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">skipped&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">2&lt;/span> &lt;span class="nv">rescued&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">ignored&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pc1 : &lt;span class="nv">ok&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">19&lt;/span> &lt;span class="nv">changed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">5&lt;/span> &lt;span class="nv">unreachable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">failed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">skipped&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">5&lt;/span> &lt;span class="nv">rescued&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">ignored&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pc11 : &lt;span class="nv">ok&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">19&lt;/span> &lt;span class="nv">changed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">5&lt;/span> &lt;span class="nv">unreachable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">failed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">skipped&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">5&lt;/span> &lt;span class="nv">rescued&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">ignored&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pc12 : &lt;span class="nv">ok&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">19&lt;/span> &lt;span class="nv">changed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">5&lt;/span> &lt;span class="nv">unreachable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">failed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">skipped&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">5&lt;/span> &lt;span class="nv">rescued&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">ignored&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pc13 : &lt;span class="nv">ok&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">19&lt;/span> &lt;span class="nv">changed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">5&lt;/span> &lt;span class="nv">unreachable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">failed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">skipped&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">5&lt;/span> &lt;span class="nv">rescued&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">ignored&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pc14 : &lt;span class="nv">ok&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">19&lt;/span> &lt;span class="nv">changed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">5&lt;/span> &lt;span class="nv">unreachable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">failed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">skipped&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">5&lt;/span> &lt;span class="nv">rescued&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">ignored&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pc2 : &lt;span class="nv">ok&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">19&lt;/span> &lt;span class="nv">changed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">5&lt;/span> &lt;span class="nv">unreachable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">failed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">skipped&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">5&lt;/span> &lt;span class="nv">rescued&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">ignored&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pc3 : &lt;span class="nv">ok&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">19&lt;/span> &lt;span class="nv">changed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">5&lt;/span> &lt;span class="nv">unreachable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">failed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">skipped&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">5&lt;/span> &lt;span class="nv">rescued&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">ignored&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pc4 : &lt;span class="nv">ok&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">19&lt;/span> &lt;span class="nv">changed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">5&lt;/span> &lt;span class="nv">unreachable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">failed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">skipped&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">5&lt;/span> &lt;span class="nv">rescued&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">ignored&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rc1 : &lt;span class="nv">ok&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">48&lt;/span> &lt;span class="nv">changed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">8&lt;/span> &lt;span class="nv">unreachable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">failed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">skipped&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">11&lt;/span> &lt;span class="nv">rescued&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">ignored&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rc2 : &lt;span class="nv">ok&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">48&lt;/span> &lt;span class="nv">changed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">8&lt;/span> &lt;span class="nv">unreachable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">failed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">skipped&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">11&lt;/span> &lt;span class="nv">rescued&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">ignored&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rc3 : &lt;span class="nv">ok&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">48&lt;/span> &lt;span class="nv">changed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">8&lt;/span> &lt;span class="nv">unreachable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">failed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">skipped&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">11&lt;/span> &lt;span class="nv">rescued&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">ignored&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rc4 : &lt;span class="nv">ok&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">48&lt;/span> &lt;span class="nv">changed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">8&lt;/span> &lt;span class="nv">unreachable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">failed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">skipped&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">11&lt;/span> &lt;span class="nv">rescued&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">ignored&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>SUCCESS&lt;span class="o">]&lt;/span> Lab devices configured
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>wsl&lt;span class="o">)&lt;/span>&amp;lt;&amp;lt;· netlab status
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Lab default in /home/netlab/iol
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> status: started
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> provider&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>: clab
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">┏━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┓
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">┃ node ┃ device ┃ image ┃ mgmt IPv4 ┃ connection ┃ provider ┃ VM/container ┃ status ┃
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">┡━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━┩
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ce1 │ iol │ vrnetlab/cisco_iol:17.12.1 │ 192.168.121.111 │ network_cli │ clab │ ce1 │ Up &lt;span class="m">3&lt;/span> minutes │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─────────┼────────┼─────────────────────────────┼─────────────────┼─────────────┼──────────┼──────────────┼──────────────┤
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ce2 │ iol │ vrnetlab/cisco_iol:17.12.1 │ 192.168.121.112 │ network_cli │ clab │ ce2 │ Up &lt;span class="m">3&lt;/span> minutes │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─────────┼────────┼─────────────────────────────┼─────────────────┼─────────────┼──────────┼──────────────┼──────────────┤
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ce3 │ iol │ vrnetlab/cisco_iol:17.12.1 │ 192.168.121.113 │ network_cli │ clab │ ce3 │ Up &lt;span class="m">3&lt;/span> minutes │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─────────┼────────┼─────────────────────────────┼─────────────────┼─────────────┼──────────┼──────────────┼──────────────┤
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ce4 │ iol │ vrnetlab/cisco_iol:17.12.1 │ 192.168.121.114 │ network_cli │ clab │ ce4 │ Up &lt;span class="m">3&lt;/span> minutes │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─────────┼────────┼─────────────────────────────┼─────────────────┼─────────────┼──────────┼──────────────┼──────────────┤
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ kbgp │ linux │ ghcr.io/srl-labs/network-m… │ 192.168.121.110 │ docker │ clab │ kbgp │ Up &lt;span class="m">3&lt;/span> minutes │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─────────┼────────┼─────────────────────────────┼─────────────────┼─────────────┼──────────┼──────────────┼──────────────┤
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ kproxy │ linux │ ghcr.io/srl-labs/network-m… │ 192.168.121.105 │ docker │ clab │ kproxy │ Up &lt;span class="m">3&lt;/span> minutes │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─────────┼────────┼─────────────────────────────┼─────────────────┼─────────────┼──────────┼──────────────┼──────────────┤
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ksynth1 │ linux │ ghcr.io/srl-labs/network-m… │ 192.168.121.106 │ docker │ clab │ ksynth1 │ Up &lt;span class="m">3&lt;/span> minutes │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─────────┼────────┼─────────────────────────────┼─────────────────┼─────────────┼──────────┼──────────────┼──────────────┤
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ksynth2 │ linux │ ghcr.io/srl-labs/network-m… │ 192.168.121.107 │ docker │ clab │ ksynth2 │ Up &lt;span class="m">3&lt;/span> minutes │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─────────┼────────┼─────────────────────────────┼─────────────────┼─────────────┼──────────┼──────────────┼──────────────┤
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ksynth3 │ linux │ ghcr.io/srl-labs/network-m… │ 192.168.121.108 │ docker │ clab │ ksynth3 │ Up &lt;span class="m">3&lt;/span> minutes │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─────────┼────────┼─────────────────────────────┼─────────────────┼─────────────┼──────────┼──────────────┼──────────────┤
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ksynth4 │ linux │ ghcr.io/srl-labs/network-m… │ 192.168.121.109 │ docker │ clab │ ksynth4 │ Up &lt;span class="m">3&lt;/span> minutes │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─────────┼────────┼─────────────────────────────┼─────────────────┼─────────────┼──────────┼──────────────┼──────────────┤
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ pc1 │ linux │ ghcr.io/srl-labs/network-m… │ 192.168.121.115 │ docker │ clab │ pc1 │ Up &lt;span class="m">3&lt;/span> minutes │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─────────┼────────┼─────────────────────────────┼─────────────────┼─────────────┼──────────┼──────────────┼──────────────┤
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ pc11 │ linux │ ghcr.io/srl-labs/network-m… │ 192.168.121.119 │ docker │ clab │ pc11 │ Up &lt;span class="m">3&lt;/span> minutes │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─────────┼────────┼─────────────────────────────┼─────────────────┼─────────────┼──────────┼──────────────┼──────────────┤
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ pc12 │ linux │ ghcr.io/srl-labs/network-m… │ 192.168.121.120 │ docker │ clab │ pc12 │ Up &lt;span class="m">3&lt;/span> minutes │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─────────┼────────┼─────────────────────────────┼─────────────────┼─────────────┼──────────┼──────────────┼──────────────┤
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ pc13 │ linux │ ghcr.io/srl-labs/network-m… │ 192.168.121.121 │ docker │ clab │ pc13 │ Up &lt;span class="m">3&lt;/span> minutes │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─────────┼────────┼─────────────────────────────┼─────────────────┼─────────────┼──────────┼──────────────┼──────────────┤
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ pc14 │ linux │ ghcr.io/srl-labs/network-m… │ 192.168.121.122 │ docker │ clab │ pc14 │ Up &lt;span class="m">3&lt;/span> minutes │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─────────┼────────┼─────────────────────────────┼─────────────────┼─────────────┼──────────┼──────────────┼──────────────┤
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ pc2 │ linux │ ghcr.io/srl-labs/network-m… │ 192.168.121.116 │ docker │ clab │ pc2 │ Up &lt;span class="m">3&lt;/span> minutes │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─────────┼────────┼─────────────────────────────┼─────────────────┼─────────────┼──────────┼──────────────┼──────────────┤
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ pc3 │ linux │ ghcr.io/srl-labs/network-m… │ 192.168.121.117 │ docker │ clab │ pc3 │ Up &lt;span class="m">3&lt;/span> minutes │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─────────┼────────┼─────────────────────────────┼─────────────────┼─────────────┼──────────┼──────────────┼──────────────┤
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ pc4 │ linux │ ghcr.io/srl-labs/network-m… │ 192.168.121.118 │ docker │ clab │ pc4 │ Up &lt;span class="m">3&lt;/span> minutes │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─────────┼────────┼─────────────────────────────┼─────────────────┼─────────────┼──────────┼──────────────┼──────────────┤
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ rc1 │ iol │ vrnetlab/cisco_iol:17.12.1 │ 192.168.121.101 │ network_cli │ clab │ rc1 │ Up &lt;span class="m">3&lt;/span> minutes │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─────────┼────────┼─────────────────────────────┼─────────────────┼─────────────┼──────────┼──────────────┼──────────────┤
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ rc2 │ iol │ vrnetlab/cisco_iol:17.12.1 │ 192.168.121.102 │ network_cli │ clab │ rc2 │ Up &lt;span class="m">3&lt;/span> minutes │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─────────┼────────┼─────────────────────────────┼─────────────────┼─────────────┼──────────┼──────────────┼──────────────┤
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ rc3 │ iol │ vrnetlab/cisco_iol:17.12.1 │ 192.168.121.103 │ network_cli │ clab │ rc3 │ Up &lt;span class="m">3&lt;/span> minutes │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├─────────┼────────┼─────────────────────────────┼─────────────────┼─────────────┼──────────┼──────────────┼──────────────┤
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ rc4 │ iol │ vrnetlab/cisco_iol:17.12.1 │ 192.168.121.104 │ network_cli │ clab │ rc4 │ Up &lt;span class="m">3&lt;/span> minutes │
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─────────┴────────┴─────────────────────────────┴─────────────────┴─────────────┴──────────┴──────────────┴──────────────┘&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Here are some connectivity tests and also notice the bitrates:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>wsl&lt;span class="o">)&lt;/span>&amp;lt;&amp;lt;· netlab &lt;span class="nb">exec&lt;/span> pc1 iperf3 -c pc4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Connecting to container pc1, executing iperf3 -c pc4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Connecting to host pc4, port &lt;span class="m">5201&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span> 5&lt;span class="o">]&lt;/span> &lt;span class="nb">local&lt;/span> 172.16.0.15 port &lt;span class="m">42090&lt;/span> connected to 172.16.3.18 port &lt;span class="m">5201&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span> ID&lt;span class="o">]&lt;/span> Interval Transfer Bitrate Retr Cwnd
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span> 5&lt;span class="o">]&lt;/span> 0.00-1.00 sec 32.5 MBytes &lt;span class="m">273&lt;/span> Mbits/sec &lt;span class="m">498&lt;/span> 14.1 KBytes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span> 5&lt;span class="o">]&lt;/span> 1.00-2.00 sec 30.1 MBytes &lt;span class="m">252&lt;/span> Mbits/sec &lt;span class="m">457&lt;/span> 14.1 KBytes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span> 5&lt;span class="o">]&lt;/span> 2.00-3.00 sec 30.7 MBytes &lt;span class="m">258&lt;/span> Mbits/sec &lt;span class="m">475&lt;/span> 12.7 KBytes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span> 5&lt;span class="o">]&lt;/span> 3.00-4.00 sec 28.0 MBytes &lt;span class="m">235&lt;/span> Mbits/sec &lt;span class="m">438&lt;/span> 14.1 KBytes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span> 5&lt;span class="o">]&lt;/span> 4.00-5.00 sec 29.4 MBytes &lt;span class="m">247&lt;/span> Mbits/sec &lt;span class="m">458&lt;/span> 14.1 KBytes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span> 5&lt;span class="o">]&lt;/span> 5.00-6.00 sec 29.8 MBytes &lt;span class="m">250&lt;/span> Mbits/sec &lt;span class="m">483&lt;/span> 8.46 KBytes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span> 5&lt;span class="o">]&lt;/span> 6.00-7.00 sec 28.5 MBytes &lt;span class="m">239&lt;/span> Mbits/sec &lt;span class="m">494&lt;/span> 22.6 KBytes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span> 5&lt;span class="o">]&lt;/span> 7.00-8.00 sec 28.4 MBytes &lt;span class="m">239&lt;/span> Mbits/sec &lt;span class="m">537&lt;/span> 11.3 KBytes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span> 5&lt;span class="o">]&lt;/span> 8.00-9.00 sec 25.2 MBytes &lt;span class="m">212&lt;/span> Mbits/sec &lt;span class="m">410&lt;/span> 14.1 KBytes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span> 5&lt;span class="o">]&lt;/span> 9.00-10.00 sec 24.0 MBytes &lt;span class="m">201&lt;/span> Mbits/sec &lt;span class="m">476&lt;/span> 14.1 KBytes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- - - - - - - - - - - - - - - - - - - - - - - - -
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span> ID&lt;span class="o">]&lt;/span> Interval Transfer Bitrate Retr
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span> 5&lt;span class="o">]&lt;/span> 0.00-10.00 sec &lt;span class="m">287&lt;/span> MBytes &lt;span class="m">241&lt;/span> Mbits/sec &lt;span class="m">4726&lt;/span> sender
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span> 5&lt;span class="o">]&lt;/span> 0.00-10.00 sec &lt;span class="m">286&lt;/span> MBytes &lt;span class="m">240&lt;/span> Mbits/sec receiver
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iperf Done.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>wsl&lt;span class="o">)&lt;/span>&amp;lt;&amp;lt;· netlab &lt;span class="nb">exec&lt;/span> pc11 iperf3 -c pc14
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Connecting to container pc11, executing iperf3 -c pc14
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Connecting to host pc14, port &lt;span class="m">5201&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span> 5&lt;span class="o">]&lt;/span> &lt;span class="nb">local&lt;/span> 172.16.9.19 port &lt;span class="m">43696&lt;/span> connected to 172.16.12.22 port &lt;span class="m">5201&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span> ID&lt;span class="o">]&lt;/span> Interval Transfer Bitrate Retr Cwnd
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span> 5&lt;span class="o">]&lt;/span> 0.00-1.00 sec 10.5 MBytes 88.2 Mbits/sec &lt;span class="m">259&lt;/span> 14.1 KBytes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span> 5&lt;span class="o">]&lt;/span> 1.00-2.00 sec 10.5 MBytes 88.1 Mbits/sec &lt;span class="m">257&lt;/span> 12.7 KBytes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span> 5&lt;span class="o">]&lt;/span> 2.00-3.00 sec 11.1 MBytes 93.3 Mbits/sec &lt;span class="m">243&lt;/span> 14.1 KBytes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span> 5&lt;span class="o">]&lt;/span> 3.00-4.00 sec 10.6 MBytes 89.2 Mbits/sec &lt;span class="m">258&lt;/span> 15.5 KBytes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span> 5&lt;span class="o">]&lt;/span> 4.00-5.00 sec 11.4 MBytes 95.4 Mbits/sec &lt;span class="m">254&lt;/span> 12.7 KBytes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span> 5&lt;span class="o">]&lt;/span> 5.00-6.00 sec 10.5 MBytes 88.1 Mbits/sec &lt;span class="m">252&lt;/span> 14.1 KBytes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span> 5&lt;span class="o">]&lt;/span> 6.00-7.00 sec 11.1 MBytes 93.3 Mbits/sec &lt;span class="m">233&lt;/span> 14.1 KBytes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span> 5&lt;span class="o">]&lt;/span> 7.00-8.00 sec 12.0 MBytes &lt;span class="m">101&lt;/span> Mbits/sec &lt;span class="m">276&lt;/span> 14.1 KBytes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span> 5&lt;span class="o">]&lt;/span> 8.00-9.00 sec 11.5 MBytes 96.4 Mbits/sec &lt;span class="m">214&lt;/span> 19.7 KBytes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span> 5&lt;span class="o">]&lt;/span> 9.00-10.00 sec 11.4 MBytes 95.4 Mbits/sec &lt;span class="m">247&lt;/span> 15.5 KBytes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- - - - - - - - - - - - - - - - - - - - - - - - -
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span> ID&lt;span class="o">]&lt;/span> Interval Transfer Bitrate Retr
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span> 5&lt;span class="o">]&lt;/span> 0.00-10.00 sec &lt;span class="m">111&lt;/span> MBytes 92.8 Mbits/sec &lt;span class="m">2493&lt;/span> sender
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span> 5&lt;span class="o">]&lt;/span> 0.00-10.00 sec &lt;span class="m">110&lt;/span> MBytes 92.6 Mbits/sec receiver
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iperf Done.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>wsl&lt;span class="o">)&lt;/span>&amp;lt;&amp;lt;· netlab &lt;span class="nb">exec&lt;/span> pc11 mtr pc14 -r
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Connecting to container pc11, executing mtr pc14 -r
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Start: 2024-12-07T18:02:20+0000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">HOST: pc11 Loss% Snt Last Avg Best Wrst StDev
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 1.&lt;span class="p">|&lt;/span>-- Ethernet0-2.ce1 0.0% &lt;span class="m">10&lt;/span> 0.5 0.6 0.5 0.7 0.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 2.&lt;span class="p">|&lt;/span>-- Ethernet1-2.blue.rc1 0.0% &lt;span class="m">10&lt;/span> 0.7 1.2 0.7 1.8 0.4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 3.&lt;span class="p">|&lt;/span>-- Ethernet0-1.rc2 0.0% &lt;span class="m">10&lt;/span> 2.2 3.0 2.2 3.6 0.4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 4.&lt;span class="p">|&lt;/span>-- Ethernet1-1.blue.rc4 0.0% &lt;span class="m">10&lt;/span> 2.4 2.4 1.9 3.0 0.3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 5.&lt;span class="p">|&lt;/span>-- Ethernet0-1.ce4 0.0% &lt;span class="m">10&lt;/span> 1.4 2.7 1.4 3.5 0.8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 6.&lt;span class="p">|&lt;/span>-- pc14 0.0% &lt;span class="m">10&lt;/span> 1.5 2.6 1.5 3.9 0.8&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="details admonition tip open">
 &lt;div class="details-summary admonition-title">&lt;i class="icon fa-fw fa-regular fa-lightbulb" aria-hidden="true">&lt;/i>Tip&lt;i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true">&lt;/i>&lt;/div>
 &lt;div class="details-content">
 &lt;div class="admonition-content">host resolution works by default since &lt;em>netlab&lt;/em> takes care of that by producing a &lt;code>hosts&lt;/code> file, attaching it into the linux containers, and provisions all hosts in the network devices as well. How cool is that!!!&lt;/div>
 &lt;/div>
&lt;/div>
&lt;h3 class="heading-element" id="4-enable-netflow">&lt;span>4. Enable Netflow&lt;/span>
 &lt;a href="#4-enable-netflow" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h3>&lt;p>So now that we have our test network ready, we can enable netflow on the core routers by choosing our netflow flavour and provision the respective commands via the &lt;code>netlab config&lt;/code> command:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>wsl&lt;span class="o">)&lt;/span>&amp;lt;&amp;lt;· &lt;span class="nv">ANSIBLE_NOCOWS&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">1&lt;/span> netlab config kentik_flow -l core -e &lt;span class="nv">ACTION&lt;/span>&lt;span class="o">=&lt;/span>push
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt; snipped &amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PLAY RECAP ****************************************************************************************************************
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rc1 : &lt;span class="nv">ok&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">7&lt;/span> &lt;span class="nv">changed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">1&lt;/span> &lt;span class="nv">unreachable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">failed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">skipped&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">4&lt;/span> &lt;span class="nv">rescued&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">ignored&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rc2 : &lt;span class="nv">ok&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">7&lt;/span> &lt;span class="nv">changed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">1&lt;/span> &lt;span class="nv">unreachable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">failed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">skipped&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">3&lt;/span> &lt;span class="nv">rescued&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">ignored&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rc3 : &lt;span class="nv">ok&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">7&lt;/span> &lt;span class="nv">changed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">1&lt;/span> &lt;span class="nv">unreachable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">failed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">skipped&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">3&lt;/span> &lt;span class="nv">rescued&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">ignored&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rc4 : &lt;span class="nv">ok&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">7&lt;/span> &lt;span class="nv">changed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">1&lt;/span> &lt;span class="nv">unreachable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">failed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">skipped&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">3&lt;/span> &lt;span class="nv">rescued&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">ignored&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>We can use this method to re-configure any other flow configuration ad-hoc by leveraging the &lt;code>ACTION&lt;/code> variable.&lt;/p>
&lt;p>Let&amp;rsquo;s check on the kproxy after a while to see that all devices are sending flows and are correctly registered with the portal:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>wsl&lt;span class="o">)&lt;/span>&amp;lt;&amp;lt;· telnet kproxy &lt;span class="m">9996&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Trying 192.168.121.105...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Connected to kproxy.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Escape character is &lt;span class="s1">&amp;#39;^]&amp;#39;&lt;/span>.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">GOOD
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">4&lt;/span> Connected Devices
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">* 29118:iol-rc3:115541 -&amp;gt; 0.0.0.0:40016 &lt;span class="o">(&lt;/span>In1: 0.116060, Out1: 0.108333, In15: 0.191401, Out15: 0.009772&lt;span class="o">)&lt;/span>. Last seen 2024-12-07T18:17:32.509264 &lt;span class="o">(&lt;/span>8.195s ago&lt;span class="o">)&lt;/span>. Sources: 192.168.121.103. Channel highwater: 0, 0, 0. Flow: netflow.v9
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">* 29118:iol-rc1:115531 -&amp;gt; 0.0.0.0:40010 &lt;span class="o">(&lt;/span>In1: 0.119930, Out1: 0.081798, In15: 0.191431, Out15: 0.008598&lt;span class="o">)&lt;/span>. Last seen 2024-12-07T18:17:35.463030 &lt;span class="o">(&lt;/span>7.186s ago&lt;span class="o">)&lt;/span>. Sources: 192.168.121.101. Channel highwater: 0, 0, 0. Flow: netflow.v9
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">* 29118:iol-rc2:115536 -&amp;gt; 0.0.0.0:40012 &lt;span class="o">(&lt;/span>In1: 0.094682, Out1: 0.027546, In15: 0.189246, Out15: 0.003203&lt;span class="o">)&lt;/span>. Last seen 2024-12-07T18:17:28.505189 &lt;span class="o">(&lt;/span>12.199s ago&lt;span class="o">)&lt;/span>. Sources: 192.168.121.102. Channel highwater: 0, 0, 0. Flow: netflow.v9
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">* 29118:iol-rc4:115546 -&amp;gt; 0.0.0.0:40014 &lt;span class="o">(&lt;/span>In1: 0.102966, Out1: 0.108333, In15: 0.190311, Out15: 0.009772&lt;span class="o">)&lt;/span>. Last seen 2024-12-07T18:17:19.681646 &lt;span class="o">(&lt;/span>21.022s ago&lt;span class="o">)&lt;/span>. Sources: 192.168.121.104. Channel highwater: 0, 0, 0. Flow: netflow.v9
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">0&lt;/span> Unregistered Devices
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Connection closed by foreign host.&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 class="heading-element" id="5-enable-traffic">&lt;span>5. Enable Traffic&lt;/span>
 &lt;a href="#5-enable-traffic" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h3>&lt;p>Our &lt;code>PC's&lt;/code> are already listening to the appropriate ports for the traffic tests, so we can run the clients using the respective template:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>wsl&lt;span class="o">)&lt;/span>·&amp;gt;&amp;gt; &lt;span class="nv">ANSIBLE_NOCOWS&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">1&lt;/span> netlab config iperf3_clients -l pcs -e &lt;span class="nv">ACTION&lt;/span>&lt;span class="o">=&lt;/span>run
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt; snipped &amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PLAY RECAP ****************************************************************************************************************
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pc1 : &lt;span class="nv">ok&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">9&lt;/span> &lt;span class="nv">changed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">3&lt;/span> &lt;span class="nv">unreachable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">failed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">skipped&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">4&lt;/span> &lt;span class="nv">rescued&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">ignored&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pc11 : &lt;span class="nv">ok&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">9&lt;/span> &lt;span class="nv">changed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">3&lt;/span> &lt;span class="nv">unreachable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">failed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">skipped&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">3&lt;/span> &lt;span class="nv">rescued&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">ignored&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pc12 : &lt;span class="nv">ok&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">9&lt;/span> &lt;span class="nv">changed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">3&lt;/span> &lt;span class="nv">unreachable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">failed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">skipped&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">3&lt;/span> &lt;span class="nv">rescued&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">ignored&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pc13 : &lt;span class="nv">ok&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">9&lt;/span> &lt;span class="nv">changed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">3&lt;/span> &lt;span class="nv">unreachable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">failed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">skipped&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">3&lt;/span> &lt;span class="nv">rescued&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">ignored&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pc14 : &lt;span class="nv">ok&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">9&lt;/span> &lt;span class="nv">changed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">3&lt;/span> &lt;span class="nv">unreachable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">failed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">skipped&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">3&lt;/span> &lt;span class="nv">rescued&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">ignored&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pc2 : &lt;span class="nv">ok&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">9&lt;/span> &lt;span class="nv">changed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">3&lt;/span> &lt;span class="nv">unreachable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">failed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">skipped&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">3&lt;/span> &lt;span class="nv">rescued&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">ignored&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pc3 : &lt;span class="nv">ok&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">9&lt;/span> &lt;span class="nv">changed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">3&lt;/span> &lt;span class="nv">unreachable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">failed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">skipped&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">3&lt;/span> &lt;span class="nv">rescued&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">ignored&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pc4 : &lt;span class="nv">ok&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">9&lt;/span> &lt;span class="nv">changed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">3&lt;/span> &lt;span class="nv">unreachable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">failed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">skipped&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">3&lt;/span> &lt;span class="nv">rescued&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">ignored&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>The same applies to this step as well. We can stop, start and reconfigure the test parameters in our template at any point using the appropriate &lt;code>ACTION&lt;/code> value.&lt;/p>
&lt;p>Here are some outputs from the devices:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>wsl&lt;span class="o">)&lt;/span>&amp;lt;&amp;lt;· netlab &lt;span class="nb">exec&lt;/span> rc1 sh int e0/3 &lt;span class="se">\|&lt;/span> i rate
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Connecting to rc1 using SSH port 22, executing sh int e0/3 &lt;span class="p">|&lt;/span> i rate
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Queueing strategy: fifo
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">5&lt;/span> minute input rate &lt;span class="m">32387000&lt;/span> bits/sec, &lt;span class="m">3279&lt;/span> packets/sec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">5&lt;/span> minute output rate &lt;span class="m">16295000&lt;/span> bits/sec, &lt;span class="m">2494&lt;/span> packets/sec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Connection to rc1 closed by remote host.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>wsl&lt;span class="o">)&lt;/span>·&amp;gt;&amp;gt; netlab &lt;span class="nb">exec&lt;/span> ce2 sh int e0/1 &lt;span class="se">\|&lt;/span> i rate
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Connecting to ce2 using SSH port 22, executing sh int e0/1 &lt;span class="p">|&lt;/span> i rate
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Queueing strategy: fifo
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">5&lt;/span> minute input rate &lt;span class="m">21226000&lt;/span> bits/sec, &lt;span class="m">2532&lt;/span> packets/sec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">5&lt;/span> minute output rate &lt;span class="m">22546000&lt;/span> bits/sec, &lt;span class="m">2651&lt;/span> packets/sec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Connection to ce2 closed by remote host.&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>And here is how it looks in Kentik&lt;/p>
&lt;figure>&lt;a class="lightgallery" href="https://net4fungr.github.io/posts/iou-love/traffic.png" title="/posts/iou-love/traffic.png" data-thumbnail="/posts/iou-love/traffic.png" data-sub-html="&lt;h2>Top Device by Average bits/s&lt;/h2>">&lt;img loading="lazy" src='https://net4fungr.github.io/posts/iou-love/traffic.png' alt="/posts/iou-love/traffic.png" height="739" width="2023">&lt;/a>&lt;figcaption class="image-caption">Top Device by Average bits/s&lt;/figcaption>
 &lt;/figure>
&lt;h3 class="heading-element" id="6-register-synthetics-agents">&lt;span>6. Register Synthetics Agents&lt;/span>
 &lt;a href="#6-register-synthetics-agents" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h3>&lt;p>Now for the last step, the &lt;code>ksynth&lt;/code> agents, on their first run they will initialise and appear in the portal as &lt;code>Pending&lt;/code> until they are activated. We need to activate them in the portal, assign them to the site we are using in the lab, choose the address families enabled, and also provide their private IP address they got from &lt;em>netlab&lt;/em>.&lt;/p>
&lt;p>We can get the IP address with the &lt;code>netlab inspect&lt;/code> command:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>wsl&lt;span class="o">)&lt;/span>·&amp;gt;&amp;gt; &lt;span class="k">for&lt;/span> i in &lt;span class="m">1&lt;/span> &lt;span class="m">2&lt;/span> &lt;span class="m">3&lt;/span> &lt;span class="m">4&lt;/span> &lt;span class="p">;&lt;/span> &lt;span class="k">do&lt;/span> &lt;span class="nb">echo&lt;/span> -n &lt;span class="s2">&amp;#34;ksynth&lt;/span>&lt;span class="nv">$i&lt;/span>&lt;span class="s2"> &amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> netlab inspect --node ksynth&lt;span class="nv">$i&lt;/span> interfaces&lt;span class="o">[&lt;/span>0&lt;span class="o">]&lt;/span>.ipv4 &lt;span class="p">;&lt;/span> &lt;span class="k">done&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ksynth1 172.16.4.6/24
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ksynth2 172.16.5.7/24
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ksynth3 172.16.6.8/24
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ksynth4 172.16.7.9/24&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>From this point onwards we can configure our tests in the portal.&lt;/p>
&lt;h2 class="heading-element" id="outro">&lt;span>Outro&lt;/span>
 &lt;a href="#outro" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h2>&lt;p>Well I hope you reached the end of this long post and that by now you have realised how simple it is to bring up a topology in &lt;em>containerlab&lt;/em> using &lt;em>netlab&lt;/em> to take care of the initial configuration of the underneath connectivity details and protocols running on it. The topology we used here is very small and simple, indeed, but I think that what &lt;em>netlab&lt;/em> has to offer does worth the effort of spending some time in getting to know it better and using it in your use cases or even pipelines.&lt;/p>
&lt;p>Let&amp;rsquo;s summarise here the key takeaways of this post:&lt;/p>
&lt;ul>
&lt;li>We have used &lt;em>netlab&lt;/em> to bring up a simple network topology via &lt;em>containerlab&lt;/em> and provision the initial configs on the devices based on the supported modules and features&lt;/li>
&lt;li>We have seen how to integrate additional containers interacting with this topology for serving our use case&lt;/li>
&lt;li>We have seen how to use &lt;em>netlabs&amp;rsquo;&lt;/em> ansible inventory to run our own plays extending the usability of the lab&lt;/li>
&lt;li>We have seen how to create additional configurations using templates and provision them ad-hoc to our nodes&lt;/li>
&lt;/ul>
&lt;p>Some of my thoughts on more back-blogs coming out of this could be:&lt;/p>
&lt;ul>
&lt;li>Building IOL containers out of the old images using i386 libraries and also licensing&lt;/li>
&lt;li>Using &lt;a href="https://netlab.tools/dev/extools/"target="_blank" rel="external nofollow noopener noreferrer">&lt;em>netlab tools&lt;/em>&lt;/a> for the service containers&lt;/li>
&lt;li>Using &lt;a href="https://netlab.tools/plugins/"target="_blank" rel="external nofollow noopener noreferrer">&lt;em>netlab plugins&lt;/em>&lt;/a> to extend the current functionality or even add a new one&lt;/li>
&lt;li>Handling of sensitive data, maybe ansible vault&lt;/li>
&lt;li>Use a wrapper on top to orchestrate the use case, like python invoke&lt;/li>
&lt;li>Use &lt;a href="https://netlab.tools/topology/validate/"target="_blank" rel="external nofollow noopener noreferrer">netlab validation tests&lt;/a>&lt;/li>
&lt;li>Use &lt;a href="https://wemulate.github.io/wemulate/"target="_blank" rel="external nofollow noopener noreferrer">WEmulate&lt;/a> to artificially impair links for my Kentik use case, like &lt;a href="https://blog.ipspace.net/2024/04/netlab-wemulate/"target="_blank" rel="external nofollow noopener noreferrer">this&lt;/a>.&lt;/li>
&lt;/ul>
&lt;p align="right">&lt;br>&lt;br>&lt;i>...till next time...have fun!!! &lt;/i> &lt;/p>
&lt;h2 class="heading-element" id="influences-and-reference">&lt;span>Influences and Reference&lt;/span>
 &lt;a href="#influences-and-reference" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h2>&lt;ul>
&lt;li>&lt;a href="https://netlab.tools/"target="_blank" rel="external nofollow noopener noreferrer">netlab&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://containerlab.dev/"target="_blank" rel="external nofollow noopener noreferrer">containerlab&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/hellt/vrnetlab"target="_blank" rel="external nofollow noopener noreferrer">vrnetlab for containerlab&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/srl-labs/srl-telemetry-lab"target="_blank" rel="external nofollow noopener noreferrer">srl-telemetry-lab&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://developer.cisco.com/docs/modeling-labs/iol/"target="_blank" rel="external nofollow noopener noreferrer">Cisco IOL in CML&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/becos76/netlab-iol"target="_blank" rel="external nofollow noopener noreferrer">My repo for this post&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>If this ain't a modern NMS, then what is?</title><link>https://net4fungr.github.io/posts/modern-nms/</link><pubDate>Sat, 01 Jun 2024 00:00:00 +0000</pubDate><guid>https://net4fungr.github.io/posts/modern-nms/</guid><category domain="https://net4fungr.github.io/categories/network-monitoring/">Network Monitoring</category><description>&lt;hr>
&lt;h2 class="heading-element" id="intro">&lt;span>Intro&lt;/span>
 &lt;a href="#intro" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h2>&lt;p>In this post we will go through a detailed how to on executing Ansible playbooks triggered by a webhook notification event raised in Kentik Portal. The use case is to have visibility into BGP Flowspec metrics of the devices during mitigations and see the relevant counters in the Portal under Kentik&amp;rsquo;s NMS Metrics Explorer.&lt;/p>
&lt;p>You may find all relevant files in my &lt;a href="https://github.com/becos76/kentik-eda"target="_blank" rel="external nofollow noopener noreferrer">repo&lt;/a>.&lt;/p>
&lt;hr>
&lt;h2 class="heading-element" id="the-intent">&lt;span>The Intent&lt;/span>
 &lt;a href="#the-intent" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h2>&lt;p>For the webhook receiver part, we are going to use &lt;a href="https://github.com/kentik/ansible_eda"target="_blank" rel="external nofollow noopener noreferrer">Kentik&amp;rsquo;s ansible_eda&lt;/a> collection that will &lt;em>listen&lt;/em> for a mitigation notification event. Once the event is received and a mitigation is started, EDA will trigger the execution of a playbook to handle the event and spin-up Telegraf in order to start polling the devices for BGP Flowspec streaming telemetry counters while reporting them back to the Portal in influx line format via HTTPS.&lt;/p>
&lt;p>Once the mitigation is over and EDA receives the respective &lt;em>cease&lt;/em> notification, a check for any active mitigations on the devices is done via Kentik&amp;rsquo;s API and if there are no active mitigations on the devices, EDA will trigger Telegraf to stop. If there are still on-going mitigations, Telegraf will continue to poll and ship metrics till we receive the last mitigation&amp;rsquo;s notification.&lt;/p>
&lt;hr>
&lt;h2 class="heading-element" id="lab-setup">&lt;span>Lab Setup&lt;/span>
 &lt;a href="#lab-setup" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h2>&lt;p>Here is how the lab has been set-up for this:&lt;/p>
&lt;ul>
&lt;li>Two Cisco IOS XRv 9000 devices defined in the portal with established BGP sessions and Flowspec family enabled. GRPC is configured and enabled on the devices.&lt;/li>
&lt;li>A mitigation Platform defined in the Portal that includes both devices, and two mitigation methods attached. One will block ICMP echo-requests and the other will Rate Limit SSH protocol&lt;/li>
&lt;li>A notification channel of type JSON defined in the portal and attached to both mitigation methods&lt;div class="details admonition note">
 &lt;div class="details-summary admonition-title">&lt;i class="icon fa-fw fa-solid fa-pencil-alt" aria-hidden="true">&lt;/i>Note&lt;i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true">&lt;/i>&lt;/div>
 &lt;div class="details-content">
 &lt;div class="admonition-content">I chose not to use any Alerting Policies with this and trigger all mitigations manually in order to speed things up&lt;/div>
 &lt;/div>
&lt;/div>&lt;/li>
&lt;li>An Ubuntu VM (jammy) with docker installed
&lt;ul>
&lt;li>EDA will run inside a docker container with Traefik &lt;em>proxying&lt;/em> the webhook events&lt;/li>
&lt;li>Once an &lt;em>actionable&lt;/em> event is received, EDA will control a Telegraf docker container accordingly through a playbook&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 class="heading-element" id="discovery">&lt;span>Discovery&lt;/span>
 &lt;a href="#discovery" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h2>&lt;p>We will start by exploring what we see on the devices during a running flowspec mitigation. We have triggered two manual mitigations in the Portal and those are currently active on the devices:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">RP/0/RP0/CPU0:ATH-POP1-XRV1#show flowspec afi-all detail
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">AFI: IPv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Flow :Dest:10.10.10.11/32,ICMPType:=8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Actions :Traffic-rate: 0 bps (bgp.1)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Flow :Source:10.10.10.12/32,Proto:=6,DPort:=22
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Actions :Traffic-rate: 160000 bps (bgp.1)&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="details admonition failure">
 &lt;div class="details-summary admonition-title">&lt;i class="icon fa-fw fa-solid fa-xmark" aria-hidden="true">&lt;/i>XRv9k limitations&lt;i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true">&lt;/i>&lt;/div>
 &lt;div class="details-content">
 &lt;div class="admonition-content">&lt;p>Unfortunatelly the XRv has a limited data plane, so we do not get any &lt;em>action&lt;/em> counters on the mitigations - this and also no netflow out of this virtual device &amp;#x1f622;. In case of a &lt;em>real&lt;/em> XR device the output would be similar to this:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">REAL-XR#show flowspec afi-all detail
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">AFI: IPv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Flow :Dest:10.10.10.11/32,ICMPType:=8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Actions :Traffic-rate: 0 bps (bgp.1)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	Statisctics (packets/bytes)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	 Matched : 10/640
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	 Dropped : 10/640&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
 &lt;/div>
&lt;/div>
&lt;p>So we have two mitigations as expected. Let&amp;rsquo;s find out which YANG model those are defined under. After trying some show commands for the xpath, there it is:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">RP/0/RP0/CPU0:ATH-POP1-XRV1#schema-describe &amp;#34;show flowspec afi-all detail&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Action: get
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Path: RootCfg.ASNFormat
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Action: get_children
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Path: RootOper.FlowSpec.VRF({&amp;#39;VRFName&amp;#39;: &amp;#39;default&amp;#39;}).AF
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Action: get
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Path: RootOper.FlowSpec.VRF({&amp;#39;VRFName&amp;#39;: &amp;#39;default&amp;#39;}).AF({&amp;#39;AFName&amp;#39;: &amp;#39;IPv4&amp;#39;}).Flow
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">RP/0/RP0/CPU0:ATH-POP1-XRV1#show telemetry internal xpath &amp;#34;show flowspec afi-all detail&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Error: Invalid input
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">RP/0/RP0/CPU0:ATH-POP1-XRV1#show telemetry internal xpath &amp;#34;show flowspec afi-all&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Error: Invalid input
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">RP/0/RP0/CPU0:ATH-POP1-XRV1#show telemetry internal xpath &amp;#34;show flowspec summary&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Cisco-IOS-XR-flowspec-oper:flow-spec/summary
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">RP/0/RP0/CPU0:ATH-POP1-XRV1#show telemetry internal json Cisco-IOS-XR-flowspec-oper:flow-spec | include path
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;encoding_path&amp;#34;: &amp;#34;Cisco-IOS-XR-flowspec-oper:flow-spec/vrfs/vrf/afs/af/flows/flow&amp;#34;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;encoding_path&amp;#34;: &amp;#34;Cisco-IOS-XR-flowspec-oper:flow-spec/vrfs/vrf/afs/af/nlris/nlri&amp;#34;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;encoding_path&amp;#34;: &amp;#34;Cisco-IOS-XR-flowspec-oper:flow-spec/vrfs/vrf/afs/af/table-summary&amp;#34;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;encoding_path&amp;#34;: &amp;#34;Cisco-IOS-XR-flowspec-oper:flow-spec/summary&amp;#34;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;encoding_path&amp;#34;: &amp;#34;Cisco-IOS-XR-flowspec-oper:flow-spec/clients/client&amp;#34;,&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Now we know the YANG model and the xpath, and we can get the metrics out of. We will test it with &lt;code>gnmic&lt;/code> to see if it works and get the details of the tags/paths returned:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="err">❯&lt;/span> &lt;span class="err">gnmic&lt;/span> &lt;span class="err">-a&lt;/span> &lt;span class="mf">10.12&lt;/span>&lt;span class="err">.&lt;/span>&lt;span class="mf">255.1&lt;/span>&lt;span class="err">:&lt;/span>&lt;span class="mi">57344&lt;/span> &lt;span class="err">-u&lt;/span> &lt;span class="err">&amp;lt;device_username&amp;gt;&lt;/span> &lt;span class="err">-p&lt;/span> &lt;span class="err">&amp;lt;device_password&amp;gt;&lt;/span> &lt;span class="err">--skip-verify&lt;/span> &lt;span class="err">prompt&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">gnmic&amp;gt;&lt;/span> &lt;span class="err">get&lt;/span> &lt;span class="err">--path&lt;/span> &lt;span class="err">Cisco-IOS-XR-flowspec-oper:flow-spec/vrfs/vrf/afs/af/flows/flow&lt;/span> &lt;span class="err">-e&lt;/span> &lt;span class="err">json_ietf&lt;/span> &lt;span class="err">--format&lt;/span> &lt;span class="err">event&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;get-request&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;timestamp&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1716762517741698080&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;tags&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;af_af-name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;IPv4&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;flow_flow-notation&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Dest:10.10.10.11/32,ICMPType:=8&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;source&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;10.12.255.1:57344&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;vrf_vrf-name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;default&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;values&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;/Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/active-flow-client/action.0/dscp&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;/Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/active-flow-client/action.0/ipv4-nh&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;0.0.0.0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;/Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/active-flow-client/action.0/ipv6-nh&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;::&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;/Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/active-flow-client/action.0/rate&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;/Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/flow-notation&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Dest:10.10.10.11/32,ICMPType:=8&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;/Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/flow-statistics/classified/bytes&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;/Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/flow-statistics/classified/packets&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;/Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/flow-statistics/dropped/bytes&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;/Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/flow-statistics/dropped/packets&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;/Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/destination-prefix-ipv4/mask&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;255.255.255.255&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;/Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/destination-prefix-ipv4/prefix&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;10.10.10.11&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;/Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/destination-prefix-ipv6/mask&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;/Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/destination-prefix-ipv6/prefix&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;::&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;/Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/icmp/code&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">255&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;/Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/icmp/type&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">8&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;/Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/source-prefix-ipv4/mask&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;0.0.0.0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;/Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/source-prefix-ipv4/prefix&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;0.0.0.0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;/Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/source-prefix-ipv6/mask&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;/Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/source-prefix-ipv6/prefix&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;::&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;/Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/tcp-flag/match-any&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;/Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/tcp-flag/value&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;get-request&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;timestamp&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1716762517741698080&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;tags&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;af_af-name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;IPv4&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;flow_flow-notation&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Source:10.10.10.12/32,Proto:=6,DPort:=22&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;source&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;10.12.255.1:57344&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;vrf_vrf-name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;default&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;values&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;/Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/active-flow-client/action.0/dscp&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;/Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/active-flow-client/action.0/ipv4-nh&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;0.0.0.0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;/Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/active-flow-client/action.0/ipv6-nh&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;::&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;/Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/active-flow-client/action.0/rate&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;160000&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;/Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/flow-notation&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Source:10.10.10.12/32,Proto:=6,DPort:=22&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;/Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/flow-statistics/classified/bytes&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;/Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/flow-statistics/classified/packets&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;/Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/flow-statistics/dropped/bytes&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;/Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/flow-statistics/dropped/packets&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;/Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/destination-port/uint16_rng_array.0/max&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">22&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;/Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/destination-port/uint16_rng_array.0/min&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">22&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;/Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/destination-prefix-ipv4/mask&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;0.0.0.0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;/Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/destination-prefix-ipv4/prefix&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;0.0.0.0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;/Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/destination-prefix-ipv6/mask&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;/Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/destination-prefix-ipv6/prefix&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;::&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;/Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/icmp/code&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;/Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/icmp/type&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;/Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/ip-protocol/uint16_rng_array.0/max&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">6&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;/Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/ip-protocol/uint16_rng_array.0/min&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">6&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;/Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/source-prefix-ipv4/mask&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;255.255.255.255&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;/Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/source-prefix-ipv4/prefix&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;10.10.10.12&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;/Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/source-prefix-ipv6/mask&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;/Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/source-prefix-ipv6/prefix&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;::&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;/Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/tcp-flag/match-any&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;/Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/tcp-flag/value&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">]&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;hr>
&lt;h2 class="heading-element" id="kentik-eda">&lt;span>Kentik EDA&lt;/span>
 &lt;a href="#kentik-eda" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h2>&lt;p>We are going to start off by explaining the file and folder structure giving a bit of info of how this works. The idea behind this is to have EDA running as a docker container. Traefik will handle reverse proxying the webhooks to EDA and in case a new mitigation is happening, then a telegraf docker container will spin up and start collecting gnmi metrics from the devices and pushing them to the Portal. Once the mitigation is over, EDA will receive the event to stop the mitigation.&lt;/p>
&lt;p>Now, at this point, since more than one mitigations can be ongoing on the devices, we are going to focus on the specific mitigation Platform that will always include our devices. So any Method under the specific mitigation Platform will cause the start of the metrics collection. Upon receiving a stop event on this Platform, we just have to make sure that this event is the &lt;em>last&lt;/em> one on the devices, and we can verify this via Kentik API requesting all active alerts in the portal of type Mitigation. If none exists, then we can assume that the event EDA received was the last one for the Platform.&lt;/p>
&lt;p>In summary, here are the features delivered:&lt;/p>
&lt;ul>
&lt;li>Traefik is handling the proxying of webhooks to the appropriate path that Kentik EDA is set up to receive&lt;/li>
&lt;li>Kentik EDA processes only the relevant mitigation events coming in excluding the rest&lt;/li>
&lt;li>The playbook will dynamically produce the telegraf configuration file according to our defined variables in order to ship the metrics in the Portal&lt;/li>
&lt;/ul>
&lt;h3 class="heading-element" id="directory-structure">&lt;span>Directory Structure&lt;/span>
 &lt;a href="#directory-structure" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-Bash" data-lang="Bash">&lt;span class="line">&lt;span class="cl">.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── docker-compose.yaml &amp;gt;-- How to bring up our services
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── Dockerfile &amp;gt;-- How to build the EDA image
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── .env &amp;gt;-- Hidden file containing sensitive data to be passed as environment variables
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── .env.sample &amp;gt;-- Example env file
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└── eda &amp;gt;-- EDA config folder to be mounted on the container
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">   ├── ansible.cfg &amp;gt;-- Ansible configuration file picked up by default
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">   ├── ansible-inventory.yml &amp;gt;-- Simple inv file including only localhost
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">   ├── eda_vars.yml &amp;gt;-- Definition of the related variables used in the project
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">   ├── mitigation.yml &amp;gt;-- Playbook to handle events received
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">   ├── rules.yml &amp;gt;-- Rulebook defining our EDA logic
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">   └── telegraf 
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">   ├── telegraf.conf.j2 &amp;gt;-- Jinja2 template producing the configuration dynamically
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">   └── telegraf.conf &amp;gt;-- Actual config to be used with the telegraf container
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">  &lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 class="heading-element" id="dockerfile">&lt;span>Dockerfile&lt;/span>
 &lt;a href="#dockerfile" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h3>&lt;p>We are installing the dependencies and ansible needed collections for Kentik EDA to run. We are going to run everything under the &lt;code>/app&lt;/code> directory inside the container&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-Dockerfile" data-lang="Dockerfile">&lt;span class="line">&lt;span class="cl">&lt;span class="k">FROM&lt;/span>&lt;span class="s"> quay.io/centos/centos:stream9-development&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="k">RUN&lt;/span> dnf install -y java-17-openjdk-devel python3-pip gcc python3-devel postgresql-devel&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="k">ENV&lt;/span> &lt;span class="nv">JAVA_HOME&lt;/span>&lt;span class="o">=&lt;/span>/usr/lib/jvm/java-17-openjdk&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="k">RUN&lt;/span> pip install -U pip &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> pip install ansible-core &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> ansible-rulebook &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> ansible-runner &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> psycopg requests &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> ansible-galaxy collection install kentik.ansible_eda community.docker&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="k">ARG&lt;/span> &lt;span class="nv">APP_DIR&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">APP_DIR&lt;/span>&lt;span class="k">:-&lt;/span>&lt;span class="p">/app&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="k">WORKDIR&lt;/span>&lt;span class="s"> $APP_DIR&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="k">RUN&lt;/span> chmod -R &lt;span class="m">0775&lt;/span> &lt;span class="nv">$APP_DIR&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 class="heading-element" id="compose">&lt;span>Compose&lt;/span>
 &lt;a href="#compose" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h3>&lt;p>Our compose file will bring up two services.&lt;/p>
&lt;ul>
&lt;li>&lt;strong>traefik&lt;/strong>: that will listen for HTTP and will forward everything received at the &lt;code>/eda&lt;/code> path to the EDA container replacing the path to &lt;code>/alert&lt;/code>, since this is the path that Kentik EDA webhook listens on, and port &lt;code>8080&lt;/code>.&lt;/li>
&lt;li>&lt;strong>kentik-eda&lt;/strong>: Our &lt;code>eda&lt;/code> folder is mounted at the &lt;code>/app&lt;/code> path inside the container, and contains all the files needed to run our logic. We also mount the docker unix socket to the container so that we can control the containers from within the EDA one. We also pass our variables to the container environment and we instruct the container to start the rulebook passing also the variables files. &lt;div class="details admonition warning">
 &lt;div class="details-summary admonition-title">&lt;i class="icon fa-fw fa-solid fa-exclamation-triangle" aria-hidden="true">&lt;/i>Avoid using this in production!!!&lt;i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true">&lt;/i>&lt;/div>
 &lt;div class="details-content">
 &lt;div class="admonition-content">Security wise it is not the best to have a docker container controlling the host&amp;rsquo;s containers by exposing the unix socket to it. &amp;#x1f604;&lt;/div>
 &lt;/div>
&lt;/div>&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">services&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">traefik&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">traefik&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">container_name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">traefik&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">command&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;span class="sd">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> --api.insecure=true
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> --providers.docker
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> --providers.docker.exposedbydefault=false
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> --accesslog=true
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> --entrypoints.eda.address=:80
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> #--log.level=DEBUG&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">ports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="m">80&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="m">80&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="m">8080&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="m">8080&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">volumes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">/var/run/docker.sock:/var/run/docker.sock:ro&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">kentik-eda&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c">#scale: 2&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">kentik-eda:0.1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">container_name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">kentik-eda&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">depends_on&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">traefik&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">build&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">context&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">volumes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">${PWD}/eda:/app&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">/var/run/docker.sock:/var/run/docker.sock:ro&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">env_file&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">.env&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">ports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="m">8080&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">command&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">bash -c &amp;#34;ansible-rulebook --rulebook rules.yml -i ./ansible-inventory.yml --vars eda_vars.yml&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="s2">&amp;#34;traefik.enable=true&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="s2">&amp;#34;traefik.http.routers.eda.rule=Host(`kentik.eda`) &amp;amp;&amp;amp; Path(`/eda`)&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="s2">&amp;#34;traefik.http.routers.eda.middlewares=eda-ratelimit,eda-path&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="s2">&amp;#34;traefik.http.middlewares.eda-path.replacepath.path=/alert&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="s2">&amp;#34;traefik.http.middlewares.eda-ratelimit.ratelimit.average=10&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="s2">&amp;#34;traefik.http.middlewares.eda-ratelimit.ratelimit.burst=50&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="s2">&amp;#34;traefik.http.routers.eda.entrypoints=eda&amp;#34;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Here is the example &lt;code>.env&lt;/code> file showing the variables needed to be exposed inside the EDA container environment:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-Bash" data-lang="Bash">&lt;span class="line">&lt;span class="cl">&lt;span class="nv">KENTIK_API_TOKEN&lt;/span>&lt;span class="o">=&lt;/span>&amp;lt;your api token&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">KENTIK_API_EMAIL&lt;/span>&lt;span class="o">=&lt;/span>&amp;lt;your portal email&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">KENTIK_API_ENDPOINT&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;https://grpc.api.kentik.eu/kmetrics/v202207/metrics/api/v2/write?bucket=&amp;amp;org=&amp;amp;precision=ns&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">GRPC_USERNAME&lt;/span>&lt;span class="o">=&lt;/span>&amp;lt;device username&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">GRPC_PASSWORD&lt;/span>&lt;span class="o">=&lt;/span>&amp;lt;device password&amp;gt;&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>We can bring everything up with &lt;code>docker compose up --build&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">❯ docker compose up --build --force-recreate --dry-run
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>+&lt;span class="o">]&lt;/span> Building 0.0s &lt;span class="o">(&lt;/span>0/0&lt;span class="o">)&lt;/span> docker:default
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>+&lt;span class="o">]&lt;/span> Running 5/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ✔ DRY-RUN MODE - build service kentik-eda 0.0s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ✔ DRY-RUN MODE - &lt;span class="o">==&lt;/span>&amp;gt; &lt;span class="o">==&lt;/span>&amp;gt; writing image dryRun-648b28d83dd200d4e7709ac3a5d522f8244467bd 0.0s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ✔ DRY-RUN MODE - &lt;span class="o">==&lt;/span>&amp;gt; &lt;span class="o">==&lt;/span>&amp;gt; naming to kentik-eda:0.1 0.0s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ✔ DRY-RUN MODE - Container traefik Recreated 0.0s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ✔ DRY-RUN MODE - Container kentik-eda Recreated 0.0s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">end of &lt;span class="s1">&amp;#39;compose up&amp;#39;&lt;/span> output, interactive run is not supported in dry-run mode&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 class="heading-element" id="rulebook-rules">&lt;span>Rulebook rules&lt;/span>
 &lt;a href="#rulebook-rules" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h3>&lt;p>Here is how we have configured our rules:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-YAML" data-lang="YAML">&lt;span class="line">&lt;span class="cl">&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Listening for Webhook Events&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">hosts&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">localhost&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">sources&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">kentik.ansible_eda.kentik_webhook&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">host&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">0.0.0.0&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">8080&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">rules&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">R1 - New Event Received&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># If it is a valid start or stop mitigation event&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">condition&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">event.payload is defined and&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">event.payload.CompanyID == vars.CompanyID and&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">event.payload.EventType == vars.EventType and&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">event.payload.MitigationPlatformID == vars.MitigationPlatformID and&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">event.payload.MitigationState in vars.ValidMitigationStates and&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">event.payload.MitigationStateNew in vars.ValidMitigationStates&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">actions&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">debug&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">msg&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">|&lt;/span>&lt;span class="sd">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> New {{event.payload.MitigationType}}/{{event.payload.MitigationState}} event received
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> ID: {{event.payload.MitigationID}}
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> Platform: {{event.payload.MitigationPlatformName}}
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> Method: {{event.payload.MitigationMethodName}}
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> IP: {{event.payload.MitigationAlertIP}}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># DEBUG:Dump the event&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c">#- print_event:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># pretty: true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># Call the pb to handle the mitigation event&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">run_playbook&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">mitigation.yml&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># Catch and ignore the rest&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">R2 - Not taking action&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">condition&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">event.meta is defined&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">action&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">debug&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">msg&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="s2">&amp;#34;Ignoring {{event.payload.EventType}} event&amp;#34;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p style="background-color:skyblue;text-align:center">&lt;b>eda/rules.yml&lt;/b>&lt;/p>
and our variables:
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-YAML" data-lang="YAML">&lt;span class="line">&lt;span class="cl">&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">CompanyID&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">&amp;lt;REDACTED&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">EventType&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;mitigation&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">MitigationPlatformID&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;257&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">ValidMitigationStates&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="s2">&amp;#34;manualMitigating&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="s2">&amp;#34;mitigating&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="s2">&amp;#34;archived&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Mitigation&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">devices&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;ath-pop1-xrv1&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">ip&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;10.12.255.1&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">57344&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;ath-pop1-xrv2&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">ip&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;10.13.255.1&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">57344&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p style="background-color:skyblue;text-align:center">&lt;b>eda/eda_vars.yml&lt;/b>&lt;/p>
&lt;p>As a condition we check the event payload against certain values in order to process it further, e.g. the CompanyID , the EventType and the MitigationPlatformID must match to what we have configured and also the EventState must be one of the &lt;em>actionable&lt;/em> states that we have defined in our dictionary. If we have a matching event then we pass control to the &lt;code>mitigation.yml&lt;/code> playbook to handle the event further.&lt;/p>
&lt;hr>
&lt;h2 class="heading-element" id="ansible-playbook">&lt;span>Ansible Playbook&lt;/span>
 &lt;a href="#ansible-playbook" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h2>&lt;p>We could have had separate playbooks for the different states of the alerts received, i.e. separate conditions in the rules file, but we chose here to proceed with just one playbook to handle both cases.&lt;/p>
&lt;p>A brief pseudocode of the playbook could be:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-Bash" data-lang="Bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#IF event state is &amp;#39;mitigating&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="c1">#IF Telegraf is not running&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">		- Generate telegraf config from template
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">		- Bring up the container
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#ELSE IF event state is &amp;#39;archived&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="c1">#IF no active mitigation alerts in portal for PlatormID&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">		- Stop telegraf container&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;details>
 &lt;summary>Here is a sequence diagram showing the workflows&lt;/summary>
 &lt;pre class="mermaid">sequenceDiagram
 autonumber
 participant Portal
 participant EDA
 Portal->>EDA: Alerts
 loop Listen
 EDA->>EDA: Check Platform and State (Start/Stop)
 create participant Playbook
 EDA->>Playbook: Process Valid Alert 
 end
 alt Mitigation Started
 Playbook->>Docker: Is Telegraf Running?
 Docker-->>Playbook: State
 alt Telegraf Running
 Playbook->>Playbook: Do nothing
 else Telegraf Down
 Playbook->>Playbook: Create Telegraf config
 Playbook->>Docker: Start Telegraf
 create participant Telegraf
 Docker->>Telegraf: Run Container
 loop
 create participant Devices
 Telegraf->>Devices: Fetch metrics
 Telegraf->>Portal: Ship metrics
 end
 end
 else Mitigation Finished
 Playbook->>Portal: Get active mitigations
 Portal-->>Playbook: Active Mitigations
 alt Active Mitigations on Platform
 Playbook->>Playbook: Do nothing
 else No Active Mitigations on Platform
 Playbook->>Docker: Stop Telegraf
 Docker->>Telegraf: Container Down
 destroy Telegraf
 end
 end&lt;/pre>
&lt;template>sequenceDiagram
 autonumber
 participant Portal
 participant EDA
 Portal->>EDA: Alerts
 loop Listen
 EDA->>EDA: Check Platform and State (Start/Stop)
 create participant Playbook
 EDA->>Playbook: Process Valid Alert 
 end
 alt Mitigation Started
 Playbook->>Docker: Is Telegraf Running?
 Docker-->>Playbook: State
 alt Telegraf Running
 Playbook->>Playbook: Do nothing
 else Telegraf Down
 Playbook->>Playbook: Create Telegraf config
 Playbook->>Docker: Start Telegraf
 create participant Telegraf
 Docker->>Telegraf: Run Container
 loop
 create participant Devices
 Telegraf->>Devices: Fetch metrics
 Telegraf->>Portal: Ship metrics
 end
 end
 else Mitigation Finished
 Playbook->>Portal: Get active mitigations
 Portal-->>Playbook: Active Mitigations
 alt Active Mitigations on Platform
 Playbook->>Playbook: Do nothing
 else No Active Mitigations on Platform
 Playbook->>Docker: Stop Telegraf
 Docker->>Telegraf: Container Down
 destroy Telegraf
 end
 end&lt;/template>&lt;/details>
&lt;p>And here is the playbook. Two blocks were used to differentiate between the start and stop workflows. For the telegraf container the configuration file is dynamically produced through a jinja2 template and this is mounted within the container. This is achieved by specifying the full host path of the file, which is also relatively mounted within the EDA container, i.e. shared.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-YAML" data-lang="YAML">&lt;span class="line">&lt;span class="cl">&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;::HANDLE MITIGATION EVENT::&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">gather_facts&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">no&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">hosts&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">localhost&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">vars_files&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">eda_vars.yml&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">tasks&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">START - NEW MITIGATION STARTING&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">block&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> 
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> 
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">START::IS TELEGRAF RUNNING&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">community.docker.docker_container_info&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">telegraf-eda&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">register&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">result&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> 
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">START::GENERATE TELEGRAF CONFIG&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">ansible.builtin.template&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">src&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/app/telegraf/telegraf.conf.j2&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">dest&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/app/telegraf/telegraf.conf&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">when&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">not result.exists|bool &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> 
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">START::BRING UP CONTAINER&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">community.docker.docker_container&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">telegraf-eda&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">telegraf:latest&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">state&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">started&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">volumes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="s2">&amp;#34;/opt/projects/kentik-eda/eda/telegraf/telegraf.conf:/etc/telegraf/telegraf.conf&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">env&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">KENTIK_API_EMAIL&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;{{ lookup(&amp;#39;ansible.builtin.env&amp;#39;, &amp;#39;KENTIK_API_EMAIL&amp;#39;)}}&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">KENTIK_API_TOKEN&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;{{ lookup(&amp;#39;ansible.builtin.env&amp;#39;, &amp;#39;KENTIK_API_TOKEN&amp;#39;)}}&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">GRPC_USERNAME&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;{{ lookup(&amp;#39;ansible.builtin.env&amp;#39;, &amp;#39;GRPC_USERNAME&amp;#39;)}}&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">GRPC_PASSWORD&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;{{ lookup(&amp;#39;ansible.builtin.env&amp;#39;, &amp;#39;GRPC_PASSWORD&amp;#39;)}}&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">when&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">not result.exists|bool &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> 
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">when&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;&amp;#39;mitigating&amp;#39; in ansible_eda.event.payload.MitigationState|lower and 
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> &amp;#39;mitigating&amp;#39; in ansible_eda.event.payload.MitigationStateNew|lower&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> 
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">MITIGATION FINISHED&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">block&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> 
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> 
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">STOP::GET ACTIVE ALERTS FROM KENTIK&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">ansible.builtin.uri&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">url&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">https://api.kentik.eu/api/v5/alerts-active/alarms&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">method&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">GET&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">http_agent&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ansible-eda-httpget&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">headers&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">X-CH-Auth-API-Token&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;{{ lookup(&amp;#39;ansible.builtin.env&amp;#39;, &amp;#39;KENTIK_API_TOKEN&amp;#39;)}}&amp;#34;&lt;/span>&lt;span class="w"> 
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">X-CH-Auth-Email&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;{{ lookup(&amp;#39;ansible.builtin.env&amp;#39;, &amp;#39;KENTIK_API_EMAIL&amp;#39;)}}&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">register&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">alerts&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">STOP::CHECK KENTIK FOR ACTIVE MITIGATIONS&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">ansible.builtin.debug&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> 
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">msg&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> 
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="s2">&amp;#34;Current Active Mitigations on Platform ID#{{MitigationPlatformID}}: {{alerts.json | 
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> selectattr(&amp;#39;mit_platform_id&amp;#39;, &amp;#39;match&amp;#39;, ansible_eda.event.payload.MitigationPlatformID ) |
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> selectattr(&amp;#39;alarm_state&amp;#39;, &amp;#39;search&amp;#39;, &amp;#39;MITIGATING&amp;#39;) | length}}&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> 
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">STOP::REMOVE TELEGRAF CONTAINER&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">community.docker.docker_container&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">telegraf-eda&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">state&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">absent&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">when&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">alerts.json | &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">selectattr(&amp;#39;mit_platform_id&amp;#39;, &amp;#39;match&amp;#39;, ansible_eda.event.payload.MitigationPlatformID ) |&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">selectattr(&amp;#39;alarm_state&amp;#39;, &amp;#39;search&amp;#39;, &amp;#39;MITIGATING&amp;#39;) | length == 0&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> 
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">when&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;&amp;#39;archived&amp;#39; in ansible_eda.event.payload.MitigationState|lower and
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> &amp;#39;archived&amp;#39; in ansible_eda.event.payload.MitigationStateNew|lower&amp;#34;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p style="background-color:skyblue;text-align:center">&lt;b>eda/mitigation.yml&lt;/b>&lt;/p>
&lt;h3 class="heading-element" id="telegraf-configuration">&lt;span>Telegraf configuration&lt;/span>
 &lt;a href="#telegraf-configuration" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h3>&lt;p>When it comes to telegraf, we chose to have the config generated dynamically before the container starts. In this way we can:&lt;/p>
&lt;ul>
&lt;li>Specify the devices&amp;rsquo; attributes in the variables file and deduce the gnmi inputs from them&lt;/li>
&lt;li>Include the MitigationPlatformID as a tag along with all other event details&lt;/li>
&lt;li>Perform a &lt;em>lookup&lt;/em> to include DEVICE_IP and DEVICE_NAME along with the tags. This was implemented via an inline starlark script referencing a lookup dictionary that is dynamically constructed from our devices dictionary.&lt;/li>
&lt;li>All sensitive data are passed from the EDA container environment and instantiated via docker when the container is brought up.&lt;/li>
&lt;/ul>
&lt;p>Here is the template:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-toml" data-lang="toml">&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="nx">agent&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">omit_hostname&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="kc">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">debug&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="kc">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">quiet&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="kc">false&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="nx">global_tags&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">platform_id&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;{{ MitigationPlatformID }}&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[[&lt;/span>&lt;span class="nx">inputs&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">gnmi&lt;/span>&lt;span class="p">]]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">addresses&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="p">[{&lt;/span>&lt;span class="err">%&lt;/span> &lt;span class="nx">for&lt;/span> &lt;span class="nx">device&lt;/span> &lt;span class="nx">in&lt;/span> &lt;span class="nx">Mitigation&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">devices&lt;/span> &lt;span class="err">%&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="s2">&amp;#34;{{device.ip}}:{{device.port}}&amp;#34;&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="err">%&lt;/span> &lt;span class="nx">if&lt;/span> &lt;span class="nx">not&lt;/span> &lt;span class="nx">loop&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">last&lt;/span> &lt;span class="err">%&lt;/span>&lt;span class="p">},{&lt;/span>&lt;span class="err">%&lt;/span> &lt;span class="nx">endif&lt;/span> &lt;span class="err">%&lt;/span>&lt;span class="p">}{&lt;/span>&lt;span class="err">%&lt;/span> &lt;span class="nx">endfor&lt;/span> &lt;span class="err">%&lt;/span>&lt;span class="p">}]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">username&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;${GRPC_USERNAME}&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">password&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;${GRPC_PASSWORD}&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">redial&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;10s&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">encoding&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;proto&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">tls_enable&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="kc">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">insecure_skip_verify&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="kc">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[[&lt;/span>&lt;span class="nx">inputs&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">gnmi&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">subscription&lt;/span>&lt;span class="p">]]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">name&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;/devices/xrv9000/flowspec&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">origin&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;Cisco-IOS-XR-flowspec-oper&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">path&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;/flow-spec/vrfs/vrf/afs/af/flows/flow/flow-statistics/&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">subscription_mode&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;sample&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">sample_interval&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;30s&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[[&lt;/span>&lt;span class="nx">processors&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">rename&lt;/span>&lt;span class="p">]]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">[[&lt;/span>&lt;span class="nx">processors&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">rename&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">replace&lt;/span>&lt;span class="p">]]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">tag&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;source&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">dest&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;device_ip&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[[&lt;/span>&lt;span class="nx">processors&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">override&lt;/span>&lt;span class="p">]]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">[&lt;/span>&lt;span class="nx">processors&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">override&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">tagpass&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">vrf_name&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">[&lt;/span>&lt;span class="nx">processors&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">override&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">tags&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">vrf_name&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;default&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[[&lt;/span>&lt;span class="nx">processors&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">starlark&lt;/span>&lt;span class="p">]]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">source&lt;/span>&lt;span class="p">=&lt;/span>&lt;span class="s1">&amp;#39;&amp;#39;&amp;#39;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">lookup = {
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">{% for device in Mitigation.devices %}
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> &amp;#34;{{ device.ip }}&amp;#34;: &amp;#34;{{ device.name }}&amp;#34;,
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">{% endfor %}}
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">def apply(metric):
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> if metric.tags[&amp;#39;&lt;/span>&lt;span class="nx">device_ip&lt;/span>&lt;span class="s1">&amp;#39;] and metric.tags[&amp;#39;&lt;/span>&lt;span class="nx">device_ip&lt;/span>&lt;span class="s1">&amp;#39;] in lookup:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> metric.tags[&amp;#39;&lt;/span>&lt;span class="nx">device_name&lt;/span>&lt;span class="s1">&amp;#39;] = lookup[metric.tags[&amp;#39;&lt;/span>&lt;span class="nx">device_ip&lt;/span>&lt;span class="s1">&amp;#39;]]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> return metric
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">&amp;#39;&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[[&lt;/span>&lt;span class="nx">outputs&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">file&lt;/span>&lt;span class="p">]]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">files&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;stdout&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">data_format&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;influx&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">influx_sort_fields&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="kc">false&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">tagexclude&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;path&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[[&lt;/span>&lt;span class="nx">outputs&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">http&lt;/span>&lt;span class="p">]]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">url&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;{{ lookup(&amp;#39;env&amp;#39;, &amp;#39;KENTIK_API_ENDPOINT&amp;#39;)}}&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">data_format&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;influx&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">influx_sort_fields&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="kc">false&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">tagexclude&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;path&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">[&lt;/span>&lt;span class="nx">outputs&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">http&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">headers&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">Content-Type&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;application/influx&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">X-CH-Auth-Email&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;${KENTIK_API_EMAIL}&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">X-CH-Auth-API-Token&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;${KENTIK_API_TOKEN}&amp;#34;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p style="background-color:skyblue;text-align:center">&lt;b>eda/telegraf/telegraf.conf.j2&lt;/b>&lt;/p>
&lt;p>And the respective config file produced to be picked up by docker:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-toml" data-lang="toml">&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="nx">agent&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">omit_hostname&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="kc">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">debug&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="kc">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">quiet&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="kc">false&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="nx">global_tags&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">platform_id&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;257&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[[&lt;/span>&lt;span class="nx">inputs&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">gnmi&lt;/span>&lt;span class="p">]]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">addresses&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;10.12.255.1:57344&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s2">&amp;#34;10.13.255.1:57344&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">username&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;${GRPC_USERNAME}&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">password&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;${GRPC_PASSWORD}&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">redial&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;10s&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">encoding&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;proto&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">tls_enable&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="kc">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">insecure_skip_verify&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="kc">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[[&lt;/span>&lt;span class="nx">inputs&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">gnmi&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">subscription&lt;/span>&lt;span class="p">]]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">name&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;/devices/xrv9000/flowspec&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">origin&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;Cisco-IOS-XR-flowspec-oper&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">path&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;/flow-spec/vrfs/vrf/afs/af/flows/flow/flow-statistics/&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">subscription_mode&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;sample&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">sample_interval&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;30s&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[[&lt;/span>&lt;span class="nx">processors&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">rename&lt;/span>&lt;span class="p">]]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">[[&lt;/span>&lt;span class="nx">processors&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">rename&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">replace&lt;/span>&lt;span class="p">]]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">tag&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;source&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">dest&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;device_ip&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[[&lt;/span>&lt;span class="nx">processors&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">override&lt;/span>&lt;span class="p">]]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">[&lt;/span>&lt;span class="nx">processors&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">override&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">tagpass&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">vrf_name&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">[&lt;/span>&lt;span class="nx">processors&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">override&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">tags&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">vrf_name&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;default&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[[&lt;/span>&lt;span class="nx">processors&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">starlark&lt;/span>&lt;span class="p">]]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">source&lt;/span>&lt;span class="p">=&lt;/span>&lt;span class="s1">&amp;#39;&amp;#39;&amp;#39;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">lookup = {
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> &amp;#34;10.12.255.1&amp;#34;: &amp;#34;ath-pop1-xrv1&amp;#34;,
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> &amp;#34;10.13.255.1&amp;#34;: &amp;#34;ath-pop1-xrv2&amp;#34;,
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">}
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">def apply(metric):
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> if metric.tags[&amp;#39;&lt;/span>&lt;span class="nx">device_ip&lt;/span>&lt;span class="s1">&amp;#39;] and metric.tags[&amp;#39;&lt;/span>&lt;span class="nx">device_ip&lt;/span>&lt;span class="s1">&amp;#39;] in lookup:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> metric.tags[&amp;#39;&lt;/span>&lt;span class="nx">device_name&lt;/span>&lt;span class="s1">&amp;#39;] = lookup[metric.tags[&amp;#39;&lt;/span>&lt;span class="nx">device_ip&lt;/span>&lt;span class="s1">&amp;#39;]]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> return metric
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">&amp;#39;&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[[&lt;/span>&lt;span class="nx">outputs&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">file&lt;/span>&lt;span class="p">]]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">files&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;stdout&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">data_format&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;influx&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">influx_sort_fields&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="kc">false&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">tagexclude&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;path&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[[&lt;/span>&lt;span class="nx">outputs&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">http&lt;/span>&lt;span class="p">]]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">url&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;https://grpc.api.kentik.eu/kmetrics/v202207/metrics/api/v2/write?bucket=&amp;amp;org=&amp;amp;precision=ns&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">data_format&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;influx&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">influx_sort_fields&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="kc">false&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">tagexclude&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;path&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">[&lt;/span>&lt;span class="nx">outputs&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">http&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">headers&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">Content-Type&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;application/influx&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">X-CH-Auth-Email&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;${KENTIK_API_EMAIL}&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">X-CH-Auth-API-Token&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;${KENTIK_API_TOKEN}&amp;#34;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p style="background-color:skyblue;text-align:center">&lt;b>eda/telegraf/telegraf.conf&lt;/b>&lt;/p>
&lt;hr>
&lt;h2 class="heading-element" id="moment-of-truth">&lt;span>Moment of Truth&lt;/span>
 &lt;a href="#moment-of-truth" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h2>&lt;p>After starting some manual mitigations, telegraf will ship the gnmi metrics to the Portal and those will be available under the &lt;code>/devices/xrv9000/flowspec&lt;/code> custom schema path based on our configuration in the &lt;a href="#telegraf-configuration">&lt;code>telegraf.conf&lt;/code>&lt;/a>file.&lt;/p>
&lt;p>Here is how it looks like in the Metrics Explorer
&lt;figure>&lt;a class="lightgallery" href="https://net4fungr.github.io/posts/modern-nms/mot.png" title="/posts/modern-nms/mot.png" data-thumbnail="/posts/modern-nms/mot.png" data-sub-html="&lt;h2>Flowspec metrics in the Portal&lt;/h2>">&lt;img loading="lazy" src='https://net4fungr.github.io/posts/modern-nms/mot.png' alt="/posts/modern-nms/mot.png" height="920" width="2541">&lt;/a>&lt;figcaption class="image-caption">Flowspec metrics in the Portal&lt;/figcaption>
 &lt;/figure>&lt;/p>
&lt;p>Here are some console outputs from EDA running:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">** 2024-05-26 16:00:04.559137 [debug] ******************************************
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Ignoring mitigation event
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">********************************************************************************
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">** 2024-05-26 16:00:18.406938 [debug] ******************************************
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">New manual/manualMitigating event received
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ID: 10108
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Platform: XR-FlowSpec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Method: Discard ICMP echo-request
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IP: 10.10.10.11/32
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">********************************************************************************
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PLAY [::HANDLE MITIGATION EVENT::] *********************************************
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">TASK [START::IS TELEGRAF RUNNING] **********************************************
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ok: [localhost]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">TASK [START::GENERATE TELEGRAF CONFIG] *****************************************
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ok: [localhost]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">TASK [START::BRING UP CONTAINER] ***********************************************
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">changed: [localhost]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">TASK [STOP::GET ACTIVE ALERTS FROM KENTIK] *************************************
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">skipping: [localhost]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">TASK [STOP::CHECK KENTIK FOR ACTIVE MITIGATIONS] *******************************
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">skipping: [localhost]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">TASK [STOP::REMOVE TELEGRAF CONTAINER] *****************************************
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">skipping: [localhost]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PLAY RECAP *********************************************************************
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">localhost : ok=3 changed=1 unreachable=0 failed=0 skipped=3 rescued=0 ignored=0&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p style="background-color:skyblue;text-align:center">&lt;b>New mitigation&lt;/b>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">** 2024-05-26 16:10:20.682550 [debug] ******************************************
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">New manual/archived event received
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ID: 10111
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Platform: XR-FlowSpec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Method: Rate Limit 20k TCP SSH
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IP: 10.10.10.15/32
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">********************************************************************************
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PLAY [::HANDLE MITIGATION EVENT::] *********************************************
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">TASK [START::IS TELEGRAF RUNNING] **********************************************
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">skipping: [localhost]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">TASK [START::GENERATE TELEGRAF CONFIG] *****************************************
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">skipping: [localhost]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">TASK [START::BRING UP CONTAINER] ***********************************************
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">skipping: [localhost]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">TASK [STOP::GET ACTIVE ALERTS FROM KENTIK] *************************************
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ok: [localhost]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">TASK [STOP::CHECK KENTIK FOR ACTIVE MITIGATIONS] *******************************
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ok: [localhost] =&amp;gt; {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;msg&amp;#34;: [
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;Current Active Mitigations on Platform ID#257: 3&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">TASK [STOP::REMOVE TELEGRAF CONTAINER] *****************************************
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">skipping: [localhost]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PLAY RECAP *********************************************************************
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">localhost : ok=2 changed=0 unreachable=0 failed=0 skipped=4 rescued=0 ignored=0&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p style="background-color:skyblue;text-align:center">&lt;b>Stop mitigation while others are running&lt;/b>&lt;/p>
&lt;hr>
&lt;h2 class="heading-element" id="outro">&lt;span>Outro&lt;/span>
 &lt;a href="#outro" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h2>&lt;p>Well I hope this post was interesting enough and can be used as a reference while exploring the use cases covered:&lt;/p>
&lt;ul>
&lt;li>How to leverage Kentik EDA to receive Portal notifications and execute ansible playbooks&lt;/li>
&lt;li>How to use telegraf to send custom ST metrics to Kentik NMS&lt;/li>
&lt;li>Generating telegraf configuration dynamically&lt;/li>
&lt;/ul>
&lt;p align="right">&lt;br>&lt;br>&lt;i>...till next time...have fun!!! &lt;/i> &lt;/p>
&lt;hr>
&lt;h2 class="heading-element" id="influences-and-reference">&lt;span>Influences and Reference&lt;/span>
 &lt;a href="#influences-and-reference" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h2>&lt;ul>
&lt;li>&lt;a href="https://www.kentik.com/blog/driving-network-automation-innovation-kentik-and-red-hat-launch-integration/"target="_blank" rel="external nofollow noopener noreferrer">Driving Network Automation Innovation: Kentik and Red Hat Launch Integration&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://www.ansible.com/blog/getting-started-with-event-driven-ansible/"target="_blank" rel="external nofollow noopener noreferrer">EDA Quickstart&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://www.kentik.com/blog/using-telegraf-to-feed-api-json-data-into-kentik-nms/"target="_blank" rel="external nofollow noopener noreferrer">Using Telegraf to Feed API JSON Data into Kentik NMS&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/kentik/ansible_eda"target="_blank" rel="external nofollow noopener noreferrer">Kentik&amp;rsquo;s ansible_eda&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/becos76/kentik-eda"target="_blank" rel="external nofollow noopener noreferrer">Repo for this post&lt;/a>&lt;/li>
&lt;/ul>
&lt;hr></description></item><item><title>K~ustom Metrics in Kentik NMS</title><link>https://net4fungr.github.io/posts/kustom-metrics/</link><pubDate>Sat, 04 May 2024 00:00:00 +0000</pubDate><guid>https://net4fungr.github.io/posts/kustom-metrics/</guid><category domain="https://net4fungr.github.io/categories/network-monitoring/">Network Monitoring</category><description>&lt;hr>
&lt;h2 class="heading-element" id="intro">&lt;span>Intro&lt;/span>
 &lt;a href="#intro" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h2>&lt;p>Since the launch of Kentik NMS, it it is possible to ingest and display custom metrics in the Portal. In this post we will be going over a walkthrough of how we can enable Kentik&amp;rsquo;s Universal Agent to poll custom SNMP and Streaming Telemetry metrics from devices and report them back to the Portal. The use case is about having visibility into BGP Flowspec counters to see what our mitigations are reporting on the devices.&lt;/p>
&lt;p>We are going to address this through SNMP as well as ST for both Junos and IOS-XR devices. For Junos, the flowspec rules are translated into firewall filters which have counters and policers depending on the action. We have two possible ways to extract those, either via SNMP or via streaming telemetry and we are going to use both. For IOS-XR, on the other-hand, there are no SNMP flowspec related OIDs, but there is a dedicated flowspec YANG model we can use to extract the counters via streaming telemetry.&lt;/p>
&lt;p>The various tools and device versions used throughout the use case are listed below:&lt;/p>
&lt;ul>
&lt;li>Kentik kagent docker container&lt;/li>
&lt;li>snmpwalk and snmptable&lt;/li>
&lt;li>gnmic&lt;/li>
&lt;li>Junos vMX on 21.3R1.9&lt;/li>
&lt;li>Cisco IOS-XRv 9000 on 7.9.1&lt;/li>
&lt;/ul>
&lt;p>You may find all relevant files in my &lt;a href="https://github.com/becos76/kentik-custom-metrics"target="_blank" rel="external nofollow noopener noreferrer">repo&lt;/a>.&lt;/p>
&lt;hr>
&lt;h2 class="heading-element" id="kentik-universal-agent-kagent">&lt;span>Kentik Universal Agent (kagent)&lt;/span>
 &lt;a href="#kentik-universal-agent-kagent" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h2>&lt;p>In order to use the custom metrics feature on the kagent we need some local configuration to be picked up by the agent on startup so it can be processed. In summary, we need three configuration files to exist localy in a specific directory structure that we can call the &lt;em>override&lt;/em> directory.&lt;/p>
&lt;p>Below is the structure along with a brief explanation on the purpose of each one.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-Bash" data-lang="Bash">&lt;span class="line">&lt;span class="cl">/opt/kentik/components/ranger/local/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└── config
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ├── profiles &lt;span class="c1"># Holds the configuration yaml files for &amp;#39;binding&amp;#39; the sources to specific &amp;#39;device&amp;#39; types&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ├── reports &lt;span class="c1"># Holds the configuration yaml files for &amp;#39;how&amp;#39; we want to report what is collected from the sources in the portal&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> └── sources &lt;span class="c1"># Holds the configuration yaml files for &amp;#39;what&amp;#39; we want to poll from the device&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>So once kagent starts it looks for the &lt;code>local&lt;/code> folder and it processes those files in the structure. For example, if we want to poll an SNMP OID for a device, we would need to create a configuration file under the &lt;code>sources&lt;/code> directory specifying which OID to poll and how often. Then we need to &lt;em>bind&lt;/em> this source to only get polled if say the device is of a specific sysObjectID, and we do that in the &lt;code>profiles&lt;/code> directory. Lastly, in the &lt;code>reports&lt;/code> directory we define the path to present the data in the portal, how the data is represented and polled from the MIB, i.e. metrics or dimensions, and how often to update the values in the database. Additionally, in the &lt;code>reports&lt;/code> directory we can use &lt;code>starlark&lt;/code> scripts to add additional logic to our reporting capabilities.&lt;/p>
&lt;h3 class="heading-element" id="kagent-container">&lt;span>Kagent container&lt;/span>
 &lt;a href="#kagent-container" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h3>&lt;p>We are going to be running our kagent instance as a container through compose. Here is how our directory structure looks like:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-Bash" data-lang="Bash">&lt;span class="line">&lt;span class="cl">/opt/dev/kentik/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── docker-compose.yml &lt;span class="c1"># How to bring up the container&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── kagent-data &lt;span class="c1"># Local dir mount so kagent data persists -&amp;gt; /opt/kentik in the container&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└── override-data &lt;span class="c1"># Local overrides directory with custom definitions -&amp;gt; /opt/kentik/components/ranger/local in the container&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> └── config
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ├── profiles
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ├── reports
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> └── sources&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>And here is the docker compose file:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-YAML" data-lang="YAML">&lt;span class="line">&lt;span class="cl">&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">services&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">kagent&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">hostname&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">kagent03&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">kentik/kagent:latest&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">restart&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">unless-stopped&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">pull_policy&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">always&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">cap_add&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">NET_RAW&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">environment&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">K_COMPANY_ID=&amp;lt;REDACTED&amp;gt;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">K_API_ROOT=grpc.api.kentik.eu:443&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c">#- K_LOG_LEVEL=debug&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">volumes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">/opt/dev/kentik/kagent-data:/opt/kentik&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">/opt/dev/kentik/override-data:/opt/kentik/components/ranger/local/&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;hr>
&lt;h2 class="heading-element" id="junos-firewall-filters">&lt;span>Junos Firewall Filters&lt;/span>
 &lt;a href="#junos-firewall-filters" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h2>&lt;p>In Junos the flowspec rules create relevant ad-hoc firewall filters and policers that are applied to the linecards and can be examined via the show firewall detail command. Here is what we get with nothing configured:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-Bash" data-lang="Bash">&lt;span class="line">&lt;span class="cl">netops@ATH-POP1-VMX1&amp;gt; show configuration firewall
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">netops@ATH-POP1-VMX1&amp;gt; show firewall detail
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Filter: __default_bpdu_filter__&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>And here is what we get if we configure a filter to count SSH packets destined to the management IP of the device and two manual mitigations from the portal, one to block traffic and one to rate limit:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-Bash" data-lang="Bash">&lt;span class="line">&lt;span class="cl">netops@ATH-POP1-VMX1&amp;gt; show firewall detail
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Filter: __default_bpdu_filter__
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Filter: TEST-FIREWALL
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Counters:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Name Bytes Packets
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SSH-PACKETS &lt;span class="m">74932&lt;/span> &lt;span class="m">1153&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Filter: __flowspec_default_inet__
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Counters:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Name Bytes Packets
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">10.11.10.10,*,icmp-type&lt;span class="o">=&lt;/span>&lt;span class="m">8&lt;/span> &lt;span class="m">41496&lt;/span> &lt;span class="m">30&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">10.11.10.10,*,proto&lt;span class="o">=&lt;/span>6,dstport&lt;span class="o">=&lt;/span>&lt;span class="m">5201&lt;/span> &lt;span class="m">172233&lt;/span> &lt;span class="m">184&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Policers:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Name Bytes Packets
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">40K_10.11.10.10,*,proto&lt;span class="o">=&lt;/span>6,dstport&lt;span class="o">=&lt;/span>&lt;span class="m">5201&lt;/span> &lt;span class="m">402000&lt;/span> &lt;span class="m">268&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>So any flowpsec rule received is reported under the &lt;code>__flowspec_default_inet__&lt;/code> filter. The one that blocks ICMP traffic is a counter and the one that limits IPERF is both a counter and a policer.&lt;/p>
&lt;h3 class="heading-element" id="snmp">&lt;span>SNMP&lt;/span>
 &lt;a href="#snmp" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h3>&lt;p>It seems that Juniper has a dedicated MIB for reporting those firewall metrics, the &lt;em>JUNOS-FIREWALL-MIB&lt;/em> and after downloading all juniper MIBs in my &lt;code>~/.snmp/mibs&lt;/code> directory and grepping for Firewall I got this:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-Bash" data-lang="Bash">&lt;span class="line">&lt;span class="cl">jnxFirewallsTable OBJECT-TYPE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SYNTAX SEQUENCE OF JnxFirewallsEntry
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> MAX-ACCESS not-accessible
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> STATUS deprecated
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> DESCRIPTION
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;A list of firewalls entries.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> NOTE: This table is deprecated and exists for backward
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> compatibility. The user is encouraged to use
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> jnxFirewallCounterTable. This table does not handle:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> 1) counter and filter names greater than 24 characters
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> 2) counters with same names but different types (the first
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> duplicate is returned only)&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ::&lt;span class="o">=&lt;/span> &lt;span class="o">{&lt;/span> jnxFirewalls &lt;span class="m">1&lt;/span> &lt;span class="o">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>So the interesting OID to be polled is the &lt;code>jnxFirewallCounterTable&lt;/code> at &lt;strong>1.3.6.1.4.1.2636.3.5.2&lt;/strong>. Let’s use snmptable to see what we get:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-Bash" data-lang="Bash">&lt;span class="line">&lt;span class="cl">$ snmptable -v2c -c kentik -m all 10.11.255.1 jnxFirewallCounterTable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SNMP table: JUNIPER-FIREWALL-MIB::jnxFirewallCounterTable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> jnxFWCounterPacketCount jnxFWCounterByteCount jnxFWCounterDisplayFilterName jnxFWCounterDisplayName jnxFWCounterDisplayType
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1118&lt;/span> &lt;span class="m">72508&lt;/span> TEST-FIREWALL SSH-PACKETS counter
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">0&lt;/span> &lt;span class="m">0&lt;/span> __default_arp_policer__ __default_arp_policer__ policer
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">30&lt;/span> &lt;span class="m">41496&lt;/span> __flowspec_default_inet__ 10.11.10.10,*,icmp-type&lt;span class="o">=&lt;/span>&lt;span class="m">8&lt;/span> counter
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">184&lt;/span> &lt;span class="m">172233&lt;/span> __flowspec_default_inet__ 10.11.10.10,*,proto&lt;span class="o">=&lt;/span>6,dstport&lt;span class="o">=&lt;/span>&lt;span class="m">5201&lt;/span> counter
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">268&lt;/span> &lt;span class="m">402000&lt;/span> __flowspec_default_inet__ 40K_10.11.10.10,*,proto&lt;span class="o">=&lt;/span>6,dstport&lt;span class="o">=&lt;/span>&lt;span class="m">5201&lt;/span> policer&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 class="heading-element" id="local-configuration">&lt;span>Local Configuration&lt;/span>
 &lt;a href="#local-configuration" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h4>&lt;p>From this point onward we can define our custom metrics in the relevant &lt;em>overrides&lt;/em> sub-directories&lt;/p>
&lt;p style="background-color:skyblue;text-align:center">&lt;b>Sources file&lt;/b>&lt;/p>
&lt;p>We are going to poll the table every 1 minute.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-YAML" data-lang="YAML">&lt;span class="line">&lt;span class="cl">&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">version&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">junos-fw-snmp&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">  &lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">sources&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">sources&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">  &lt;/span>&lt;span class="nt">junos-fw-snmp&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>!&lt;span class="l">snmp&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">    &lt;/span>&lt;span class="nt">table&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">1.3.6.1.4.1.2636.3.5.2&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">    &lt;/span>&lt;span class="nt">interval&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">60s&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p style="background-color:skyblue;text-align:center">&lt;b>Profiles file&lt;/b>&lt;/p>
&lt;p>We will bind the source to the vMX sysObjectId&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-YAML" data-lang="YAML">&lt;span class="line">&lt;span class="cl">&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">version&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">junos-fw-snmp&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">profile&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">profile&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">match&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">sysobjectid&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="m">1.3.6.1.4.1.2636.1.1.1.2.108&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">reports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">junos-fw-snmp&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">include&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">device_name_ip&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">sources&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">junos-fw-snmp&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p style="background-color:skyblue;text-align:center">&lt;b>Reports file&lt;/b>&lt;/p>
&lt;p>We are going to report those under the &lt;code>/junos/firewall/snmp&lt;/code> schema path in the Portal and we define the mapping on the table fields identifying the metrics:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-YAML" data-lang="YAML">&lt;span class="line">&lt;span class="cl">&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">version&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">junos-fw-snmp&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">reports&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">reports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">/junos/firewall/snmp&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">combine&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">table0&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>!&lt;span class="l">snmp&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">table&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">1.3.6.1.4.1.2636.3.5.2&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">index&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">$index0&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">fields&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">packets&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>!&lt;span class="l">snmp&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">table&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">1.3.6.1.4.1.2636.3.5.2&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">value&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">1.3.6.1.4.1.2636.3.5.2.1.4&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">metric&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">bytes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>!&lt;span class="l">snmp&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">table&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">1.3.6.1.4.1.2636.3.5.2&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">value&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">1.3.6.1.4.1.2636.3.5.2.1.5&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">metric&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">filter_name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>!&lt;span class="l">snmp&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">table&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">1.3.6.1.4.1.2636.3.5.2&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">value&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">1.3.6.1.4.1.2636.3.5.2.1.6&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">metric&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">counter_name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>!&lt;span class="l">snmp&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">table&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">1.3.6.1.4.1.2636.3.5.2&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">value&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">1.3.6.1.4.1.2636.3.5.2.1.7&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">metric&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">counter_type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>!&lt;span class="l">snmp&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">table&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">1.3.6.1.4.1.2636.3.5.2&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">value&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">1.3.6.1.4.1.2636.3.5.2.1.8&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">metric&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">tweak&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>!&lt;span class="l">enum&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">1&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">other&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">2&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">counter&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">3&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">policer&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">interval&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">60s&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Here is how our &lt;em>overrides&lt;/em> directory structure looks like:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-Bash" data-lang="Bash">&lt;span class="line">&lt;span class="cl">override-data/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└── config
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ├── profiles
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> │   ├── junos-fw-snmp.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ├── reports
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> │   ├── junos-fw-snmp.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> └── sources
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> └── junos-fw-snmp.yml&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>I&amp;rsquo;ve used the same file name for these but it could be anything. Resources are referenced via the metadata name key and not by the filename.&lt;/p>
&lt;h4 class="heading-element" id="kagent-bring-up">&lt;span>Kagent Bring Up&lt;/span>
 &lt;a href="#kagent-bring-up" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h4>&lt;p>Next step is to bring up the container and see what we get, but it seems there is an error:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-JSON" data-lang="JSON">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>&lt;span class="nt">&amp;#34;level&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;error&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nt">&amp;#34;error&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;OID 1.3.6.1.4.1.2636.3.5.2 in table source jnxFirewallCounterTable 
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> loaded from config/sources/snmp/juniper.yml also appears in table source junos-fw-snmp 
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> loaded from sources/junos-fw-snmp.yml&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nt">&amp;#34;time&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;2024-05-03T16:51:41Z&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nt">&amp;#34;message&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;invalid config&amp;#34;&lt;/span>&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>This means that kagent is already configured to poll this OID from the file mentioned.
&lt;div class="details admonition note open">
 &lt;div class="details-summary admonition-title">&lt;i class="icon fa-fw fa-solid fa-pencil-alt" aria-hidden="true">&lt;/i>Kagent Default Config&lt;i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true">&lt;/i>&lt;/div>
 &lt;div class="details-content">
 &lt;div class="admonition-content">Kagent is pulling its &lt;em>default configuration&lt;/em> each time is brought up and this is in the &lt;code>/opt/kentik/components/ranger/current/LATEST.zip&lt;/code> file&lt;/div>
 &lt;/div>
&lt;/div>
So after unziping the file and looking into the file mentioned we see that the definition is there and the table is polled every five minutes:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-Bash" data-lang="Bash">&lt;span class="line">&lt;span class="cl">$ cat config/sources/snmp/juniper.yml &lt;span class="p">|&lt;/span> grep FirewallCounter -A3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> jnxFirewallCounterTable: !snmp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> table: 1.3.6.1.4.1.2636.3.5.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> interval: 5m&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>In this case, since we can have reports and profiles referring to existing sources in the &lt;code>LATEST.zip&lt;/code> file we are going to remove the sources definition file and remove the reference in the profiles. Furthermore, we are going to adjust the interval in the profile definition since there is no reason to report more frequently than we gather the data at this point.&lt;/p>
&lt;p>Upon restarting kagent, the &lt;em>overrides&lt;/em> directory is picked up with no errors:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-JSON" data-lang="JSON">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>&lt;span class="nt">&amp;#34;level&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;info&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nt">&amp;#34;path&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;../local/config&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nt">&amp;#34;time&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;2024-05-03T17:12:58Z&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;message&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;optional/override config directory exists, using&amp;#34;&lt;/span>&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 class="heading-element" id="kentik-portal">&lt;span>Kentik Portal&lt;/span>
 &lt;a href="#kentik-portal" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h4>&lt;p>In the portal, the metrics are available under the configured path:&lt;/p>
&lt;figure>&lt;a class="lightgallery" href="https://net4fungr.github.io/posts/kustom-metrics/img_001.png" title="/posts/kustom-metrics/img_001.png" data-thumbnail="/posts/kustom-metrics/img_001.png" data-sub-html="&lt;h2>SCHEMA path&lt;/h2>">&lt;img loading="lazy" src='https://net4fungr.github.io/posts/kustom-metrics/img_001.png' alt="/posts/kustom-metrics/img_001.png" height="1098" width="400">&lt;/a>&lt;figcaption class="image-caption">SCHEMA path&lt;/figcaption>
 &lt;/figure>
&lt;p>The table is populating:
&lt;figure>&lt;a class="lightgallery" href="https://net4fungr.github.io/posts/kustom-metrics/img_002.png" title="/posts/kustom-metrics/img_002.png" data-thumbnail="/posts/kustom-metrics/img_002.png" data-sub-html="&lt;h2>Junos Metrics Table&lt;/h2>">&lt;img loading="lazy" src='https://net4fungr.github.io/posts/kustom-metrics/img_002.png' alt="/posts/kustom-metrics/img_002.png" height="311" width="2000">&lt;/a>&lt;figcaption class="image-caption">Junos Metrics Table&lt;/figcaption>
 &lt;/figure>&lt;/p>
&lt;p>After a while the chart started graphing as well
&lt;figure>&lt;a class="lightgallery" href="https://net4fungr.github.io/posts/kustom-metrics/img_003.png" title="/posts/kustom-metrics/img_003.png" data-thumbnail="/posts/kustom-metrics/img_003.png" data-sub-html="&lt;h2>Junos Metrics Chart&lt;/h2>">&lt;img loading="lazy" src='https://net4fungr.github.io/posts/kustom-metrics/img_003.png' alt="/posts/kustom-metrics/img_003.png" height="711" width="2000">&lt;/a>&lt;figcaption class="image-caption">Junos Metrics Chart&lt;/figcaption>
 &lt;/figure>&lt;/p>
&lt;h3 class="heading-element" id="grpc">&lt;span>GRPC&lt;/span>
 &lt;a href="#grpc" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h3>&lt;p>Let’s try now to get the same via streaming telemetry and GRPC. According to &lt;a href="https://www.juniper.net/documentation/us/en/software/junos/interfaces-telemetry/topics/concept/junos-telemetry-interface-grpc-sensors.html"target="_blank" rel="external nofollow noopener noreferrer">this&lt;/a> we can get those metrics under the &lt;code>/junos/system/linecard/firewall&lt;/code> path.&lt;/p>
&lt;p>Using gnmic (I could only get data via subscriptions and not get rpc calls):&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-JSON" data-lang="JSON">&lt;span class="line">&lt;span class="cl">&lt;span class="err">$&lt;/span> &lt;span class="err">gnmic&lt;/span> &lt;span class="err">-a&lt;/span> &lt;span class="mf">10.11&lt;/span>&lt;span class="err">.&lt;/span>&lt;span class="mf">255.1&lt;/span>&lt;span class="err">:&lt;/span>&lt;span class="mi">32767&lt;/span> &lt;span class="err">-u&lt;/span> &lt;span class="err">&amp;lt;username&amp;gt;-p&lt;/span> &lt;span class="err">&amp;lt;password&amp;gt;&lt;/span> &lt;span class="err">--skip-verify&lt;/span> &lt;span class="err">sub&lt;/span> &lt;span class="err">--mode&lt;/span> &lt;span class="err">once&lt;/span> &lt;span class="err">--path&lt;/span> &lt;span class="err">/junos/system/linecard/firewall&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;source&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;10.11.255.1:32767&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;subscription-name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;default-1714758367&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;timestamp&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1714758371632000000&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;time&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2024-05-03T20:46:11.632+03:00&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;prefix&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;junos/firewall[name=__default_bpdu_filter__]/state&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;updates&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Path&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;timestamp&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;values&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;timestamp&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1714746658&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Path&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;memory-usage[name=HEAP]/allocated&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;values&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;memory-usage/allocated&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">2596&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;source&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;10.11.255.1:32767&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;subscription-name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;default-1714758367&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;timestamp&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1714758371632000000&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;time&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2024-05-03T20:46:11.632+03:00&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;prefix&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;junos/firewall[name=TEST-FIREWALL]/state&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;updates&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Path&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;timestamp&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;values&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;timestamp&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1714746658&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Path&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;memory-usage[name=HEAP]/allocated&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;values&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;memory-usage/allocated&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">4004&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Path&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;counter[name=SSH-PACKETS]/packets&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;values&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;counter/packets&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1162&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Path&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;counter[name=SSH-PACKETS]/bytes&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;values&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;counter/bytes&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">75400&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;source&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;10.11.255.1:32767&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;subscription-name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;default-1714758367&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;timestamp&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1714758371632000000&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;time&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2024-05-03T20:46:11.632+03:00&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;prefix&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;junos/firewall[name=__default_arp_policer__]/state&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;updates&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Path&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;timestamp&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;values&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;timestamp&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1714403887&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Path&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;memory-usage[name=HEAP]/allocated&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;values&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;memory-usage/allocated&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1652&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Path&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;policer[name=__default_arp_policer__]/out-of-spec-packets&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;values&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;policer/out-of-spec-packets&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Path&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;policer[name=__default_arp_policer__]/out-of-spec-bytes&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;values&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;policer/out-of-spec-bytes&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Path&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;policer[name=__default_arp_policer__]/offered-packets&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;values&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;policer/offered-packets&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Path&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;policer[name=__default_arp_policer__]/offered-bytes&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;values&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;policer/offered-bytes&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Path&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;policer[name=__default_arp_policer__]/transmitted-packets&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;values&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;policer/transmitted-packets&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Path&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;policer[name=__default_arp_policer__]/transmitted-bytes&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;values&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;policer/transmitted-bytes&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;source&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;10.11.255.1:32767&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;subscription-name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;default-1714758367&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;timestamp&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1714758371632000000&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;time&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2024-05-03T20:46:11.632+03:00&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;prefix&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;junos/firewall[name=__flowspec_default_inet__]/state&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;updates&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Path&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;timestamp&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;values&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;timestamp&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1714753321&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Path&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;memory-usage[name=HEAP]/allocated&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;values&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;memory-usage/allocated&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">7172&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Path&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;counter[name=10.11.10.10,*,icmp-type=8]/packets&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;values&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;counter/packets&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1315&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Path&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;counter[name=10.11.10.10,*,icmp-type=8]/bytes&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;values&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;counter/bytes&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1876476&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Path&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;counter[name=10.11.10.10,*,proto=6,dstport=5201]/packets&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;values&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;counter/packets&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">3311&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Path&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;counter[name=10.11.10.10,*,proto=6,dstport=5201]/bytes&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;values&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;counter/bytes&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">4738920&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Path&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;policer[name=40K_10.11.10.10,*,proto=6,dstport=5201]/out-of-spec-packets&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;values&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;policer/out-of-spec-packets&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">6891&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Path&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;policer[name=40K_10.11.10.10,*,proto=6,dstport=5201]/out-of-spec-bytes&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;values&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;policer/out-of-spec-bytes&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">10336500&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Path&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;policer[name=40K_10.11.10.10,*,proto=6,dstport=5201]/offered-packets&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;values&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;policer/offered-packets&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Path&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;policer[name=40K_10.11.10.10,*,proto=6,dstport=5201]/offered-bytes&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;values&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;policer/offered-bytes&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Path&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;policer[name=40K_10.11.10.10,*,proto=6,dstport=5201]/transmitted-packets&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;values&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;policer/transmitted-packets&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Path&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;policer[name=40K_10.11.10.10,*,proto=6,dstport=5201]/transmitted-bytes&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;values&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;policer/transmitted-bytes&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;source&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;10.11.255.1:32767&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;subscription-name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;default-1714758367&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;timestamp&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1714758371633000000&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;time&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2024-05-03T20:46:11.633+03:00&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;prefix&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;junos/firewall[name=__default_bpdu_filter__]/state&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;updates&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Path&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;timestamp&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;values&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;timestamp&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1714746658&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Path&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;memory-usage[name=HEAP]/allocated&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;values&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;memory-usage/allocated&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">2596&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;source&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;10.11.255.1:32767&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;subscription-name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;default-1714758367&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;timestamp&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1714758371633000000&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;time&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2024-05-03T20:46:11.633+03:00&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;prefix&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;junos/firewall[name=TEST-FIREWALL]/state&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;updates&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Path&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;timestamp&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;values&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;timestamp&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1714746658&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Path&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;memory-usage[name=HEAP]/allocated&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;values&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;memory-usage/allocated&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">4004&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Path&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;counter[name=SSH-PACKETS]/packets&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;values&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;counter/packets&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1162&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Path&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;counter[name=SSH-PACKETS]/bytes&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;values&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;counter/bytes&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">75400&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;source&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;10.11.255.1:32767&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;subscription-name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;default-1714758367&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;timestamp&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1714758371633000000&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;time&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2024-05-03T20:46:11.633+03:00&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;prefix&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;junos/firewall[name=__default_arp_policer__]/state&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;updates&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Path&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;timestamp&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;values&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;timestamp&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1714403887&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Path&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;memory-usage[name=HEAP]/allocated&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;values&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;memory-usage/allocated&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1652&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;source&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;10.11.255.1:32767&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;subscription-name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;default-1714758367&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;timestamp&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1714758371633000000&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;time&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2024-05-03T20:46:11.633+03:00&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;prefix&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;junos/firewall[name=__flowspec_default_inet__]/state&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;updates&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Path&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;timestamp&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;values&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;timestamp&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1714753321&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Path&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;memory-usage[name=HEAP]/allocated&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;values&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;memory-usage/allocated&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">7172&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Path&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;counter[name=10.11.10.10,*,icmp-type=8]/packets&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;values&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;counter/packets&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1315&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Path&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;counter[name=10.11.10.10,*,icmp-type=8]/bytes&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;values&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;counter/bytes&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1876476&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Path&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;counter[name=10.11.10.10,*,proto=6,dstport=5201]/packets&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;values&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;counter/packets&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">3311&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Path&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;counter[name=10.11.10.10,*,proto=6,dstport=5201]/bytes&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;values&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;counter/bytes&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">4738920&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Path&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;policer[name=40K_10.11.10.10,*,proto=6,dstport=5201]/out-of-spec-packets&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;values&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;policer/out-of-spec-packets&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">6891&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Path&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;policer[name=40K_10.11.10.10,*,proto=6,dstport=5201]/out-of-spec-bytes&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;values&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;policer/out-of-spec-bytes&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">10336500&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Let&amp;rsquo;s briefly look at the paths returned to better understand what we are getting via this subscription:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-YAML" data-lang="YAML">&lt;span class="line">&lt;span class="cl">&lt;span class="l">$ gnmic -a 10.11.255.1:32767 -u &amp;lt;username&amp;gt; -p &amp;lt;password&amp;gt; --skip-verify sub --mode once --path /junos/system/linecard/firewall | grep -e prefix -e Path&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">&amp;#34;prefix&amp;#34;: &lt;/span>&lt;span class="s2">&amp;#34;junos/firewall[name=__default_bpdu_filter__]/state&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">&amp;#34;Path&amp;#34;: &lt;/span>&lt;span class="s2">&amp;#34;timestamp&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">&amp;#34;Path&amp;#34;: &lt;/span>&lt;span class="s2">&amp;#34;memory-usage[name=HEAP]/allocated&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">&amp;#34;prefix&amp;#34;: &lt;/span>&lt;span class="s2">&amp;#34;junos/firewall[name=TEST-FIREWALL]/state&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">&amp;#34;Path&amp;#34;: &lt;/span>&lt;span class="s2">&amp;#34;timestamp&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">&amp;#34;Path&amp;#34;: &lt;/span>&lt;span class="s2">&amp;#34;memory-usage[name=HEAP]/allocated&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">&amp;#34;Path&amp;#34;: &lt;/span>&lt;span class="s2">&amp;#34;counter[name=SSH-PACKETS]/packets&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">&amp;#34;Path&amp;#34;: &lt;/span>&lt;span class="s2">&amp;#34;counter[name=SSH-PACKETS]/bytes&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">&amp;#34;prefix&amp;#34;: &lt;/span>&lt;span class="s2">&amp;#34;junos/firewall[name=__default_arp_policer__]/state&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">&amp;#34;Path&amp;#34;: &lt;/span>&lt;span class="s2">&amp;#34;timestamp&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">&amp;#34;Path&amp;#34;: &lt;/span>&lt;span class="s2">&amp;#34;memory-usage[name=HEAP]/allocated&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">&amp;#34;Path&amp;#34;: &lt;/span>&lt;span class="s2">&amp;#34;policer[name=__default_arp_policer__]/out-of-spec-packets&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">&amp;#34;Path&amp;#34;: &lt;/span>&lt;span class="s2">&amp;#34;policer[name=__default_arp_policer__]/out-of-spec-bytes&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">&amp;#34;Path&amp;#34;: &lt;/span>&lt;span class="s2">&amp;#34;policer[name=__default_arp_policer__]/offered-packets&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">&amp;#34;Path&amp;#34;: &lt;/span>&lt;span class="s2">&amp;#34;policer[name=__default_arp_policer__]/offered-bytes&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">&amp;#34;Path&amp;#34;: &lt;/span>&lt;span class="s2">&amp;#34;policer[name=__default_arp_policer__]/transmitted-packets&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">&amp;#34;Path&amp;#34;: &lt;/span>&lt;span class="s2">&amp;#34;policer[name=__default_arp_policer__]/transmitted-bytes&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">&amp;#34;prefix&amp;#34;: &lt;/span>&lt;span class="s2">&amp;#34;junos/firewall[name=__flowspec_default_inet__]/state&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">&amp;#34;Path&amp;#34;: &lt;/span>&lt;span class="s2">&amp;#34;timestamp&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">&amp;#34;Path&amp;#34;: &lt;/span>&lt;span class="s2">&amp;#34;memory-usage[name=HEAP]/allocated&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">&amp;#34;Path&amp;#34;: &lt;/span>&lt;span class="s2">&amp;#34;counter[name=10.11.10.10,*,icmp-type=8]/packets&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">&amp;#34;Path&amp;#34;: &lt;/span>&lt;span class="s2">&amp;#34;counter[name=10.11.10.10,*,icmp-type=8]/bytes&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">&amp;#34;Path&amp;#34;: &lt;/span>&lt;span class="s2">&amp;#34;counter[name=10.11.10.10,*,proto=6,dstport=5201]/packets&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">&amp;#34;Path&amp;#34;: &lt;/span>&lt;span class="s2">&amp;#34;counter[name=10.11.10.10,*,proto=6,dstport=5201]/bytes&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">&amp;#34;Path&amp;#34;: &lt;/span>&lt;span class="s2">&amp;#34;policer[name=40K_10.11.10.10,*,proto=6,dstport=5201]/out-of-spec-packets&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">&amp;#34;Path&amp;#34;: &lt;/span>&lt;span class="s2">&amp;#34;policer[name=40K_10.11.10.10,*,proto=6,dstport=5201]/out-of-spec-bytes&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">&amp;#34;Path&amp;#34;: &lt;/span>&lt;span class="s2">&amp;#34;policer[name=40K_10.11.10.10,*,proto=6,dstport=5201]/offered-packets&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">&amp;#34;Path&amp;#34;: &lt;/span>&lt;span class="s2">&amp;#34;policer[name=40K_10.11.10.10,*,proto=6,dstport=5201]/offered-bytes&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">&amp;#34;Path&amp;#34;: &lt;/span>&lt;span class="s2">&amp;#34;policer[name=40K_10.11.10.10,*,proto=6,dstport=5201]/transmitted-packets&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">&amp;#34;Path&amp;#34;: &lt;/span>&lt;span class="s2">&amp;#34;policer[name=40K_10.11.10.10,*,proto=6,dstport=5201]/transmitted-bytes&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">&amp;#34;prefix&amp;#34;: &lt;/span>&lt;span class="s2">&amp;#34;junos/firewall[name=__default_bpdu_filter__]/state&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">&amp;#34;Path&amp;#34;: &lt;/span>&lt;span class="s2">&amp;#34;timestamp&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">&amp;#34;Path&amp;#34;: &lt;/span>&lt;span class="s2">&amp;#34;memory-usage[name=HEAP]/allocated&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">&amp;#34;prefix&amp;#34;: &lt;/span>&lt;span class="s2">&amp;#34;junos/firewall[name=TEST-FIREWALL]/state&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">&amp;#34;Path&amp;#34;: &lt;/span>&lt;span class="s2">&amp;#34;timestamp&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">&amp;#34;Path&amp;#34;: &lt;/span>&lt;span class="s2">&amp;#34;memory-usage[name=HEAP]/allocated&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">&amp;#34;Path&amp;#34;: &lt;/span>&lt;span class="s2">&amp;#34;counter[name=SSH-PACKETS]/packets&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">&amp;#34;Path&amp;#34;: &lt;/span>&lt;span class="s2">&amp;#34;counter[name=SSH-PACKETS]/bytes&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">&amp;#34;prefix&amp;#34;: &lt;/span>&lt;span class="s2">&amp;#34;junos/firewall[name=__default_arp_policer__]/state&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">&amp;#34;Path&amp;#34;: &lt;/span>&lt;span class="s2">&amp;#34;timestamp&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">&amp;#34;Path&amp;#34;: &lt;/span>&lt;span class="s2">&amp;#34;memory-usage[name=HEAP]/allocated&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">&amp;#34;prefix&amp;#34;: &lt;/span>&lt;span class="s2">&amp;#34;junos/firewall[name=__flowspec_default_inet__]/state&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">&amp;#34;Path&amp;#34;: &lt;/span>&lt;span class="s2">&amp;#34;timestamp&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">&amp;#34;Path&amp;#34;: &lt;/span>&lt;span class="s2">&amp;#34;memory-usage[name=HEAP]/allocated&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">&amp;#34;Path&amp;#34;: &lt;/span>&lt;span class="s2">&amp;#34;counter[name=10.11.10.10,*,icmp-type=8]/packets&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">&amp;#34;Path&amp;#34;: &lt;/span>&lt;span class="s2">&amp;#34;counter[name=10.11.10.10,*,icmp-type=8]/bytes&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">&amp;#34;Path&amp;#34;: &lt;/span>&lt;span class="s2">&amp;#34;counter[name=10.11.10.10,*,proto=6,dstport=5201]/packets&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">&amp;#34;Path&amp;#34;: &lt;/span>&lt;span class="s2">&amp;#34;counter[name=10.11.10.10,*,proto=6,dstport=5201]/bytes&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">&amp;#34;Path&amp;#34;: &lt;/span>&lt;span class="s2">&amp;#34;policer[name=40K_10.11.10.10,*,proto=6,dstport=5201]/out-of-spec-packets&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">&amp;#34;Path&amp;#34;: &lt;/span>&lt;span class="s2">&amp;#34;policer[name=40K_10.11.10.10,*,proto=6,dstport=5201]/out-of-spec-bytes&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>It looks like we are getting the allocated memory per filter and the relevant metrics according to if the filter is a counter or policer. Let&amp;rsquo;s create the relevant local overrides files. In the reports file we need extra processing on the data returned from the subscription before it is stored in the database and this is done via the use of starlark scripts.&lt;/p>
&lt;h4 class="heading-element" id="local-configuration-take-1">&lt;span>Local Configuration (take 1)&lt;/span>
 &lt;a href="#local-configuration-take-1" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h4>&lt;p style="background-color:skyblue;text-align:center">&lt;b>Sources file&lt;/b>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-YAML" data-lang="YAML">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">version&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">junos-fw-grpc&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">sources&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">sources&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">junos-fw-grpc&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>!&lt;span class="l">gnmi&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">path&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/junos/system/linecard/firewall/&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">mode&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">SAMPLE&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">extra&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">sample_interval&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">30s&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p style="background-color:skyblue;text-align:center">&lt;b>Profiles file&lt;/b>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-YAML" data-lang="YAML">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">version&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">junos-fw-grpc&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">profile&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">profile&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">match&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">sysobjectid&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="m">1.3.6.1.4.1.2636.1.1.1.2.108&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">features&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">gnmi&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">reports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">junos-fw-grpc&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">include&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">device_name_ip&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">sources&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">junos-fw-grpc&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p style="background-color:skyblue;text-align:center">&lt;b>Reports file&lt;/b>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-YAML" data-lang="YAML">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">version&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">junos-fw-grpc&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">reports&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">reports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">/junos/firewall/grpc&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>!&lt;span class="l">external&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">starlark&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">file&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">junos-fw-grpc.star&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">interval&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">30s&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>The starlark script acts as a pre-processor to the data before forming it to influx line protocol and ingesting it in the database. So we have options to manipulate the data according to the use case.&lt;/p>
&lt;p>From the rpc we see that all information is returned under the &lt;code>/junos/firewall/&lt;/code> path so lets see what we get from this. We are going to use the log method to output the dictionary we receive from gnmi in the container logs using a basic starlark script:&lt;/p>
&lt;p style="background-color:skyblue;text-align:center">&lt;b>Basic Starlark Script&lt;/b>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">load&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;ranger&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;source&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">load&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;ranger&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;metric&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">load&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;ranger&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;device&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">load&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;ranger&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;log&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">execute&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">report&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="n">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;###### STARTING STRALARK #######&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="n">data&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">source&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">select&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;junos/firewall&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="n">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">    &lt;span class="n">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;###### STRALARK FINISHED #######&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Here is how our overrides directory look like:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-Bash" data-lang="Bash">&lt;span class="line">&lt;span class="cl">override-data/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└── config
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ├── profiles
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> │   ├── junos-fw-grpc.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> │   └── junos-fw-snmp.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ├── reports
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> │   ├── junos-fw-grpc.star
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> │   ├── junos-fw-grpc.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> │   └── junos-fw-snmp.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> └── sources
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> └── junos-fw-grpc.yml&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>And here is what is returned from starlark when we dump it as a dictionary:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-JSON" data-lang="JSON">&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;state&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;timestamp&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1714746658&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;memory-usage&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;allocated&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">2596&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;HEAP&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;__default_bpdu_filter__&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;state&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;timestamp&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1714746658&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;memory-usage&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;allocated&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">4004&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;HEAP&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;counter&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;packets&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1341&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;bytes&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">88064&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;SSH-PACKETS&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;TEST-FIREWALL&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;state&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;policer&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;out-of-spec-packets&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;out-of-spec-bytes&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;offered-packets&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;offered-bytes&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;transmitted-packets&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;transmitted-bytes&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;__default_arp_policer__&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;timestamp&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1714403887&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;memory-usage&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;allocated&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1652&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;HEAP&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;__default_arp_policer__&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;state&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;timestamp&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1714753321&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;memory-usage&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;allocated&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">7172&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;HEAP&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;counter&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;packets&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">36574&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;bytes&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">52226328&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;10.11.10.10,*,icmp-type=8&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;packets&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">6336&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;bytes&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">9216704&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;10.11.10.10,*,proto=6,dstport=5201&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;policer&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;out-of-spec-packets&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">13378&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;out-of-spec-bytes&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">20067000&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;offered-packets&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;offered-bytes&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;transmitted-packets&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;transmitted-bytes&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;40K_10.11.10.10,*,proto=6,dstport=5201&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;__flowspec_default_inet__&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">]&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>So we got a list of dictionaries. One dictionary per firewall filter containing the allocated memory and the counter or policer names and metrics. Now since the counter metrics are different from the policer one&amp;rsquo;s, it seems wise to report them in different paths on the portal schema. For example:&lt;/p>
&lt;ul>
&lt;li>&lt;code>/junos/firewall/filter/memory/&lt;/code> → will hold the allocated memory for each filter&lt;/li>
&lt;li>&lt;code>/junos/firewall/filter/counters/&lt;/code> → will hold the counter metrics&lt;/li>
&lt;li>&lt;code>/junos/firewall/filter/policers/&lt;/code> → will hold the policer metrics&lt;/li>
&lt;/ul>
&lt;h4 class="heading-element" id="local-configuration-take-2">&lt;span>Local Configuration (take 2)&lt;/span>
 &lt;a href="#local-configuration-take-2" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h4>&lt;p style="background-color:skyblue;text-align:center">&lt;b>Reports - different paths&lt;/b>&lt;/p>
In order to achieve this we are going to adjust our reports file to specify those three different configs, paths and scripts.
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-YAML" data-lang="YAML">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">version&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">junos-fw-grpc&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">reports&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">reports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">/junos/firewall/filter/memory&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>!&lt;span class="l">external&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">starlark&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">file&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">junos-fw-grpc-memory.star&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">interval&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">30s&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">/junos/firewall/filter/counters&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>!&lt;span class="l">external&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">starlark&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">file&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">junos-fw-grpc-counters.star&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">interval&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">30s&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">/junos/firewall/filter/policers&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>!&lt;span class="l">external&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">starlark&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">file&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">junos-fw-grpc-policers.star&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">interval&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">30s&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p style="background-color:skyblue;text-align:center">&lt;b>Starlark - Memory&lt;/b>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">load&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;ranger&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;source&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">load&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;ranger&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;metric&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">load&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;ranger&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;device&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">load&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;ranger&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;log&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">execute&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">report&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;###### STLRK - MEMORY START #######&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">data&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">source&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">select&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;junos/firewall&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">data&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># iterate over non empty dicts in the list&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">memory&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="n">_&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;name&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">_&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;state&amp;#39;&lt;/span>&lt;span class="p">][&lt;/span>&lt;span class="s1">&amp;#39;memory-usage&amp;#39;&lt;/span>&lt;span class="p">][&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">][&lt;/span>&lt;span class="s1">&amp;#39;allocated&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">_&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">data&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="n">_&lt;/span>&lt;span class="p">]:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">record&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">report&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">record&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;filter_name&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">record&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;allocated_memory&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">memory&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">metric&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">record&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;device_name&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">device&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">record&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;device_ip&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">device&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">host&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;###### STLRK - MEMORY END #######&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;###### STLRK - MEMORY *** EMPTY **** #######&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p style="background-color:skyblue;text-align:center">&lt;b>Starlark - Counters&lt;/b>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">load&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;ranger&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;source&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">load&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;ranger&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;metric&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">load&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;ranger&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;device&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">load&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;ranger&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;log&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">execute&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">report&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;###### STLRK - COUNTERS START #######&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">data&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">source&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">select&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;junos/firewall&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">data&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># iterate over non empty dicts that have counter key&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">fname&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">state&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="n">_&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;name&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">_&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;state&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">_&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">data&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="n">_&lt;/span> &lt;span class="ow">and&lt;/span> &lt;span class="n">_&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;state&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;counter&amp;#39;&lt;/span>&lt;span class="p">)]&lt;/span> &lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">cname&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">packets&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nb">bytes&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="n">_&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;name&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">_&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;packets&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">_&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;bytes&amp;#39;&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">_&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">state&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;counter&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="p">]:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">record&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">report&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">record&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;filter_name&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">fname&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">record&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;counter_name&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">cname&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">record&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;packets&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">packets&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">metric&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">record&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;bytes&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nb">bytes&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">metric&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">record&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;device_name&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">device&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">record&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;device_ip&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">device&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">host&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;###### STLRK - COUNTERS END #######&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;###### STLRK - COUNTERS *** EMPTY **** #######&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p style="background-color:skyblue;text-align:center">&lt;b>Starlark - Policers&lt;/b>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">load&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;ranger&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;source&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">load&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;ranger&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;metric&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">load&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;ranger&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;device&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">load&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;ranger&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;log&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">metrics&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;offered-bytes&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;offered-packets&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;out-of-spec-bytes&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;out-of-spec-packets&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;transmitted-bytes&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;transmitted-packets&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">execute&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">report&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;###### STLRK - POLICER START #######&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">data&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">source&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">select&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;junos/firewall&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">data&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># iterate over non empty dicts that have policer key&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">fname&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">state&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="n">_&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;name&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">_&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;state&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">_&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">data&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="n">_&lt;/span> &lt;span class="ow">and&lt;/span> &lt;span class="n">_&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;state&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;policer&amp;#39;&lt;/span>&lt;span class="p">)]:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">policer&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">state&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;policer&amp;#39;&lt;/span>&lt;span class="p">]:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">record&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">report&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">record&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;filter_name&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">fname&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">record&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;policer_name&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">policer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">pop&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;name&amp;#39;&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># Get metrics defined statically above&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">key&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">metrics&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">record&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">policer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">,&lt;/span> &lt;span class="n">metric&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">record&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;device_name&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">device&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">record&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;device_ip&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">device&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">host&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;###### STLRK - POLICER END #######&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;###### STLRK - POLICER *** EMPTY **** #######&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>And this is our &lt;em>overrides&lt;/em> structure now:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-Bash" data-lang="Bash">&lt;span class="line">&lt;span class="cl">override-data/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└── config
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ├── profiles
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> │   ├── junos-fw-grpc.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> │   └── junos-fw-snmp.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ├── reports
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> │   ├── junos-fw-grpc-counters.star
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> │   ├── junos-fw-grpc-memory.star
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> │   ├── junos-fw-grpc-policers.star
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> │   ├── junos-fw-grpc.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> │   └── junos-fw-snmp.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> └── sources
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> └── junos-fw-grpc.yml&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 class="heading-element" id="kentik-portal-1">&lt;span>Kentik Portal&lt;/span>
 &lt;a href="#kentik-portal-1" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h4>&lt;p>After restarting kagent, we look at the Portal for the results in the three different paths.&lt;/p>
&lt;p>Here are the &lt;strong>Memory&lt;/strong> metrics for our fitlers:
&lt;figure>&lt;a class="lightgallery" href="https://net4fungr.github.io/posts/kustom-metrics/img_004.png" title="/posts/kustom-metrics/img_004.png" data-thumbnail="/posts/kustom-metrics/img_004.png" data-sub-html="&lt;h2>GRPC Memory metrics&lt;/h2>">&lt;img loading="lazy" src='https://net4fungr.github.io/posts/kustom-metrics/img_004.png' alt="/posts/kustom-metrics/img_004.png" height="653" width="2000">&lt;/a>&lt;figcaption class="image-caption">GRPC Memory metrics&lt;/figcaption>
 &lt;/figure>&lt;/p>
&lt;p>The &lt;strong>Counter&lt;/strong> metrics:
&lt;figure>&lt;a class="lightgallery" href="https://net4fungr.github.io/posts/kustom-metrics/img_005.png" title="/posts/kustom-metrics/img_005.png" data-thumbnail="/posts/kustom-metrics/img_005.png" data-sub-html="&lt;h2>GRPC Counter metrics&lt;/h2>">&lt;img loading="lazy" src='https://net4fungr.github.io/posts/kustom-metrics/img_005.png' alt="/posts/kustom-metrics/img_005.png" height="610" width="2000">&lt;/a>&lt;figcaption class="image-caption">GRPC Counter metrics&lt;/figcaption>
 &lt;/figure>&lt;/p>
&lt;p>And the &lt;strong>Policer&lt;/strong> one&amp;rsquo;s:
&lt;figure>&lt;a class="lightgallery" href="https://net4fungr.github.io/posts/kustom-metrics/img_006.png" title="/posts/kustom-metrics/img_006.png" data-thumbnail="/posts/kustom-metrics/img_006.png" data-sub-html="&lt;h2>GRPC Policer metrics&lt;/h2>">&lt;img loading="lazy" src='https://net4fungr.github.io/posts/kustom-metrics/img_006.png' alt="/posts/kustom-metrics/img_006.png" height="555" width="2000">&lt;/a>&lt;figcaption class="image-caption">GRPC Policer metrics&lt;/figcaption>
 &lt;/figure>&lt;/p>
&lt;hr>
&lt;h2 class="heading-element" id="ios-xr-flowspec">&lt;span>IOS-XR Flowspec&lt;/span>
 &lt;a href="#ios-xr-flowspec" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h2>&lt;p>Let&amp;rsquo;s do the same now for the XRs. Since there is no SNMP for flowspec but there is a dedicated yang model for it let’s see what gnmic has to say:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-JSON" data-lang="JSON">&lt;span class="line">&lt;span class="cl">&lt;span class="err">get&lt;/span> &lt;span class="err">-e&lt;/span> &lt;span class="err">json_ietf&lt;/span> &lt;span class="err">--path&lt;/span> &lt;span class="err">Cisco-IOS-XR-flowspec-oper:flow-spec/vrfs/vrf/afs/af/flows/flow/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;source&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;10.12.255.1&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;timestamp&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1714928869517180944&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;time&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2024-05-05T20:07:49.517180944+03:00&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;updates&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Path&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Cisco-IOS-XR-flowspec-oper:flow-spec/vrfs/vrf[vrf-name=default]/afs/af[af-name=IPv4]/flows/flow[flow-notation=Dest:10.11.10.10/32,Proto:=6,DPort:=5201]&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;values&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;flow-spec/vrfs/vrf/afs/af/flows/flow&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;active-flow-client&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;action&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;dscp&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;ipv4-nh&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;0.0.0.0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;ipv6-nh&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;::&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;rate&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;40000&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;flow-notation&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Dest:10.11.10.10/32,Proto:=6,DPort:=5201&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;flow-statistics&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;classified&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;bytes&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;packets&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;0&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;dropped&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;bytes&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;packets&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;0&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;matches&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;destination-port&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;uint16_rng_array&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;max&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">5201&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;min&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">5201&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;destination-prefix-ipv4&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;mask&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;255.255.255.255&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;prefix&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;10.11.10.10&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;destination-prefix-ipv6&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;mask&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;prefix&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;::&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;icmp&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;code&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;type&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;ip-protocol&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;uint16_rng_array&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;max&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">6&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;min&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">6&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;source-prefix-ipv4&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;mask&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;0.0.0.0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;prefix&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;0.0.0.0&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;source-prefix-ipv6&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;mask&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;prefix&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;::&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;tcp-flag&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;match-any&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;value&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Path&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Cisco-IOS-XR-flowspec-oper:flow-spec/vrfs/vrf[vrf-name=default]/afs/af[af-name=IPv4]/flows/flow[flow-notation=Dest:10.11.10.10/32,ICMPType:=8]&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;values&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;flow-spec/vrfs/vrf/afs/af/flows/flow&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;active-flow-client&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;action&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;dscp&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;ipv4-nh&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;0.0.0.0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;ipv6-nh&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;::&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;rate&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;0&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;flow-notation&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Dest:10.11.10.10/32,ICMPType:=8&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;flow-statistics&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;classified&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;bytes&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;packets&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;0&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;dropped&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;bytes&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;packets&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;0&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;matches&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;destination-prefix-ipv4&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;mask&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;255.255.255.255&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;prefix&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;10.11.10.10&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;destination-prefix-ipv6&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;mask&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;prefix&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;::&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;icmp&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;code&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">255&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;type&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">8&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;source-prefix-ipv4&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;mask&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;0.0.0.0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;prefix&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;0.0.0.0&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;source-prefix-ipv6&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;mask&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;prefix&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;::&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;tcp-flag&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;match-any&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;value&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">]&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>And the equivalent list of paths:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-JSON" data-lang="JSON">&lt;span class="line">&lt;span class="cl">&lt;span class="err">sub&lt;/span> &lt;span class="err">--mode&lt;/span> &lt;span class="err">once&lt;/span> &lt;span class="err">-e&lt;/span> &lt;span class="err">json_ietf&lt;/span> &lt;span class="err">--path&lt;/span> &lt;span class="err">Cisco-IOS-XR-flowspec-oper:flow-spec/vrfs/vrf/afs/af/flows/flow/&lt;/span> &lt;span class="err">--format&lt;/span> &lt;span class="err">event&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;default-1714934425&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;timestamp&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1714934426719000000&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;tags&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;af_af-name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;IPv4&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;flow_flow-notation&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Dest:10.11.10.10/32,Proto:=6,DPort:=5201&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;source&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;10.12.255.1:57344&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;subscription-name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;default-1714934425&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;vrf_vrf-name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;values&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/active-flow-client/action.0/dscp&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/active-flow-client/action.0/ipv4-nh&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;0.0.0.0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/active-flow-client/action.0/ipv6-nh&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;::&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/active-flow-client/action.0/rate&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;40000&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/flow-statistics/classified/bytes&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/flow-statistics/classified/packets&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/flow-statistics/dropped/bytes&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/flow-statistics/dropped/packets&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/destination-port.0/max&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">5201&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/destination-port.0/min&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">5201&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/destination-prefix-ipv4/mask&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;255.255.255.255&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/destination-prefix-ipv4/prefix&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;10.11.10.10&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/destination-prefix-ipv6/mask&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/destination-prefix-ipv6/prefix&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;::&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/icmp/code&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/icmp/type&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/ip-protocol.0/max&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">6&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/ip-protocol.0/min&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">6&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/source-prefix-ipv4/mask&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;0.0.0.0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/source-prefix-ipv4/prefix&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;0.0.0.0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/source-prefix-ipv6/mask&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/source-prefix-ipv6/prefix&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;::&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/tcp-flag/match-any&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/tcp-flag/value&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;default-1714934425&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;timestamp&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1714934426719000000&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;tags&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;af_af-name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;IPv4&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;flow_flow-notation&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Dest:10.11.10.10/32,ICMPType:=8&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;source&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;10.12.255.1:57344&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;subscription-name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;default-1714934425&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;vrf_vrf-name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;values&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/active-flow-client/action.0/dscp&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/active-flow-client/action.0/ipv4-nh&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;0.0.0.0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/active-flow-client/action.0/ipv6-nh&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;::&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/active-flow-client/action.0/rate&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/flow-statistics/classified/bytes&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/flow-statistics/classified/packets&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/flow-statistics/dropped/bytes&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/flow-statistics/dropped/packets&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/destination-prefix-ipv4/mask&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;255.255.255.255&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/destination-prefix-ipv4/prefix&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;10.11.10.10&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/destination-prefix-ipv6/mask&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/destination-prefix-ipv6/prefix&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;::&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/icmp/code&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">255&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/icmp/type&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">8&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/source-prefix-ipv4/mask&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;0.0.0.0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/source-prefix-ipv4/prefix&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;0.0.0.0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/source-prefix-ipv6/mask&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/source-prefix-ipv6/prefix&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;::&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/tcp-flag/match-any&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Cisco-IOS-XR-flowspec-oper:/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/tcp-flag/value&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>So we get the &lt;strong>actions&lt;/strong> of the rule, the &lt;strong>statistics&lt;/strong>, as well as the &lt;strong>match configuration&lt;/strong> under the respective paths:&lt;/p>
&lt;ul>
&lt;li>&lt;code>/flow-spec/vrfs/vrf/afs/af/flows/flow/active-flow-client/&lt;/code>&lt;/li>
&lt;li>&lt;code>/flow-spec/vrfs/vrf/afs/af/flows/flow/flow-statistics/&lt;/code>&lt;/li>
&lt;li>&lt;code>/flow-spec/vrfs/vrf/afs/af/flows/flow/matches/&lt;/code>&lt;/li>
&lt;/ul>
&lt;h4 class="heading-element" id="local-configuration-1">&lt;span>Local Configuration&lt;/span>
 &lt;a href="#local-configuration-1" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h4>&lt;p>The &lt;em>interesting&lt;/em> metrics are under &lt;code>/flow-statistics&lt;/code> and we get the tags for the &lt;code>vrf&lt;/code> and the &lt;code>address-family&lt;/code>. Let&amp;rsquo;s configure &lt;em>our&lt;/em> local files.&lt;/p>
&lt;p style="background-color:skyblue;text-align:center">&lt;b>Sources file&lt;/b>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-YAML" data-lang="YAML">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">version&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">xrv-fspec-grpc&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">sources&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">sources&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">xrv-fspec-grpc&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>!&lt;span class="l">gnmi&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">path&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Cisco-IOS-XR-flowspec-oper:flow-spec/vrfs/vrf/afs/af/flows/flow/&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">mode&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">SAMPLE&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">extra&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">sample_interval&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">30s&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p style="background-color:skyblue;text-align:center">&lt;b>Profiles file&lt;/b>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-YAML" data-lang="YAML">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">version&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">xrv-fspec-grpc&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">profile&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">profile&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">match&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">sysobjectid&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="m">1.3.6.1.4.1.9.1.2264&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">features&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">gnmi&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">reports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">xrv-fspec-grpc&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">include&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">device_name_ip&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">sources&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">xrv-fspec-grpc&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p style="background-color:skyblue;text-align:center">&lt;b>Reports file&lt;/b>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-YAML" data-lang="YAML">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">version&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">xrv-fspec-grpc&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">reports&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">reports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">/xrv/flowspec/statistics&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>!&lt;span class="l">external&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">starlark&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">file&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">xrv-fspec-grpc.star&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">interval&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">30s&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p style="background-color:skyblue;text-align:center">&lt;b>XR Starlark Script&lt;/b>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">load&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;ranger&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;source&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">load&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;ranger&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;metric&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">load&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;ranger&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;device&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">load&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;ranger&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;log&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">execute&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">report&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">data&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">source&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">select&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;flow-spec/vrfs/vrf&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">vrf_name&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">af_name&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">flow&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">statistics&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="p">[(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">i&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;vrf-name&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">y&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;af-name&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">z&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;flow-notation&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">z&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;flow-statistics&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">data&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">y&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;afs&amp;#39;&lt;/span>&lt;span class="p">][&lt;/span>&lt;span class="s1">&amp;#39;af&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">z&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">y&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;flows&amp;#39;&lt;/span>&lt;span class="p">][&lt;/span>&lt;span class="s1">&amp;#39;flow&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="p">]:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">vrf_name&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">vrf_name&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;default&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">record&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">report&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">record&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;vrf_name&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">vrf_name&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">record&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;af_name&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">af_name&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">record&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;flow_rule&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">flow&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">record&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;classified_bytes&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">statistics&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;classified&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;bytes&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">metric&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">record&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;classified_packets&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">statistics&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;classified&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;packets&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">metric&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">record&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;dropped_bytes&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">statistics&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;dropped&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;bytes&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="n">metric&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">record&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;dropped_packets&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">statistics&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;dropped&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;packets&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="n">metric&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">record&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;device_name&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">device&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">record&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;device_ip&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">device&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">host&lt;/span>&lt;span class="p">)&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Here is our directory structure now with the new files added for XR:
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl"> 
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">override-data/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└── config
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ├── profiles
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> │   ├── junos-fw-grpc.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> │   ├── junos-fw-snmp.yml
&lt;/span>&lt;/span>&lt;span class="line hl">&lt;span class="cl"> │   └── xrv-fspec-grpc.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ├── reports
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> │   ├── junos-fw-grpc-counters.star
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> │   ├── junos-fw-grpc-memory.star
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> │   ├── junos-fw-grpc-policers.star
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> │   ├── junos-fw-grpc.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> │   ├── junos-fw-snmp.yml
&lt;/span>&lt;/span>&lt;span class="line hl">&lt;span class="cl"> │   ├── xrv-fspec-grpc.star
&lt;/span>&lt;/span>&lt;span class="line hl">&lt;span class="cl"> │   └── xrv-fspec-grpc.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> └── sources
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ├── junos-fw-grpc.yml
&lt;/span>&lt;/span>&lt;span class="line hl">&lt;span class="cl"> └── xrv-fspec-grpc.yml&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/p>
&lt;h4 class="heading-element" id="kentik-portal-2">&lt;span>Kentik Portal&lt;/span>
 &lt;a href="#kentik-portal-2" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h4>&lt;p>Restarting kagent to pick up the new configuration and here is what we get in the Portal under &lt;code>/xrv/flowspec/statistics&lt;/code>, the configured path in our Reports file:&lt;/p>
&lt;figure>&lt;a class="lightgallery" href="https://net4fungr.github.io/posts/kustom-metrics/img_007.png" title="/posts/kustom-metrics/img_007.png" data-thumbnail="/posts/kustom-metrics/img_007.png" data-sub-html="&lt;h2>XR Flowspec metrics&lt;/h2>">&lt;img loading="lazy" src='https://net4fungr.github.io/posts/kustom-metrics/img_007.png' alt="/posts/kustom-metrics/img_007.png" height="701" width="2544">&lt;/a>&lt;figcaption class="image-caption">XR Flowspec metrics&lt;/figcaption>
 &lt;/figure>
&lt;div class="details admonition note open">
 &lt;div class="details-summary admonition-title">&lt;i class="icon fa-fw fa-solid fa-pencil-alt" aria-hidden="true">&lt;/i>No XRv counters&lt;i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true">&lt;/i>&lt;/div>
 &lt;div class="details-content">
 &lt;div class="admonition-content">Unfortunately, XRv does not report those due to limitations of its virtual dataplane &amp;#x1f622;, but you get the picture&lt;/div>
 &lt;/div>
&lt;/div>
&lt;hr>
&lt;h2 class="heading-element" id="outro">&lt;span>Outro&lt;/span>
 &lt;a href="#outro" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h2>&lt;p>Well we covered enough ground to demonstrate what is possible currently with Kentik NMS when it comes to custom metrics:&lt;/p>
&lt;ul>
&lt;li>How to enable Kentik Universal Agent to poll for specific metrics from devices&lt;/li>
&lt;li>Polling and reporting on a custom SNMP Table&lt;/li>
&lt;li>Polling and reporting on a custom ST path via GRPC&lt;/li>
&lt;li>Associating custom metrics to specific device types&lt;/li>
&lt;/ul>
&lt;p align="right">&lt;br>&lt;br>&lt;i>...till next time...have fun!!! &lt;/i> &lt;/p>
&lt;hr>
&lt;h2 class="heading-element" id="influences-and-reference">&lt;span>Influences and Reference&lt;/span>
 &lt;a href="#influences-and-reference" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h2>&lt;ul>
&lt;li>&lt;a href="https://www.kentik.com/blog/how-to-configure-kentik-nms-to-collect-custom-snmp-metrics/"target="_blank" rel="external nofollow noopener noreferrer">How to Configure Kentik NMS to Collect Custom SNMP Metrics&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://www.kentik.com/blog/adding-multiple-custom-metrics-to-kentik-nms/"target="_blank" rel="external nofollow noopener noreferrer">Adding Multiple Custom Metrics to Kentik NMS&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://www.kentik.com/blog/adjusting-data-before-sending-it-to-kentik-nms/"target="_blank" rel="external nofollow noopener noreferrer">Adjusting Data Before Sending It to Kentik NMS&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/becos76/kentik-custom-metrics"target="_blank" rel="external nofollow noopener noreferrer">Repo for this post&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>IOS-XR :: Get Your XPATHs, Get Your XPATHs Honey</title><link>https://net4fungr.github.io/posts/xr-get-xpath/</link><pubDate>Mon, 11 Jul 2022 00:00:00 +0300</pubDate><guid>https://net4fungr.github.io/posts/xr-get-xpath/</guid><category domain="https://net4fungr.github.io/categories/telemetry/">Telemetry</category><description>&lt;p>One of the mostly raised questions when you start leveraging MDT is which YANG model and xpath to use to configure the subscription on the device. Up to now, there was little to none help from the box itself, and a lot of searching and experimentation on the models was needed. Apparently this has changed now, and there are two sets of commands that will help in your quest.&lt;/p>
&lt;p>Let&amp;rsquo;s jump on &lt;a href="https://devnetsandbox.cisco.com/RM/Diagram/Index/e83cfd31-ade3-4e15-91d6-3118b867a0dd?diagramType=Topology"target="_blank" rel="external nofollow noopener noreferrer">DevNet&amp;rsquo;s always-on XRv9000&lt;/a> sandbox and issue some commands.&lt;/p>
&lt;div class="highlight" hl_lines="">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ ssh admin@sandbox-iosxr-1.cisco.com
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Password:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">RP/0/RP0/CPU0:ansible-iosxr#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">RP/0/RP0/CPU0:ansible-iosxr#show version
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sun Jul 10 22:02:49.475 UTC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Cisco IOS XR Software, Version 7.3.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Copyright (c) 2013-2021 by Cisco Systems, Inc.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Build Information:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Built By : ingunawa
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Built On : Wed Oct 13 20:00:36 PDT 2021
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Built Host : iox-ucs-017
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Workspace : /auto/srcarchive17/prod/7.3.2/xrv9k/ws
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Version : 7.3.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Location : /opt/cisco/XR/packages/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Label : 7.3.2-0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cisco IOS-XRv 9000 () processor
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">System uptime is 2 weeks 5 days 10 hours 35 minutes&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Let&amp;rsquo;s say we want to find out which model and xpath will give us the sensors for &lt;code>show interfaces&lt;/code>. There was the &lt;em>old&lt;/em> command &lt;code>schema-describe&lt;/code>, but now there is a new kid in town called &lt;code>show telemetry internal&lt;/code> that does the trick.&lt;/p>
&lt;div class="highlight" hl_lines="8">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">RP/0/RP0/CPU0:ansible-iosxr#schema-describe &amp;#34;show interfaces&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sun Jul 10 22:09:54.304 UTC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Action: get
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Path: RootOper.Interfaces.Interface
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">RP/0/RP0/CPU0:ansible-iosxr#show telemetry internal xpath &amp;#34;show interfaces&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sun Jul 10 22:11:04.759 UTC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Cisco-IOS-XR-pfi-im-cmd-oper:interfaces/interface-xr/interface&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>So now, we&amp;rsquo;ve got the model and xpath, let&amp;rsquo;s see what will be streamed for just the Bundle interfaces&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="err">RP/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="err">/RP&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="err">/CPU&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="err">:ansible-iosxr#show&lt;/span> &lt;span class="err">telemetry&lt;/span> &lt;span class="err">internal&lt;/span> &lt;span class="err">json&lt;/span> &lt;span class="err">Cisco-IOS-XR-pfi-im-cmd-oper:interfaces/interface-xr/interface&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="err">interface-name=&amp;#39;Bundle-*&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">Sun&lt;/span> &lt;span class="err">Jul&lt;/span> &lt;span class="mi">10&lt;/span> &lt;span class="mi">22&lt;/span>&lt;span class="err">:&lt;/span>&lt;span class="mi">24&lt;/span>&lt;span class="err">:&lt;/span>&lt;span class="mf">38.169&lt;/span> &lt;span class="err">UTC&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;encoding_path&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Cisco-IOS-XR-pfi-im-cmd-oper:interfaces/interface-xr/interface&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;subscription_id_str&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;app_TEST_200000001&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;collection_start_time&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;1657491878258&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;msg_timestamp&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;1657491878577&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;collection_end_time&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;1657491878577&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;node_id_str&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;ansible-iosxr&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;data_json&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;keys&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;interface-name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Bundle-Ether10&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;timestamp&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;1657491878321&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;content&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;bandwidth64-bit&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;data-rates&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;peak-output-data-rate&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;input-load&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;input-packet-rate&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;output-data-rate&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;peak-input-packet-rate&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;bandwidth&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;load-interval&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">9&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;output-packet-rate&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;input-data-rate&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;peak-output-packet-rate&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;reliability&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">255&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;peak-input-data-rate&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;output-load&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;interface-type&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;IFT_ETHERBUNDLE&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;bandwidth&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;fast-shutdown&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;is-intf-logical&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;speed&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;interface-type-information&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;bundle-information&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;interface-type-info&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;bundle&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;loopback-configuration&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;no-loopback&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;state-transition-count&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;last-state-transition-time&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;interface-handle&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Bundle-Ether10&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;is-dampening-enabled&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;state&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;im-state-down&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;mac-address&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;address&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;00:08:20:78:ff:1d&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;hardware-type-string&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Aggregated Ethernet interface(s)&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;is-l2-looped&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;line-state&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;im-state-down&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;encapsulation&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;ether&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;encapsulation-type-string&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;ARPA&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;is-l2-transport-enabled&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;duplexity&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;im-attr-duplex-full&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;mtu&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1514&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;max-bandwidth64-bit&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;if-index&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">28&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;max-bandwidth&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;collection_id&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;54&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;span class="err">,&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Or, by using the old method:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="err">RP/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="err">/RP&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="err">/CPU&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="err">:ansible-iosxr#run&lt;/span> &lt;span class="err">mdt_exec&lt;/span> &lt;span class="err">-s&lt;/span> &lt;span class="err">Cisco-IOS-XR-pfi-im-cmd-oper:interfaces/interface-xr/interface&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="err">interface-name=&amp;#39;Bundle-*&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">Sun&lt;/span> &lt;span class="err">Jul&lt;/span> &lt;span class="mi">10&lt;/span> &lt;span class="mi">22&lt;/span>&lt;span class="err">:&lt;/span>&lt;span class="mi">26&lt;/span>&lt;span class="err">:&lt;/span>&lt;span class="mf">48.133&lt;/span> &lt;span class="err">UTC&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">Enter&lt;/span> &lt;span class="err">any&lt;/span> &lt;span class="err">key&lt;/span> &lt;span class="err">to&lt;/span> &lt;span class="err">exit...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="err">Sub_id&lt;/span> &lt;span class="mi">200000001&lt;/span>&lt;span class="err">,&lt;/span> &lt;span class="err">flag&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="err">,&lt;/span> &lt;span class="err">len&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="err">Sub_id&lt;/span> &lt;span class="mi">200000001&lt;/span>&lt;span class="err">,&lt;/span> &lt;span class="err">flag&lt;/span> &lt;span class="mi">4&lt;/span>&lt;span class="err">,&lt;/span> &lt;span class="err">len&lt;/span> &lt;span class="mi">1440&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">--------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>&lt;span class="nt">&amp;#34;node_id_str&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;ansible-iosxr&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nt">&amp;#34;subscription_id_str&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;app_TEST_200000001&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;#34;encoding_path&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;Cisco-IOS-XR-pfi-im-cmd-oper:interfaces/interface-xr/interface&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;#34;collection_id&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;55&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nt">&amp;#34;collection_start_time&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;1657492008249&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nt">&amp;#34;msg_timestamp&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;1657492008548&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;#34;data_json&amp;#34;&lt;/span>&lt;span class="p">:[{&lt;/span>&lt;span class="nt">&amp;#34;timestamp&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;1657492008306&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nt">&amp;#34;keys&amp;#34;&lt;/span>&lt;span class="p">:[{&lt;/span>&lt;span class="nt">&amp;#34;interface-name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;Bundle-Ether10&amp;#34;&lt;/span>&lt;span class="p">}],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;#34;content&amp;#34;&lt;/span>&lt;span class="p">:{&lt;/span>&lt;span class="nt">&amp;#34;interface-handle&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;Bundle-Ether10&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nt">&amp;#34;interface-type&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;IFT_ETHERBUNDLE&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;#34;hardware-type-string&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;Aggregated Ethernet interface(s)&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nt">&amp;#34;state&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;im-state-down&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;#34;line-state&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;im-state-down&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nt">&amp;#34;encapsulation&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;ether&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nt">&amp;#34;encapsulation-type-string&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;ARPA&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;#34;mtu&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">1514&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nt">&amp;#34;is-l2-transport-enabled&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nt">&amp;#34;state-transition-count&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;#34;last-state-transition-time&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nt">&amp;#34;is-dampening-enabled&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nt">&amp;#34;speed&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;#34;duplexity&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;im-attr-duplex-full&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nt">&amp;#34;mac-address&amp;#34;&lt;/span>&lt;span class="p">:{&lt;/span>&lt;span class="nt">&amp;#34;address&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;00:08:20:78:ff:1d&amp;#34;&lt;/span>&lt;span class="p">},&lt;/span>&lt;span class="nt">&amp;#34;bandwidth&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;#34;max-bandwidth&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nt">&amp;#34;is-l2-looped&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nt">&amp;#34;loopback-configuration&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;no-loopback&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;#34;fast-shutdown&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nt">&amp;#34;interface-type-information&amp;#34;&lt;/span>&lt;span class="p">:{&lt;/span>&lt;span class="nt">&amp;#34;interface-type-info&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;bundle&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;#34;bundle-information&amp;#34;&lt;/span>&lt;span class="p">:{}},&lt;/span>&lt;span class="nt">&amp;#34;data-rates&amp;#34;&lt;/span>&lt;span class="p">:{&lt;/span>&lt;span class="nt">&amp;#34;input-data-rate&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nt">&amp;#34;input-packet-rate&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;#34;output-data-rate&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nt">&amp;#34;output-packet-rate&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nt">&amp;#34;peak-input-data-rate&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;#34;peak-input-packet-rate&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nt">&amp;#34;peak-output-data-rate&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nt">&amp;#34;peak-output-packet-rate&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;#34;bandwidth&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nt">&amp;#34;load-interval&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">9&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nt">&amp;#34;output-load&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nt">&amp;#34;input-load&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nt">&amp;#34;reliability&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">255&lt;/span>&lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;#34;if-index&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">28&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nt">&amp;#34;is-intf-logical&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nt">&amp;#34;bandwidth64-bit&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nt">&amp;#34;max-bandwidth64-bit&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;0&amp;#34;&lt;/span>&lt;span class="p">}}],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;#34;collection_end_time&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;1657492008549&amp;#34;&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">--------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="err">Sub_id&lt;/span> &lt;span class="mi">200000001&lt;/span>&lt;span class="err">,&lt;/span> &lt;span class="err">flag&lt;/span> &lt;span class="mi">8&lt;/span>&lt;span class="err">,&lt;/span> &lt;span class="err">len&lt;/span> &lt;span class="mi">0&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Now, let&amp;rsquo;s try to &lt;em>start&lt;/em> from an openconfig model.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="err">RP/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="err">/RP&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="err">/CPU&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="err">:ansible-iosxr#show&lt;/span> &lt;span class="err">telemetry&lt;/span> &lt;span class="err">internal&lt;/span> &lt;span class="err">xpath&lt;/span> &lt;span class="err">openconfig-interfaces&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">Sun&lt;/span> &lt;span class="err">Jul&lt;/span> &lt;span class="mi">10&lt;/span> &lt;span class="mi">22&lt;/span>&lt;span class="err">:&lt;/span>&lt;span class="mi">39&lt;/span>&lt;span class="err">:&lt;/span>&lt;span class="mf">52.953&lt;/span> &lt;span class="err">UTC&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">openconfig-interfaces:interfaces/interface/state/counters&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">openconfig-interfaces:interfaces/interface&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">openconfig-interfaces:interfaces/interface/subinterfaces/subinterface/state/counters&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">openconfig-interfaces:interfaces/interface/state&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">openconfig-interfaces:interfaces/interface/hold-time&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">openconfig-interfaces:interfaces/interface/subinterfaces/subinterface&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">#&lt;/span> &lt;span class="err">Or&lt;/span> &lt;span class="err">old&lt;/span> &lt;span class="err">school&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">RP/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="err">/RP&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="err">/CPU&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="err">:ansible-iosxr#run&lt;/span> &lt;span class="err">mdt_get_gather_paths&lt;/span> &lt;span class="err">openconfig-interfaces&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">Sun&lt;/span> &lt;span class="err">Jul&lt;/span> &lt;span class="mi">10&lt;/span> &lt;span class="mi">22&lt;/span>&lt;span class="err">:&lt;/span>&lt;span class="mi">41&lt;/span>&lt;span class="err">:&lt;/span>&lt;span class="mf">36.554&lt;/span> &lt;span class="err">UTC&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">openconfig-interfaces:interfaces/interface/state/counters&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">openconfig-interfaces:interfaces/interface&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">openconfig-interfaces:interfaces/interface/subinterfaces/subinterface/state/counters&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">openconfig-interfaces:interfaces/interface/state&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">openconfig-interfaces:interfaces/interface/hold-time&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">openconfig-interfaces:interfaces/interface/subinterfaces/subinterface&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">RP/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="err">/RP&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="err">/CPU&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="err">:ansible-iosxr#show&lt;/span> &lt;span class="err">telemetry&lt;/span> &lt;span class="err">internal&lt;/span> &lt;span class="err">json&lt;/span> &lt;span class="err">openconfig-interfaces:interfaces/interface&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="err">name=&amp;#39;Bundle-*&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="err">/state/counters&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">Sun&lt;/span> &lt;span class="err">Jul&lt;/span> &lt;span class="mi">10&lt;/span> &lt;span class="mi">22&lt;/span>&lt;span class="err">:&lt;/span>&lt;span class="mi">43&lt;/span>&lt;span class="err">:&lt;/span>&lt;span class="mf">59.255&lt;/span> &lt;span class="err">UTC&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;encoding_path&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;openconfig-interfaces:interfaces/interface/state&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;subscription_id_str&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;app_TEST_200000001&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;collection_start_time&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;1657493039807&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;msg_timestamp&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;1657493039813&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;collection_end_time&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;1657493039813&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;node_id_str&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;ansible-iosxr&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;data_json&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;keys&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Bundle-Ether10&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;timestamp&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;1657493039812&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;content&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Bundle-Ether10&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;type&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;iana-if-type:ieee8023adLag&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;oper-status&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;DOWN&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;enabled&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;admin-status&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;UP&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;logical&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;mtu&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1514&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;ifindex&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">28&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;last-change&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;loopback-mode&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;counters&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;carrier-transitions&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;0&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;collection_id&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;70&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;span class="err">,&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>That is all! Keep a note on the old commands that exists:&lt;/p>
&lt;ul>
&lt;li>&lt;strong>schema-describe&lt;/strong> &lt;em>&amp;ldquo;show command&amp;rdquo;&lt;/em>&lt;/li>
&lt;li>&lt;strong>run mdt_get_gather_paths&lt;/strong> &lt;em>&amp;lt;yang model&amp;gt;&lt;/em>&lt;/li>
&lt;li>&lt;strong>run mdt_exec&lt;/strong> -s &lt;em>&amp;lt;xpath&amp;gt;&lt;/em> -c &lt;em>&amp;lt;sample interval in msec&amp;gt;&lt;/em>&lt;/li>
&lt;/ul>
&lt;p>And the new one:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">RP/0/RP0/CPU0:ansible-iosxr#show telemetry internal ?
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> json Display yang sensor paths data in json format
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> xpath Display yang sensor paths&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Find out more on &lt;a href="https://xrdocs.io/"target="_blank" rel="external nofollow noopener noreferrer">xrdocs.io&lt;/a>, in the &lt;a href="https://xrdocs.io/telemetry/tutorials/"target="_blank" rel="external nofollow noopener noreferrer">telemetry tutorials&lt;/a>&lt;/p>
&lt;p align="right">...till next time...&lt;em>have fun!&lt;/em>&lt;/p></description></item><item><title>k8s Ansible</title><link>https://net4fungr.github.io/posts/k8s-ansible/</link><pubDate>Wed, 06 Jul 2022 15:36:24 +0300</pubDate><guid>https://net4fungr.github.io/posts/k8s-ansible/</guid><category domain="https://net4fungr.github.io/categories/ansible/">Ansible</category><description>&lt;img src="https://net4fungr.github.io/posts/k8s-ansible/featured-image.png" alt="featured image" referrerpolicy="no-referrer">&lt;h2 class="heading-element" id="intro">&lt;span>Intro&lt;/span>
 &lt;a href="#intro" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h2>&lt;hr>
&lt;p>Throughout this post, I am documenting my ansible orientation and ramping-up process towards automating the provisioning of a k8s cluster on ubuntu linux. I believe it is not something too fancy or something that has not been visited over and over again in various other posts, but this is the scrub of my exposure with ansible automation. I tried to make it modular with several playbook imports and task includes executed from a &lt;em>parent&lt;/em> playbook file, rather than having a single long playbook. Ansible &lt;em>roles&lt;/em> are not leveraged &amp;#x1f601;. The &lt;em>code&lt;/em> for this project can be found &lt;a href="https://github.com/becos76/k8s_ansible/"target="_blank" rel="external nofollow noopener noreferrer">here&lt;/a>.&lt;/p>
&lt;hr>
&lt;h2 class="heading-element" id="the-intent">&lt;span>The Intent&lt;/span>
 &lt;a href="#the-intent" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h2>&lt;hr>
&lt;p>Let&amp;rsquo;s begin by setting the in-scope items for the project:&lt;/p>
&lt;ul>
&lt;li>Ubuntu 20.04 VMs based on cloud images provisioned with a known username/passwd and assigned DHCP IPv4 addresses. (Setting up the VMs &lt;a href="https://net4fungr.github.io/posts/kube-my-router-pt1">reference&lt;/a>)&lt;/li>
&lt;li>Kubernetes single node cluster version 1.22&lt;/li>
&lt;li>Docker CRI&lt;/li>
&lt;li>Flannel CNI&lt;/li>
&lt;li>Single playbook which calls subsequent playbooks and task lists at runtime&lt;/li>
&lt;li>Kubeadm for cluster setup&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 class="heading-element" id="playbook-overview">&lt;span>Playbook Overview&lt;/span>
 &lt;a href="#playbook-overview" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h2>&lt;hr>
&lt;p>The following mindmap diagram represents the automation tasks flows. &lt;span style="color:red">Red &lt;/span>lines represent imported playbook files. &lt;span style="color:green">Green &lt;/span>lines are included task lists files, and &lt;span style="color:#7a28FF">blue &lt;/span> lines are the actual tasks to be executed.&lt;/p>
&lt;figure>&lt;a class="lightgallery" href="https://net4fungr.github.io/posts/k8s-ansible/play_mmap.png" title="/posts/k8s-ansible/play_mmap.png" data-thumbnail="/posts/k8s-ansible/play_mmap.png" data-sub-html="&lt;h2>k8s Ansible Playbook Flow&lt;/h2>">&lt;img loading="lazy" src='https://net4fungr.github.io/posts/k8s-ansible/play_mmap.png' alt="/posts/k8s-ansible/play_mmap.png" height="1062" width="800">&lt;/a>&lt;figcaption class="image-caption">k8s Ansible Playbook Flow&lt;/figcaption>
 &lt;/figure>
&lt;p>In short, we start from a single playbook file called &lt;em>start.yml&lt;/em> and we have broken down our flow in three phases. The &lt;em>&lt;strong>init&lt;/strong>&lt;/em> phase covers Steps 01 and 02, and refer to assigning static IPs to our dynamic VMs. Step 01 is about building the mapping from DHCP to Static IPs of our nodes and generating the relevant &lt;em>netplan&lt;/em> configuration files using a jinja2 template. Step 02 covers the application of these configuration files to the VMs.&lt;/p>
&lt;p>Next, is the &lt;em>&lt;strong>pre-deployment&lt;/strong>&lt;/em> phase, or Step 03, which is about preparing the VMs for k8s deployment, i.e. setting hostnames, establishing SSH key authentication with ansible, upgrading, etc.&lt;/p>
&lt;p>The final phase is the &lt;em>&lt;strong>deployment&lt;/strong>&lt;/em> one, where we call our tasks to deploy the k8s cluster upon the relevant control and worker nodes.&lt;/p>
&lt;p>The &lt;em>&lt;strong>check&lt;/strong>&lt;/em> phase, although not depicted in the flow, is a very important one during which we do our environment pre-checks in order for the playbook to be executed successfully, i.e. are all hosts declared properly in the ansible hosts file, are all variables declared as they should be,etc.&lt;/p>
&lt;p>Let&amp;rsquo;s expand on the directory structure in order to make things more explicit.&lt;/p>
&lt;hr>
&lt;h3 class="heading-element" id="directory-layout">&lt;span>Directory Layout&lt;/span>
 &lt;a href="#directory-layout" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h3>&lt;hr>
&lt;p>Here is how the tree of our ansible playbook &lt;em>home&lt;/em> directory looks like:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">.
&lt;/span>&lt;/span>&lt;span class="line hl">&lt;span class="cl">├── .secrets -------------------&amp;lt; Custom directory to hold sensitive data
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│   ├── passwd.yml -------------&amp;lt; Encrypted secrets file
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│   └── vault_passwd -----------&amp;lt; Ansible-vault clear text password
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── ansible.cfg ----------------&amp;lt; ansible configuration file
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── checks.yml -----------------&amp;lt; &lt;span class="s2">&amp;#34;Pre-checks&amp;#34;&lt;/span> playbook - Step &lt;span class="m">00&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line hl">&lt;span class="cl">├── configs --------------------&amp;lt; Directory to store generated static ip netplan files
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── deployment.yml -------------&amp;lt; &lt;span class="s2">&amp;#34;Deploy&amp;#34;&lt;/span> phase playbook - Step &lt;span class="m">04&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── hosts ----------------------&amp;lt; ansible inventory file in ini format
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── init_play.yml --------------&amp;lt; &lt;span class="s2">&amp;#34;Init&amp;#34;&lt;/span> phase playbook - Step &lt;span class="m">01&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── pre_deploy.yml -------------&amp;lt; &lt;span class="s2">&amp;#34;Pre-deploy&amp;#34;&lt;/span> phase playbook - Step &lt;span class="m">03&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── start.yml ---------------&amp;gt;&amp;gt;&amp;gt;&amp;gt; &lt;span class="s2">&amp;#34;Master&amp;#34;&lt;/span> playbook
&lt;/span>&lt;/span>&lt;span class="line hl">&lt;span class="cl">├── tasks ----------------------&amp;lt; Folder to hold all task lists files arranged per phase
&lt;/span>&lt;/span>&lt;span class="line hl">&lt;span class="cl">│   ├── deploy
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│   │   ├── boot_control.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│   │   ├── cni.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│   │   ├── cri.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│   │   ├── packages_general.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│   │   ├── packages_kube.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│   │   ├── swap.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│   │   └── workers.yml
&lt;/span>&lt;/span>&lt;span class="line hl">&lt;span class="cl">│   ├── init
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│   │   └── apply_netplan.yml --&amp;lt; Step &lt;span class="m">02&lt;/span> playbook
&lt;/span>&lt;/span>&lt;span class="line hl">&lt;span class="cl">│   └── pre
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│   ├── cloud-init.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│   ├── hostname.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│   ├── hosts.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│   ├── reboot.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│   ├── sshkeys.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│   ├── sudo.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│   └── upgrade.yml
&lt;/span>&lt;/span>&lt;span class="line hl">&lt;span class="cl">├── templates ------------------&amp;lt; Templates default folder
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│   └── netplan.j2
&lt;/span>&lt;/span>&lt;span class="line hl">&lt;span class="cl">└── vars -----------------------&amp;lt; Custom directory to host variables
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> └── netplan.yml&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Below is the ansible configuration file where we define which file contains the inventory. We instruct ansible not complain if the SSH target hosts are not known. For facts gathering, we only need the network facts and not the hardware ones. We define where is the encryption password for ansible-vault. The &lt;em>callback_whitelist&lt;/em> is very useful if we want to see timing statistics of our playbook execution.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-dosini" data-lang="dosini">&lt;span class="line">&lt;span class="cl">&lt;span class="k">[defaults]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">inventory&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">hosts&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">host_key_checking&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">False&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">gather_subset&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">!hardware, network&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">vault_password_file&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">.secrets/vault_passwd&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#callback_whitelist = timer, profile_tasks&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p style="background-color:deepskyblue;text-align:center">&lt;b>ansible.cfg&lt;/b>&lt;/p>
&lt;h3 class="heading-element" id="ansible-key-files-overview">&lt;span>Ansible key files overview&lt;/span>
 &lt;a href="#ansible-key-files-overview" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h3>&lt;p>Here is our inventory file:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-dosini" data-lang="dosini">&lt;span class="line">&lt;span class="cl">&lt;span class="k">[all:vars]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">ansible_ssh_common_args&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#39;-o UserKnownHostsFile=/dev/null&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">ansible_user&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">ubuntu&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">ansible_ssh_private_key_file&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">~/.ssh/id_ansible&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">k8s_version&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">1.22.10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">k8s_pod_cidr&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">10.244.0.0/16&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">[control]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">kates-control ansible_host&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">192.168.1.40&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">[workers]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">kates-node-01 ansible_host&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">192.168.1.41&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">kates-node-02 ansible_host&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">192.168.1.42&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">kates-node-03 ansible_host&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">192.168.1.43&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">[dhcp_hosts]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">192.168.1.203&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">192.168.1.206&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">192.168.1.208&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">192.168.1.209&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p style="background-color:deepskyblue;text-align:center">&lt;b>hosts&lt;/b>&lt;/p>
&lt;p>We split our targets into three groups and declare common variables in the &lt;em>all&lt;/em> section. The &lt;em>ansible_ssh_common_args&lt;/em> variable prevents ansible to complain about host key changes, since these VMs were re-provisioned a lot of times during testing the playbook and were getting the same DHCP addresses. We declare here the SSH user that is used for the initial connection to the &lt;em>dynamic&lt;/em> hosts till the point that these hosts are assigned static IPs and configured with an SSH public key in order for ansible to continue further with the tasks.&lt;/p>
&lt;p>The &lt;em>passwd.yml&lt;/em> file contains the passwords that ansible will use for SSH and &lt;em>sudo&lt;/em> access on the targets. These are used initially and then &lt;em>publickey&lt;/em> and sudoless access is enabled.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">$ ansible-vault view .secrets/passwd.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ansible_sudo_pass: &lt;span class="s2">&amp;#34;ubuntu123&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ansible_become_pass: &lt;span class="s2">&amp;#34;ubuntu123&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ansible_ssh_pass: &lt;span class="s2">&amp;#34;ubuntu123&amp;#34;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p style="background-color:deepskyblue;text-align:center">&lt;b>.secrets/passwd.yml&lt;/b>&lt;/p>
&lt;p>Let&amp;rsquo;s now check the variables file that will be loaded during play runtime.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">netplan&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">gateway4&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">192.168.1.1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">subnet&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">24&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">dns&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="m">192.168.1.1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="m">8.8.8.8&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p style="background-color:deepskyblue;text-align:center">&lt;b>vars/netplan.yml&lt;/b>&lt;/p>
&lt;p>It is a dictionary containing all variables needed to populate the &lt;em>jinja2&lt;/em> template and produce the respective netplan configuration file that will enable assigning static ip to our hosts.&lt;/p>
&lt;p>Here is the &lt;em>jinja2&lt;/em> template file:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-jinja" data-lang="jinja">&lt;span class="line">&lt;span class="cl">&lt;span class="x">network:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> ethernets:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> &lt;/span>&lt;span class="cp">{{&lt;/span> &lt;span class="nv">item.intf&lt;/span> &lt;span class="cp">}}&lt;/span>&lt;span class="x">:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> dhcp4: false
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> dhcp6: false
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> addresses: [&lt;/span>&lt;span class="cp">{{&lt;/span> &lt;span class="nv">item.newIP&lt;/span> &lt;span class="cp">}}&lt;/span>&lt;span class="x">/&lt;/span>&lt;span class="cp">{{&lt;/span> &lt;span class="nv">netplan.subnet&lt;/span> &lt;span class="cp">}}&lt;/span>&lt;span class="x">]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> gateway4: &lt;/span>&lt;span class="cp">{{&lt;/span> &lt;span class="nv">netplan.gateway4&lt;/span> &lt;span class="cp">}}&lt;/span>&lt;span class="x">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> nameservers:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> addresses: [&lt;/span>&lt;span class="cp">{%&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="nv">dns&lt;/span> &lt;span class="k">in&lt;/span> &lt;span class="nv">netplan.dns&lt;/span> &lt;span class="cp">%}{{&lt;/span>&lt;span class="nv">dns&lt;/span>&lt;span class="cp">}}{%&lt;/span>- &lt;span class="k">if&lt;/span> &lt;span class="k">not&lt;/span> &lt;span class="nb">loop&lt;/span>&lt;span class="nv">.last&lt;/span> &lt;span class="cp">%}&lt;/span>&lt;span class="x">, &lt;/span>&lt;span class="cp">{%&lt;/span> &lt;span class="k">endif&lt;/span> &lt;span class="cp">%}{%&lt;/span> &lt;span class="k">endfor&lt;/span> &lt;span class="cp">%}&lt;/span>&lt;span class="x">]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="x"> version: 2&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p style="background-color:deepskyblue;text-align:center">&lt;b>templates/netplan.j2&lt;/b>&lt;/p>
&lt;p>So, this template will iterate over a list of dictionaries that will be created in runtime containing a mapping of &lt;em>dynamic&lt;/em> IP to &lt;em>static&lt;/em> one along with the &lt;em>netplan&lt;/em> variables for each hosts. The outcome will be a netplan config file that will be placed and applied on the target host.
&lt;div class="details admonition note open">
 &lt;div class="details-summary admonition-title">&lt;i class="icon fa-fw fa-solid fa-pencil-alt" aria-hidden="true">&lt;/i>Note&lt;i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true">&lt;/i>&lt;/div>
 &lt;div class="details-content">
 &lt;div class="admonition-content">For DNS entries, since we can have more than one, we append a &lt;em>comma&lt;/em> if it is not the last item in order to build the list.&lt;/div>
 &lt;/div>
&lt;/div>&lt;/p>
&lt;p>Last but not least, here is the &lt;em>master&lt;/em> playbook, or &lt;code>playbook zero&lt;/code> that I like to call it.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="c">#!/usr/bin/env ansible-playbook&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ONE PLAY TO CONTROL ALL&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">hosts&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">all&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">gather_facts&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">no&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;&amp;lt;! ################# CHECK :: PRE-FLIGHT CHECKING ################### !&amp;gt;&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">import_playbook&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">checks.yml&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;&amp;lt;! ################# INIT :: PREPARE FOR STATIC IPs ################# !&amp;gt;&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">import_playbook&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">init_play.yml&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;&amp;lt;! ################# INIT :: CHANGE TO STATIC IPs ################### !&amp;gt;&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">import_playbook&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">tasks/init/apply_netplan.yml&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;&amp;lt;! ################# PRE :: PERFORM PRE-DEPLOYMENT TASKS ############ !&amp;gt;&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">import_playbook&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">pre_deploy.yml&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;&amp;lt;! ################# DEPLOY :: PERFORM DEPLOYMENT TASKS ############# !&amp;gt;&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">import_playbook&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">deployment.yml&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p style="background-color:deepskyblue;text-align:center">&lt;b>start.yml&lt;/b>&lt;/p>
&lt;p>Pretty straight forward. It is just importing all other playbooks one by one &amp;#x1f604;&lt;/p>
&lt;hr>
&lt;h3 class="heading-element" id="ansible-modules-in-play">&lt;span>Ansible modules in play&lt;/span>
 &lt;a href="#ansible-modules-in-play" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h3>&lt;hr>
&lt;p>The following table lists all ansible modules used in this project in alphabetical order along with a short description on their use.&lt;/p>
&lt;table>
 &lt;thead>
 &lt;tr>
 &lt;th>Short Name&lt;/th>
 &lt;th>FQCN&lt;/th>
 &lt;th>Description&lt;/th>
 &lt;/tr>
 &lt;/thead>
 &lt;tbody>
 &lt;tr>
 &lt;td>apt&lt;/td>
 &lt;td>&lt;a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/apt_module.html"target="_blank" rel="external nofollow noopener noreferrer">ansible.builtin.apt&lt;/a>&lt;/td>
 &lt;td>Manages &lt;em>apt&lt;/em> packages in Debian/Ubuntu distros&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>apt_key&lt;/td>
 &lt;td>&lt;a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/apt_key_module.html"target="_blank" rel="external nofollow noopener noreferrer">ansible.builtin.apt_key&lt;/a>&lt;/td>
 &lt;td>Manages keys in &lt;em>apt&lt;/em> keyring&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>apt_repository&lt;/td>
 &lt;td>&lt;a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/apt_repository_module.html"target="_blank" rel="external nofollow noopener noreferrer">ansible.builtin.apt_repository&lt;/a>&lt;/td>
 &lt;td>Manages &lt;em>apt&lt;/em> repositories&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>assert&lt;/td>
 &lt;td>&lt;a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/assert_module.html"target="_blank" rel="external nofollow noopener noreferrer">ansible.builtin.assert&lt;/a>&lt;/td>
 &lt;td>Evaluates if given expressions are true&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>authorized_key&lt;/td>
 &lt;td>&lt;a href="https://docs.ansible.com/ansible/latest/collections/ansible/posix/authorized_key_module.html"target="_blank" rel="external nofollow noopener noreferrer">ansible.posix.authorized_key&lt;/a>&lt;/td>
 &lt;td>Manages SSH authorized keys of user accounts&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>blockinfile&lt;/td>
 &lt;td>&lt;a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/blockinfile_module.html"target="_blank" rel="external nofollow noopener noreferrer">ansible.builtin.blockinfile&lt;/a>&lt;/td>
 &lt;td>Manages a block of multi-line text surrounded by customizable marker lines in files&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>command&lt;/td>
 &lt;td>&lt;a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/command_module.html"target="_blank" rel="external nofollow noopener noreferrer">ansible.builtin.command&lt;/a>&lt;/td>
 &lt;td>Executes commands on linux targets without invoking a shell&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>copy&lt;/td>
 &lt;td>&lt;a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/copy_module.html"target="_blank" rel="external nofollow noopener noreferrer">ansible.builtin.copy&lt;/a>&lt;/td>
 &lt;td>Copy files to remote linux locations&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>debug&lt;/td>
 &lt;td>&lt;a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/debug_module.html"target="_blank" rel="external nofollow noopener noreferrer">ansible.builtin.debug&lt;/a>&lt;/td>
 &lt;td>Print statements during execution and can be useful for debugging variables or expressions without necessarily halting the playbook&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>file&lt;/td>
 &lt;td>&lt;a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/file_module.html"target="_blank" rel="external nofollow noopener noreferrer">ansible.builtin.file&lt;/a>&lt;/td>
 &lt;td>Manage files, attributes of files, symlinks or directories in linux nodes&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>hostname&lt;/td>
 &lt;td>&lt;a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/hostname_module.html"target="_blank" rel="external nofollow noopener noreferrer">ansible.builtin.hostname&lt;/a>&lt;/td>
 &lt;td>Set the hostname in most linux distros&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>import_playbook&lt;/td>
 &lt;td>&lt;a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/import_playbook_module.html"target="_blank" rel="external nofollow noopener noreferrer">ansible.builtin.import_playbook&lt;/a>&lt;/td>
 &lt;td>Imports a playbook file in the current playbook for execution&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>include_tasks&lt;/td>
 &lt;td>&lt;a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/include_tasks_module.html"target="_blank" rel="external nofollow noopener noreferrer">ansible.builtin.include_tasks&lt;/a>&lt;/td>
 &lt;td>Dynamically includes a file with a list of tasks to be executed in the current playbook&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>include_vars&lt;/td>
 &lt;td>&lt;a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/include_vars_module.html"target="_blank" rel="external nofollow noopener noreferrer">ansible.builtin.include_vars&lt;/a>&lt;/td>
 &lt;td>Loads YAML/JSON variables dynamically from a file or directory, recursively, during task runtime&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>lineinfile&lt;/td>
 &lt;td>&lt;a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/lineinfile_module.html"target="_blank" rel="external nofollow noopener noreferrer">ansible.builtin.lineinfile&lt;/a>&lt;/td>
 &lt;td>Manage lines in a text file&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>meta&lt;/td>
 &lt;td>&lt;a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/meta_module.html"target="_blank" rel="external nofollow noopener noreferrer">ansible.builtin.meta&lt;/a>&lt;/td>
 &lt;td>Execute ansible &lt;em>actions&lt;/em>&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>openssh_keypair&lt;/td>
 &lt;td>&lt;a href="https://docs.ansible.com/ansible/latest/collections/community/crypto/openssh_keypair_module.html"target="_blank" rel="external nofollow noopener noreferrer">community.crypto.openssh_keypair&lt;/a>&lt;/td>
 &lt;td>(Re)Generate OpenSSH private and public keys&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>reboot&lt;/td>
 &lt;td>&lt;a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/reboot_module.html"target="_blank" rel="external nofollow noopener noreferrer">ansible.builtin.reboot&lt;/a>&lt;/td>
 &lt;td>Reboot a machine, wait for it to go down, come back up, and respond to commands&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>replace&lt;/td>
 &lt;td>&lt;a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/replace_module.html"target="_blank" rel="external nofollow noopener noreferrer">ansible.builtin.replace&lt;/a>&lt;/td>
 &lt;td>Replace all instances of a particular string in a file using a back-referenced regular expression&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>set_fact&lt;/td>
 &lt;td>&lt;a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/set_fact_module.html"target="_blank" rel="external nofollow noopener noreferrer">ansible.builtin.set_fact&lt;/a>&lt;/td>
 &lt;td>Set host variable(s) and fact(s)&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>setup&lt;/td>
 &lt;td>&lt;a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/setup_module.html"target="_blank" rel="external nofollow noopener noreferrer">ansible.builtin.setup&lt;/a>&lt;/td>
 &lt;td>Gathers facts about remote hosts&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>shell&lt;/td>
 &lt;td>&lt;a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/shell_module.html"target="_blank" rel="external nofollow noopener noreferrer">ansible.builtin.shell&lt;/a>&lt;/td>
 &lt;td>Execute shell commands on targets&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>stat&lt;/td>
 &lt;td>&lt;a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/stat_module.html"target="_blank" rel="external nofollow noopener noreferrer">ansible.builtin.stat&lt;/a>&lt;/td>
 &lt;td>Retrieve file or file system status&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>systemd&lt;/td>
 &lt;td>&lt;a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/systemd_module.html"target="_blank" rel="external nofollow noopener noreferrer">ansible.builtin.systemd&lt;/a>&lt;/td>
 &lt;td>Manage systemd units&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>template&lt;/td>
 &lt;td>&lt;a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/template_module.html"target="_blank" rel="external nofollow noopener noreferrer">ansible.builtin.template&lt;/a>&lt;/td>
 &lt;td>Template a file out to a target host using &lt;em>jinja2&lt;/em>&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>user&lt;/td>
 &lt;td>&lt;a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/user_module.html"target="_blank" rel="external nofollow noopener noreferrer">ansible.builtin.user&lt;/a>&lt;/td>
 &lt;td>Manage user accounts and user attributes&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>wait_for&lt;/td>
 &lt;td>&lt;a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/wait_for_module.html"target="_blank" rel="external nofollow noopener noreferrer">ansible.builtin.wait_for&lt;/a>&lt;/td>
 &lt;td>Waits for a condition before continuing&lt;/td>
 &lt;/tr>
 &lt;/tbody>
&lt;/table>
&lt;hr>
&lt;h2 class="heading-element" id="phased-execution">&lt;span>Phased Execution&lt;/span>
 &lt;a href="#phased-execution" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h2>&lt;hr>
&lt;p>Let&amp;rsquo;s delve a bit deeper on the phases now. We will just analyse some key tasks to make the logic more explicit.&lt;/p>
&lt;hr>
&lt;h3 class="heading-element" id="the-check-phase">&lt;span>The &lt;em>check&lt;/em> phase&lt;/span>
 &lt;a href="#the-check-phase" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h3>&lt;hr>
&lt;p>As previously states, during this phase we are aiming to check if all variables, files, and configurations are how they are supposed to be, or better how are playbooks want them to be in order to execute correctly. The most popular modules used here are those of &lt;em>debug&lt;/em> and &lt;em>assert&lt;/em>.&lt;/p>
&lt;p>Let&amp;rsquo;s see for example a simple check on the inventory groups:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">INVENTORY CHECK - SINGLE CONTROL NODE&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">debug&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> 
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">msg&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;control group is not correctly populated for a single (1) control node&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">when&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">(not groups.control) or (groups.control|length &amp;gt; 1)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">failed_when&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">(not groups.control) or (groups.control|length &amp;gt; 1)&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>What we do here is making sure the group &lt;em>control&lt;/em> is defined and it contains only one target host definition, since we are deploying a single control node cluster. This task will be executed only &lt;code>when&lt;/code> the condition we are checking is &lt;em>false&lt;/em> and will be declared as failed using the &lt;code>failed_when&lt;/code> clause.&lt;/p>
&lt;p>Another simple example is using &lt;em>assert&lt;/em>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">CHECK QUANTITIES&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">assert&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">that&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">groups.dhcp_hosts|length == (groups.control+groups.workers)|length&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">quiet&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">yes&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">fail_msg&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;Number of DHCP hosts cannot be different of number of K8s nodes&amp;#34;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Here, we are checking that we have the same number of &lt;em>dynamic&lt;/em> hosts defined as the total number of k8s nodes, workers and control nodes together, since there will be a one-to-one mapping in the configuration and deployment.&lt;/p>
&lt;p>Now, let&amp;rsquo;s see how we check the variables file:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">CHECK FOR NETPLAN VARIABLES FILE&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">stat&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">path&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;{{ lookup(&amp;#39;ansible.builtin.env&amp;#39;, &amp;#39;PWD&amp;#39;) }}/vars/netplan.yml&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">register&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">netplan_file&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="nt">debug&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">msg=&amp;#34;Netplan variables file is not found&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">when&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">not netplan_file.stat.exists&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">failed_when&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">not netplan_file.stat.exists&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">INCLUDING NETPLAN VARIABLES&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">include_vars&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">dir&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;{{ lookup(&amp;#39;ansible.builtin.env&amp;#39;, &amp;#39;PWD&amp;#39;) }}/vars&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">files_matching&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">netplan.yml&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">CHECKING NETPLAN VARIABLES&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">assert&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">that&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> 
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">netplan is defined and netplan&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">netplan.gateway4 is defined and netplan.gateway4&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">netplan.subnet is defined and netplan.subnet|int &amp;gt; 0 and netplan.subnet &amp;lt;= 31&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">netplan.dns is defined and netplan.dns&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">quiet&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">yes&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">fail_msg&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;Make sure all netplan variables are defined correctly&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">success_msg&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;Looks Good!&amp;#34;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>So, we use &lt;em>stat&lt;/em> and &lt;em>debug&lt;/em> to make sure that the file exists in the correct directory. Then we &lt;em>load&lt;/em> it in the play with &lt;em>include_vars&lt;/em> so we can have access to the variables, and finally we check the values with &lt;em>assert&lt;/em>.&lt;/p>
&lt;p>Finally, using &lt;em>wait_for&lt;/em> we check if there is connectivity to the target hosts and act accordingly. We need the &lt;em>dynamic_hosts&lt;/em> to be alive and the k8s node&amp;rsquo;s IPs to be unreachable.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">CHECK SSH CONNECTIVITY TO DHCP HOSTS&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">wait_for&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">22&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">host&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;{{item}}&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">search_regex&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">OpenSSH&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">delay&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">0&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">timeout&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">2&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">loop&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;{{groups.dhcp_hosts}}&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">CHECK SSH CONNECTIVITY TO K8S NODES&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">wait_for&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">22&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">host&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;{{hostvars[item].ansible_host}}&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">search_regex&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">OpenSSH&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">delay&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">0&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">timeout&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">2&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">msg&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Should not be alive&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">state&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">stopped&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">loop&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;{{groups.control+groups.workers}}&amp;#34;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;hr>
&lt;h3 class="heading-element" id="the-init-phase-steps-01-and-02">&lt;span>The &lt;em>init&lt;/em> phase (Steps 01 and 02)&lt;/span>
 &lt;a href="#the-init-phase-steps-01-and-02" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h3>&lt;hr>
&lt;p>This phase calls two playbook files. As Step 01, we build the &lt;em>dynamic&lt;/em> host mapping to &lt;em>static&lt;/em> k8s node and we create the netplan config files for the hosts locally, thus this playbook is run against localhost. As Step 02, we upload the netplan files and apply the new configuration on the targets.&lt;/p>
&lt;p>Here is the playbook for the first step:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="c">#!/usr/bin/env ansible-playbook&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;&amp;lt;! ################# INIT :: PREPARE FOR STATIC IPs ################# !&amp;gt;&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">hosts&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">localhost&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">gather_facts&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">yes&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">vars_files&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">.secrets/passwd.yml&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">vars/netplan.yml&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> 
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> 
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">tasks&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">GET FACTS OF DHCP NODES&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">setup&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">delegate_to&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;{{ item }}&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">delegate_facts&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">loop&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;{{groups.dhcp_hosts}}&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> 
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">PREPARE STATIC MAPPINGS&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">set_fact&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">dhcp_map=&amp;#34;{{ dhcp_map|default([]) + &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>{&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;oldIP&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="l">hostvars[item.0].ansible_default_ipv4.address,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;intf&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="l">hostvars[item.0].ansible_default_ipv4.interface,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;newIP&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="l">hostvars[item.1].ansible_host&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>}&lt;span class="p">]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>}}&lt;span class="s2">&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> loop: &amp;#34;&lt;/span>{{&lt;span class="l">groups.dhcp_hosts|zip(groups.control+groups.workers)|list}}&amp;#34; &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> 
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">GENERATE NETPLAN CONFIGS&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">template&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">src&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">netplan.j2&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">dest&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">configs/netplan.{{item.oldIP}}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">loop&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;{{dhcp_map}}&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p style="background-color:deepskyblue;text-align:center">&lt;b>init_play.yml&lt;/b>&lt;/p>
&lt;p>We use the &lt;em>setup&lt;/em> module to connect to &lt;em>dhcp_hosts&lt;/em> and gather their facts. We are interested in their IPv4 assigned address and the network interface name. We then use &lt;em>set_fact&lt;/em> to build our list of dictionaries in order to use it for &lt;em>jinja2&lt;/em> template config creation.&lt;/p>
&lt;p>A sample of the list of dictionaries looks like this:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>&lt;span class="nt">&amp;#34;oldIP&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;192.168.1.203&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nt">&amp;#34;intf&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;ens3&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nt">&amp;#34;newIP&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;192.168.1.40&amp;#34;&lt;/span>&lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>&lt;span class="nt">&amp;#34;oldIP&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;192.168.1.204&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nt">&amp;#34;intf&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;ens3&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nt">&amp;#34;newIP&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;192.168.1.41&amp;#34;&lt;/span>&lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>&lt;span class="nt">&amp;#34;oldIP&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;192.168.1.205&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nt">&amp;#34;intf&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;ens3&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nt">&amp;#34;newIP&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;192.168.1.42&amp;#34;&lt;/span>&lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>&lt;span class="nt">&amp;#34;oldIP&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;192.168.1.206&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nt">&amp;#34;intf&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;ens3&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nt">&amp;#34;newIP&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;192.168.1.43&amp;#34;&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">]&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Once the list is populated, we use the &lt;em>template&lt;/em> module to get the configuration files and output them in the &lt;em>configs&lt;/em> directory appending the &amp;ldquo;OldIP&amp;rdquo; to the filename.&lt;/p>
&lt;p>As a second step, we apply the configs to our target hosts by getting the netplan filename and replacing it with the respective netplan config file generated in the previous step. We make the change and wait for connectivity to the static IPs.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="c">#!/usr/bin/env ansible-playbook&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;&amp;lt;! ################# INIT :: CHANGE TO STATIC IPs ################### !&amp;gt;&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">hosts&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">dhcp_hosts&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">gather_facts&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">yes&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">vars_files&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="s2">&amp;#34;{{inventory_dir}}/.secrets/passwd.yml&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">tasks&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">GET NETPLAN FILENAME&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">shell&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ls /etc/netplan&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">register&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">netplan_file&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> 
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">UPLOAD NETPLAN CONFIGS&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">copy&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">content&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;{{lookup(&amp;#39;file&amp;#39;, &amp;#39;{{inventory_dir}}/configs/netplan.{{ansible_host}}&amp;#39;)}}\n&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">dest&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;/etc/netplan/{{netplan_file.stdout}}&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">become&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">yes&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">APPLY NETPLAN SETTINGS&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">command&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">netplan apply&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">become&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">yes&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">async&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">10&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">poll&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">0&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> 
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">CHECK CONNECTIVITY TO STATIC IPs&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">wait_for&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">22&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">host&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;{{hostvars[item].ansible_host}}&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">search_regex&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">OpenSSH&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">delay&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">20&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">timeout&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">120&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">loop&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;{{groups.control+groups.workers}}&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">connection&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">local&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">run_once&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">yes&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p style="background-color:deepskyblue;text-align:center">&lt;b>tasks/init/apply_netplan.yml&lt;/b>&lt;/p>
&lt;hr>
&lt;h3 class="heading-element" id="the-pre-deploy-phase-step-03">&lt;span>The &lt;em>pre-deploy&lt;/em> phase (Step 03)&lt;/span>
 &lt;a href="#the-pre-deploy-phase-step-03" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h3>&lt;hr>
&lt;p>Now that we have established that our targets will use their final static IPs, we are going to perform some tasks to prepare them for k8s deployment.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="c">#!/usr/bin/env ansible-playbook&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;&amp;lt;! ################# PRE :: PERFORM PRE-DEPLOYMENT TASKS ################### !&amp;gt;&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">hosts&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">all:!dhcp_hosts&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">gather_facts&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">yes&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c">#any_errors_fatal: no&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">vars_files&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">.secrets/passwd.yml&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">tasks&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;&amp;lt;======================== SSH KEYS ========================&amp;gt;&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">include_tasks&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">tasks/pre/sshkeys.yml&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> 
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;&amp;lt;======================== SUDO ============================&amp;gt;&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">include_tasks&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">tasks/pre/sudo.yml&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> 
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;&amp;lt;======================== CLOUD-INIT ======================&amp;gt;&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">include_tasks&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">tasks/pre/cloud-init.yml&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> 
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;&amp;lt;======================== HOSTNAMES =======================&amp;gt;&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">include_tasks&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">tasks/pre/hostname.yml&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> 
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;&amp;lt;======================== HOSTS FILES =====================&amp;gt;&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">include_tasks&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">tasks/pre/hosts.yml&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> 
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;&amp;lt;======================== UPDATE/UPGRADE ==================&amp;gt;&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">include_tasks&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">tasks/pre/upgrade.yml&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> 
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;&amp;lt;======================== REBOOT ========================-&amp;gt;&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">include_tasks&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">tasks/pre/reboot.yml &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">debug&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">msg=&amp;#34;\u2705 NODE READY FOR DEPLOYMENT&amp;#34;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p style="background-color:deepskyblue;text-align:center">&lt;b>pre_deploy.yml&lt;/b>&lt;/p>
&lt;p>We first generate an SSH key on localhost and distribute it to all the nodes in order for ansible to access them without using the user password. Then we enable passwordless sudo access for the ansible user. We disable cloud-init if the service is there. Set the correct hostname and configure all k8s nodes in the hosts files, and, finally perform pings between hosts to verify that name resolution and connectivity is successful.&lt;/p>
&lt;hr>
&lt;h3 class="heading-element" id="the-deploy-phase-step-04">&lt;span>The &lt;em>deploy&lt;/em> phase (Step 04)&lt;/span>
 &lt;a href="#the-deploy-phase-step-04" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h3>&lt;hr>
&lt;p>The last phase is to deploy the k8s cluster.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="c">#!/usr/bin/env ansible-playbook&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">K8S DEPLOYMENT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">hosts&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">all:!dhcp_hosts&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">gather_facts&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">yes&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">vars_files&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">.secrets/passwd.yml&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">tasks&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;&amp;lt;======================== PRE-REQUISITES ===================&amp;gt;&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">include_tasks&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">tasks/deploy/packages_general.yml&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">args&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">apply&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">become&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">yes&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> 
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;&amp;lt;======================== TURN OFF SWAP ====================&amp;gt;&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">include_tasks&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">tasks/deploy/swap.yml&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> 
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;&amp;lt;======================== DOCKER CRI =======================&amp;gt;&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">include_tasks&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">tasks/deploy/cri.yml&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">args&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">apply&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">become&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">yes&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> 
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;&amp;lt;======================== KUBE PACKAGES ====================&amp;gt;&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">include_tasks&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">tasks/deploy/packages_kube.yml&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">args&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">apply&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">become&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">yes&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;&amp;lt;======================= PREPARE THE CONTROL NODE ==========&amp;gt;&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">block&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;&amp;lt;======================== INIT CONTROL NODE ==========&amp;gt;&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">include_tasks&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">tasks/deploy/boot_control.yml&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> 
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;&amp;lt;======================== DEPLOY CNI =================&amp;gt;&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">include_tasks&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">tasks/deploy/cni.yml&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">when&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">inventory_hostname in groups.control&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> 
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;&amp;lt;===================== ADD WORKER NODES ====================&amp;gt;&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">include_tasks&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">tasks/deploy/workers.yml&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p style="background-color:deepskyblue;text-align:center">&lt;b>deployment.yml&lt;/b>&lt;/p>
&lt;p>We start off by installing the prerequisite packages, apt keys and repositories. We then turn off swap if any, in order for &lt;em>kubelet&lt;/em> service to run without issues. Then, we proceed installing docker CRI, changing cgroup to &lt;em>systemd&lt;/em> and assigning the user to docker group. We download &lt;em>kubeadm&lt;/em>, &lt;em>kubectl&lt;/em>, and &lt;em>kubelet&lt;/em> packages. Next, we initialise the control node and install the network CNI plugin. Finally, we join the worker nodes to the cluster.&lt;/p>
&lt;hr>
&lt;h2 class="heading-element" id="optimisations">&lt;span>Optimisations&lt;/span>
 &lt;a href="#optimisations" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h2>&lt;hr>
&lt;p>If we&amp;rsquo;ve reached this stage, it means that everything is working fine, we are happy, so the code is good and we do not need any optimisations or fine tuning &amp;#x1f604;. Well, there is always room for improvement and fine tuning, the only enemy is time.&lt;/p>
&lt;p>I am sure that a more experienced eye could spot many ways to improve the playbook and suggest better ways to do things or use tasks, but here are my observations after finishing the playbook:&lt;/p>
&lt;ul>
&lt;li>&lt;strong>Improving Speed&lt;/strong>: During the &lt;em>check&lt;/em> phase, where we check for reachability, I initially used to ping the hosts and act on the result. This was adding a nearly 45 second delay in execution, so I tested with &lt;em>wait_for&lt;/em> towards SSH connectivity and this improved script time tremendously. After all, SSH connectivity is somewhat better than ping reachability, since it is one step further &amp;#x1f604;. What I am suggesting here is to take in mind the end goal of what you are after and figure out a way to do it more meaningful and perhaps faster. For example, if you have a task to create a file in a directory, should you first check if the directory exists? Well, it depends on the use case, but in general the task to create the file will fail if the directory does not exist in the first place and you would be able catch this.&lt;/li>
&lt;li>&lt;strong>Task Consolidation&lt;/strong>: Although this playbook does the job, I think it is just automating a list of steps to achieve the result like one could perform manually on a system. Let&amp;rsquo;s take for example the &lt;em>apt&lt;/em> module that installs packages. The module is called several times to install packages according to the phase of the playbook, but what about if we just used a single &lt;em>apt&lt;/em> task to install all our needed packages from all phases. It would be like having a &lt;em>package installation&lt;/em> phase. Unless for some reason we need discrete stages and actions, I think that looking at the playbook as a holistic entity most probably will reveal tasks that can be consolidated.&lt;/li>
&lt;li>&lt;strong>Task Reduction&lt;/strong>: Well, here, the main focus is about the question should I use several tasks to do something or it can be done with a single task or less. As an example, we need to check for the existence of a file. We use the &lt;em>stat&lt;/em> module and register a variable. We then use the &lt;em>debug&lt;/em> module to check the output for success or not. For sure, it will depend on the use case, but another way of treating this could be by just the &lt;em>debug&lt;/em> module and using a file lookup conditional clause for this task.&lt;/li>
&lt;li>&lt;strong>Best Practices&lt;/strong>: Here, I will not expand more on using ansible roles, or group_vars folder, or avoiding the declarations of variables in the inventory file &amp;#x1f604;&lt;/li>
&lt;/ul>
&lt;p align="right">...till next time...&lt;em>have fun!&lt;/em>&lt;/p></description></item><item><title>Proxy or not...here I come...</title><link>https://net4fungr.github.io/posts/proxy-or-not/</link><pubDate>Tue, 14 Jun 2022 00:00:00 +0000</pubDate><guid>https://net4fungr.github.io/posts/proxy-or-not/</guid><category domain="https://net4fungr.github.io/categories/linux/">Linux</category><description>&lt;p>There has been a need sometimes that you are on a system that is not permanently set to use a proxy server for internet access and you just want to give one or two curl or wget commands to fetch some files, or vice versa &amp;#x1f604;. In order to avoid exporting the appropriate environment variables in the correct place, you can use the following two methods to enable or disable ad-hoc usage of the proxy server in linux bash.&lt;/p>
&lt;h2 class="heading-element" id="method-one---as-an-executable-preceding-your-actual-command">&lt;span>Method One - as an executable preceding your actual command&lt;/span>
 &lt;a href="#method-one---as-an-executable-preceding-your-actual-command" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h2>&lt;p>Just put the following commands in a bash script, make it executable and put it in your path somewhere on the system.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">becos@fossa:~$ cat proxy
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#!/bin/bash -eu&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">###########&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">## Adjust to your environment&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">##&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">HTTP_PROXY&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;http://10.10.10.10:8080&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">HTTPS_PROXY&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;http://10.10.10.10:8080&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">NO_PROXY&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;localhost,127.0.0.1,&lt;/span>&lt;span class="k">$(&lt;/span>hostname -i&lt;span class="k">)&lt;/span>&lt;span class="s2">,.domain.com&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">###########&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">http_proxy&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$HTTP_PROXY&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">https_proxy&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$HTTPS_PROXY&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">no_proxy&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$NO_PROXY&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> HTTP_PROXY HTTPS_PROXY NO_PROXY http_proxy https_proxy no_proxy
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">exec&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$@&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">becos@fossa:~$ chmod +x proxy &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> sudo mv !$ /usr/local/bin/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">chmod +x proxy &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> sudo mv proxy /usr/local/bin/&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Now you can precede the &lt;strong>proxy&lt;/strong> command just before calling your command that needs the proxy environment variables.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">becos@fossa:~$ proxy curl -sv http://www.google.com &amp;gt; /dev/null
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">* Uses proxy env variable &lt;span class="nv">no_proxy&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s1">&amp;#39;localhost,127.0.0.1,192.168.1.5,.domain.com&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">* Uses proxy env variable &lt;span class="nv">http_proxy&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s1">&amp;#39;http://10.10.10.10:8080&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">* Trying 10.10.10.10:8080...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">* TCP_NODELAY &lt;span class="nb">set&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">^C
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">becos@fossa:~$&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 class="heading-element" id="method-two---as-functions-to-the-user-profile">&lt;span>Method Two - as functions to the user profile&lt;/span>
 &lt;a href="#method-two---as-functions-to-the-user-profile" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h2>&lt;p>You can add these two functions in say your &lt;em>.profile&lt;/em>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="k">function&lt;/span> proxyoff
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">unset&lt;/span> http_proxy HTTP_PROXY https_proxy HTTPS_PROXY no_proxy NO_PROXY
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">function&lt;/span> proxyon
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">http_proxy&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;http://10.10.10.10:8080&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">HTTP_PROXY&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$http_proxy&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">https_proxy&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;http://10.10.10.10:8080&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">HTTPS_PROXY&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$http_proxy&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">no_proxy&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;localhost,127.0.0.1,&lt;/span>&lt;span class="k">$(&lt;/span>hostname -i&lt;span class="k">)&lt;/span>&lt;span class="s2">,.domain.com&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">NO_PROXY&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$no_proxy&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">export&lt;/span> http_proxy HTTP_PROXY https_proxy HTTPS_PROXY no_proxy NO_PROXY
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>So, after a new shell, you can use the on and off functions according to your intent.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">becos@fossa:~$ env &lt;span class="p">|&lt;/span> grep -i proxy
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">becos@fossa:~$ proxyon
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">becos@fossa:~$ env &lt;span class="p">|&lt;/span> grep -i proxy
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">no_proxy&lt;/span>&lt;span class="o">=&lt;/span>localhost,127.0.0.1,192.168.1.5,.domain.com
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">https_proxy&lt;/span>&lt;span class="o">=&lt;/span>http://10.10.10.10:8080
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">NO_PROXY&lt;/span>&lt;span class="o">=&lt;/span>localhost,127.0.0.1,192.168.1.5,.domain.com
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">HTTPS_PROXY&lt;/span>&lt;span class="o">=&lt;/span>http://10.10.10.10:8080
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">HTTP_PROXY&lt;/span>&lt;span class="o">=&lt;/span>http://10.10.10.10:8080
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">http_proxy&lt;/span>&lt;span class="o">=&lt;/span>http://10.10.10.10:8080
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">becos@fossa:~$ proxyoff
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">becos@fossa:~$ env &lt;span class="p">|&lt;/span> grep -i proxy&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>That&amp;rsquo;s it, I hope it finds a use case.&lt;/p>
&lt;p align="right">...till next time...&lt;em>have fun!&lt;/em>&lt;/p></description></item><item><title>Kube my router up! - Last Part</title><link>https://net4fungr.github.io/posts/kube-my-router-pt3/</link><pubDate>Mon, 06 Jun 2022 00:00:00 +0300</pubDate><guid>https://net4fungr.github.io/posts/kube-my-router-pt3/</guid><category domain="https://net4fungr.github.io/categories/art-of-labbing/">Art of Labbing</category><description>&lt;img src="https://net4fungr.github.io/posts/kube-my-router-pt3/featured-image-preview.jpg" alt="featured image" referrerpolicy="no-referrer">&lt;hr>
&lt;h2 class="heading-element" id="intro">&lt;span>&lt;a href="https://net4fungr.github.io/posts/kube-my-router-pt1/#intro">Intro&lt;/a>&lt;/span>
 &lt;a href="#intro" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h2>&lt;hr>
&lt;h2 class="heading-element" id="part-one---setting-up-the-k8s-vms-in-eve-ng">&lt;span>&lt;a href="https://net4fungr.github.io/posts/kube-my-router-pt1/">Part One - Setting up the k8s VMs in EVE-NG&lt;/a>&lt;/span>
 &lt;a href="#part-one---setting-up-the-k8s-vms-in-eve-ng" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h2>&lt;hr>
&lt;h2 class="heading-element" id="part-two---deploying-the-k8s-cluster-with-kubeadm">&lt;span>&lt;a href="https://net4fungr.github.io/posts/kube-my-router-pt2/">Part Two - Deploying the k8s cluster with kubeadm&lt;/a>&lt;/span>
 &lt;a href="#part-two---deploying-the-k8s-cluster-with-kubeadm" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h2>&lt;hr>
&lt;h2 class="heading-element" id="last-part---installing-and-testing-kne">&lt;span>&lt;a href="https://net4fungr.github.io/posts/kube-my-router-pt3/">Last Part - Installing and testing KNE&lt;/a>&lt;/span>
 &lt;a href="#last-part---installing-and-testing-kne" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h2>&lt;hr>
&lt;h3 class="heading-element" id="the-intent">&lt;span>The Intent&lt;/span>
 &lt;a href="#the-intent" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h3>&lt;ul>
&lt;li>Install Google&amp;rsquo;s KNE on the k8s control node&lt;/li>
&lt;li>Use KNE to create sample topologies&lt;/li>
&lt;li>Test with Nokia srlinux&lt;/li>
&lt;li>Test with Arista cEOS&lt;/li>
&lt;/ul>
&lt;p>The time has come to install Google&amp;rsquo;s KNE!!!. We are going to use the k8s control node for KNEs &amp;ldquo;control&amp;rdquo; server, so everything will be installed on it.&lt;/p>
&lt;hr>
&lt;h3 class="heading-element" id="prepare-for-kne-installation">&lt;span>Prepare for KNE installation&lt;/span>
 &lt;a href="#prepare-for-kne-installation" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h3>&lt;hr>
&lt;p>We need &lt;strong>go&lt;/strong> so we are going to install it.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Download go&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ wget -q https://go.dev/dl/go1.18.2.linux-amd64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Install it under our HOME directory&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ tar -xvzf go1.18.2.linux-amd64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Put it in your PATH&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ &lt;span class="nb">export&lt;/span> &lt;span class="nv">PATH&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">$PATH&lt;/span>:~/go/bin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ &lt;span class="nb">echo&lt;/span> !! &amp;gt;&amp;gt; ~/.profile
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="nb">export&lt;/span> &lt;span class="nv">PATH&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">$PATH&lt;/span>:~/go/bin &amp;gt;&amp;gt; ~/.profile
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Check if it&amp;#39;s working&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ go version
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">go version go1.18.2 linux/amd64&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;hr>
&lt;h3 class="heading-element" id="deploy-kne">&lt;span>Deploy KNE&lt;/span>
 &lt;a href="#deploy-kne" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h3>&lt;hr>
&lt;div class="details admonition note open">
 &lt;div class="details-summary admonition-title">&lt;i class="icon fa-fw fa-solid fa-pencil-alt" aria-hidden="true">&lt;/i>Use of kind&lt;i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true">&lt;/i>&lt;/div>
 &lt;div class="details-content">
 &lt;div class="admonition-content">KNE requires &lt;strong>kind&lt;/strong> if you are going to use it in a single node. KNE can also deploy a single node k8s using kind and have it run inside a container. Then all the labs will be deployed into this containerised k8s node.&lt;/div>
 &lt;/div>
&lt;/div>
&lt;p>OK! We are now ready to install KNE. There are two ways, either install it via go&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">$ go install github.com/google/kne/kne_cli@latest&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>or, clone the repo from github and build it locally, which is what I did.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ git clone https://github.com/google/kne.git
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Cloning into &lt;span class="s1">&amp;#39;kne&amp;#39;&lt;/span>...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">remote: Enumerating objects: 2146, &lt;span class="k">done&lt;/span>.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">remote: Counting objects: 100% &lt;span class="o">(&lt;/span>154/154&lt;span class="o">)&lt;/span>, &lt;span class="k">done&lt;/span>.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">remote: Compressing objects: 100% &lt;span class="o">(&lt;/span>89/89&lt;span class="o">)&lt;/span>, &lt;span class="k">done&lt;/span>.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">remote: Total &lt;span class="m">2146&lt;/span> &lt;span class="o">(&lt;/span>delta 66&lt;span class="o">)&lt;/span>, reused &lt;span class="m">145&lt;/span> &lt;span class="o">(&lt;/span>delta 62&lt;span class="o">)&lt;/span>, pack-reused &lt;span class="m">1992&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Receiving objects: 100% &lt;span class="o">(&lt;/span>2146/2146&lt;span class="o">)&lt;/span>, 41.28 MiB &lt;span class="p">|&lt;/span> 200.00 KiB/s, &lt;span class="k">done&lt;/span>.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Resolving deltas: 100% &lt;span class="o">(&lt;/span>1052/1052&lt;span class="o">)&lt;/span>, &lt;span class="k">done&lt;/span>.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ &lt;span class="nb">cd&lt;/span> kne/kne_cli/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~/kne/kne_cli$ &lt;span class="nv">GOPATH&lt;/span>&lt;span class="o">=&lt;/span>~/go go install
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~/kne/kne_cli$ &lt;span class="nb">cd&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ kne_cli
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Kubernetes Network Emulation CLI. Works with meshnet to create
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">layer &lt;span class="m">2&lt;/span> topology used by containers to layout networks in a k8s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">environment.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Usage:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> kne_cli &lt;span class="o">[&lt;/span>command&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Available Commands:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> completion Generate the autocompletion script &lt;span class="k">for&lt;/span> the specified shell
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> create Create Topology
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> delete Delete Topology
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> deploy Deploy cluster.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">help&lt;/span> Help about any &lt;span class="nb">command&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> show Show Topology
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> topology Topology commands.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Flags:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -h, --help &lt;span class="nb">help&lt;/span> &lt;span class="k">for&lt;/span> kne_cli
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --kubecfg string kubeconfig file &lt;span class="o">(&lt;/span>default &lt;span class="s2">&amp;#34;/home/ubuntu/.kube/config&amp;#34;&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -v, --verbosity string log level &lt;span class="o">(&lt;/span>default &lt;span class="s2">&amp;#34;info&amp;#34;&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Use &lt;span class="s2">&amp;#34;kne_cli [command] --help&amp;#34;&lt;/span> &lt;span class="k">for&lt;/span> more information about a command.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;hr>
&lt;h3 class="heading-element" id="prepare-k8s-cluster-for-kne">&lt;span>Prepare k8s cluster for KNE&lt;/span>
 &lt;a href="#prepare-k8s-cluster-for-kne" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h3>&lt;hr>
&lt;p>We need to install meshnet CNI.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Install meshnet from local manifests&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ kubectl apply -k kne/manifests/meshnet/base/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">namespace/meshnet created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">customresourcedefinition.apiextensions.k8s.io/topologies.networkop.co.uk created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">serviceaccount/meshnet created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">clusterrole.rbac.authorization.k8s.io/meshnet-clusterrole created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">clusterrolebinding.rbac.authorization.k8s.io/meshnet-clusterrolebinding created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">daemonset.apps/meshnet created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Check for any issues&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ kubectl get events -n meshnet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">LAST SEEN TYPE REASON OBJECT MESSAGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">15m Normal Scheduled pod/meshnet-72zz4 Successfully assigned meshnet/meshnet-72zz4 to kates-node-02
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">15m Normal Pulling pod/meshnet-72zz4 Pulling image &lt;span class="s2">&amp;#34;hfam/meshnet:latest&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">15m Normal Pulled pod/meshnet-72zz4 Successfully pulled image &lt;span class="s2">&amp;#34;hfam/meshnet:latest&amp;#34;&lt;/span> in 9.581184132s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">15m Normal Created pod/meshnet-72zz4 Created container meshnet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">15m Normal Started pod/meshnet-72zz4 Started container meshnet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">15m Normal Scheduled pod/meshnet-9vqr2 Successfully assigned meshnet/meshnet-9vqr2 to kates-node-01
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">15m Normal Pulling pod/meshnet-9vqr2 Pulling image &lt;span class="s2">&amp;#34;hfam/meshnet:latest&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">15m Normal Pulled pod/meshnet-9vqr2 Successfully pulled image &lt;span class="s2">&amp;#34;hfam/meshnet:latest&amp;#34;&lt;/span> in 9.716760651s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">15m Normal Created pod/meshnet-9vqr2 Created container meshnet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">15m Normal Started pod/meshnet-9vqr2 Started container meshnet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">15m Normal Scheduled pod/meshnet-fkv2s Successfully assigned meshnet/meshnet-fkv2s to kates-control
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">15m Normal Pulling pod/meshnet-fkv2s Pulling image &lt;span class="s2">&amp;#34;hfam/meshnet:latest&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">15m Normal Pulled pod/meshnet-fkv2s Successfully pulled image &lt;span class="s2">&amp;#34;hfam/meshnet:latest&amp;#34;&lt;/span> in 10.072682996s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">15m Normal Created pod/meshnet-fkv2s Created container meshnet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">15m Normal Started pod/meshnet-fkv2s Started container meshnet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">15m Normal SuccessfulCreate daemonset/meshnet Created pod: meshnet-fkv2s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">15m Normal SuccessfulCreate daemonset/meshnet Created pod: meshnet-72zz4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">15m Normal SuccessfulCreate daemonset/meshnet Created pod: meshnet-9vqr2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Check the new namespace&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ kubectl get all -n meshnet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod/meshnet-72zz4 1/1 Running &lt;span class="m">0&lt;/span> 15m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod/meshnet-9vqr2 1/1 Running &lt;span class="m">0&lt;/span> 15m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod/meshnet-fkv2s 1/1 Running &lt;span class="m">0&lt;/span> 15m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME DESIRED CURRENT READY UP-TO-DATE AVAILABLE NODE SELECTOR AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">daemonset.apps/meshnet &lt;span class="m">3&lt;/span> &lt;span class="m">3&lt;/span> &lt;span class="m">3&lt;/span> &lt;span class="m">3&lt;/span> &lt;span class="m">3&lt;/span> kubernetes.io/arch&lt;span class="o">=&lt;/span>amd64 15m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Check the cni&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ sudo cat /etc/cni/net.d/00-meshnet.conflist
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;cniVersion&amp;#34;&lt;/span>: &lt;span class="s2">&amp;#34;0.3.1&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;name&amp;#34;&lt;/span>: &lt;span class="s2">&amp;#34;cbr0&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;plugins&amp;#34;&lt;/span>: &lt;span class="o">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;delegate&amp;#34;&lt;/span>: &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;hairpinMode&amp;#34;&lt;/span>: true,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;isDefaultGateway&amp;#34;&lt;/span>: &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;type&amp;#34;&lt;/span>: &lt;span class="s2">&amp;#34;flannel&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;capabilities&amp;#34;&lt;/span>: &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;portMappings&amp;#34;&lt;/span>: &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;type&amp;#34;&lt;/span>: &lt;span class="s2">&amp;#34;portmap&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;name&amp;#34;&lt;/span>: &lt;span class="s2">&amp;#34;meshnet&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;type&amp;#34;&lt;/span>: &lt;span class="s2">&amp;#34;meshnet&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;ipam&amp;#34;&lt;/span>: &lt;span class="o">{}&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;dns&amp;#34;&lt;/span>: &lt;span class="o">{}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Then we need to install metallb in order to access our nodes from outside k8s.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Install from local manifests&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ kubectl apply -f kne/manifests/metallb/namespace.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">namespace/metallb-system created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ kubectl create secret generic -n metallb-system memberlist --from-literal&lt;span class="o">=&lt;/span>&lt;span class="nv">secretkey&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="k">$(&lt;/span>openssl rand -base64 128&lt;span class="k">)&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">secret/memberlist created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ kubectl apply -f kne/manifests/metallb/metallb.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Warning: policy/v1beta1 PodSecurityPolicy is deprecated in v1.21+, unavailable in v1.25+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">podsecuritypolicy.policy/controller created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">podsecuritypolicy.policy/speaker created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">serviceaccount/controller created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">serviceaccount/speaker created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">clusterrole.rbac.authorization.k8s.io/metallb-system:controller created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">clusterrole.rbac.authorization.k8s.io/metallb-system:speaker created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">role.rbac.authorization.k8s.io/config-watcher created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">role.rbac.authorization.k8s.io/pod-lister created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">role.rbac.authorization.k8s.io/controller created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">clusterrolebinding.rbac.authorization.k8s.io/metallb-system:controller created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">clusterrolebinding.rbac.authorization.k8s.io/metallb-system:speaker created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rolebinding.rbac.authorization.k8s.io/config-watcher created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rolebinding.rbac.authorization.k8s.io/pod-lister created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rolebinding.rbac.authorization.k8s.io/controller created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">daemonset.apps/speaker created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">deployment.apps/controller created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ kubectl get events -n metallb-system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">LAST SEEN TYPE REASON OBJECT MESSAGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">70s Normal Scheduled pod/controller-868bf4c94d-dtnmn Successfully assigned metallb-system/controller-868bf4c94d-dtnmn to kates-node-02
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">70s Normal Pulling pod/controller-868bf4c94d-dtnmn Pulling image &lt;span class="s2">&amp;#34;quay.io/metallb/controller:v0.12.1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">52s Normal Pulled pod/controller-868bf4c94d-dtnmn Successfully pulled image &lt;span class="s2">&amp;#34;quay.io/metallb/controller:v0.12.1&amp;#34;&lt;/span> in 17.316467325s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">52s Normal Created pod/controller-868bf4c94d-dtnmn Created container controller
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">52s Normal Started pod/controller-868bf4c94d-dtnmn Started container controller
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">70s Normal SuccessfulCreate replicaset/controller-868bf4c94d Created pod: controller-868bf4c94d-dtnmn
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">70s Normal ScalingReplicaSet deployment/controller Scaled up replica &lt;span class="nb">set&lt;/span> controller-868bf4c94d to &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">70s Normal Scheduled pod/speaker-hb6ms Successfully assigned metallb-system/speaker-hb6ms to kates-node-02
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">70s Normal Pulling pod/speaker-hb6ms Pulling image &lt;span class="s2">&amp;#34;quay.io/metallb/speaker:v0.12.1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">60s Normal Pulled pod/speaker-hb6ms Successfully pulled image &lt;span class="s2">&amp;#34;quay.io/metallb/speaker:v0.12.1&amp;#34;&lt;/span> in 9.820655993s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">60s Normal Created pod/speaker-hb6ms Created container speaker
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">60s Normal Started pod/speaker-hb6ms Started container speaker
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">70s Normal Scheduled pod/speaker-j5gpn Successfully assigned metallb-system/speaker-j5gpn to kates-node-01
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">70s Normal Pulling pod/speaker-j5gpn Pulling image &lt;span class="s2">&amp;#34;quay.io/metallb/speaker:v0.12.1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">59s Normal Pulled pod/speaker-j5gpn Successfully pulled image &lt;span class="s2">&amp;#34;quay.io/metallb/speaker:v0.12.1&amp;#34;&lt;/span> in 10.835647902s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">59s Normal Created pod/speaker-j5gpn Created container speaker
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">59s Normal Started pod/speaker-j5gpn Started container speaker
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">70s Normal Scheduled pod/speaker-z9qqw Successfully assigned metallb-system/speaker-z9qqw to kates-control
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">70s Normal Pulling pod/speaker-z9qqw Pulling image &lt;span class="s2">&amp;#34;quay.io/metallb/speaker:v0.12.1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">59s Normal Pulled pod/speaker-z9qqw Successfully pulled image &lt;span class="s2">&amp;#34;quay.io/metallb/speaker:v0.12.1&amp;#34;&lt;/span> in 11.068649905s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">59s Normal Created pod/speaker-z9qqw Created container speaker
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">59s Normal Started pod/speaker-z9qqw Started container speaker
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">70s Normal SuccessfulCreate daemonset/speaker Created pod: speaker-z9qqw
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">70s Normal SuccessfulCreate daemonset/speaker Created pod: speaker-j5gpn
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">70s Normal SuccessfulCreate daemonset/speaker Created pod: speaker-hb6ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ kubectl get all -n metallb-system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod/controller-868bf4c94d-qllcz 1/1 Running &lt;span class="m">0&lt;/span> 39s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod/speaker-2dpxw 1/1 Running &lt;span class="m">0&lt;/span> 39s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod/speaker-5qgm9 1/1 Running &lt;span class="m">0&lt;/span> 39s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME DESIRED CURRENT READY UP-TO-DATE AVAILABLE NODE SELECTOR AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">daemonset.apps/speaker &lt;span class="m">2&lt;/span> &lt;span class="m">2&lt;/span> &lt;span class="m">2&lt;/span> &lt;span class="m">2&lt;/span> &lt;span class="m">2&lt;/span> kubernetes.io/os&lt;span class="o">=&lt;/span>linux 39s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY UP-TO-DATE AVAILABLE AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">deployment.apps/controller 1/1 &lt;span class="m">1&lt;/span> &lt;span class="m">1&lt;/span> 39s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME DESIRED CURRENT READY AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">replicaset.apps/controller-868bf4c94d &lt;span class="m">1&lt;/span> &lt;span class="m">1&lt;/span> &lt;span class="m">1&lt;/span> 39s&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Finally we need a configmap with an ip range to assign addresses from out local network.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ cat &amp;gt; ./metallb-configmap.yaml &lt;span class="s">&amp;lt;&amp;lt; EOF
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">&amp;gt; apiVersion: v1
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">&amp;gt; kind: ConfigMap
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">&amp;gt; metadata:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">&amp;gt; namespace: metallb-system
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">&amp;gt; name: config
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">&amp;gt; data:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">&amp;gt; config: |
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">&amp;gt; address-pools:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">&amp;gt; - name: default
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">&amp;gt; protocol: layer2
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">&amp;gt; addresses:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">&amp;gt; - 192.168.1.50 - 192.168.1.99
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">&amp;gt; EOF&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ kubectl apply -f metallb-configmap.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">configmap/config created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ kubectl get cm -n metallb-system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME DATA AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">config &lt;span class="m">1&lt;/span> 13s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-root-ca.crt &lt;span class="m">1&lt;/span> 4m16s&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;hr>
&lt;h3 class="heading-element" id="use-kne-to-create-a-basic-topology">&lt;span>Use KNE to create a basic topology&lt;/span>
 &lt;a href="#use-kne-to-create-a-basic-topology" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h3>&lt;hr>
&lt;p>Okay now! Let pick a simple sample lab with two linux nodes and spin it up.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ kne_cli create kne/examples/2node-host.pb.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> /home/ubuntu/kne/examples
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Creating manager &lt;span class="k">for&lt;/span>: 2node-host
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Trying in-cluster configuration
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Falling back to kubeconfig: &lt;span class="s2">&amp;#34;/home/ubuntu/.kube/config&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Topology:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">name: &lt;span class="s2">&amp;#34;2node-host&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nodes: &amp;lt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: &lt;span class="s2">&amp;#34;vm-1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> type: HOST
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> config: &amp;lt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> image: &lt;span class="s2">&amp;#34;hfam/ubuntu:latest&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nodes: &amp;lt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: &lt;span class="s2">&amp;#34;vm-2&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> type: HOST
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">links: &amp;lt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> a_node: &lt;span class="s2">&amp;#34;vm-1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> a_int: &lt;span class="s2">&amp;#34;eth1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> z_node: &lt;span class="s2">&amp;#34;vm-2&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> z_int: &lt;span class="s2">&amp;#34;eth1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Adding Link: vm-1:eth1 vm-2:eth1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Adding Node: vm-1:UNKNOWN:HOST
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Adding Node: vm-2:UNKNOWN:HOST
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Creating namespace &lt;span class="k">for&lt;/span> topology: &lt;span class="s2">&amp;#34;2node-host&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Server Namespace: &lt;span class="p">&amp;amp;&lt;/span>Namespace&lt;span class="o">{&lt;/span>ObjectMeta:&lt;span class="o">{&lt;/span>2node-host 13677a1e-f4fc-42cc-bee8-4484107facb6 &lt;span class="m">139020&lt;/span> &lt;span class="m">0&lt;/span> 2022-06-01 13:29:27 +0000 UTC &amp;lt;nil&amp;gt; &amp;lt;nil&amp;gt; map&lt;span class="o">[&lt;/span>kubernetes.io/metadata.name:2node-host&lt;span class="o">]&lt;/span> map&lt;span class="o">[]&lt;/span> &lt;span class="o">[]&lt;/span> &lt;span class="o">[]&lt;/span> &lt;span class="o">[{&lt;/span>kne_cli Update v1 2022-06-01 13:29:27 +0000 UTC FieldsV1 &lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;f:metadata&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;f:labels&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;.&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:kubernetes.io/metadata.name&amp;#34;&lt;/span>:&lt;span class="o">{}}}}&lt;/span> &lt;span class="o">}]}&lt;/span>,Spec:NamespaceSpec&lt;span class="o">{&lt;/span>Finalizers:&lt;span class="o">[&lt;/span>kubernetes&lt;span class="o">]&lt;/span>,&lt;span class="o">}&lt;/span>,Status:NamespaceStatus&lt;span class="o">{&lt;/span>Phase:Active,Conditions:&lt;span class="o">[]&lt;/span>NamespaceCondition&lt;span class="o">{}&lt;/span>,&lt;span class="o">}&lt;/span>,&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Getting topology specs &lt;span class="k">for&lt;/span> namespace 2node-host
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Getting topology specs &lt;span class="k">for&lt;/span> node vm-1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Getting topology specs &lt;span class="k">for&lt;/span> node vm-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Creating topology &lt;span class="k">for&lt;/span> meshnet node vm-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Meshnet Node:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;amp;&lt;/span>&lt;span class="o">{&lt;/span>TypeMeta:&lt;span class="o">{&lt;/span>Kind: APIVersion:&lt;span class="o">}&lt;/span> ObjectMeta:&lt;span class="o">{&lt;/span>Name:vm-2 GenerateName: Namespace:2node-host SelfLink: UID:b6de0742-35e3-478b-8c40-e7b6f59dc8bf ResourceVersion:139023 Generation:1 CreationTimestamp:2022-06-01 13:29:27 +0000 UTC DeletionTimestamp:&amp;lt;nil&amp;gt; DeletionGracePeriodSeconds:&amp;lt;nil&amp;gt; Labels:map&lt;span class="o">[]&lt;/span> Annotations:map&lt;span class="o">[]&lt;/span> OwnerReferences:&lt;span class="o">[]&lt;/span> Finalizers:&lt;span class="o">[]&lt;/span> ZZZ_DeprecatedClusterName: ManagedFields:&lt;span class="o">[{&lt;/span>Manager:kne_cli Operation:Update APIVersion:networkop.co.uk/v1beta1 Time:2022-06-01 13:29:27 +0000 UTC FieldsType:FieldsV1 FieldsV1:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;f:spec&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;.&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:links&amp;#34;&lt;/span>:&lt;span class="o">{}}}&lt;/span> Subresource:&lt;span class="o">}]}&lt;/span> Status:&lt;span class="o">{&lt;/span>TypeMeta:&lt;span class="o">{&lt;/span>Kind: APIVersion:&lt;span class="o">}&lt;/span> ObjectMeta:&lt;span class="o">{&lt;/span>Name: GenerateName: Namespace: SelfLink: UID: ResourceVersion: Generation:0 CreationTimestamp:0001-01-01 00:00:00 +0000 UTC DeletionTimestamp:&amp;lt;nil&amp;gt; DeletionGracePeriodSeconds:&amp;lt;nil&amp;gt; Labels:map&lt;span class="o">[]&lt;/span> Annotations:map&lt;span class="o">[]&lt;/span> OwnerReferences:&lt;span class="o">[]&lt;/span> Finalizers:&lt;span class="o">[]&lt;/span> ZZZ_DeprecatedClusterName: ManagedFields:&lt;span class="o">[]}&lt;/span> Skipped:&lt;span class="o">[]&lt;/span> SrcIp: NetNs:&lt;span class="o">}&lt;/span> Spec:&lt;span class="o">{&lt;/span>TypeMeta:&lt;span class="o">{&lt;/span>Kind: APIVersion:&lt;span class="o">}&lt;/span> Links:&lt;span class="o">[{&lt;/span>LocalIntf:eth1 LocalIP: PeerIntf:eth1 PeerIP: PeerPod:vm-1 UID:0&lt;span class="o">}]}}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Creating topology &lt;span class="k">for&lt;/span> meshnet node vm-1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Meshnet Node:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;amp;&lt;/span>&lt;span class="o">{&lt;/span>TypeMeta:&lt;span class="o">{&lt;/span>Kind: APIVersion:&lt;span class="o">}&lt;/span> ObjectMeta:&lt;span class="o">{&lt;/span>Name:vm-1 GenerateName: Namespace:2node-host SelfLink: UID:140df03a-15a1-44fe-a57f-47d464f8b9fc ResourceVersion:139024 Generation:1 CreationTimestamp:2022-06-01 13:29:27 +0000 UTC DeletionTimestamp:&amp;lt;nil&amp;gt; DeletionGracePeriodSeconds:&amp;lt;nil&amp;gt; Labels:map&lt;span class="o">[]&lt;/span> Annotations:map&lt;span class="o">[]&lt;/span> OwnerReferences:&lt;span class="o">[]&lt;/span> Finalizers:&lt;span class="o">[]&lt;/span> ZZZ_DeprecatedClusterName: ManagedFields:&lt;span class="o">[{&lt;/span>Manager:kne_cli Operation:Update APIVersion:networkop.co.uk/v1beta1 Time:2022-06-01 13:29:27 +0000 UTC FieldsType:FieldsV1 FieldsV1:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;f:spec&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;.&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:links&amp;#34;&lt;/span>:&lt;span class="o">{}}}&lt;/span> Subresource:&lt;span class="o">}]}&lt;/span> Status:&lt;span class="o">{&lt;/span>TypeMeta:&lt;span class="o">{&lt;/span>Kind: APIVersion:&lt;span class="o">}&lt;/span> ObjectMeta:&lt;span class="o">{&lt;/span>Name: GenerateName: Namespace: SelfLink: UID: ResourceVersion: Generation:0 CreationTimestamp:0001-01-01 00:00:00 +0000 UTC DeletionTimestamp:&amp;lt;nil&amp;gt; DeletionGracePeriodSeconds:&amp;lt;nil&amp;gt; Labels:map&lt;span class="o">[]&lt;/span> Annotations:map&lt;span class="o">[]&lt;/span> OwnerReferences:&lt;span class="o">[]&lt;/span> Finalizers:&lt;span class="o">[]&lt;/span> ZZZ_DeprecatedClusterName: ManagedFields:&lt;span class="o">[]}&lt;/span> Skipped:&lt;span class="o">[]&lt;/span> SrcIp: NetNs:&lt;span class="o">}&lt;/span> Spec:&lt;span class="o">{&lt;/span>TypeMeta:&lt;span class="o">{&lt;/span>Kind: APIVersion:&lt;span class="o">}&lt;/span> Links:&lt;span class="o">[{&lt;/span>LocalIntf:eth1 LocalIP: PeerIntf:eth1 PeerIP: PeerPod:vm-2 UID:0&lt;span class="o">}]}}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Creating Node Pods
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Creating Pod:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name:&lt;span class="s2">&amp;#34;vm-1&amp;#34;&lt;/span> type:HOST config:&lt;span class="o">{&lt;/span>command:&lt;span class="s2">&amp;#34;/bin/sh&amp;#34;&lt;/span> command:&lt;span class="s2">&amp;#34;-c&amp;#34;&lt;/span> command:&lt;span class="s2">&amp;#34;sleep 2000000000000&amp;#34;&lt;/span> image:&lt;span class="s2">&amp;#34;hfam/ubuntu:latest&amp;#34;&lt;/span> entry_command:&lt;span class="s2">&amp;#34;kubectl exec -it vm-1 -- sh&amp;#34;&lt;/span> config_path:&lt;span class="s2">&amp;#34;/etc&amp;#34;&lt;/span> config_file:&lt;span class="s2">&amp;#34;config&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> interfaces:&lt;span class="o">{&lt;/span>key:&lt;span class="s2">&amp;#34;eth1&amp;#34;&lt;/span> value:&lt;span class="o">{&lt;/span>int_name:&lt;span class="s2">&amp;#34;eth1&amp;#34;&lt;/span> peer_name:&lt;span class="s2">&amp;#34;vm-2&amp;#34;&lt;/span> peer_int_name:&lt;span class="s2">&amp;#34;eth1&amp;#34;&lt;/span>&lt;span class="o">}}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> no services found
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Node &lt;span class="s2">&amp;#34;vm-1&amp;#34;&lt;/span> resource created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Creating Pod:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name:&lt;span class="s2">&amp;#34;vm-2&amp;#34;&lt;/span> type:HOST config:&lt;span class="o">{&lt;/span>command:&lt;span class="s2">&amp;#34;/bin/sh&amp;#34;&lt;/span> command:&lt;span class="s2">&amp;#34;-c&amp;#34;&lt;/span> command:&lt;span class="s2">&amp;#34;sleep 2000000000000&amp;#34;&lt;/span> image:&lt;span class="s2">&amp;#34;alpine:latest&amp;#34;&lt;/span> entry_command:&lt;span class="s2">&amp;#34;kubectl exec -it vm-2 -- sh&amp;#34;&lt;/span> config_path:&lt;span class="s2">&amp;#34;/etc&amp;#34;&lt;/span> config_file:&lt;span class="s2">&amp;#34;config&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> interfaces:&lt;span class="o">{&lt;/span>key:&lt;span class="s2">&amp;#34;eth1&amp;#34;&lt;/span> value:&lt;span class="o">{&lt;/span>int_name:&lt;span class="s2">&amp;#34;eth1&amp;#34;&lt;/span> peer_name:&lt;span class="s2">&amp;#34;vm-1&amp;#34;&lt;/span> peer_int_name:&lt;span class="s2">&amp;#34;eth1&amp;#34;&lt;/span>&lt;span class="o">}}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> no services found
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Node &lt;span class="s2">&amp;#34;vm-2&amp;#34;&lt;/span> resource created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0003&lt;span class="o">]&lt;/span> Node &lt;span class="s2">&amp;#34;vm-1&amp;#34;&lt;/span>: Status RUNNING
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0003&lt;span class="o">]&lt;/span> Node &lt;span class="s2">&amp;#34;vm-2&amp;#34;&lt;/span>: Status RUNNING
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0003&lt;span class="o">]&lt;/span> Topology &lt;span class="s2">&amp;#34;2node-host&amp;#34;&lt;/span> created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Error: failed to check resource kne/examples/2node-host.pb.txt: could not get services &lt;span class="k">for&lt;/span> node vm-1: services &lt;span class="s2">&amp;#34;service-vm-1&amp;#34;&lt;/span> not found
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Let&amp;rsquo;s look in k8s&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ kubectl get all -n 2node-host -owide
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod/vm-1 1/1 Running &lt;span class="m">0&lt;/span> 55s 10.244.115.196 kates-node-01 &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod/vm-2 1/1 Running &lt;span class="m">0&lt;/span> 55s 10.244.209.195 kates-node-02 &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Attach to the 1st device&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ kubectl &lt;span class="nb">exec&lt;/span> -n 2node-host -it pod/vm-1 -- bash
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Defaulted container &lt;span class="s2">&amp;#34;vm-1&amp;#34;&lt;/span> out of: vm-1, init-vm-1 &lt;span class="o">(&lt;/span>init&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@vm-1:/#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@vm-1:/# ip link
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">1: lo: &amp;lt;LOOPBACK,UP,LOWER_UP&amp;gt; mtu &lt;span class="m">65536&lt;/span> qdisc noqueue state UNKNOWN mode DEFAULT group default qlen &lt;span class="m">1000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">3: eth0@if26: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu &lt;span class="m">1450&lt;/span> qdisc noqueue state UP mode DEFAULT group default
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> link/ether d6:75:2e:b9:44:e1 brd ff:ff:ff:ff:ff:ff link-netnsid &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">27: eth1@if27: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu &lt;span class="m">1450&lt;/span> qdisc noqueue state UNKNOWN mode DEFAULT group default qlen &lt;span class="m">1000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> link/ether 5e:02:2b:e4:66:b2 brd ff:ff:ff:ff:ff:ff link-netnsid &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@vm-1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Configure an IP address on the adapter connected to the 2nd device&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@vm-1:/# ip add add 10.1.1.1/30 dev eth1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@vm-1:/# &lt;span class="nb">exit&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">exit&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Attach to the 2nd device, do the same and verify that the ping is successful&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ kubectl &lt;span class="nb">exec&lt;/span> -n 2node-host -it pod/vm-2 -- sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Defaulted container &lt;span class="s2">&amp;#34;vm-2&amp;#34;&lt;/span> out of: vm-2, init-vm-2 &lt;span class="o">(&lt;/span>init&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/ &lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/ &lt;span class="c1"># ip link&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/ &lt;span class="c1"># ip add add 10.1.1.2/30 dev eth1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/ &lt;span class="c1"># ping 10.1.1.1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PING 10.1.1.1 &lt;span class="o">(&lt;/span>10.1.1.1&lt;span class="o">)&lt;/span>: &lt;span class="m">56&lt;/span> data bytes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">64&lt;/span> bytes from 10.1.1.1: &lt;span class="nv">seq&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">ttl&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">64&lt;/span> &lt;span class="nv">time&lt;/span>&lt;span class="o">=&lt;/span>3.370 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">64&lt;/span> bytes from 10.1.1.1: &lt;span class="nv">seq&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">1&lt;/span> &lt;span class="nv">ttl&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">64&lt;/span> &lt;span class="nv">time&lt;/span>&lt;span class="o">=&lt;/span>1.082 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">64&lt;/span> bytes from 10.1.1.1: &lt;span class="nv">seq&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">2&lt;/span> &lt;span class="nv">ttl&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">64&lt;/span> &lt;span class="nv">time&lt;/span>&lt;span class="o">=&lt;/span>0.844 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">64&lt;/span> bytes from 10.1.1.1: &lt;span class="nv">seq&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">3&lt;/span> &lt;span class="nv">ttl&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">64&lt;/span> &lt;span class="nv">time&lt;/span>&lt;span class="o">=&lt;/span>1.001 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">^C
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--- 10.1.1.1 ping statistics ---
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">4&lt;/span> packets transmitted, &lt;span class="m">4&lt;/span> packets received, 0% packet loss
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">round-trip min/avg/max &lt;span class="o">=&lt;/span> 0.844/1.574/3.370 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># We are learning the MAC of the peer device&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/ &lt;span class="c1"># ip nei&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">10.1.1.1 dev eth1 lladdr 5e:02:2b:e4:66:b2 ref &lt;span class="m">1&lt;/span> used 0/0/0 probes &lt;span class="m">4&lt;/span> REACHABLE&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Seems working, right? &amp;#x1f604;&lt;/p>
&lt;hr>
&lt;h3 class="heading-element" id="test-nokia-srlinux">&lt;span>Test Nokia srlinux&lt;/span>
 &lt;a href="#test-nokia-srlinux" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h3>&lt;hr>
&lt;p>In order to use the srlinux container we need to have the srlinux controller installed in k8s.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ kubectl apply -k https://github.com/srl-labs/srl-controller/config/default
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">namespace/srlinux-controller created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">customresourcedefinition.apiextensions.k8s.io/srlinuxes.kne.srlinux.dev created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">serviceaccount/srlinux-controller-controller-manager created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">role.rbac.authorization.k8s.io/srlinux-controller-leader-election-role created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">clusterrole.rbac.authorization.k8s.io/srlinux-controller-manager-role created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">clusterrole.rbac.authorization.k8s.io/srlinux-controller-metrics-reader created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">clusterrole.rbac.authorization.k8s.io/srlinux-controller-proxy-role created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rolebinding.rbac.authorization.k8s.io/srlinux-controller-leader-election-rolebinding created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">clusterrolebinding.rbac.authorization.k8s.io/srlinux-controller-manager-rolebinding created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">clusterrolebinding.rbac.authorization.k8s.io/srlinux-controller-proxy-rolebinding created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">configmap/srlinux-controller-manager-config created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">service/srlinux-controller-controller-manager-metrics-service created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">deployment.apps/srlinux-controller-controller-manager created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ kubectl get all -n srlinux-controller
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod/srlinux-controller-controller-manager-69f6579c6f-skg2j 2/2 Running &lt;span class="m">0&lt;/span> 40s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME TYPE CLUSTER-IP EXTERNAL-IP PORT&lt;span class="o">(&lt;/span>S&lt;span class="o">)&lt;/span> AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">service/srlinux-controller-controller-manager-metrics-service ClusterIP 10.100.185.117 &amp;lt;none&amp;gt; 8443/TCP 40s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY UP-TO-DATE AVAILABLE AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">deployment.apps/srlinux-controller-controller-manager 1/1 &lt;span class="m">1&lt;/span> &lt;span class="m">1&lt;/span> 40s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME DESIRED CURRENT READY AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">replicaset.apps/srlinux-controller-controller-manager-69f6579c6f &lt;span class="m">1&lt;/span> &lt;span class="m">1&lt;/span> &lt;span class="m">1&lt;/span> 40s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ kubectl get events -n srlinux-controller
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">LAST SEEN TYPE REASON OBJECT MESSAGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">49s Normal LeaderElection configmap/8bce046c.srlinux.dev srlinux-controller-controller-manager-69f6579c6f-skg2j_9e9d41e6-e29c-4abd-849f-39fd019eca72 became leader
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">49s Normal LeaderElection lease/8bce046c.srlinux.dev srlinux-controller-controller-manager-69f6579c6f-skg2j_9e9d41e6-e29c-4abd-849f-39fd019eca72 became leader
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">62s Normal Scheduled pod/srlinux-controller-controller-manager-69f6579c6f-skg2j Successfully assigned srlinux-controller/srlinux-controller-controller-manager-69f6579c6f-skg2j to kates-node-02
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">61s Normal Pulling pod/srlinux-controller-controller-manager-69f6579c6f-skg2j Pulling image &lt;span class="s2">&amp;#34;gcr.io/kubebuilder/kube-rbac-proxy:v0.8.0&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">57s Normal Pulled pod/srlinux-controller-controller-manager-69f6579c6f-skg2j Successfully pulled image &lt;span class="s2">&amp;#34;gcr.io/kubebuilder/kube-rbac-proxy:v0.8.0&amp;#34;&lt;/span> in 4.485800395s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">57s Normal Created pod/srlinux-controller-controller-manager-69f6579c6f-skg2j Created container kube-rbac-proxy
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">57s Normal Started pod/srlinux-controller-controller-manager-69f6579c6f-skg2j Started container kube-rbac-proxy
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">57s Normal Pulling pod/srlinux-controller-controller-manager-69f6579c6f-skg2j Pulling image &lt;span class="s2">&amp;#34;ghcr.io/srl-labs/srl-controller:0.3.1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">53s Normal Pulled pod/srlinux-controller-controller-manager-69f6579c6f-skg2j Successfully pulled image &lt;span class="s2">&amp;#34;ghcr.io/srl-labs/srl-controller:0.3.1&amp;#34;&lt;/span> in 4.313788546s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">52s Normal Created pod/srlinux-controller-controller-manager-69f6579c6f-skg2j Created container manager
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">52s Normal Started pod/srlinux-controller-controller-manager-69f6579c6f-skg2j Started container manager
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">62s Normal SuccessfulCreate replicaset/srlinux-controller-controller-manager-69f6579c6f Created pod: srlinux-controller-controller-manager-69f6579c6f-skg2j
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">62s Normal ScalingReplicaSet deployment/srlinux-controller-controller-manager Scaled up replica &lt;span class="nb">set&lt;/span> srlinux-controller-controller-manager-69f6579c6f to &lt;span class="m">1&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Deploy a sample topology using KNEs sample topologies files.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ cat kne/examples/srlinux/2node-srl-with-cert.pbtxt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">name: &lt;span class="s2">&amp;#34;2srl-certs&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nodes: &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: &lt;span class="s2">&amp;#34;r1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> type: NOKIA_SRL
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> config: &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> cert: &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self_signed: &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> cert_name: &lt;span class="s2">&amp;#34;kne-profile&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> key_name: &lt;span class="s2">&amp;#34;N/A&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> key_size: 4096,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> services:&lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> key: &lt;span class="m">22&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> value: &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: &lt;span class="s2">&amp;#34;ssh&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> inside: &lt;span class="m">22&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> services:&lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> key: &lt;span class="m">57400&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> value: &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: &lt;span class="s2">&amp;#34;gnmi&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> inside: &lt;span class="m">57400&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nodes: &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: &lt;span class="s2">&amp;#34;r2&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> type: NOKIA_SRL
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> config: &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> cert: &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self_signed: &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> cert_name: &lt;span class="s2">&amp;#34;kne-profile&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> key_name: &lt;span class="s2">&amp;#34;N/A&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> key_size: 4096,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> services:&lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> key: &lt;span class="m">22&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> value: &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: &lt;span class="s2">&amp;#34;ssh&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> inside: &lt;span class="m">22&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">links: &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> a_node: &lt;span class="s2">&amp;#34;r1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> a_int: &lt;span class="s2">&amp;#34;e1-1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> z_node: &lt;span class="s2">&amp;#34;r2&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> z_int: &lt;span class="s2">&amp;#34;e1-1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Create the topology with 2 SR linux devices.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ kne_cli create kne/examples/srlinux/2node-srl-with-cert.pbtxt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> /home/ubuntu/kne/examples/srlinux
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Creating manager &lt;span class="k">for&lt;/span>: 2srl-certs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Trying in-cluster configuration
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Falling back to kubeconfig: &lt;span class="s2">&amp;#34;/home/ubuntu/.kube/config&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Topology:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">name: &lt;span class="s2">&amp;#34;2srl-certs&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nodes: &amp;lt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: &lt;span class="s2">&amp;#34;r1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> type: NOKIA_SRL
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> config: &amp;lt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> cert: &amp;lt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self_signed: &amp;lt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> cert_name: &lt;span class="s2">&amp;#34;kne-profile&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> key_name: &lt;span class="s2">&amp;#34;N/A&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> key_size: &lt;span class="m">4096&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> services: &amp;lt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> key: &lt;span class="m">22&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> value: &amp;lt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: &lt;span class="s2">&amp;#34;ssh&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> inside: &lt;span class="m">22&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> services: &amp;lt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> key: &lt;span class="m">57400&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> value: &amp;lt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: &lt;span class="s2">&amp;#34;gnmi&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> inside: &lt;span class="m">57400&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nodes: &amp;lt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: &lt;span class="s2">&amp;#34;r2&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> type: NOKIA_SRL
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> config: &amp;lt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> cert: &amp;lt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self_signed: &amp;lt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> cert_name: &lt;span class="s2">&amp;#34;kne-profile&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> key_name: &lt;span class="s2">&amp;#34;N/A&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> key_size: &lt;span class="m">4096&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> services: &amp;lt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> key: &lt;span class="m">22&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> value: &amp;lt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: &lt;span class="s2">&amp;#34;ssh&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> inside: &lt;span class="m">22&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">links: &amp;lt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> a_node: &lt;span class="s2">&amp;#34;r1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> a_int: &lt;span class="s2">&amp;#34;e1-1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> z_node: &lt;span class="s2">&amp;#34;r2&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> z_int: &lt;span class="s2">&amp;#34;e1-1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Adding Link: r1:e1-1 r2:e1-1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Adding Node: r1:UNKNOWN:NOKIA_SRL
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Adding Node: r2:UNKNOWN:NOKIA_SRL
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Creating namespace &lt;span class="k">for&lt;/span> topology: &lt;span class="s2">&amp;#34;2srl-certs&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Server Namespace: &lt;span class="p">&amp;amp;&lt;/span>Namespace&lt;span class="o">{&lt;/span>ObjectMeta:&lt;span class="o">{&lt;/span>2srl-certs 3dbfff65-53fe-430a-b4a5-1d8f364b598c &lt;span class="m">9092&lt;/span> &lt;span class="m">0&lt;/span> 2022-06-03 21:30:30 +0000 UTC &amp;lt;nil&amp;gt; &amp;lt;nil&amp;gt; map&lt;span class="o">[&lt;/span>kubernetes.io/metadata.name:2srl-certs&lt;span class="o">]&lt;/span> map&lt;span class="o">[]&lt;/span> &lt;span class="o">[]&lt;/span> &lt;span class="o">[]&lt;/span> &lt;span class="o">[{&lt;/span>kne_cli Update v1 2022-06-03 21:30:30 +0000 UTC FieldsV1 &lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;f:metadata&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;f:labels&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;.&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:kubernetes.io/metadata.name&amp;#34;&lt;/span>:&lt;span class="o">{}}}}}]}&lt;/span>,Spec:NamespaceSpec&lt;span class="o">{&lt;/span>Finalizers:&lt;span class="o">[&lt;/span>kubernetes&lt;span class="o">]&lt;/span>,&lt;span class="o">}&lt;/span>,Status:NamespaceStatus&lt;span class="o">{&lt;/span>Phase:Active,Conditions:&lt;span class="o">[]&lt;/span>NamespaceCondition&lt;span class="o">{}&lt;/span>,&lt;span class="o">}&lt;/span>,&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Getting topology specs &lt;span class="k">for&lt;/span> namespace 2srl-certs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Getting topology specs &lt;span class="k">for&lt;/span> node r1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Getting topology specs &lt;span class="k">for&lt;/span> node r2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Creating topology &lt;span class="k">for&lt;/span> meshnet node r2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Meshnet Node:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;amp;&lt;/span>&lt;span class="o">{&lt;/span>TypeMeta:&lt;span class="o">{&lt;/span>Kind: APIVersion:&lt;span class="o">}&lt;/span> ObjectMeta:&lt;span class="o">{&lt;/span>Name:r2 GenerateName: Namespace:2srl-certs SelfLink: UID:45c4a20d-a803-491d-8a78-9a75603e3f1a ResourceVersion:9095 Generation:1 CreationTimestamp:2022-06-03 21:30:30 +0000 UTC DeletionTimestamp:&amp;lt;nil&amp;gt; DeletionGracePeriodSeconds:&amp;lt;nil&amp;gt; Labels:map&lt;span class="o">[]&lt;/span> Annotations:map&lt;span class="o">[]&lt;/span> OwnerReferences:&lt;span class="o">[]&lt;/span> Finalizers:&lt;span class="o">[]&lt;/span> ClusterName: ManagedFields:&lt;span class="o">[{&lt;/span>Manager:kne_cli Operation:Update APIVersion:networkop.co.uk/v1beta1 Time:2022-06-03 21:30:30 +0000 UTC FieldsType:FieldsV1 FieldsV1:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;f:spec&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;.&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:links&amp;#34;&lt;/span>:&lt;span class="o">{}}}}]}&lt;/span> Status:&lt;span class="o">{&lt;/span>TypeMeta:&lt;span class="o">{&lt;/span>Kind: APIVersion:&lt;span class="o">}&lt;/span> ObjectMeta:&lt;span class="o">{&lt;/span>Name: GenerateName: Namespace: SelfLink: UID: ResourceVersion: Generation:0 CreationTimestamp:0001-01-01 00:00:00 +0000 UTC DeletionTimestamp:&amp;lt;nil&amp;gt; DeletionGracePeriodSeconds:&amp;lt;nil&amp;gt; Labels:map&lt;span class="o">[]&lt;/span> Annotations:map&lt;span class="o">[]&lt;/span> OwnerReferences:&lt;span class="o">[]&lt;/span> Finalizers:&lt;span class="o">[]&lt;/span> ClusterName: ManagedFields:&lt;span class="o">[]}&lt;/span> Skipped:&lt;span class="o">[]&lt;/span> SrcIp: NetNs:&lt;span class="o">}&lt;/span> Spec:&lt;span class="o">{&lt;/span>TypeMeta:&lt;span class="o">{&lt;/span>Kind: APIVersion:&lt;span class="o">}&lt;/span> Links:&lt;span class="o">[{&lt;/span>LocalIntf:e1-1 LocalIP: PeerIntf:e1-1 PeerIP: PeerPod:r1 UID:0&lt;span class="o">}]}}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Creating topology &lt;span class="k">for&lt;/span> meshnet node r1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Meshnet Node:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;amp;&lt;/span>&lt;span class="o">{&lt;/span>TypeMeta:&lt;span class="o">{&lt;/span>Kind: APIVersion:&lt;span class="o">}&lt;/span> ObjectMeta:&lt;span class="o">{&lt;/span>Name:r1 GenerateName: Namespace:2srl-certs SelfLink: UID:bda477bd-f318-4a3d-ba2a-a7688c60716b ResourceVersion:9096 Generation:1 CreationTimestamp:2022-06-03 21:30:30 +0000 UTC DeletionTimestamp:&amp;lt;nil&amp;gt; DeletionGracePeriodSeconds:&amp;lt;nil&amp;gt; Labels:map&lt;span class="o">[]&lt;/span> Annotations:map&lt;span class="o">[]&lt;/span> OwnerReferences:&lt;span class="o">[]&lt;/span> Finalizers:&lt;span class="o">[]&lt;/span> ClusterName: ManagedFields:&lt;span class="o">[{&lt;/span>Manager:kne_cli Operation:Update APIVersion:networkop.co.uk/v1beta1 Time:2022-06-03 21:30:30 +0000 UTC FieldsType:FieldsV1 FieldsV1:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;f:spec&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;.&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:links&amp;#34;&lt;/span>:&lt;span class="o">{}}}}]}&lt;/span> Status:&lt;span class="o">{&lt;/span>TypeMeta:&lt;span class="o">{&lt;/span>Kind: APIVersion:&lt;span class="o">}&lt;/span> ObjectMeta:&lt;span class="o">{&lt;/span>Name: GenerateName: Namespace: SelfLink: UID: ResourceVersion: Generation:0 CreationTimestamp:0001-01-01 00:00:00 +0000 UTC DeletionTimestamp:&amp;lt;nil&amp;gt; DeletionGracePeriodSeconds:&amp;lt;nil&amp;gt; Labels:map&lt;span class="o">[]&lt;/span> Annotations:map&lt;span class="o">[]&lt;/span> OwnerReferences:&lt;span class="o">[]&lt;/span> Finalizers:&lt;span class="o">[]&lt;/span> ClusterName: ManagedFields:&lt;span class="o">[]}&lt;/span> Skipped:&lt;span class="o">[]&lt;/span> SrcIp: NetNs:&lt;span class="o">}&lt;/span> Spec:&lt;span class="o">{&lt;/span>TypeMeta:&lt;span class="o">{&lt;/span>Kind: APIVersion:&lt;span class="o">}&lt;/span> Links:&lt;span class="o">[{&lt;/span>LocalIntf:e1-1 LocalIP: PeerIntf:e1-1 PeerIP: PeerPod:r2 UID:0&lt;span class="o">}]}}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Creating Node Pods
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Creating Srlinux node resource r1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Created SR Linux node r1 configmap
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Created Srlinux resource: r1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Created Service:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;amp;&lt;/span>Service&lt;span class="o">{&lt;/span>ObjectMeta:&lt;span class="o">{&lt;/span>service-r1 2srl-certs 776a3f25-05bd-483e-9947-2800efa8e796 &lt;span class="m">9111&lt;/span> &lt;span class="m">0&lt;/span> 2022-06-03 21:30:31 +0000 UTC &amp;lt;nil&amp;gt; &amp;lt;nil&amp;gt; map&lt;span class="o">[&lt;/span>pod:r1&lt;span class="o">]&lt;/span> map&lt;span class="o">[]&lt;/span> &lt;span class="o">[]&lt;/span> &lt;span class="o">[]&lt;/span> &lt;span class="o">[{&lt;/span>kne_cli Update v1 2022-06-03 21:30:31 +0000 UTC FieldsV1 &lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;f:metadata&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;f:labels&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;.&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:pod&amp;#34;&lt;/span>:&lt;span class="o">{}}}&lt;/span>,&lt;span class="s2">&amp;#34;f:spec&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;f:allocateLoadBalancerNodePorts&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:externalTrafficPolicy&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:internalTrafficPolicy&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:ports&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;.&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;k:{\&amp;#34;port\&amp;#34;:22,\&amp;#34;protocol\&amp;#34;:\&amp;#34;TCP\&amp;#34;}&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;.&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:name&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:port&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:protocol&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:targetPort&amp;#34;&lt;/span>:&lt;span class="o">{}}&lt;/span>,&lt;span class="s2">&amp;#34;k:{\&amp;#34;port\&amp;#34;:57400,\&amp;#34;protocol\&amp;#34;:\&amp;#34;TCP\&amp;#34;}&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;.&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:name&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:port&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:protocol&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:targetPort&amp;#34;&lt;/span>:&lt;span class="o">{}}}&lt;/span>,&lt;span class="s2">&amp;#34;f:selector&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:sessionAffinity&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:type&amp;#34;&lt;/span>:&lt;span class="o">{}}}}]}&lt;/span>,Spec:ServiceSpec&lt;span class="o">{&lt;/span>Ports:&lt;span class="o">[]&lt;/span>ServicePort&lt;span class="o">{&lt;/span>ServicePort&lt;span class="o">{&lt;/span>Name:ssh,Protocol:TCP,Port:22,TargetPort:&lt;span class="o">{&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="m">22&lt;/span> &lt;span class="o">}&lt;/span>,NodePort:30742,AppProtocol:nil,&lt;span class="o">}&lt;/span>,ServicePort&lt;span class="o">{&lt;/span>Name:gnmi,Protocol:TCP,Port:57400,TargetPort:&lt;span class="o">{&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="m">57400&lt;/span> &lt;span class="o">}&lt;/span>,NodePort:30637,AppProtocol:nil,&lt;span class="o">}&lt;/span>,&lt;span class="o">}&lt;/span>,Selector:map&lt;span class="o">[&lt;/span>string&lt;span class="o">]&lt;/span>string&lt;span class="o">{&lt;/span>app: r1,&lt;span class="o">}&lt;/span>,ClusterIP:10.103.94.50,Type:LoadBalancer,ExternalIPs:&lt;span class="o">[]&lt;/span>,SessionAffinity:None,LoadBalancerIP:,LoadBalancerSourceRanges:&lt;span class="o">[]&lt;/span>,ExternalName:,ExternalTrafficPolicy:Cluster,HealthCheckNodePort:0,PublishNotReadyAddresses:false,SessionAffinityConfig:nil,TopologyKeys:&lt;span class="o">[]&lt;/span>,IPFamilyPolicy:*SingleStack,ClusterIPs:&lt;span class="o">[&lt;/span>10.103.94.50&lt;span class="o">]&lt;/span>,IPFamilies:&lt;span class="o">[&lt;/span>IPv4&lt;span class="o">]&lt;/span>,AllocateLoadBalancerNodePorts:*true,LoadBalancerClass:nil,InternalTrafficPolicy:*Cluster,&lt;span class="o">}&lt;/span>,Status:ServiceStatus&lt;span class="o">{&lt;/span>LoadBalancer:LoadBalancerStatus&lt;span class="o">{&lt;/span>Ingress:&lt;span class="o">[]&lt;/span>LoadBalancerIngress&lt;span class="o">{}&lt;/span>,&lt;span class="o">}&lt;/span>,Conditions:&lt;span class="o">[]&lt;/span>Condition&lt;span class="o">{}&lt;/span>,&lt;span class="o">}&lt;/span>,&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Node &lt;span class="s2">&amp;#34;r1&amp;#34;&lt;/span> resource created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Creating Srlinux node resource r2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Created SR Linux node r2 configmap
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0001&lt;span class="o">]&lt;/span> Created Srlinux resource: r2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0001&lt;span class="o">]&lt;/span> Created Service:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;amp;&lt;/span>Service&lt;span class="o">{&lt;/span>ObjectMeta:&lt;span class="o">{&lt;/span>service-r2 2srl-certs 09c1e6e0-0c19-4497-b133-d2b2fa22d20d &lt;span class="m">9126&lt;/span> &lt;span class="m">0&lt;/span> 2022-06-03 21:30:31 +0000 UTC &amp;lt;nil&amp;gt; &amp;lt;nil&amp;gt; map&lt;span class="o">[&lt;/span>pod:r2&lt;span class="o">]&lt;/span> map&lt;span class="o">[]&lt;/span> &lt;span class="o">[]&lt;/span> &lt;span class="o">[]&lt;/span> &lt;span class="o">[{&lt;/span>kne_cli Update v1 2022-06-03 21:30:31 +0000 UTC FieldsV1 &lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;f:metadata&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;f:labels&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;.&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:pod&amp;#34;&lt;/span>:&lt;span class="o">{}}}&lt;/span>,&lt;span class="s2">&amp;#34;f:spec&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;f:allocateLoadBalancerNodePorts&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:externalTrafficPolicy&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:internalTrafficPolicy&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:ports&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;.&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;k:{\&amp;#34;port\&amp;#34;:22,\&amp;#34;protocol\&amp;#34;:\&amp;#34;TCP\&amp;#34;}&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;.&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:name&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:port&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:protocol&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:targetPort&amp;#34;&lt;/span>:&lt;span class="o">{}}}&lt;/span>,&lt;span class="s2">&amp;#34;f:selector&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:sessionAffinity&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:type&amp;#34;&lt;/span>:&lt;span class="o">{}}}}]}&lt;/span>,Spec:ServiceSpec&lt;span class="o">{&lt;/span>Ports:&lt;span class="o">[]&lt;/span>ServicePort&lt;span class="o">{&lt;/span>ServicePort&lt;span class="o">{&lt;/span>Name:ssh,Protocol:TCP,Port:22,TargetPort:&lt;span class="o">{&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="m">22&lt;/span> &lt;span class="o">}&lt;/span>,NodePort:32417,AppProtocol:nil,&lt;span class="o">}&lt;/span>,&lt;span class="o">}&lt;/span>,Selector:map&lt;span class="o">[&lt;/span>string&lt;span class="o">]&lt;/span>string&lt;span class="o">{&lt;/span>app: r2,&lt;span class="o">}&lt;/span>,ClusterIP:10.111.173.232,Type:LoadBalancer,ExternalIPs:&lt;span class="o">[]&lt;/span>,SessionAffinity:None,LoadBalancerIP:,LoadBalancerSourceRanges:&lt;span class="o">[]&lt;/span>,ExternalName:,ExternalTrafficPolicy:Cluster,HealthCheckNodePort:0,PublishNotReadyAddresses:false,SessionAffinityConfig:nil,TopologyKeys:&lt;span class="o">[]&lt;/span>,IPFamilyPolicy:*SingleStack,ClusterIPs:&lt;span class="o">[&lt;/span>10.111.173.232&lt;span class="o">]&lt;/span>,IPFamilies:&lt;span class="o">[&lt;/span>IPv4&lt;span class="o">]&lt;/span>,AllocateLoadBalancerNodePorts:*true,LoadBalancerClass:nil,InternalTrafficPolicy:*Cluster,&lt;span class="o">}&lt;/span>,Status:ServiceStatus&lt;span class="o">{&lt;/span>LoadBalancer:LoadBalancerStatus&lt;span class="o">{&lt;/span>Ingress:&lt;span class="o">[]&lt;/span>LoadBalancerIngress&lt;span class="o">{}&lt;/span>,&lt;span class="o">}&lt;/span>,Conditions:&lt;span class="o">[]&lt;/span>Condition&lt;span class="o">{}&lt;/span>,&lt;span class="o">}&lt;/span>,&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0001&lt;span class="o">]&lt;/span> Node &lt;span class="s2">&amp;#34;r2&amp;#34;&lt;/span> resource created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0001&lt;span class="o">]&lt;/span> r1 - generating self signed certs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0001&lt;span class="o">]&lt;/span> r1 - waiting &lt;span class="k">for&lt;/span> pod to be running
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0003&lt;span class="o">]&lt;/span> r1 - pod running.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0018&lt;span class="o">]&lt;/span> r1 - finshed cert generation
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0018&lt;span class="o">]&lt;/span> r2 - generating self signed certs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0018&lt;span class="o">]&lt;/span> r2 - waiting &lt;span class="k">for&lt;/span> pod to be running
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0018&lt;span class="o">]&lt;/span> r2 - pod running.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0021&lt;span class="o">]&lt;/span> r2 - finshed cert generation
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0022&lt;span class="o">]&lt;/span> Node &lt;span class="s2">&amp;#34;r1&amp;#34;&lt;/span>: Status RUNNING
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0022&lt;span class="o">]&lt;/span> Node &lt;span class="s2">&amp;#34;r2&amp;#34;&lt;/span>: Status RUNNING
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0022&lt;span class="o">]&lt;/span> Topology &lt;span class="s2">&amp;#34;2srl-certs&amp;#34;&lt;/span> created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0022&lt;span class="o">]&lt;/span> Pods:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0022&lt;span class="o">]&lt;/span> r1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0022&lt;span class="o">]&lt;/span> r2&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Now, it may take some time for the last command to complete since it is fetching the images as well. Let&amp;rsquo;s check on k8s.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ kubectl get all -n 2srl-certs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod/r1 1/1 Running &lt;span class="m">0&lt;/span> 23m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod/r2 1/1 Running &lt;span class="m">0&lt;/span> 23m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME TYPE CLUSTER-IP EXTERNAL-IP PORT&lt;span class="o">(&lt;/span>S&lt;span class="o">)&lt;/span> AGE
&lt;/span>&lt;/span>&lt;span class="line hl">&lt;span class="cl">service/service-r1 LoadBalancer 10.103.94.50 192.168.1.50 22:30742/TCP,57400:30637/TCP 23m
&lt;/span>&lt;/span>&lt;span class="line hl">&lt;span class="cl">service/service-r2 LoadBalancer 10.111.173.232 192.168.1.51 22:32417/TCP 23m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ kubectl get events -n 2srl-certs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">LAST SEEN TYPE REASON OBJECT MESSAGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">23m Normal Scheduled pod/r1 Successfully assigned 2srl-certs/r1 to kates-node-02
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">23m Normal Pulled pod/r1 Container image &lt;span class="s2">&amp;#34;networkop/init-wait:latest&amp;#34;&lt;/span> already present on machine
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">23m Normal Created pod/r1 Created container init-r1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">23m Normal Started pod/r1 Started container init-r1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">23m Normal Pulled pod/r1 Container image &lt;span class="s2">&amp;#34;ghcr.io/nokia/srlinux:latest&amp;#34;&lt;/span> already present on machine
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">23m Normal Created pod/r1 Created container r1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">23m Normal Started pod/r1 Started container r1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">23m Normal Scheduled pod/r2 Successfully assigned 2srl-certs/r2 to kates-node-01
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">23m Normal Pulled pod/r2 Container image &lt;span class="s2">&amp;#34;networkop/init-wait:latest&amp;#34;&lt;/span> already present on machine
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">23m Normal Created pod/r2 Created container init-r2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">23m Normal Started pod/r2 Started container init-r2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">23m Normal Pulled pod/r2 Container image &lt;span class="s2">&amp;#34;ghcr.io/nokia/srlinux:latest&amp;#34;&lt;/span> already present on machine
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">23m Normal Created pod/r2 Created container r2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">23m Normal Started pod/r2 Started container r2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">23m Normal IPAllocated service/service-r1 Assigned IP &lt;span class="o">[&lt;/span>&lt;span class="s2">&amp;#34;192.168.1.50&amp;#34;&lt;/span>&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">23m Normal nodeAssigned service/service-r1 announcing from node &lt;span class="s2">&amp;#34;kates-node-01&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">23m Normal IPAllocated service/service-r2 Assigned IP &lt;span class="o">[&lt;/span>&lt;span class="s2">&amp;#34;192.168.1.51&amp;#34;&lt;/span>&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">23m Normal nodeAssigned service/service-r2 announcing from node &lt;span class="s2">&amp;#34;kates-node-02&amp;#34;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>It looks good. From another terminal you can access the devices via SSH to the service IP assigned (admin:admin are the credentials).&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">❯ ssh admin@192.168.1.50
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">The authenticity of host &lt;span class="s1">&amp;#39;192.168.1.50 (192.168.1.50)&amp;#39;&lt;/span> can&lt;span class="s1">&amp;#39;t be established.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">ECDSA key fingerprint is SHA256:cJwi5r4UVEVYEX9IAqrThzCrIQUYRRk3y5i5Lnw5hPE.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">Warning: Permanently added &amp;#39;&lt;/span>192.168.1.50&lt;span class="s1">&amp;#39; (ECDSA) to the list of known hosts.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">admin@192.168.1.50&amp;#39;&lt;/span>s password:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Using configuration file&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>: &lt;span class="o">[&lt;/span>&lt;span class="s1">&amp;#39;/etc/opt/srlinux/srlinux.rc&amp;#39;&lt;/span>&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Welcome to the srlinux CLI.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type &lt;span class="s1">&amp;#39;help&amp;#39;&lt;/span> &lt;span class="o">(&lt;/span>and press &amp;lt;ENTER&amp;gt;&lt;span class="o">)&lt;/span> &lt;span class="k">if&lt;/span> you need any &lt;span class="nb">help&lt;/span> using this.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--&lt;span class="o">{&lt;/span> running &lt;span class="o">}&lt;/span>--&lt;span class="o">[&lt;/span> &lt;span class="o">]&lt;/span>--
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">A:r1#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">A:r1# show interface brief
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">+---------------------+---------------+---------------+---------------+---------------+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> Port &lt;span class="p">|&lt;/span> Admin State &lt;span class="p">|&lt;/span> Oper State &lt;span class="p">|&lt;/span> Speed &lt;span class="p">|&lt;/span> Type &lt;span class="p">|&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">+&lt;span class="o">=====================&lt;/span>+&lt;span class="o">===============&lt;/span>+&lt;span class="o">===============&lt;/span>+&lt;span class="o">===============&lt;/span>+&lt;span class="o">===============&lt;/span>+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> mgmt0 &lt;span class="p">|&lt;/span> &lt;span class="nb">enable&lt;/span> &lt;span class="p">|&lt;/span> down &lt;span class="p">|&lt;/span> &lt;span class="p">|&lt;/span> &lt;span class="p">|&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">+---------------------+---------------+---------------+---------------+---------------+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--&lt;span class="o">{&lt;/span> running &lt;span class="o">}&lt;/span>--&lt;span class="o">[&lt;/span> &lt;span class="o">]&lt;/span>--
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">A:r1#&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Hmmm, something is wrong here. We were supposed to get a bunch of interfaces, instead we got only mgmt0 and it is down.
Let&amp;rsquo;s attach to the device shell and check the interfaces with some pings&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ kubectl -n 2srl-certs &lt;span class="nb">exec&lt;/span> -it r1 -- bash
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Defaulted container &lt;span class="s2">&amp;#34;r1&amp;#34;&lt;/span> out of: r1, init-r1 &lt;span class="o">(&lt;/span>init&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@r1 /&lt;span class="o">]&lt;/span>&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@r1 /&lt;span class="o">]&lt;/span>&lt;span class="c1"># ip link&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">1: lo: &amp;lt;LOOPBACK,UP,LOWER_UP&amp;gt; mtu &lt;span class="m">65536&lt;/span> qdisc noqueue state UNKNOWN mode DEFAULT group default qlen &lt;span class="m">1000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">3: mgmt0@if6: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu &lt;span class="m">1450&lt;/span> qdisc noqueue state UP mode DEFAULT group default
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> link/ether 82:98:bc:94:f1:94 brd ff:ff:ff:ff:ff:ff link-netnsid &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">4: gway-2800@if2: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu &lt;span class="m">1500&lt;/span> qdisc noqueue state UP mode DEFAULT group default qlen &lt;span class="m">1000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> link/ether be:75:15:da:44:66 brd ff:ff:ff:ff:ff:ff link-netns srbase-mgmt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">7: e1-1@if7: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu &lt;span class="m">1450&lt;/span> qdisc noqueue state UNKNOWN mode DEFAULT group default qlen &lt;span class="m">1000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> link/ether f6:96:83:ff:1f:db brd ff:ff:ff:ff:ff:ff link-netnsid &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@r1 /&lt;span class="o">]&lt;/span>&lt;span class="c1"># ip add&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">1: lo: &amp;lt;LOOPBACK,UP,LOWER_UP&amp;gt; mtu &lt;span class="m">65536&lt;/span> qdisc noqueue state UNKNOWN group default qlen &lt;span class="m">1000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> inet 127.0.0.1/8 scope host lo
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> valid_lft forever preferred_lft forever
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> inet6 ::1/128 scope host
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> valid_lft forever preferred_lft forever
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">3: mgmt0@if6: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu &lt;span class="m">1450&lt;/span> qdisc noqueue state UP group default
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> link/ether 82:98:bc:94:f1:94 brd ff:ff:ff:ff:ff:ff link-netnsid &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> inet 10.244.2.53/24 brd 10.244.2.255 scope global eth0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> valid_lft forever preferred_lft forever
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> inet6 fe80::8098:bcff:fe94:f194/64 scope link
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> valid_lft forever preferred_lft forever
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">4: gway-2800@if2: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu &lt;span class="m">1500&lt;/span> qdisc noqueue state UP group default qlen &lt;span class="m">1000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> link/ether be:75:15:da:44:66 brd ff:ff:ff:ff:ff:ff link-netns srbase-mgmt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> inet6 fe80::bc75:15ff:feda:4466/64 scope link
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> valid_lft forever preferred_lft forever
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">7: e1-1@if7: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu &lt;span class="m">1450&lt;/span> qdisc noqueue state UNKNOWN group default qlen &lt;span class="m">1000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> link/ether f6:96:83:ff:1f:db brd ff:ff:ff:ff:ff:ff link-netnsid &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> inet6 fe80::f496:83ff:feff:1fdb/64 scope link
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> valid_lft forever preferred_lft forever
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@r1 /&lt;span class="o">]&lt;/span>&lt;span class="c1"># ip add add 10.1.1.1/30 dev e1-1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@r1 /&lt;span class="o">]&lt;/span>&lt;span class="c1"># exit&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">exit&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ kubectl -n 2srl-certs &lt;span class="nb">exec&lt;/span> -it r2 -- bash
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Defaulted container &lt;span class="s2">&amp;#34;r2&amp;#34;&lt;/span> out of: r2, init-r2 &lt;span class="o">(&lt;/span>init&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@r2 /&lt;span class="o">]&lt;/span>&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@r2 /&lt;span class="o">]&lt;/span>&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@r2 /&lt;span class="o">]&lt;/span>&lt;span class="c1"># ip add add 10.1.1.2/30 dev e1-1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@r2 /&lt;span class="o">]&lt;/span>&lt;span class="c1"># ping 10.1.1.1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PING 10.1.1.1 &lt;span class="o">(&lt;/span>10.1.1.1&lt;span class="o">)&lt;/span> 56&lt;span class="o">(&lt;/span>84&lt;span class="o">)&lt;/span> bytes of data.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">64&lt;/span> bytes from 10.1.1.1: &lt;span class="nv">icmp_seq&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">1&lt;/span> &lt;span class="nv">ttl&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">64&lt;/span> &lt;span class="nv">time&lt;/span>&lt;span class="o">=&lt;/span>1.99 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">64&lt;/span> bytes from 10.1.1.1: &lt;span class="nv">icmp_seq&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">2&lt;/span> &lt;span class="nv">ttl&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">64&lt;/span> &lt;span class="nv">time&lt;/span>&lt;span class="o">=&lt;/span>0.804 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">64&lt;/span> bytes from 10.1.1.1: &lt;span class="nv">icmp_seq&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">3&lt;/span> &lt;span class="nv">ttl&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">64&lt;/span> &lt;span class="nv">time&lt;/span>&lt;span class="o">=&lt;/span>0.678 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">64&lt;/span> bytes from 10.1.1.1: &lt;span class="nv">icmp_seq&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">4&lt;/span> &lt;span class="nv">ttl&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">64&lt;/span> &lt;span class="nv">time&lt;/span>&lt;span class="o">=&lt;/span>0.959 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">^C
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--- 10.1.1.1 ping statistics ---
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">4&lt;/span> packets transmitted, &lt;span class="m">4&lt;/span> received, 0% packet loss, &lt;span class="nb">time&lt;/span> 3052ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rtt min/avg/max/mdev &lt;span class="o">=&lt;/span> 0.678/1.108/1.992/0.520 ms&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Seems PODs are communicating fine, and I guess the issues is with the router itself, or should I say the container &amp;#x1f604;. Let&amp;rsquo;s check some logs.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ kubectl -n 2srl-certs describe pod/r1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt; ...omitted...&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Events:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Type Reason Age From Message
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ---- ------ ---- ---- -------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal Scheduled 36m default-scheduler Successfully assigned 2srl-certs/r1 to kates-node-02
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal Pulled 36m kubelet Container image &lt;span class="s2">&amp;#34;networkop/init-wait:latest&amp;#34;&lt;/span> already present on machine
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal Created 36m kubelet Created container init-r1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal Started 36m kubelet Started container init-r1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal Pulled 36m kubelet Container image &lt;span class="s2">&amp;#34;ghcr.io/nokia/srlinux:latest&amp;#34;&lt;/span> already present on machine
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal Created 36m kubelet Created container r1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal Started 36m kubelet Started container r1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Check to see the boot up logs&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ kubectl -n 2srl-certs logs r1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Defaulted container &lt;span class="s2">&amp;#34;r1&amp;#34;&lt;/span> out of: r1, init-r1 &lt;span class="o">(&lt;/span>init&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Fri Jun &lt;span class="m">3&lt;/span> 21:30:33 UTC 2022: entrypoint.sh called
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Fri Jun &lt;span class="m">3&lt;/span> 21:30:33 UTC 2022: renaming docker interface eth0 to mgmt0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Fri Jun &lt;span class="m">3&lt;/span> 21:30:33 UTC 2022: turning off checksum offloading on mgmt0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Actual changes:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rx-checksumming: off
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tx-checksumming: off
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tx-checksum-ip-generic: off
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tx-checksum-sctp: off
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tcp-segmentation-offload: off
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tx-tcp-segmentation: off &lt;span class="o">[&lt;/span>requested on&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tx-tcp-ecn-segmentation: off &lt;span class="o">[&lt;/span>requested on&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tx-tcp-mangleid-segmentation: off &lt;span class="o">[&lt;/span>requested on&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tx-tcp6-segmentation: off &lt;span class="o">[&lt;/span>requested on&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Fri Jun &lt;span class="m">3&lt;/span> 21:30:33 UTC 2022: starting sshd
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ssh-keygen: generating new host keys: RSA DSA ECDSA ED25519
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Fri Jun &lt;span class="m">3&lt;/span> 21:30:33 UTC 2022: Calling boot_run script
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cat: /sys/class/dmi/id/board_name: No such file or directory
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cat: /sys/class/dmi/id/board_name: No such file or directory
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/opt/srlinux/bin/bootscript/05_sr_createuser.sh: line 270: !srl_is_running_on_nokia_rootfs: &lt;span class="nb">command&lt;/span> not found
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/opt/srlinux/bin/bootscript/05_sr_createuser.sh: line 282: python: &lt;span class="nb">command&lt;/span> not found
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">chmod: cannot access &lt;span class="s1">&amp;#39;/dev/console&amp;#39;&lt;/span>: No such file or directory
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">chmod: missing operand after &lt;span class="s1">&amp;#39;0664&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Try &lt;span class="s1">&amp;#39;chmod --help&amp;#39;&lt;/span> &lt;span class="k">for&lt;/span> more information.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/usr/bin/find: &lt;span class="s1">&amp;#39;/var/log/srlinux/file&amp;#39;&lt;/span>: No such file or directory
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">logmgr_set_env.sh: plain_bootup_start
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Fri Jun &lt;span class="m">3&lt;/span> 21:30:35 UTC &lt;span class="m">2022&lt;/span> logmgr_set_env.sh: restart of rsyslogd
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">which: no python in &lt;span class="o">(&lt;/span>/opt/srlinux/bin:/opt/srlinux/usr/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">readlink: missing operand
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Try &lt;span class="s1">&amp;#39;readlink --help&amp;#39;&lt;/span> &lt;span class="k">for&lt;/span> more information.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">setfacl: /mnt/nokiaos: No such file or directory
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">setfacl: /mnt/nokiaos: No such file or directory
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">setfacl: /mnt/nokiaos: No such file or directory
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">setfacl: /mnt/nokiaos: No such file or directory
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">setfacl: Option -m: Invalid argument near character &lt;span class="m">5&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">setfacl: Option -m: Invalid argument near character &lt;span class="m">3&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">setfacl: Option -m: Invalid argument near character &lt;span class="m">5&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">setfacl: Option -m: Invalid argument near character &lt;span class="m">3&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">System has not been booted with systemd as init system &lt;span class="o">(&lt;/span>PID 1&lt;span class="o">)&lt;/span>. Can&lt;span class="s1">&amp;#39;t operate.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">Failed to connect to bus: Host is down
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">Failed to open connection to &amp;#34;system&amp;#34; message bus: Failed to connect to socket /run/dbus/system_bus_socket: No such file or directory
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">System has not been booted with systemd as init system (PID 1). Can&amp;#39;&lt;/span>t operate.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Failed to connect to bus: Host is down
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">findfs: unable to resolve &lt;span class="s1">&amp;#39;LABEL=EFI-System&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">No disk with label EFI-System is found
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Failed to &lt;span class="nb">set&lt;/span> capabilities on file &lt;span class="sb">`&lt;/span>/usr/sbin/tcpdump&lt;span class="s1">&amp;#39; (No such file or directory)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">usage: setcap [-q] [-v] [-n &amp;lt;rootid&amp;gt;] (-r|-|&amp;lt;caps&amp;gt;) &amp;lt;filename&amp;gt; [ ... (-r|-|&amp;lt;capsN&amp;gt;) &amp;lt;filenameN&amp;gt; ]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> Note &amp;lt;filename&amp;gt; must be a regular (non-symlink) file.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">Fri Jun 3 21:30:37 UTC 2022: entrypoint.sh done, executing sudo bash -c touch /.dockerenv &amp;amp;&amp;amp; /opt/srlinux/bin/sr_linux
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">No/Invalid license found!
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">Not starting in a named namespace, giving it the name &amp;#34;srbase&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">Unix domain socket directory is /opt/srlinux/var/run/
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">Log directory is /var/log/srlinux/stdout
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> Started supportd: source /etc/profile.d/sr_app_env.sh &amp;amp;&amp;gt;/dev/null; bash -c &amp;#34;./sr_supportd --server-mode&amp;#34; &amp;gt;/var/log/srlinux/stdout/supportd.log 2&amp;gt;&amp;amp;1 &amp;amp;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> Application supportd is running: PID 1525
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> Started dev_mgr: source /etc/profile.d/sr_app_env.sh &amp;amp;&amp;gt;/dev/null; bash -c &amp;#34;./sr_device_mgr&amp;#34; &amp;gt;/var/log/srlinux/stdout/dev_mgr.log 2&amp;gt;&amp;amp;1 &amp;amp;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> Application dev_mgr is running: PID 1548
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> Started idb_server: source /etc/profile.d/sr_app_env.sh &amp;amp;&amp;gt;/dev/null; bash -c &amp;#34;./sr_idb_server&amp;#34; &amp;gt;/var/log/srlinux/stdout/idb_server.log 2&amp;gt;&amp;amp;1 &amp;amp;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> Application idb_server is running: PID 1568
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> Started aaa_mgr: source /etc/profile.d/sr_app_env.sh &amp;amp;&amp;gt;/dev/null; bash -c &amp;#34;./sr_aaa_mgr&amp;#34; &amp;gt;/var/log/srlinux/stdout/aaa_mgr.log 2&amp;gt;&amp;amp;1 &amp;amp;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> Started acl_mgr: source /etc/profile.d/sr_app_env.sh &amp;amp;&amp;gt;/dev/null; bash -c &amp;#34;./sr_acl_mgr&amp;#34; &amp;gt;/var/log/srlinux/stdout/acl_mgr.log 2&amp;gt;&amp;amp;1 &amp;amp;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> Started arp_nd_mgr: source /etc/profile.d/sr_app_env.sh &amp;amp;&amp;gt;/dev/null; bash -c &amp;#34;./sr_arp_nd_mgr&amp;#34; &amp;gt;/var/log/srlinux/stdout/arp_nd_mgr.log 2&amp;gt;&amp;amp;1 &amp;amp;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> Started chassis_mgr: source /etc/profile.d/sr_app_env.sh &amp;amp;&amp;gt;/dev/null; bash -c &amp;#34;./sr_chassis_mgr&amp;#34; &amp;gt;/var/log/srlinux/stdout/chassis_mgr.log 2&amp;gt;&amp;amp;1 &amp;amp;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> Started dhcp_client_mgr: source /etc/profile.d/sr_app_env.sh &amp;amp;&amp;gt;/dev/null; bash -c &amp;#34;./sr_dhcp_client_mgr&amp;#34; &amp;gt;/var/log/srlinux/stdout/dhcp_client_mgr.log 2&amp;gt;&amp;amp;1 &amp;amp;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> Started evpn_mgr: source /etc/profile.d/sr_app_env.sh &amp;amp;&amp;gt;/dev/null; bash -c &amp;#34;./sr_evpn_mgr&amp;#34; &amp;gt;/var/log/srlinux/stdout/evpn_mgr.log 2&amp;gt;&amp;amp;1 &amp;amp;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> Started fhs_mgr: source /etc/profile.d/sr_app_env.sh &amp;amp;&amp;gt;/dev/null; bash -c &amp;#34;./sr_fhs_mgr&amp;#34; &amp;gt;/var/log/srlinux/stdout/fhs_mgr.log 2&amp;gt;&amp;amp;1 &amp;amp;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> Started fib_mgr: source /etc/profile.d/sr_app_env.sh &amp;amp;&amp;gt;/dev/null; bash -c &amp;#34;./sr_fib_mgr&amp;#34; &amp;gt;/var/log/srlinux/stdout/fib_mgr.log 2&amp;gt;&amp;amp;1 &amp;amp;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> Started l2_mac_learn_mgr: source /etc/profile.d/sr_app_env.sh &amp;amp;&amp;gt;/dev/null; bash -c &amp;#34;./sr_l2_mac_learn_mgr&amp;#34; &amp;gt;/var/log/srlinux/stdout/l2_mac_learn_mgr.log 2&amp;gt;&amp;amp;1 &amp;amp;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> Started l2_mac_mgr: source /etc/profile.d/sr_app_env.sh &amp;amp;&amp;gt;/dev/null; bash -c &amp;#34;./sr_l2_mac_mgr&amp;#34; &amp;gt;/var/log/srlinux/stdout/l2_mac_mgr.log 2&amp;gt;&amp;amp;1 &amp;amp;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> Started lag_mgr: source /etc/profile.d/sr_app_env.sh &amp;amp;&amp;gt;/dev/null; bash -c &amp;#34;./sr_lag_mgr&amp;#34; &amp;gt;/var/log/srlinux/stdout/lag_mgr.log 2&amp;gt;&amp;amp;1 &amp;amp;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> Started linux_mgr: source /etc/profile.d/sr_app_env.sh &amp;amp;&amp;gt;/dev/null; bash -c &amp;#34;./sr_linux_mgr&amp;#34; &amp;gt;/var/log/srlinux/stdout/linux_mgr.log 2&amp;gt;&amp;amp;1 &amp;amp;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> Started log_mgr: source /etc/profile.d/sr_app_env.sh &amp;amp;&amp;gt;/dev/null; bash -c &amp;#34;./sr_log_mgr&amp;#34; &amp;gt;/var/log/srlinux/stdout/log_mgr.log 2&amp;gt;&amp;amp;1 &amp;amp;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> Started mcid_mgr: source /etc/profile.d/sr_app_env.sh &amp;amp;&amp;gt;/dev/null; bash -c &amp;#34;./sr_mcid_mgr&amp;#34; &amp;gt;/var/log/srlinux/stdout/mcid_mgr.log 2&amp;gt;&amp;amp;1 &amp;amp;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> Started mgmt_server: source /etc/profile.d/sr_app_env.sh &amp;amp;&amp;gt;/dev/null; bash -c &amp;#34;./sr_mgmt_server&amp;#34; &amp;gt;/var/log/srlinux/stdout/mgmt_server.log 2&amp;gt;&amp;amp;1 &amp;amp;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> Started net_inst_mgr: source /etc/profile.d/sr_app_env.sh &amp;amp;&amp;gt;/dev/null; bash -c &amp;#34;./sr_net_inst_mgr&amp;#34; &amp;gt;/var/log/srlinux/stdout/net_inst_mgr.log 2&amp;gt;&amp;amp;1 &amp;amp;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> Started sdk_mgr: source /etc/profile.d/sr_app_env.sh &amp;amp;&amp;gt;/dev/null; bash -c &amp;#34;./sr_sdk_mgr&amp;#34; &amp;gt;/var/log/srlinux/stdout/sdk_mgr.log 2&amp;gt;&amp;amp;1 &amp;amp;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> Started sflow_sample_mgr: source /etc/profile.d/sr_app_env.sh &amp;amp;&amp;gt;/dev/null; bash -c &amp;#34;./sr_sflow_sample_mgr&amp;#34; &amp;gt;/var/log/srlinux/stdout/sflow_sample_mgr.log 2&amp;gt;&amp;amp;1 &amp;amp;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> Started xdp_lc_1: source /etc/profile.d/sr_app_env.sh &amp;amp;&amp;gt;/dev/null; bash -c &amp;#34;exec -a sr_xdp_lc_1 ./sr_xdp_lc --slot_num 1&amp;#34; &amp;gt;/var/log/srlinux/stdout/xdp_lc_1.log 2&amp;gt;&amp;amp;1 &amp;amp;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> Application aaa_mgr is running: PID 1582
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> Application acl_mgr is running: PID 1593
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> Application arp_nd_mgr is running: PID 1604
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> Application chassis_mgr is running: PID 1615
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> Application dhcp_client_mgr is running: PID 1627
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> Application evpn_mgr is running: PID 1638
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> Application fhs_mgr is running: PID 1649
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> Application fib_mgr is running: PID 1662
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> Application l2_mac_learn_mgr is running: PID 1673
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> Application l2_mac_mgr is running: PID 1687
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> Application lag_mgr is running: PID 1706
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> Application linux_mgr is running: PID 1717
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> Application log_mgr is running: PID 1728
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> Application mcid_mgr is running: PID 1741
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> Application mgmt_server is running: PID 1755
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> Application net_inst_mgr is running: PID 1766
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> Application sdk_mgr is running: PID 1777
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> Application sflow_sample_mgr is running: PID 1787
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> Application xdp_lc_1 is running: PID 1797
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> Started xdp_lc_1: source /etc/profile.d/sr_app_env.sh &amp;amp;&amp;gt;/dev/null; bash -c &amp;#34;exec -a sr_xdp_lc_1 ./sr_xdp_lc --slot_num 1&amp;#34; &amp;gt;/var/log/srlinux/stdout/xdp_lc_1.log 2&amp;gt;&amp;amp;1 &amp;amp;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> Application xdp_lc_1 is running: PID 2551
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">[/dev/console unavailable]: 22-06-03 21:30:55.343 sr_app_mgr: Would reboot with reason &amp;#39;&lt;/span>AppMgr: xdp_lc_1 has failed&lt;span class="err">&amp;#39;&lt;/span> but no-reboot is set&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Well it took me some time to figure out that the last line was the indication that &amp;ldquo;xdp_lc_1&amp;rdquo; represents the process for the line card, i.e. all interfaces were missing.
Let&amp;rsquo;s go into the device shell to check the mentioned log.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@r1 /&lt;span class="o">]&lt;/span>&lt;span class="c1"># cat /var/log/srlinux/stdout/xdp_lc_1.20220603_213042.log&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ERROR: This system does not support &lt;span class="s2">&amp;#34;SSSE3&amp;#34;&lt;/span>.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Please check that RTE_MACHINE is &lt;span class="nb">set&lt;/span> correctly.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">EAL: FATAL: unsupported cpu type.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">EAL: unsupported cpu type.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">22-06-03 21:30:42.524202 &lt;span class="m">1797&lt;/span> C common dpdk.cc:925 SRL_ASSERT_MSG Termination &lt;span class="nv">handler&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">=========&lt;/span> SRL_ASSERT_MSG in program: &lt;span class="nv">sr_xdp_lc_1&lt;/span> &lt;span class="o">=========&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">===&lt;/span> At: /builds/sr/srlinux/srlutil/dpdk/dpdk.cc:925
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">===&lt;/span> Condition failed: &lt;span class="o">((&lt;/span>diag &amp;gt; 0&lt;span class="o">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">===&lt;/span> Cannot init DPDK EAL
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 0x7a1bad, sr_xdp_lc_1 : srlinux::dpdk::Dpdk::InitEal&lt;span class="o">()&lt;/span>+0x159d
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 0x7a1cb1, sr_xdp_lc_1 : srlinux::dpdk::Dpdk::Init&lt;span class="o">()&lt;/span>+0x11
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 0x57c766, sr_xdp_lc_1 : main&lt;span class="o">()&lt;/span>+0x236
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 0x7fc972aadca3, /lib64/libc.so.6 : __libc_start_main&lt;span class="o">()&lt;/span>+0xf3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 0x59268e, sr_xdp_lc_1 : _start&lt;span class="o">()&lt;/span>+0x2e
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">==============================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">===&lt;/span> Program: sr_xdp_lc_1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/builds/sr/srlinux/srlutil/dpdk/dpdk.cc:925 &lt;span class="p">|&lt;/span> condition failed &lt;span class="o">((&lt;/span>diag &amp;gt; 0&lt;span class="o">))&lt;/span> &lt;span class="p">|&lt;/span> Cannot init DPDK EAL&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>After some googling around, It seems that SSSE3 is not there in the CPU.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ lscpu
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Architecture: x86_64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CPU op-mode&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>: 32-bit, 64-bit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Byte Order: Little Endian
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Address sizes: &lt;span class="m">40&lt;/span> bits physical, &lt;span class="m">48&lt;/span> bits virtual
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CPU&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>: &lt;span class="m">8&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">On-line CPU&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span> list: 0-7
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Thread&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span> per core: &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Core&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span> per socket: &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Socket&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>: &lt;span class="m">8&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NUMA node&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>: &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Vendor ID: GenuineIntel
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CPU family: &lt;span class="m">6&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Model: &lt;span class="m">6&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Model name: QEMU Virtual CPU version 2.5+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Stepping: &lt;span class="m">3&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CPU MHz: 2496.000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">BogoMIPS: 4992.00
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Hypervisor vendor: KVM
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Virtualization type: full
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">L1d cache: &lt;span class="m">256&lt;/span> KiB
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">L1i cache: &lt;span class="m">256&lt;/span> KiB
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">L2 cache: &lt;span class="m">32&lt;/span> MiB
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">L3 cache: &lt;span class="m">128&lt;/span> MiB
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NUMA node0 CPU&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>: 0-7
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Vulnerability Itlb multihit: KVM: Vulnerable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Vulnerability L1tf: Mitigation&lt;span class="p">;&lt;/span> PTE Inversion
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Vulnerability Mds: Vulnerable: Clear CPU buffers attempted, no microcode&lt;span class="p">;&lt;/span> SMT Host state unknown
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Vulnerability Meltdown: Mitigation&lt;span class="p">;&lt;/span> PTI
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Vulnerability Spec store bypass: Vulnerable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Vulnerability Spectre v1: Mitigation&lt;span class="p">;&lt;/span> usercopy/swapgs barriers and __user pointer sanitization
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Vulnerability Spectre v2: Mitigation&lt;span class="p">;&lt;/span> Retpolines, STIBP disabled, RSB filling
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Vulnerability Srbds: Not affected
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Vulnerability Tsx async abort: Not affected
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Flags: fpu de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pse36 clflush mmx fxsr sse sse2 syscall nx lm rep_good nopl xtopology cpuid tsc_known_freq pni cx16 x2apic hypervisor lahf_lm cpuid_fault pti&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Let&amp;rsquo;s check on EVE-NGs CPU because I don&amp;rsquo;t think the processor is too old &amp;#x1f604;&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">root@eve-01:~# lscpu &lt;span class="p">|&lt;/span> grep Flags
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Flags: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx pdpe1gb rdtscp lm constant_tsc art arch_perfmon pebs bts rep_good nopl xtopology nonstop_tsc cpuid aperfmperf tsc_known_freq pni pclmulqdq dtes64 monitor ds_cpl vmx smx est tm2 ssse3 sdbg fma cx16 xtpr pdcm pcid sse4_1 sse4_2 x2apic movbe popcnt tsc_deadline_timer aes xsave avx f16c rdrand lahf_lm abm 3dnowprefetch cpuid_fault epb invpcid_single pti tpr_shadow vnmi flexpriority ept vpid ept_ad fsgsbase tsc_adjust bmi1 hle avx2 smep bmi2 erms invpcid rtm mpx rdseed adx smap clflushopt intel_pt xsaveopt xsavec xgetbv1 xsaves dtherm ida arat pln pts hwp hwp_notify hwp_act_window hwp_epp&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>So, it is there, but QEMU is not exposing it to the guest machines, which is an easy fix &amp;#x1f604; rather than deprecating the EVE-NGs. The fix is to append the parameters &lt;strong>-cpu qemu64,+ssse3,+sse4.1,+sse4.2&lt;/strong> to the qemu command line for booting the VMs, but only after shutting down all 3 nodes to apply the change, as depicted below.&lt;/p>
&lt;figure>&lt;a class="lightgallery" href="https://net4fungr.github.io/posts/kube-my-router-pt3/ssse3.png" title="/posts/kube-my-router-pt3/ssse3.png" data-thumbnail="/posts/kube-my-router-pt3/ssse3.png" data-sub-html="&lt;h2>Missing CPU instruction set for SR Linux&lt;/h2>">&lt;img loading="lazy" src='https://net4fungr.github.io/posts/kube-my-router-pt3/ssse3.png' alt="/posts/kube-my-router-pt3/ssse3.png" height="385" width="400">&lt;/a>&lt;figcaption class="image-caption">Missing CPU instruction set for SR Linux&lt;/figcaption>
 &lt;/figure>
&lt;p>Yet again if you want to make this the default for all linux VMs on your EVE-NG, you could append this to the template.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">root@eve-01:~# cat /opt/unetlab/html/templates/intel/linux.yml &lt;span class="p">|&lt;/span> grep -v &lt;span class="s2">&amp;#34;#&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">---
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">type: qemu
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">description: Linux
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">name: Linux
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cpulimit: &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">icon: Server.png
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cpu: &lt;span class="m">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ram: &lt;span class="m">4096&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ethernet: &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">console: vnc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">shutdown: &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">qemu_arch: x86_64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">qemu_version: 2.12.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">qemu_nic: virtio-net-pci
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">qemu_options: -machine &lt;span class="nv">type&lt;/span>&lt;span class="o">=&lt;/span>pc,accel&lt;span class="o">=&lt;/span>kvm -vga virtio -usbdevice tablet -boot &lt;span class="nv">order&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nb">cd&lt;/span> -cpu qemu64,+ssse3,+sse4.1,+sse4.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>After applying the &amp;ldquo;patch&amp;rdquo; and bringing up all nodes, everything should look better.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ kubectl -n 2srl-certs get all
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod/r1 1/1 Running &lt;span class="m">1&lt;/span> 63m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod/r2 1/1 Running &lt;span class="m">1&lt;/span> 63m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME TYPE CLUSTER-IP EXTERNAL-IP PORT&lt;span class="o">(&lt;/span>S&lt;span class="o">)&lt;/span> AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">service/service-r1 LoadBalancer 10.103.94.50 192.168.1.50 22:30742/TCP,57400:30637/TCP 63m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">service/service-r2 LoadBalancer 10.111.173.232 192.168.1.51 22:32417/TCP 63m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ ssh admin@192.168.1.50
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">admin@192.168.1.50&lt;span class="s1">&amp;#39;s password:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">Using configuration file(s): [&amp;#39;&lt;/span>/etc/opt/srlinux/srlinux.rc&lt;span class="s1">&amp;#39;]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">Welcome to the srlinux CLI.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">Type &amp;#39;&lt;/span>help&lt;span class="err">&amp;#39;&lt;/span> &lt;span class="o">(&lt;/span>and press &amp;lt;ENTER&amp;gt;&lt;span class="o">)&lt;/span> &lt;span class="k">if&lt;/span> you need any &lt;span class="nb">help&lt;/span> using this.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--&lt;span class="o">{&lt;/span> &lt;span class="o">[&lt;/span>FACTORY&lt;span class="o">]&lt;/span> running &lt;span class="o">}&lt;/span>--&lt;span class="o">[&lt;/span> &lt;span class="o">]&lt;/span>--
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">A:r1# show interface brief
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">+---------------------+-----------------------+-----------------------+-----------------------+-----------------------+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> Port &lt;span class="p">|&lt;/span> Admin State &lt;span class="p">|&lt;/span> Oper State &lt;span class="p">|&lt;/span> Speed &lt;span class="p">|&lt;/span> Type &lt;span class="p">|&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">+&lt;span class="o">=====================&lt;/span>+&lt;span class="o">=======================&lt;/span>+&lt;span class="o">=======================&lt;/span>+&lt;span class="o">=======================&lt;/span>+&lt;span class="o">=======================&lt;/span>+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> ethernet-1/1 &lt;span class="p">|&lt;/span> disable &lt;span class="p">|&lt;/span> down &lt;span class="p">|&lt;/span> 25G &lt;span class="p">|&lt;/span> &lt;span class="p">|&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> ethernet-1/2 &lt;span class="p">|&lt;/span> disable &lt;span class="p">|&lt;/span> down &lt;span class="p">|&lt;/span> 25G &lt;span class="p">|&lt;/span> &lt;span class="p">|&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> ethernet-1/3 &lt;span class="p">|&lt;/span> disable &lt;span class="p">|&lt;/span> down &lt;span class="p">|&lt;/span> 25G &lt;span class="p">|&lt;/span> &lt;span class="p">|&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> ethernet-1/4 &lt;span class="p">|&lt;/span> disable &lt;span class="p">|&lt;/span> down &lt;span class="p">|&lt;/span> 25G &lt;span class="p">|&lt;/span> &lt;span class="p">|&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> ethernet-1/5 &lt;span class="p">|&lt;/span> disable &lt;span class="p">|&lt;/span> down &lt;span class="p">|&lt;/span> 25G &lt;span class="p">|&lt;/span> &lt;span class="p">|&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> ethernet-1/6 &lt;span class="p">|&lt;/span> disable &lt;span class="p">|&lt;/span> down &lt;span class="p">|&lt;/span> 25G &lt;span class="p">|&lt;/span> &lt;span class="p">|&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> ethernet-1/7 &lt;span class="p">|&lt;/span> disable &lt;span class="p">|&lt;/span> down &lt;span class="p">|&lt;/span> 25G &lt;span class="p">|&lt;/span> &lt;span class="p">|&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt; ...omitted... &amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> ethernet-1/53 &lt;span class="p">|&lt;/span> disable &lt;span class="p">|&lt;/span> down &lt;span class="p">|&lt;/span> 100G &lt;span class="p">|&lt;/span> &lt;span class="p">|&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> ethernet-1/54 &lt;span class="p">|&lt;/span> disable &lt;span class="p">|&lt;/span> down &lt;span class="p">|&lt;/span> 100G &lt;span class="p">|&lt;/span> &lt;span class="p">|&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> ethernet-1/55 &lt;span class="p">|&lt;/span> disable &lt;span class="p">|&lt;/span> down &lt;span class="p">|&lt;/span> 100G &lt;span class="p">|&lt;/span> &lt;span class="p">|&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> ethernet-1/56 &lt;span class="p">|&lt;/span> disable &lt;span class="p">|&lt;/span> down &lt;span class="p">|&lt;/span> 100G &lt;span class="p">|&lt;/span> &lt;span class="p">|&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> mgmt0 &lt;span class="p">|&lt;/span> &lt;span class="nb">enable&lt;/span> &lt;span class="p">|&lt;/span> up &lt;span class="p">|&lt;/span> 1G &lt;span class="p">|&lt;/span> &lt;span class="p">|&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">+---------------------+-----------------------+-----------------------+-----------------------+-----------------------+&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>We can now proceed with the ping testing, this time from within the box &amp;#x1f604;. Let&amp;rsquo;s apply some configs on the interfaces.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">A:r1# diff flat
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">insert / interface ethernet-1/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">insert / interface ethernet-1/1 admin-state &lt;span class="nb">enable&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">insert / interface ethernet-1/1 subinterface &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">insert / interface ethernet-1/1 subinterface &lt;span class="m">0&lt;/span> ipv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">insert / interface ethernet-1/1 subinterface &lt;span class="m">0&lt;/span> ipv4 address 10.1.1.1/30
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">insert / network-instance main
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">insert / network-instance main interface ethernet-1/1.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">A:r1# commit now
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">All changes have been committed. Leaving candidate mode.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--&lt;span class="o">{&lt;/span> &lt;span class="o">[&lt;/span>FACTORY&lt;span class="o">]&lt;/span> + running &lt;span class="o">}&lt;/span>--&lt;span class="o">[&lt;/span> &lt;span class="o">]&lt;/span>--
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">A:r1# show interface ethernet-1/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">==========================================================================================================================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ethernet-1/1 is down, reason lower-layer-down
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ethernet-1/1.0 is down, reason port-down
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Network-instance: main
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Encapsulation : null
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Type : routed
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> IPv4 addr : 10.1.1.1/30 &lt;span class="o">(&lt;/span>static, None&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--------------------------------------------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">==========================================================================================================================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--&lt;span class="o">{&lt;/span> &lt;span class="o">[&lt;/span>FACTORY&lt;span class="o">]&lt;/span> + candidate shared default &lt;span class="o">}&lt;/span>--&lt;span class="o">[&lt;/span> &lt;span class="o">]&lt;/span>--
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">A:r1#&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>I guess we still have a &lt;em>lower layer&lt;/em> problem. Let&amp;rsquo;s get a shell into the box and check the logs.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ kubectl -n 2srl-certs &lt;span class="nb">exec&lt;/span> -it r1 -- bash
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Defaulted container &lt;span class="s2">&amp;#34;r1&amp;#34;&lt;/span> out of: r1, init-r1 &lt;span class="o">(&lt;/span>init&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@r1 /&lt;span class="o">]&lt;/span>&lt;span class="c1"># tail /var/log/messages&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Jun &lt;span class="m">8&lt;/span> 12:50:02 r1 sr_net_inst_mgr: netinst&lt;span class="p">|&lt;/span>1704&lt;span class="p">|&lt;/span>1704&lt;span class="p">|&lt;/span>00013&lt;span class="p">|&lt;/span>N: The interface mgmt0.0 in network-instance mgmt is now up
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Jun &lt;span class="m">8&lt;/span> 12:51:19 r1 sr_aaa_mgr: aaa&lt;span class="p">|&lt;/span>1528&lt;span class="p">|&lt;/span>1650&lt;span class="p">|&lt;/span>00000&lt;span class="p">|&lt;/span>N: Opened session &lt;span class="k">for&lt;/span> user admin from host 10.244.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Jun &lt;span class="m">8&lt;/span> 12:51:19 r1 sr_aaa_mgr: aaa&lt;span class="p">|&lt;/span>1528&lt;span class="p">|&lt;/span>1650&lt;span class="p">|&lt;/span>00001&lt;span class="p">|&lt;/span>N: User admin successfully authenticated from host 10.244.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Jun &lt;span class="m">8&lt;/span> 12:55:44 r1 sr_mgmt_server: mgmt&lt;span class="p">|&lt;/span>1693&lt;span class="p">|&lt;/span>1693&lt;span class="p">|&lt;/span>00020&lt;span class="p">|&lt;/span>I: All changes have been committed successfully by user admin session 1.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Jun &lt;span class="m">8&lt;/span> 12:55:44 r1 sr_xdp_lc_1: debug&lt;span class="p">|&lt;/span>1739&lt;span class="p">|&lt;/span>1814&lt;span class="p">|&lt;/span>00001&lt;span class="p">|&lt;/span>E: common netdevice.c:355 NetDeviceGetSpeed ioctl&lt;span class="o">(&lt;/span>SIOCETHTOOL, &lt;span class="s2">&amp;#34;e1-1&amp;#34;&lt;/span>, &lt;span class="m">1&lt;/span> &lt;span class="o">(&lt;/span>0x1&lt;span class="o">)&lt;/span>, &lt;span class="m">32684&lt;/span> &lt;span class="o">(&lt;/span>0x7fac&lt;span class="o">))&lt;/span>: Operation not supported &lt;span class="o">(&lt;/span>95&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Jun &lt;span class="m">8&lt;/span> 12:55:44 r1 sr_xdp_lc_1: debug&lt;span class="p">|&lt;/span>1739&lt;span class="p">|&lt;/span>1814&lt;span class="p">|&lt;/span>00003&lt;span class="p">|&lt;/span>E: common netdevice.c:182 NetDeviceSetMTU ioctl&lt;span class="o">(&lt;/span>SIOCSIFMTU, &lt;span class="s2">&amp;#34;e1-1&amp;#34;&lt;/span>, 9232&lt;span class="o">)&lt;/span>: Invalid argument &lt;span class="o">(&lt;/span>22&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Jun &lt;span class="m">8&lt;/span> 12:55:44 r1 sr_xdp_lc_1: debug&lt;span class="p">|&lt;/span>1739&lt;span class="p">|&lt;/span>1814&lt;span class="p">|&lt;/span>00004&lt;span class="p">|&lt;/span>E: simif sim_physif.cc:764 UpdateAdminState error setting mtu &lt;span class="k">for&lt;/span> interface &lt;span class="s2">&amp;#34;ethernet-1/1&amp;#34;&lt;/span> mtu: &lt;span class="m">9232&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Jun &lt;span class="m">8&lt;/span> 12:55:44 r1 sr_xdp_lc_1: debug&lt;span class="p">|&lt;/span>1739&lt;span class="p">|&lt;/span>1814&lt;span class="p">|&lt;/span>00005&lt;span class="p">|&lt;/span>E: common netdevice.c:355 NetDeviceGetSpeed ioctl&lt;span class="o">(&lt;/span>SIOCETHTOOL, &lt;span class="s2">&amp;#34;e1-1&amp;#34;&lt;/span>, &lt;span class="m">1&lt;/span> &lt;span class="o">(&lt;/span>0x1&lt;span class="o">)&lt;/span>, &lt;span class="m">26571&lt;/span> &lt;span class="o">(&lt;/span>0x67cb&lt;span class="o">))&lt;/span>: Operation not supported &lt;span class="o">(&lt;/span>95&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Jun &lt;span class="m">8&lt;/span> 12:55:44 r1 sr_net_inst_mgr: netinst&lt;span class="p">|&lt;/span>1704&lt;span class="p">|&lt;/span>1704&lt;span class="p">|&lt;/span>00014&lt;span class="p">|&lt;/span>N: Network Instance main is now up
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Jun &lt;span class="m">8&lt;/span> 12:55:45 r1 sr_net_inst_mgr: netinst&lt;span class="p">|&lt;/span>1704&lt;span class="p">|&lt;/span>1704&lt;span class="p">|&lt;/span>00015&lt;span class="p">|&lt;/span>W: The interface ethernet-1/1.0 in network-instance main is now down &lt;span class="k">for&lt;/span> reason: the subinterface is operationally down
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@r1 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># tail /var/log/srlinux/debug/errors.log&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2022-06-08T12:55:44.990045+00:00 r1 local6&lt;span class="p">|&lt;/span>ERR sr_xdp_lc_1: debug&lt;span class="p">|&lt;/span>1739&lt;span class="p">|&lt;/span>1814&lt;span class="p">|&lt;/span>00001&lt;span class="p">|&lt;/span>E: common netdevice.c:355 NetDeviceGetSpeed ioctl&lt;span class="o">(&lt;/span>SIOCETHTOOL, &lt;span class="s2">&amp;#34;e1-1&amp;#34;&lt;/span>, &lt;span class="m">1&lt;/span> &lt;span class="o">(&lt;/span>0x1&lt;span class="o">)&lt;/span>, &lt;span class="m">32684&lt;/span> &lt;span class="o">(&lt;/span>0x7fac&lt;span class="o">))&lt;/span>: Operation not supported &lt;span class="o">(&lt;/span>95&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2022-06-08T12:55:44.990171+00:00 r1 local6&lt;span class="p">|&lt;/span>ERR sr_xdp_lc_1: debug&lt;span class="p">|&lt;/span>1739&lt;span class="p">|&lt;/span>1814&lt;span class="p">|&lt;/span>00003&lt;span class="p">|&lt;/span>E: common netdevice.c:182 NetDeviceSetMTU ioctl&lt;span class="o">(&lt;/span>SIOCSIFMTU, &lt;span class="s2">&amp;#34;e1-1&amp;#34;&lt;/span>, 9232&lt;span class="o">)&lt;/span>: Invalid argument &lt;span class="o">(&lt;/span>22&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2022-06-08T12:55:44.990193+00:00 r1 local6&lt;span class="p">|&lt;/span>ERR sr_xdp_lc_1: debug&lt;span class="p">|&lt;/span>1739&lt;span class="p">|&lt;/span>1814&lt;span class="p">|&lt;/span>00004&lt;span class="p">|&lt;/span>E: simif sim_physif.cc:764 UpdateAdminState error setting mtu &lt;span class="k">for&lt;/span> interface &lt;span class="s2">&amp;#34;ethernet-1/1&amp;#34;&lt;/span> mtu: &lt;span class="m">9232&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2022-06-08T12:55:44.990805+00:00 r1 local6&lt;span class="p">|&lt;/span>ERR sr_xdp_lc_1: debug&lt;span class="p">|&lt;/span>1739&lt;span class="p">|&lt;/span>1814&lt;span class="p">|&lt;/span>00005&lt;span class="p">|&lt;/span>E: common netdevice.c:355 NetDeviceGetSpeed ioctl&lt;span class="o">(&lt;/span>SIOCETHTOOL, &lt;span class="s2">&amp;#34;e1-1&amp;#34;&lt;/span>, &lt;span class="m">1&lt;/span> &lt;span class="o">(&lt;/span>0x1&lt;span class="o">)&lt;/span>, &lt;span class="m">26571&lt;/span> &lt;span class="o">(&lt;/span>0x67cb&lt;span class="o">))&lt;/span>: Operation not supported &lt;span class="o">(&lt;/span>95&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@r1 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># tail /var/log/srlinux/debug/sr_xdp_lc_1.log&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2022-06-08T12:55:44.990045+00:00 r1 local6&lt;span class="p">|&lt;/span>ERR sr_xdp_lc_1: debug&lt;span class="p">|&lt;/span>1739&lt;span class="p">|&lt;/span>1814&lt;span class="p">|&lt;/span>00001&lt;span class="p">|&lt;/span>E: common netdevice.c:355 NetDeviceGetSpeed ioctl&lt;span class="o">(&lt;/span>SIOCETHTOOL, &lt;span class="s2">&amp;#34;e1-1&amp;#34;&lt;/span>, &lt;span class="m">1&lt;/span> &lt;span class="o">(&lt;/span>0x1&lt;span class="o">)&lt;/span>, &lt;span class="m">32684&lt;/span> &lt;span class="o">(&lt;/span>0x7fac&lt;span class="o">))&lt;/span>: Operation not supported &lt;span class="o">(&lt;/span>95&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2022-06-08T12:55:44.990087+00:00 r1 local6&lt;span class="p">|&lt;/span>WARN sr_xdp_lc_1: debug&lt;span class="p">|&lt;/span>1739&lt;span class="p">|&lt;/span>1814&lt;span class="p">|&lt;/span>00002&lt;span class="p">|&lt;/span>W: simif sim_physif.cc:218 GetInterfaceSpeed Unable to get speed &lt;span class="k">for&lt;/span> interface: e1-1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2022-06-08T12:55:44.990171+00:00 r1 local6&lt;span class="p">|&lt;/span>ERR sr_xdp_lc_1: debug&lt;span class="p">|&lt;/span>1739&lt;span class="p">|&lt;/span>1814&lt;span class="p">|&lt;/span>00003&lt;span class="p">|&lt;/span>E: common netdevice.c:182 NetDeviceSetMTU ioctl&lt;span class="o">(&lt;/span>SIOCSIFMTU, &lt;span class="s2">&amp;#34;e1-1&amp;#34;&lt;/span>, 9232&lt;span class="o">)&lt;/span>: Invalid argument &lt;span class="o">(&lt;/span>22&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2022-06-08T12:55:44.990193+00:00 r1 local6&lt;span class="p">|&lt;/span>ERR sr_xdp_lc_1: debug&lt;span class="p">|&lt;/span>1739&lt;span class="p">|&lt;/span>1814&lt;span class="p">|&lt;/span>00004&lt;span class="p">|&lt;/span>E: simif sim_physif.cc:764 UpdateAdminState error setting mtu &lt;span class="k">for&lt;/span> interface &lt;span class="s2">&amp;#34;ethernet-1/1&amp;#34;&lt;/span> mtu: &lt;span class="m">9232&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2022-06-08T12:55:44.990805+00:00 r1 local6&lt;span class="p">|&lt;/span>ERR sr_xdp_lc_1: debug&lt;span class="p">|&lt;/span>1739&lt;span class="p">|&lt;/span>1814&lt;span class="p">|&lt;/span>00005&lt;span class="p">|&lt;/span>E: common netdevice.c:355 NetDeviceGetSpeed ioctl&lt;span class="o">(&lt;/span>SIOCETHTOOL, &lt;span class="s2">&amp;#34;e1-1&amp;#34;&lt;/span>, &lt;span class="m">1&lt;/span> &lt;span class="o">(&lt;/span>0x1&lt;span class="o">)&lt;/span>, &lt;span class="m">26571&lt;/span> &lt;span class="o">(&lt;/span>0x67cb&lt;span class="o">))&lt;/span>: Operation not supported &lt;span class="o">(&lt;/span>95&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2022-06-08T12:55:44.990828+00:00 r1 local6&lt;span class="p">|&lt;/span>WARN sr_xdp_lc_1: debug&lt;span class="p">|&lt;/span>1739&lt;span class="p">|&lt;/span>1814&lt;span class="p">|&lt;/span>00006&lt;span class="p">|&lt;/span>W: simif sim_physif.cc:218 GetInterfaceSpeed Unable to get speed &lt;span class="k">for&lt;/span> interface: e1-1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2022-06-08T12:55:45.006160+00:00 r1 local6&lt;span class="p">|&lt;/span>WARN sr_xdp_lc_1: debug&lt;span class="p">|&lt;/span>1739&lt;span class="p">|&lt;/span>2066&lt;span class="p">|&lt;/span>00009&lt;span class="p">|&lt;/span>W: cpmgr cp_mgr.cc:1595 CpMgrExtractFrameHandler interface &lt;span class="m">2147483647&lt;/span> not found &lt;span class="k">for&lt;/span> reason MLD
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2022-06-08T12:55:45.018077+00:00 r1 local6&lt;span class="p">|&lt;/span>WARN sr_xdp_lc_1: debug&lt;span class="p">|&lt;/span>1739&lt;span class="p">|&lt;/span>2066&lt;span class="p">|&lt;/span>00010&lt;span class="p">|&lt;/span>W: cpmgr cp_mgr.cc:1595 CpMgrExtractFrameHandler interface &lt;span class="m">2147483647&lt;/span> not found &lt;span class="k">for&lt;/span> reason MLD
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2022-06-08T12:55:45.658478+00:00 r1 local6&lt;span class="p">|&lt;/span>WARN sr_xdp_lc_1: debug&lt;span class="p">|&lt;/span>1739&lt;span class="p">|&lt;/span>2066&lt;span class="p">|&lt;/span>00011&lt;span class="p">|&lt;/span>W: cpmgr cp_mgr.cc:1595 CpMgrExtractFrameHandler interface &lt;span class="m">2147483647&lt;/span> not found &lt;span class="k">for&lt;/span> reason MLD&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>It seems we have an MTU issue for the 25G interfaces that by default get 9232. Maybe if we specify a lower MTU and set speed to 1G&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">--&lt;span class="o">{&lt;/span> &lt;span class="o">[&lt;/span>FACTORY&lt;span class="o">]&lt;/span> + candidate shared default &lt;span class="o">}&lt;/span>--&lt;span class="o">[&lt;/span> &lt;span class="o">]&lt;/span>--
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">A:r1# info flat interface ethernet-1/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> / interface ethernet-1/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> / interface ethernet-1/1 admin-state &lt;span class="nb">enable&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> / interface ethernet-1/1 mtu &lt;span class="m">1500&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> / interface ethernet-1/1 ethernet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> / interface ethernet-1/1 ethernet port-speed 1G
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> / interface ethernet-1/1 subinterface &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> / interface ethernet-1/1 subinterface &lt;span class="m">0&lt;/span> ipv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> / interface ethernet-1/1 subinterface &lt;span class="m">0&lt;/span> ipv4 address 10.1.1.1/30
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--&lt;span class="o">{&lt;/span> &lt;span class="o">[&lt;/span>FACTORY&lt;span class="o">]&lt;/span> + candidate shared default &lt;span class="o">}&lt;/span>--&lt;span class="o">[&lt;/span> &lt;span class="o">]&lt;/span>--
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">A:r1# show interface ethernet-1/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">==========================================================================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ethernet-1/1 is down, reason lower-layer-down
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ethernet-1/1.0 is down, reason ip-mtu-too-large
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Network-instance: main
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Encapsulation : null
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Type : routed
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> IPv4 addr : 10.1.1.1/30 &lt;span class="o">(&lt;/span>static, None&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">==========================================================================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--&lt;span class="o">{&lt;/span> &lt;span class="o">[&lt;/span>FACTORY&lt;span class="o">]&lt;/span> + candidate shared default &lt;span class="o">}&lt;/span>--&lt;span class="o">[&lt;/span> &lt;span class="o">]&lt;/span>--
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">A:r1&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>OK, let&amp;rsquo;s check the MTU on the container then after deleting the configs in r1 to see the default situation&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@r1 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># ip link&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">1: lo: &amp;lt;LOOPBACK,UP,LOWER_UP&amp;gt; mtu &lt;span class="m">65536&lt;/span> qdisc noqueue state UNKNOWN mode DEFAULT group default qlen &lt;span class="m">1000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">3: mgmt0@if7: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu &lt;span class="m">1514&lt;/span> qdisc noqueue state UP mode DEFAULT group default
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> link/ether 86:28:21:01:2f:32 brd ff:ff:ff:ff:ff:ff link-netnsid &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">4: gway-2800@if2: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu &lt;span class="m">1500&lt;/span> qdisc noqueue state UP mode DEFAULT group default qlen &lt;span class="m">1000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> link/ether 26:e1:9b:7f:82:07 brd ff:ff:ff:ff:ff:ff link-netns srbase-mgmt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">5: mgmt0-0@if4: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu &lt;span class="m">1500&lt;/span> qdisc noqueue state UP mode DEFAULT group default qlen &lt;span class="m">1000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> link/ether e2:33:67:b1:b0:8e brd ff:ff:ff:ff:ff:ff link-netns srbase-mgmt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">alias&lt;/span> mgmt0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">6: monit_in@if5: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu &lt;span class="m">9234&lt;/span> qdisc noqueue state UP mode DEFAULT group default qlen &lt;span class="m">1000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> link/ether fa:13:fb:a3:7c:e6 brd ff:ff:ff:ff:ff:ff link-netns monit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">8: e1-1@if8: &amp;lt;BROADCAST,MULTICAST&amp;gt; mtu &lt;span class="m">1450&lt;/span> qdisc noqueue state DOWN mode DEFAULT group default qlen &lt;span class="m">1000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> link/ether 02:ab:b7:ff:00:01 brd ff:ff:ff:ff:ff:ff link-netnsid &lt;span class="m">0&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>So, the interface is configured with an MTU of 1450, which I guess is inherited by our &lt;em>host&lt;/em> network adapter and also cannot be changed on the fly in the container. Let&amp;rsquo;s see what we kave in k8s.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ ip link
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">1: lo: &amp;lt;LOOPBACK,UP,LOWER_UP&amp;gt; mtu &lt;span class="m">65536&lt;/span> qdisc noqueue state UNKNOWN mode DEFAULT group default qlen &lt;span class="m">1000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2: ens3: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu &lt;span class="m">1500&lt;/span> qdisc fq_codel state UP mode DEFAULT group default qlen &lt;span class="m">1000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> link/ether 00:50:02:00:01:00 brd ff:ff:ff:ff:ff:ff
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">3: flannel.1: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu &lt;span class="m">1450&lt;/span> qdisc noqueue state UNKNOWN mode DEFAULT group default
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> link/ether 5e:3c:ea:cf:bd:cd brd ff:ff:ff:ff:ff:ff
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">4: cni0: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu &lt;span class="m">1450&lt;/span> qdisc noqueue state UP mode DEFAULT group default qlen &lt;span class="m">1000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> link/ether 92:19:8e:ea:71:f5 brd ff:ff:ff:ff:ff:ff
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">5: vethf00a4528@if3: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu &lt;span class="m">1450&lt;/span> qdisc noqueue master cni0 state UP mode DEFAULT group default
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> link/ether 92:85:21:c2:60:82 brd ff:ff:ff:ff:ff:ff link-netns cni-461b355e-9191-3b43-3778-e328f19016ef
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">6: vethd6c19f4d@if3: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu &lt;span class="m">1450&lt;/span> qdisc noqueue master cni0 state UP mode DEFAULT group default
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> link/ether d6:77:32:3c:c2:91 brd ff:ff:ff:ff:ff:ff link-netns cni-c88dd2d1-485d-2cd4-5f2d-d5b5539370eb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>So flannel, since it is a VXLAN CNI inherits the MTU of ens3 &lt;em>physical&lt;/em> interface minus 50 overhead for the headers. I am thinking of an easy fix around this is to increase the MTU on the physical interface, i.e. EVE-NGs physical interface and k8s VMs one as well. Let&amp;rsquo;s shutdown all VMs first and make the change to the EVE hosts.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Configure jumbo MTU on both EVE-NG nodes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@eve-01:~# ip link &lt;span class="nb">set&lt;/span> mtu &lt;span class="m">9000&lt;/span> dev eth0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@eve-01:~# ip link &lt;span class="nb">set&lt;/span> mtu &lt;span class="m">9000&lt;/span> dev pnet0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@eve-02:~# ip link &lt;span class="nb">set&lt;/span> mtu &lt;span class="m">9000&lt;/span> dev eth0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@eve-02:~# ip link &lt;span class="nb">set&lt;/span> mtu &lt;span class="m">9000&lt;/span> dev pnet0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># If you want to make it permanent&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@eve-01:~# head -n20 /etc/network/interfaces
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># This file describes the network interfaces available on your system&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># and how to activate them. For more information, see interfaces(5).&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># The loopback network interface&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">auto lo
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iface lo inet loopback
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># The primary network interface&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iface eth0 inet manual
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">auto pnet0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iface pnet0 inet static
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> address 192.168.1.21
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> netmask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> gateway 192.168.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dns-domain lab.net
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dns-nameservers 192.168.1.1 8.8.8.8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> bridge_ports eth0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> bridge_stp off
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mtu &lt;span class="m">9000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line hl">&lt;span class="cl"> post-up ifconfig eth0 mtu &lt;span class="m">9000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Verify that jumbo MTU is supported on your infra&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@eve-01:~# ping 192.168.1.22 -Mdo -s &lt;span class="m">5000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PING 192.168.1.22 &lt;span class="o">(&lt;/span>192.168.1.22&lt;span class="o">)&lt;/span> 5000&lt;span class="o">(&lt;/span>5028&lt;span class="o">)&lt;/span> bytes of data.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">5008&lt;/span> bytes from 192.168.1.22: &lt;span class="nv">icmp_seq&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">1&lt;/span> &lt;span class="nv">ttl&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">64&lt;/span> &lt;span class="nv">time&lt;/span>&lt;span class="o">=&lt;/span>0.434 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">5008&lt;/span> bytes from 192.168.1.22: &lt;span class="nv">icmp_seq&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">2&lt;/span> &lt;span class="nv">ttl&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">64&lt;/span> &lt;span class="nv">time&lt;/span>&lt;span class="o">=&lt;/span>0.415 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">5008&lt;/span> bytes from 192.168.1.22: &lt;span class="nv">icmp_seq&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">3&lt;/span> &lt;span class="nv">ttl&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">64&lt;/span> &lt;span class="nv">time&lt;/span>&lt;span class="o">=&lt;/span>0.423 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">5008&lt;/span> bytes from 192.168.1.22: &lt;span class="nv">icmp_seq&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">4&lt;/span> &lt;span class="nv">ttl&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">64&lt;/span> &lt;span class="nv">time&lt;/span>&lt;span class="o">=&lt;/span>0.397 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">^C
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--- 192.168.1.22 ping statistics ---
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">4&lt;/span> packets transmitted, &lt;span class="m">4&lt;/span> received, 0% packet loss, &lt;span class="nb">time&lt;/span> 3083ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rtt min/avg/max/mdev &lt;span class="o">=&lt;/span> 0.397/0.417/0.434/0.019 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@eve-02:~# tracepath -n 192.168.1.21
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 1?: &lt;span class="o">[&lt;/span>LOCALHOST&lt;span class="o">]&lt;/span> pmtu &lt;span class="m">9000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 1: 192.168.1.21 0.570ms reached
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 1: 192.168.1.21 0.428ms reached
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Resume: pmtu &lt;span class="m">9000&lt;/span> hops &lt;span class="m">1&lt;/span> back &lt;span class="m">1&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Bring up the k8s VMs and set the MTU there too.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ cat /etc/netplan/50-cloud-init.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># This file is generated from information provided by the datasource. Changes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># to it will not persist across an instance reboot. To disable cloud-init&amp;#39;s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># network configuration capabilities, write a file&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># /etc/cloud/cloud.cfg.d/99-disable-network-config.cfg with the following:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># network: {config: disabled}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">network:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ethernets:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ens3:
&lt;/span>&lt;/span>&lt;span class="line hl">&lt;span class="cl"> mtu: &lt;span class="m">9000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dhcp4: &lt;span class="nb">false&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dhcp6: &lt;span class="nb">false&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> addresses: &lt;span class="o">[&lt;/span>192.168.1.30/24&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> gateway4: 192.168.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> nameservers:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> addresses: &lt;span class="o">[&lt;/span>192.168.1.1, 8.8.8.8&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> version: &lt;span class="m">2&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Reboot all 3 VMs and check the network&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ ip link
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">1: lo: &amp;lt;LOOPBACK,UP,LOWER_UP&amp;gt; mtu &lt;span class="m">65536&lt;/span> qdisc noqueue state UNKNOWN mode DEFAULT group default qlen &lt;span class="m">1000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2: ens3: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu &lt;span class="m">9000&lt;/span> qdisc fq_codel state UP mode DEFAULT group default qlen &lt;span class="m">1000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> link/ether 00:50:02:00:01:00 brd ff:ff:ff:ff:ff:ff
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">3: flannel.1: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu &lt;span class="m">8950&lt;/span> qdisc noqueue state UNKNOWN mode DEFAULT group default
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> link/ether 2a:d3:ae:2c:3a:47 brd ff:ff:ff:ff:ff:ff
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">4: cni0: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu &lt;span class="m">8950&lt;/span> qdisc noqueue state UP mode DEFAULT group default qlen &lt;span class="m">1000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> link/ether b2:26:5f:c2:46:4c brd ff:ff:ff:ff:ff:ff
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">5: veth48f89ceb@if3: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu &lt;span class="m">8950&lt;/span> qdisc noqueue master cni0 state UP mode DEFAULT group default
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> link/ether 4a:f4:77:a3:32:db brd ff:ff:ff:ff:ff:ff link-netns cni-9818a9b4-e802-2a6c-fc91-c4e241c38383
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">6: vethafbac825@if3: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu &lt;span class="m">8950&lt;/span> qdisc noqueue master cni0 state UP mode DEFAULT group default
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> link/ether c6:44:4c:53:b4:50 brd ff:ff:ff:ff:ff:ff link-netns cni-014e3a91-e088-0d4b-740b-1024368a45a4&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>It looks so much better now &amp;#x1f604;. OK, back on r1 then, let&amp;rsquo;s see how it looks like on the networking side&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ kubectl -n 2srl-certs &lt;span class="nb">exec&lt;/span> -it r1 -- bash
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Defaulted container &lt;span class="s2">&amp;#34;r1&amp;#34;&lt;/span> out of: r1, init-r1 &lt;span class="o">(&lt;/span>init&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@r1 /&lt;span class="o">]&lt;/span>&lt;span class="c1"># ip link&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">1: lo: &amp;lt;LOOPBACK,UP,LOWER_UP&amp;gt; mtu &lt;span class="m">65536&lt;/span> qdisc noqueue state UNKNOWN mode DEFAULT group default qlen &lt;span class="m">1000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">3: mgmt0@if10: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu &lt;span class="m">1514&lt;/span> qdisc noqueue state UP mode DEFAULT group default
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> link/ether 2e:99:25:47:fe:3d brd ff:ff:ff:ff:ff:ff link-netnsid &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">4: gway-2800@if2: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu &lt;span class="m">1500&lt;/span> qdisc noqueue state UP mode DEFAULT group default qlen &lt;span class="m">1000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> link/ether 66:fa:8c:11:28:47 brd ff:ff:ff:ff:ff:ff link-netns srbase-mgmt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">5: mgmt0-0@if4: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu &lt;span class="m">1500&lt;/span> qdisc noqueue state UP mode DEFAULT group default qlen &lt;span class="m">1000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> link/ether 0a:5d:84:d6:be:df brd ff:ff:ff:ff:ff:ff link-netns srbase-mgmt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">alias&lt;/span> mgmt0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">6: monit_in@if5: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu &lt;span class="m">9234&lt;/span> qdisc noqueue state UP mode DEFAULT group default qlen &lt;span class="m">1000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> link/ether 76:35:de:b1:c1:a6 brd ff:ff:ff:ff:ff:ff link-netns monit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">11: e1-1@if11: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu &lt;span class="m">8950&lt;/span> qdisc noqueue state UNKNOWN mode DEFAULT group default qlen &lt;span class="m">1000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> link/ether be:d0:be:51:69:e3 brd ff:ff:ff:ff:ff:ff link-netnsid &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@r1 /&lt;span class="o">]&lt;/span>&lt;span class="c1">#&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Now lets configure the devices with the following commands&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># on R1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--&lt;span class="o">{&lt;/span> &lt;span class="o">[&lt;/span>FACTORY&lt;span class="o">]&lt;/span> + candidate shared default &lt;span class="o">}&lt;/span>--&lt;span class="o">[&lt;/span> &lt;span class="o">]&lt;/span>--
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">A:r1# info flat interface ethernet-1/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> / interface ethernet-1/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> / interface ethernet-1/1 mtu &lt;span class="m">1516&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> / interface ethernet-1/1 ethernet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> / interface ethernet-1/1 ethernet port-speed 10G
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> / interface ethernet-1/1 subinterface &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> / interface ethernet-1/1 subinterface &lt;span class="m">0&lt;/span> ip-mtu &lt;span class="m">1500&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> / interface ethernet-1/1 subinterface &lt;span class="m">0&lt;/span> ipv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> / interface ethernet-1/1 subinterface &lt;span class="m">0&lt;/span> ipv4 address 10.1.1.1/30
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--&lt;span class="o">{&lt;/span> &lt;span class="o">[&lt;/span>FACTORY&lt;span class="o">]&lt;/span> + candidate shared default &lt;span class="o">}&lt;/span>--&lt;span class="o">[&lt;/span> &lt;span class="o">]&lt;/span>--
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">A:r1# info flat network-instance main
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> / network-instance main
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> / network-instance main interface ethernet-1/1.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">A:r1# show interface ethernet-1/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">==========================================================================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ethernet-1/1 is up, speed 10G, &lt;span class="nb">type&lt;/span> None
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ethernet-1/1.0 is up
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Network-instance: main
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Encapsulation : null
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Type : routed
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> IPv4 addr : 10.1.1.1/30 &lt;span class="o">(&lt;/span>static, preferred, primary&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">==========================================================================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># on R2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">A:r2# info flat interface ethernet-1/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> / interface ethernet-1/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> / interface ethernet-1/1 mtu &lt;span class="m">1516&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> / interface ethernet-1/1 ethernet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> / interface ethernet-1/1 ethernet port-speed 10G
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> / interface ethernet-1/1 subinterface &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> / interface ethernet-1/1 subinterface &lt;span class="m">0&lt;/span> ip-mtu &lt;span class="m">1500&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> / interface ethernet-1/1 subinterface &lt;span class="m">0&lt;/span> ipv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> / interface ethernet-1/1 subinterface &lt;span class="m">0&lt;/span> ipv4 address 10.1.1.2/30
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--&lt;span class="o">{&lt;/span> running &lt;span class="o">}&lt;/span>--&lt;span class="o">[&lt;/span> &lt;span class="o">]&lt;/span>--
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">A:r2# info flat network-instance main
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> / network-instance main
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> / network-instance main interface ethernet-1/1.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Check that we get pings&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">A:r2# ping 10.1.1.1 network-instance main
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Using network instance main
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PING 10.1.1.1 &lt;span class="o">(&lt;/span>10.1.1.1&lt;span class="o">)&lt;/span> 56&lt;span class="o">(&lt;/span>84&lt;span class="o">)&lt;/span> bytes of data.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">64&lt;/span> bytes from 10.1.1.1: &lt;span class="nv">icmp_seq&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">1&lt;/span> &lt;span class="nv">ttl&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">64&lt;/span> &lt;span class="nv">time&lt;/span>&lt;span class="o">=&lt;/span>58.8 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">64&lt;/span> bytes from 10.1.1.1: &lt;span class="nv">icmp_seq&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">2&lt;/span> &lt;span class="nv">ttl&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">64&lt;/span> &lt;span class="nv">time&lt;/span>&lt;span class="o">=&lt;/span>14.7 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">64&lt;/span> bytes from 10.1.1.1: &lt;span class="nv">icmp_seq&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">3&lt;/span> &lt;span class="nv">ttl&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">64&lt;/span> &lt;span class="nv">time&lt;/span>&lt;span class="o">=&lt;/span>9.13 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">64&lt;/span> bytes from 10.1.1.1: &lt;span class="nv">icmp_seq&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">4&lt;/span> &lt;span class="nv">ttl&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">64&lt;/span> &lt;span class="nv">time&lt;/span>&lt;span class="o">=&lt;/span>12.5 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">64&lt;/span> bytes from 10.1.1.1: &lt;span class="nv">icmp_seq&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">5&lt;/span> &lt;span class="nv">ttl&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">64&lt;/span> &lt;span class="nv">time&lt;/span>&lt;span class="o">=&lt;/span>14.7 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">64&lt;/span> bytes from 10.1.1.1: &lt;span class="nv">icmp_seq&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">6&lt;/span> &lt;span class="nv">ttl&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">64&lt;/span> &lt;span class="nv">time&lt;/span>&lt;span class="o">=&lt;/span>9.12 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">64&lt;/span> bytes from 10.1.1.1: &lt;span class="nv">icmp_seq&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">7&lt;/span> &lt;span class="nv">ttl&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">64&lt;/span> &lt;span class="nv">time&lt;/span>&lt;span class="o">=&lt;/span>12.5 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">64&lt;/span> bytes from 10.1.1.1: &lt;span class="nv">icmp_seq&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">8&lt;/span> &lt;span class="nv">ttl&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">64&lt;/span> &lt;span class="nv">time&lt;/span>&lt;span class="o">=&lt;/span>6.85 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">^C
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--- 10.1.1.1 ping statistics ---
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">8&lt;/span> packets transmitted, &lt;span class="m">8&lt;/span> received, 0% packet loss, &lt;span class="nb">time&lt;/span> 7008ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rtt min/avg/max/mdev &lt;span class="o">=&lt;/span> 6.853/17.291/58.831/15.918 ms&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>OK, now let&amp;rsquo;s try out the other srlinux variants supported&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ kubectl -n 2srl-certs get cm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME DATA AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-root-ca.crt &lt;span class="m">1&lt;/span> 5h33m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">srlinux-kne-entrypoint &lt;span class="m">1&lt;/span> 5h33m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">srlinux-topomac-script &lt;span class="m">1&lt;/span> 5h33m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">srlinux-variants &lt;span class="m">5&lt;/span> 5h33m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ kubectl -n 2srl-certs describe cm srlinux-variants &lt;span class="p">|&lt;/span> grep ^ixr
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ixrd1:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ixrd10:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ixrd2:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ixrd3:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ixr6:&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Create a simple lab containing only the node definitions.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~/labs$ cat test-sr.pbtxt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">name: &lt;span class="s2">&amp;#34;srl-test&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nodes: &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: &lt;span class="s2">&amp;#34;r1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vendor: NOKIA
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> services:&lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> key: &lt;span class="m">22&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> value: &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: &lt;span class="s2">&amp;#34;ssh&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> inside: &lt;span class="m">22&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> model: &lt;span class="s2">&amp;#34;ixr6&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nodes: &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: &lt;span class="s2">&amp;#34;r2&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vendor: NOKIA
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> services:&lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> key: &lt;span class="m">22&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> value: &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: &lt;span class="s2">&amp;#34;ssh&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> inside: &lt;span class="m">22&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> model: &lt;span class="s2">&amp;#34;ixrd1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nodes: &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: &lt;span class="s2">&amp;#34;r3&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vendor: NOKIA
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> services:&lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> key: &lt;span class="m">22&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> value: &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: &lt;span class="s2">&amp;#34;ssh&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> inside: &lt;span class="m">22&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> model: &lt;span class="s2">&amp;#34;ixrd2&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nodes: &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: &lt;span class="s2">&amp;#34;r4&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vendor: NOKIA
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> services:&lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> key: &lt;span class="m">22&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> value: &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: &lt;span class="s2">&amp;#34;ssh&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> inside: &lt;span class="m">22&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> model: &lt;span class="s2">&amp;#34;ixrd3&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nodes: &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: &lt;span class="s2">&amp;#34;r5&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vendor: NOKIA
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> services:&lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> key: &lt;span class="m">22&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> value: &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: &lt;span class="s2">&amp;#34;ssh&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> inside: &lt;span class="m">22&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> model: &lt;span class="s2">&amp;#34;ixrd10&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>And start it up.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~/labs$ kne_cli create test-sr.pbtxt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> /home/ubuntu/labs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Creating manager &lt;span class="k">for&lt;/span>: srl-test
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Trying in-cluster configuration
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Falling back to kubeconfig: &lt;span class="s2">&amp;#34;/home/ubuntu/.kube/config&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Topology:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">name: &lt;span class="s2">&amp;#34;srl-test&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nodes: &amp;lt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: &lt;span class="s2">&amp;#34;r1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> services: &amp;lt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> key: &lt;span class="m">22&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> value: &amp;lt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: &lt;span class="s2">&amp;#34;ssh&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> inside: &lt;span class="m">22&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vendor: NOKIA
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> model: &lt;span class="s2">&amp;#34;ixr6&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nodes: &amp;lt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: &lt;span class="s2">&amp;#34;r2&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> services: &amp;lt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> key: &lt;span class="m">22&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> value: &amp;lt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: &lt;span class="s2">&amp;#34;ssh&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> inside: &lt;span class="m">22&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vendor: NOKIA
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> model: &lt;span class="s2">&amp;#34;ixrd1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nodes: &amp;lt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: &lt;span class="s2">&amp;#34;r3&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> services: &amp;lt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> key: &lt;span class="m">22&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> value: &amp;lt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: &lt;span class="s2">&amp;#34;ssh&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> inside: &lt;span class="m">22&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vendor: NOKIA
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> model: &lt;span class="s2">&amp;#34;ixrd2&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nodes: &amp;lt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: &lt;span class="s2">&amp;#34;r4&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> services: &amp;lt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> key: &lt;span class="m">22&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> value: &amp;lt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: &lt;span class="s2">&amp;#34;ssh&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> inside: &lt;span class="m">22&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vendor: NOKIA
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> model: &lt;span class="s2">&amp;#34;ixrd3&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nodes: &amp;lt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: &lt;span class="s2">&amp;#34;r5&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> services: &amp;lt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> key: &lt;span class="m">22&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> value: &amp;lt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: &lt;span class="s2">&amp;#34;ssh&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> inside: &lt;span class="m">22&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vendor: NOKIA
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> model: &lt;span class="s2">&amp;#34;ixrd10&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Adding Node: r1:NOKIA:UNKNOWN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Adding Node: r2:NOKIA:UNKNOWN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Adding Node: r3:NOKIA:UNKNOWN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Adding Node: r4:NOKIA:UNKNOWN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Adding Node: r5:NOKIA:UNKNOWN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Creating namespace &lt;span class="k">for&lt;/span> topology: &lt;span class="s2">&amp;#34;srl-test&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Server Namespace: &lt;span class="p">&amp;amp;&lt;/span>Namespace&lt;span class="o">{&lt;/span>ObjectMeta:&lt;span class="o">{&lt;/span>srl-test 9209b1c5-6ea2-427f-8a2f-4f6e3705f8e8 &lt;span class="m">53116&lt;/span> &lt;span class="m">0&lt;/span> 2022-06-08 18:41:57 +0000 UTC &amp;lt;nil&amp;gt; &amp;lt;nil&amp;gt; map&lt;span class="o">[&lt;/span>kubernetes.io/metadata.name:srl-test&lt;span class="o">]&lt;/span> map&lt;span class="o">[]&lt;/span> &lt;span class="o">[]&lt;/span> &lt;span class="o">[]&lt;/span> &lt;span class="o">[{&lt;/span>kne_cli Update v1 2022-06-08 18:41:57 +0000 UTC FieldsV1 &lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;f:metadata&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;f:labels&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;.&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:kubernetes.io/metadata.name&amp;#34;&lt;/span>:&lt;span class="o">{}}}}}]}&lt;/span>,Spec:NamespaceSpec&lt;span class="o">{&lt;/span>Finalizers:&lt;span class="o">[&lt;/span>kubernetes&lt;span class="o">]&lt;/span>,&lt;span class="o">}&lt;/span>,Status:NamespaceStatus&lt;span class="o">{&lt;/span>Phase:Active,Conditions:&lt;span class="o">[]&lt;/span>NamespaceCondition&lt;span class="o">{}&lt;/span>,&lt;span class="o">}&lt;/span>,&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Getting topology specs &lt;span class="k">for&lt;/span> namespace srl-test
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Getting topology specs &lt;span class="k">for&lt;/span> node r5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Getting topology specs &lt;span class="k">for&lt;/span> node r1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Getting topology specs &lt;span class="k">for&lt;/span> node r2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Getting topology specs &lt;span class="k">for&lt;/span> node r3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Getting topology specs &lt;span class="k">for&lt;/span> node r4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Creating topology &lt;span class="k">for&lt;/span> meshnet node r2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Meshnet Node:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;amp;&lt;/span>&lt;span class="o">{&lt;/span>TypeMeta:&lt;span class="o">{&lt;/span>Kind: APIVersion:&lt;span class="o">}&lt;/span> ObjectMeta:&lt;span class="o">{&lt;/span>Name:r2 GenerateName: Namespace:srl-test SelfLink: UID:c11bdba8-4d64-4aea-b065-858907ed8271 ResourceVersion:53119 Generation:1 CreationTimestamp:2022-06-08 18:41:57 +0000 UTC DeletionTimestamp:&amp;lt;nil&amp;gt; DeletionGracePeriodSeconds:&amp;lt;nil&amp;gt; Labels:map&lt;span class="o">[]&lt;/span> Annotations:map&lt;span class="o">[]&lt;/span> OwnerReferences:&lt;span class="o">[]&lt;/span> Finalizers:&lt;span class="o">[]&lt;/span> ClusterName: ManagedFields:&lt;span class="o">[{&lt;/span>Manager:kne_cli Operation:Update APIVersion:networkop.co.uk/v1beta1 Time:2022-06-08 18:41:57 +0000 UTC FieldsType:FieldsV1 FieldsV1:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;f:spec&amp;#34;&lt;/span>:&lt;span class="o">{}}}]}&lt;/span> Status:&lt;span class="o">{&lt;/span>TypeMeta:&lt;span class="o">{&lt;/span>Kind: APIVersion:&lt;span class="o">}&lt;/span> ObjectMeta:&lt;span class="o">{&lt;/span>Name: GenerateName: Namespace: SelfLink: UID: ResourceVersion: Generation:0 CreationTimestamp:0001-01-01 00:00:00 +0000 UTC DeletionTimestamp:&amp;lt;nil&amp;gt; DeletionGracePeriodSeconds:&amp;lt;nil&amp;gt; Labels:map&lt;span class="o">[]&lt;/span> Annotations:map&lt;span class="o">[]&lt;/span> OwnerReferences:&lt;span class="o">[]&lt;/span> Finalizers:&lt;span class="o">[]&lt;/span> ClusterName: ManagedFields:&lt;span class="o">[]}&lt;/span> Skipped:&lt;span class="o">[]&lt;/span> SrcIp: NetNs:&lt;span class="o">}&lt;/span> Spec:&lt;span class="o">{&lt;/span>TypeMeta:&lt;span class="o">{&lt;/span>Kind: APIVersion:&lt;span class="o">}&lt;/span> Links:&lt;span class="o">[]}}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Creating topology &lt;span class="k">for&lt;/span> meshnet node r3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Meshnet Node:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;amp;&lt;/span>&lt;span class="o">{&lt;/span>TypeMeta:&lt;span class="o">{&lt;/span>Kind: APIVersion:&lt;span class="o">}&lt;/span> ObjectMeta:&lt;span class="o">{&lt;/span>Name:r3 GenerateName: Namespace:srl-test SelfLink: UID:3b0ca0fd-263a-400b-aec5-c2799a07f711 ResourceVersion:53120 Generation:1 CreationTimestamp:2022-06-08 18:41:57 +0000 UTC DeletionTimestamp:&amp;lt;nil&amp;gt; DeletionGracePeriodSeconds:&amp;lt;nil&amp;gt; Labels:map&lt;span class="o">[]&lt;/span> Annotations:map&lt;span class="o">[]&lt;/span> OwnerReferences:&lt;span class="o">[]&lt;/span> Finalizers:&lt;span class="o">[]&lt;/span> ClusterName: ManagedFields:&lt;span class="o">[{&lt;/span>Manager:kne_cli Operation:Update APIVersion:networkop.co.uk/v1beta1 Time:2022-06-08 18:41:57 +0000 UTC FieldsType:FieldsV1 FieldsV1:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;f:spec&amp;#34;&lt;/span>:&lt;span class="o">{}}}]}&lt;/span> Status:&lt;span class="o">{&lt;/span>TypeMeta:&lt;span class="o">{&lt;/span>Kind: APIVersion:&lt;span class="o">}&lt;/span> ObjectMeta:&lt;span class="o">{&lt;/span>Name: GenerateName: Namespace: SelfLink: UID: ResourceVersion: Generation:0 CreationTimestamp:0001-01-01 00:00:00 +0000 UTC DeletionTimestamp:&amp;lt;nil&amp;gt; DeletionGracePeriodSeconds:&amp;lt;nil&amp;gt; Labels:map&lt;span class="o">[]&lt;/span> Annotations:map&lt;span class="o">[]&lt;/span> OwnerReferences:&lt;span class="o">[]&lt;/span> Finalizers:&lt;span class="o">[]&lt;/span> ClusterName: ManagedFields:&lt;span class="o">[]}&lt;/span> Skipped:&lt;span class="o">[]&lt;/span> SrcIp: NetNs:&lt;span class="o">}&lt;/span> Spec:&lt;span class="o">{&lt;/span>TypeMeta:&lt;span class="o">{&lt;/span>Kind: APIVersion:&lt;span class="o">}&lt;/span> Links:&lt;span class="o">[]}}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Creating topology &lt;span class="k">for&lt;/span> meshnet node r4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Meshnet Node:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;amp;&lt;/span>&lt;span class="o">{&lt;/span>TypeMeta:&lt;span class="o">{&lt;/span>Kind: APIVersion:&lt;span class="o">}&lt;/span> ObjectMeta:&lt;span class="o">{&lt;/span>Name:r4 GenerateName: Namespace:srl-test SelfLink: UID:66947ac6-f55a-4082-8eee-4afcbc513c33 ResourceVersion:53121 Generation:1 CreationTimestamp:2022-06-08 18:41:57 +0000 UTC DeletionTimestamp:&amp;lt;nil&amp;gt; DeletionGracePeriodSeconds:&amp;lt;nil&amp;gt; Labels:map&lt;span class="o">[]&lt;/span> Annotations:map&lt;span class="o">[]&lt;/span> OwnerReferences:&lt;span class="o">[]&lt;/span> Finalizers:&lt;span class="o">[]&lt;/span> ClusterName: ManagedFields:&lt;span class="o">[{&lt;/span>Manager:kne_cli Operation:Update APIVersion:networkop.co.uk/v1beta1 Time:2022-06-08 18:41:57 +0000 UTC FieldsType:FieldsV1 FieldsV1:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;f:spec&amp;#34;&lt;/span>:&lt;span class="o">{}}}]}&lt;/span> Status:&lt;span class="o">{&lt;/span>TypeMeta:&lt;span class="o">{&lt;/span>Kind: APIVersion:&lt;span class="o">}&lt;/span> ObjectMeta:&lt;span class="o">{&lt;/span>Name: GenerateName: Namespace: SelfLink: UID: ResourceVersion: Generation:0 CreationTimestamp:0001-01-01 00:00:00 +0000 UTC DeletionTimestamp:&amp;lt;nil&amp;gt; DeletionGracePeriodSeconds:&amp;lt;nil&amp;gt; Labels:map&lt;span class="o">[]&lt;/span> Annotations:map&lt;span class="o">[]&lt;/span> OwnerReferences:&lt;span class="o">[]&lt;/span> Finalizers:&lt;span class="o">[]&lt;/span> ClusterName: ManagedFields:&lt;span class="o">[]}&lt;/span> Skipped:&lt;span class="o">[]&lt;/span> SrcIp: NetNs:&lt;span class="o">}&lt;/span> Spec:&lt;span class="o">{&lt;/span>TypeMeta:&lt;span class="o">{&lt;/span>Kind: APIVersion:&lt;span class="o">}&lt;/span> Links:&lt;span class="o">[]}}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Creating topology &lt;span class="k">for&lt;/span> meshnet node r5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Meshnet Node:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;amp;&lt;/span>&lt;span class="o">{&lt;/span>TypeMeta:&lt;span class="o">{&lt;/span>Kind: APIVersion:&lt;span class="o">}&lt;/span> ObjectMeta:&lt;span class="o">{&lt;/span>Name:r5 GenerateName: Namespace:srl-test SelfLink: UID:2f31adf0-3298-4709-a310-5144e1253913 ResourceVersion:53122 Generation:1 CreationTimestamp:2022-06-08 18:41:57 +0000 UTC DeletionTimestamp:&amp;lt;nil&amp;gt; DeletionGracePeriodSeconds:&amp;lt;nil&amp;gt; Labels:map&lt;span class="o">[]&lt;/span> Annotations:map&lt;span class="o">[]&lt;/span> OwnerReferences:&lt;span class="o">[]&lt;/span> Finalizers:&lt;span class="o">[]&lt;/span> ClusterName: ManagedFields:&lt;span class="o">[{&lt;/span>Manager:kne_cli Operation:Update APIVersion:networkop.co.uk/v1beta1 Time:2022-06-08 18:41:57 +0000 UTC FieldsType:FieldsV1 FieldsV1:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;f:spec&amp;#34;&lt;/span>:&lt;span class="o">{}}}]}&lt;/span> Status:&lt;span class="o">{&lt;/span>TypeMeta:&lt;span class="o">{&lt;/span>Kind: APIVersion:&lt;span class="o">}&lt;/span> ObjectMeta:&lt;span class="o">{&lt;/span>Name: GenerateName: Namespace: SelfLink: UID: ResourceVersion: Generation:0 CreationTimestamp:0001-01-01 00:00:00 +0000 UTC DeletionTimestamp:&amp;lt;nil&amp;gt; DeletionGracePeriodSeconds:&amp;lt;nil&amp;gt; Labels:map&lt;span class="o">[]&lt;/span> Annotations:map&lt;span class="o">[]&lt;/span> OwnerReferences:&lt;span class="o">[]&lt;/span> Finalizers:&lt;span class="o">[]&lt;/span> ClusterName: ManagedFields:&lt;span class="o">[]}&lt;/span> Skipped:&lt;span class="o">[]&lt;/span> SrcIp: NetNs:&lt;span class="o">}&lt;/span> Spec:&lt;span class="o">{&lt;/span>TypeMeta:&lt;span class="o">{&lt;/span>Kind: APIVersion:&lt;span class="o">}&lt;/span> Links:&lt;span class="o">[]}}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Creating topology &lt;span class="k">for&lt;/span> meshnet node r1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Meshnet Node:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;amp;&lt;/span>&lt;span class="o">{&lt;/span>TypeMeta:&lt;span class="o">{&lt;/span>Kind: APIVersion:&lt;span class="o">}&lt;/span> ObjectMeta:&lt;span class="o">{&lt;/span>Name:r1 GenerateName: Namespace:srl-test SelfLink: UID:54123e29-d30e-4c6c-8e65-a2689d8bce5f ResourceVersion:53123 Generation:1 CreationTimestamp:2022-06-08 18:41:57 +0000 UTC DeletionTimestamp:&amp;lt;nil&amp;gt; DeletionGracePeriodSeconds:&amp;lt;nil&amp;gt; Labels:map&lt;span class="o">[]&lt;/span> Annotations:map&lt;span class="o">[]&lt;/span> OwnerReferences:&lt;span class="o">[]&lt;/span> Finalizers:&lt;span class="o">[]&lt;/span> ClusterName: ManagedFields:&lt;span class="o">[{&lt;/span>Manager:kne_cli Operation:Update APIVersion:networkop.co.uk/v1beta1 Time:2022-06-08 18:41:57 +0000 UTC FieldsType:FieldsV1 FieldsV1:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;f:spec&amp;#34;&lt;/span>:&lt;span class="o">{}}}]}&lt;/span> Status:&lt;span class="o">{&lt;/span>TypeMeta:&lt;span class="o">{&lt;/span>Kind: APIVersion:&lt;span class="o">}&lt;/span> ObjectMeta:&lt;span class="o">{&lt;/span>Name: GenerateName: Namespace: SelfLink: UID: ResourceVersion: Generation:0 CreationTimestamp:0001-01-01 00:00:00 +0000 UTC DeletionTimestamp:&amp;lt;nil&amp;gt; DeletionGracePeriodSeconds:&amp;lt;nil&amp;gt; Labels:map&lt;span class="o">[]&lt;/span> Annotations:map&lt;span class="o">[]&lt;/span> OwnerReferences:&lt;span class="o">[]&lt;/span> Finalizers:&lt;span class="o">[]&lt;/span> ClusterName: ManagedFields:&lt;span class="o">[]}&lt;/span> Skipped:&lt;span class="o">[]&lt;/span> SrcIp: NetNs:&lt;span class="o">}&lt;/span> Spec:&lt;span class="o">{&lt;/span>TypeMeta:&lt;span class="o">{&lt;/span>Kind: APIVersion:&lt;span class="o">}&lt;/span> Links:&lt;span class="o">[]}}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Creating Node Pods
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Creating Srlinux node resource r3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Created SR Linux node r3 configmap
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Created Srlinux resource: r3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Created Service:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;amp;&lt;/span>Service&lt;span class="o">{&lt;/span>ObjectMeta:&lt;span class="o">{&lt;/span>service-r3 srl-test e1b53ca4-5334-42b1-bc76-d02541fae176 &lt;span class="m">53133&lt;/span> &lt;span class="m">0&lt;/span> 2022-06-08 18:41:58 +0000 UTC &amp;lt;nil&amp;gt; &amp;lt;nil&amp;gt; map&lt;span class="o">[&lt;/span>pod:r3&lt;span class="o">]&lt;/span> map&lt;span class="o">[]&lt;/span> &lt;span class="o">[]&lt;/span> &lt;span class="o">[]&lt;/span> &lt;span class="o">[{&lt;/span>kne_cli Update v1 2022-06-08 18:41:58 +0000 UTC FieldsV1 &lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;f:metadata&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;f:labels&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;.&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:pod&amp;#34;&lt;/span>:&lt;span class="o">{}}}&lt;/span>,&lt;span class="s2">&amp;#34;f:spec&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;f:allocateLoadBalancerNodePorts&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:externalTrafficPolicy&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:internalTrafficPolicy&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:ports&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;.&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;k:{\&amp;#34;port\&amp;#34;:22,\&amp;#34;protocol\&amp;#34;:\&amp;#34;TCP\&amp;#34;}&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;.&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:name&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:port&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:protocol&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:targetPort&amp;#34;&lt;/span>:&lt;span class="o">{}}}&lt;/span>,&lt;span class="s2">&amp;#34;f:selector&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:sessionAffinity&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:type&amp;#34;&lt;/span>:&lt;span class="o">{}}}}]}&lt;/span>,Spec:ServiceSpec&lt;span class="o">{&lt;/span>Ports:&lt;span class="o">[]&lt;/span>ServicePort&lt;span class="o">{&lt;/span>ServicePort&lt;span class="o">{&lt;/span>Name:ssh,Protocol:TCP,Port:22,TargetPort:&lt;span class="o">{&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="m">22&lt;/span> &lt;span class="o">}&lt;/span>,NodePort:30482,AppProtocol:nil,&lt;span class="o">}&lt;/span>,&lt;span class="o">}&lt;/span>,Selector:map&lt;span class="o">[&lt;/span>string&lt;span class="o">]&lt;/span>string&lt;span class="o">{&lt;/span>app: r3,&lt;span class="o">}&lt;/span>,ClusterIP:10.98.252.104,Type:LoadBalancer,ExternalIPs:&lt;span class="o">[]&lt;/span>,SessionAffinity:None,LoadBalancerIP:,LoadBalancerSourceRanges:&lt;span class="o">[]&lt;/span>,ExternalName:,ExternalTrafficPolicy:Cluster,HealthCheckNodePort:0,PublishNotReadyAddresses:false,SessionAffinityConfig:nil,TopologyKeys:&lt;span class="o">[]&lt;/span>,IPFamilyPolicy:*SingleStack,ClusterIPs:&lt;span class="o">[&lt;/span>10.98.252.104&lt;span class="o">]&lt;/span>,IPFamilies:&lt;span class="o">[&lt;/span>IPv4&lt;span class="o">]&lt;/span>,AllocateLoadBalancerNodePorts:*true,LoadBalancerClass:nil,InternalTrafficPolicy:*Cluster,&lt;span class="o">}&lt;/span>,Status:ServiceStatus&lt;span class="o">{&lt;/span>LoadBalancer:LoadBalancerStatus&lt;span class="o">{&lt;/span>Ingress:&lt;span class="o">[]&lt;/span>LoadBalancerIngress&lt;span class="o">{}&lt;/span>,&lt;span class="o">}&lt;/span>,Conditions:&lt;span class="o">[]&lt;/span>Condition&lt;span class="o">{}&lt;/span>,&lt;span class="o">}&lt;/span>,&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Node &lt;span class="s2">&amp;#34;r3&amp;#34;&lt;/span> resource created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Creating Srlinux node resource r4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Created SR Linux node r4 configmap
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Created Srlinux resource: r4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Created Service:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;amp;&lt;/span>Service&lt;span class="o">{&lt;/span>ObjectMeta:&lt;span class="o">{&lt;/span>service-r4 srl-test c83fd861-fdda-44af-984b-6fe94e3ab2b8 &lt;span class="m">53151&lt;/span> &lt;span class="m">0&lt;/span> 2022-06-08 18:41:58 +0000 UTC &amp;lt;nil&amp;gt; &amp;lt;nil&amp;gt; map&lt;span class="o">[&lt;/span>pod:r4&lt;span class="o">]&lt;/span> map&lt;span class="o">[]&lt;/span> &lt;span class="o">[]&lt;/span> &lt;span class="o">[]&lt;/span> &lt;span class="o">[{&lt;/span>kne_cli Update v1 2022-06-08 18:41:58 +0000 UTC FieldsV1 &lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;f:metadata&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;f:labels&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;.&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:pod&amp;#34;&lt;/span>:&lt;span class="o">{}}}&lt;/span>,&lt;span class="s2">&amp;#34;f:spec&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;f:allocateLoadBalancerNodePorts&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:externalTrafficPolicy&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:internalTrafficPolicy&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:ports&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;.&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;k:{\&amp;#34;port\&amp;#34;:22,\&amp;#34;protocol\&amp;#34;:\&amp;#34;TCP\&amp;#34;}&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;.&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:name&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:port&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:protocol&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:targetPort&amp;#34;&lt;/span>:&lt;span class="o">{}}}&lt;/span>,&lt;span class="s2">&amp;#34;f:selector&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:sessionAffinity&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:type&amp;#34;&lt;/span>:&lt;span class="o">{}}}}]}&lt;/span>,Spec:ServiceSpec&lt;span class="o">{&lt;/span>Ports:&lt;span class="o">[]&lt;/span>ServicePort&lt;span class="o">{&lt;/span>ServicePort&lt;span class="o">{&lt;/span>Name:ssh,Protocol:TCP,Port:22,TargetPort:&lt;span class="o">{&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="m">22&lt;/span> &lt;span class="o">}&lt;/span>,NodePort:30936,AppProtocol:nil,&lt;span class="o">}&lt;/span>,&lt;span class="o">}&lt;/span>,Selector:map&lt;span class="o">[&lt;/span>string&lt;span class="o">]&lt;/span>string&lt;span class="o">{&lt;/span>app: r4,&lt;span class="o">}&lt;/span>,ClusterIP:10.96.239.113,Type:LoadBalancer,ExternalIPs:&lt;span class="o">[]&lt;/span>,SessionAffinity:None,LoadBalancerIP:,LoadBalancerSourceRanges:&lt;span class="o">[]&lt;/span>,ExternalName:,ExternalTrafficPolicy:Cluster,HealthCheckNodePort:0,PublishNotReadyAddresses:false,SessionAffinityConfig:nil,TopologyKeys:&lt;span class="o">[]&lt;/span>,IPFamilyPolicy:*SingleStack,ClusterIPs:&lt;span class="o">[&lt;/span>10.96.239.113&lt;span class="o">]&lt;/span>,IPFamilies:&lt;span class="o">[&lt;/span>IPv4&lt;span class="o">]&lt;/span>,AllocateLoadBalancerNodePorts:*true,LoadBalancerClass:nil,InternalTrafficPolicy:*Cluster,&lt;span class="o">}&lt;/span>,Status:ServiceStatus&lt;span class="o">{&lt;/span>LoadBalancer:LoadBalancerStatus&lt;span class="o">{&lt;/span>Ingress:&lt;span class="o">[]&lt;/span>LoadBalancerIngress&lt;span class="o">{}&lt;/span>,&lt;span class="o">}&lt;/span>,Conditions:&lt;span class="o">[]&lt;/span>Condition&lt;span class="o">{}&lt;/span>,&lt;span class="o">}&lt;/span>,&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Node &lt;span class="s2">&amp;#34;r4&amp;#34;&lt;/span> resource created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Creating Srlinux node resource r5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Created SR Linux node r5 configmap
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Created Srlinux resource: r5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0001&lt;span class="o">]&lt;/span> Created Service:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;amp;&lt;/span>Service&lt;span class="o">{&lt;/span>ObjectMeta:&lt;span class="o">{&lt;/span>service-r5 srl-test 0b6ab531-b20d-45a4-ac83-d1ce10f08547 &lt;span class="m">53165&lt;/span> &lt;span class="m">0&lt;/span> 2022-06-08 18:41:58 +0000 UTC &amp;lt;nil&amp;gt; &amp;lt;nil&amp;gt; map&lt;span class="o">[&lt;/span>pod:r5&lt;span class="o">]&lt;/span> map&lt;span class="o">[]&lt;/span> &lt;span class="o">[]&lt;/span> &lt;span class="o">[]&lt;/span> &lt;span class="o">[{&lt;/span>kne_cli Update v1 2022-06-08 18:41:58 +0000 UTC FieldsV1 &lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;f:metadata&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;f:labels&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;.&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:pod&amp;#34;&lt;/span>:&lt;span class="o">{}}}&lt;/span>,&lt;span class="s2">&amp;#34;f:spec&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;f:allocateLoadBalancerNodePorts&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:externalTrafficPolicy&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:internalTrafficPolicy&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:ports&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;.&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;k:{\&amp;#34;port\&amp;#34;:22,\&amp;#34;protocol\&amp;#34;:\&amp;#34;TCP\&amp;#34;}&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;.&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:name&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:port&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:protocol&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:targetPort&amp;#34;&lt;/span>:&lt;span class="o">{}}}&lt;/span>,&lt;span class="s2">&amp;#34;f:selector&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:sessionAffinity&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:type&amp;#34;&lt;/span>:&lt;span class="o">{}}}}]}&lt;/span>,Spec:ServiceSpec&lt;span class="o">{&lt;/span>Ports:&lt;span class="o">[]&lt;/span>ServicePort&lt;span class="o">{&lt;/span>ServicePort&lt;span class="o">{&lt;/span>Name:ssh,Protocol:TCP,Port:22,TargetPort:&lt;span class="o">{&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="m">22&lt;/span> &lt;span class="o">}&lt;/span>,NodePort:31089,AppProtocol:nil,&lt;span class="o">}&lt;/span>,&lt;span class="o">}&lt;/span>,Selector:map&lt;span class="o">[&lt;/span>string&lt;span class="o">]&lt;/span>string&lt;span class="o">{&lt;/span>app: r5,&lt;span class="o">}&lt;/span>,ClusterIP:10.109.164.166,Type:LoadBalancer,ExternalIPs:&lt;span class="o">[]&lt;/span>,SessionAffinity:None,LoadBalancerIP:,LoadBalancerSourceRanges:&lt;span class="o">[]&lt;/span>,ExternalName:,ExternalTrafficPolicy:Cluster,HealthCheckNodePort:0,PublishNotReadyAddresses:false,SessionAffinityConfig:nil,TopologyKeys:&lt;span class="o">[]&lt;/span>,IPFamilyPolicy:*SingleStack,ClusterIPs:&lt;span class="o">[&lt;/span>10.109.164.166&lt;span class="o">]&lt;/span>,IPFamilies:&lt;span class="o">[&lt;/span>IPv4&lt;span class="o">]&lt;/span>,AllocateLoadBalancerNodePorts:*true,LoadBalancerClass:nil,InternalTrafficPolicy:*Cluster,&lt;span class="o">}&lt;/span>,Status:ServiceStatus&lt;span class="o">{&lt;/span>LoadBalancer:LoadBalancerStatus&lt;span class="o">{&lt;/span>Ingress:&lt;span class="o">[]&lt;/span>LoadBalancerIngress&lt;span class="o">{}&lt;/span>,&lt;span class="o">}&lt;/span>,Conditions:&lt;span class="o">[]&lt;/span>Condition&lt;span class="o">{}&lt;/span>,&lt;span class="o">}&lt;/span>,&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0001&lt;span class="o">]&lt;/span> Node &lt;span class="s2">&amp;#34;r5&amp;#34;&lt;/span> resource created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0001&lt;span class="o">]&lt;/span> Creating Srlinux node resource r1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0001&lt;span class="o">]&lt;/span> Created SR Linux node r1 configmap
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0001&lt;span class="o">]&lt;/span> Created Srlinux resource: r1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0001&lt;span class="o">]&lt;/span> Created Service:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;amp;&lt;/span>Service&lt;span class="o">{&lt;/span>ObjectMeta:&lt;span class="o">{&lt;/span>service-r1 srl-test 2c60749c-43d4-498b-90c8-0bf4e319e8fc &lt;span class="m">53180&lt;/span> &lt;span class="m">0&lt;/span> 2022-06-08 18:41:59 +0000 UTC &amp;lt;nil&amp;gt; &amp;lt;nil&amp;gt; map&lt;span class="o">[&lt;/span>pod:r1&lt;span class="o">]&lt;/span> map&lt;span class="o">[]&lt;/span> &lt;span class="o">[]&lt;/span> &lt;span class="o">[]&lt;/span> &lt;span class="o">[{&lt;/span>kne_cli Update v1 2022-06-08 18:41:59 +0000 UTC FieldsV1 &lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;f:metadata&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;f:labels&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;.&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:pod&amp;#34;&lt;/span>:&lt;span class="o">{}}}&lt;/span>,&lt;span class="s2">&amp;#34;f:spec&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;f:allocateLoadBalancerNodePorts&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:externalTrafficPolicy&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:internalTrafficPolicy&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:ports&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;.&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;k:{\&amp;#34;port\&amp;#34;:22,\&amp;#34;protocol\&amp;#34;:\&amp;#34;TCP\&amp;#34;}&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;.&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:name&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:port&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:protocol&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:targetPort&amp;#34;&lt;/span>:&lt;span class="o">{}}}&lt;/span>,&lt;span class="s2">&amp;#34;f:selector&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:sessionAffinity&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:type&amp;#34;&lt;/span>:&lt;span class="o">{}}}}]}&lt;/span>,Spec:ServiceSpec&lt;span class="o">{&lt;/span>Ports:&lt;span class="o">[]&lt;/span>ServicePort&lt;span class="o">{&lt;/span>ServicePort&lt;span class="o">{&lt;/span>Name:ssh,Protocol:TCP,Port:22,TargetPort:&lt;span class="o">{&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="m">22&lt;/span> &lt;span class="o">}&lt;/span>,NodePort:30431,AppProtocol:nil,&lt;span class="o">}&lt;/span>,&lt;span class="o">}&lt;/span>,Selector:map&lt;span class="o">[&lt;/span>string&lt;span class="o">]&lt;/span>string&lt;span class="o">{&lt;/span>app: r1,&lt;span class="o">}&lt;/span>,ClusterIP:10.99.13.223,Type:LoadBalancer,ExternalIPs:&lt;span class="o">[]&lt;/span>,SessionAffinity:None,LoadBalancerIP:,LoadBalancerSourceRanges:&lt;span class="o">[]&lt;/span>,ExternalName:,ExternalTrafficPolicy:Cluster,HealthCheckNodePort:0,PublishNotReadyAddresses:false,SessionAffinityConfig:nil,TopologyKeys:&lt;span class="o">[]&lt;/span>,IPFamilyPolicy:*SingleStack,ClusterIPs:&lt;span class="o">[&lt;/span>10.99.13.223&lt;span class="o">]&lt;/span>,IPFamilies:&lt;span class="o">[&lt;/span>IPv4&lt;span class="o">]&lt;/span>,AllocateLoadBalancerNodePorts:*true,LoadBalancerClass:nil,InternalTrafficPolicy:*Cluster,&lt;span class="o">}&lt;/span>,Status:ServiceStatus&lt;span class="o">{&lt;/span>LoadBalancer:LoadBalancerStatus&lt;span class="o">{&lt;/span>Ingress:&lt;span class="o">[]&lt;/span>LoadBalancerIngress&lt;span class="o">{}&lt;/span>,&lt;span class="o">}&lt;/span>,Conditions:&lt;span class="o">[]&lt;/span>Condition&lt;span class="o">{}&lt;/span>,&lt;span class="o">}&lt;/span>,&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0001&lt;span class="o">]&lt;/span> Node &lt;span class="s2">&amp;#34;r1&amp;#34;&lt;/span> resource created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0001&lt;span class="o">]&lt;/span> Creating Srlinux node resource r2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0001&lt;span class="o">]&lt;/span> Created SR Linux node r2 configmap
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0001&lt;span class="o">]&lt;/span> Created Srlinux resource: r2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0001&lt;span class="o">]&lt;/span> Created Service:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;amp;&lt;/span>Service&lt;span class="o">{&lt;/span>ObjectMeta:&lt;span class="o">{&lt;/span>service-r2 srl-test 0ee27dd3-5e80-429a-afb1-f13f9b99555c &lt;span class="m">53198&lt;/span> &lt;span class="m">0&lt;/span> 2022-06-08 18:41:59 +0000 UTC &amp;lt;nil&amp;gt; &amp;lt;nil&amp;gt; map&lt;span class="o">[&lt;/span>pod:r2&lt;span class="o">]&lt;/span> map&lt;span class="o">[]&lt;/span> &lt;span class="o">[]&lt;/span> &lt;span class="o">[]&lt;/span> &lt;span class="o">[{&lt;/span>kne_cli Update v1 2022-06-08 18:41:59 +0000 UTC FieldsV1 &lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;f:metadata&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;f:labels&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;.&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:pod&amp;#34;&lt;/span>:&lt;span class="o">{}}}&lt;/span>,&lt;span class="s2">&amp;#34;f:spec&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;f:allocateLoadBalancerNodePorts&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:externalTrafficPolicy&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:internalTrafficPolicy&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:ports&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;.&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;k:{\&amp;#34;port\&amp;#34;:22,\&amp;#34;protocol\&amp;#34;:\&amp;#34;TCP\&amp;#34;}&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;.&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:name&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:port&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:protocol&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:targetPort&amp;#34;&lt;/span>:&lt;span class="o">{}}}&lt;/span>,&lt;span class="s2">&amp;#34;f:selector&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:sessionAffinity&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:type&amp;#34;&lt;/span>:&lt;span class="o">{}}}}]}&lt;/span>,Spec:ServiceSpec&lt;span class="o">{&lt;/span>Ports:&lt;span class="o">[]&lt;/span>ServicePort&lt;span class="o">{&lt;/span>ServicePort&lt;span class="o">{&lt;/span>Name:ssh,Protocol:TCP,Port:22,TargetPort:&lt;span class="o">{&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="m">22&lt;/span> &lt;span class="o">}&lt;/span>,NodePort:30699,AppProtocol:nil,&lt;span class="o">}&lt;/span>,&lt;span class="o">}&lt;/span>,Selector:map&lt;span class="o">[&lt;/span>string&lt;span class="o">]&lt;/span>string&lt;span class="o">{&lt;/span>app: r2,&lt;span class="o">}&lt;/span>,ClusterIP:10.106.39.51,Type:LoadBalancer,ExternalIPs:&lt;span class="o">[]&lt;/span>,SessionAffinity:None,LoadBalancerIP:,LoadBalancerSourceRanges:&lt;span class="o">[]&lt;/span>,ExternalName:,ExternalTrafficPolicy:Cluster,HealthCheckNodePort:0,PublishNotReadyAddresses:false,SessionAffinityConfig:nil,TopologyKeys:&lt;span class="o">[]&lt;/span>,IPFamilyPolicy:*SingleStack,ClusterIPs:&lt;span class="o">[&lt;/span>10.106.39.51&lt;span class="o">]&lt;/span>,IPFamilies:&lt;span class="o">[&lt;/span>IPv4&lt;span class="o">]&lt;/span>,AllocateLoadBalancerNodePorts:*true,LoadBalancerClass:nil,InternalTrafficPolicy:*Cluster,&lt;span class="o">}&lt;/span>,Status:ServiceStatus&lt;span class="o">{&lt;/span>LoadBalancer:LoadBalancerStatus&lt;span class="o">{&lt;/span>Ingress:&lt;span class="o">[]&lt;/span>LoadBalancerIngress&lt;span class="o">{}&lt;/span>,&lt;span class="o">}&lt;/span>,Conditions:&lt;span class="o">[]&lt;/span>Condition&lt;span class="o">{}&lt;/span>,&lt;span class="o">}&lt;/span>,&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0001&lt;span class="o">]&lt;/span> Node &lt;span class="s2">&amp;#34;r2&amp;#34;&lt;/span> resource created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0003&lt;span class="o">]&lt;/span> Node &lt;span class="s2">&amp;#34;r2&amp;#34;&lt;/span>: Status RUNNING
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0003&lt;span class="o">]&lt;/span> Node &lt;span class="s2">&amp;#34;r1&amp;#34;&lt;/span>: Status RUNNING
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0003&lt;span class="o">]&lt;/span> Node &lt;span class="s2">&amp;#34;r3&amp;#34;&lt;/span>: Status RUNNING
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0004&lt;span class="o">]&lt;/span> Node &lt;span class="s2">&amp;#34;r4&amp;#34;&lt;/span>: Status RUNNING
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0004&lt;span class="o">]&lt;/span> Node &lt;span class="s2">&amp;#34;r5&amp;#34;&lt;/span>: Status RUNNING
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0004&lt;span class="o">]&lt;/span> Topology &lt;span class="s2">&amp;#34;srl-test&amp;#34;&lt;/span> created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0006&lt;span class="o">]&lt;/span> Pods:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0006&lt;span class="o">]&lt;/span> r5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0006&lt;span class="o">]&lt;/span> r1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0006&lt;span class="o">]&lt;/span> r2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0006&lt;span class="o">]&lt;/span> r3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0006&lt;span class="o">]&lt;/span> r4&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Let&amp;rsquo;s see what we have on k8s.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ kubectl -n srl-test get all -owide
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod/r1 0/1 CrashLoopBackOff &lt;span class="m">2&lt;/span> &lt;span class="o">(&lt;/span>28s ago&lt;span class="o">)&lt;/span> 70s 10.244.1.20 kates-node-01 &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod/r2 1/1 Running &lt;span class="m">0&lt;/span> 70s 10.244.2.22 kates-node-02 &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod/r3 1/1 Running &lt;span class="m">0&lt;/span> 71s 10.244.2.20 kates-node-02 &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod/r4 1/1 Running &lt;span class="m">0&lt;/span> 71s 10.244.1.19 kates-node-01 &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod/r5 0/1 CrashLoopBackOff &lt;span class="m">2&lt;/span> &lt;span class="o">(&lt;/span>22s ago&lt;span class="o">)&lt;/span> 71s 10.244.2.21 kates-node-02 &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME TYPE CLUSTER-IP EXTERNAL-IP PORT&lt;span class="o">(&lt;/span>S&lt;span class="o">)&lt;/span> AGE SELECTOR
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">service/service-r1 LoadBalancer 10.99.13.223 192.168.1.53 22:30431/TCP 70s &lt;span class="nv">app&lt;/span>&lt;span class="o">=&lt;/span>r1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">service/service-r2 LoadBalancer 10.106.39.51 192.168.1.54 22:30699/TCP 70s &lt;span class="nv">app&lt;/span>&lt;span class="o">=&lt;/span>r2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">service/service-r3 LoadBalancer 10.98.252.104 192.168.1.50 22:30482/TCP 71s &lt;span class="nv">app&lt;/span>&lt;span class="o">=&lt;/span>r3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">service/service-r4 LoadBalancer 10.96.239.113 192.168.1.51 22:30936/TCP 71s &lt;span class="nv">app&lt;/span>&lt;span class="o">=&lt;/span>r4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">service/service-r5 LoadBalancer 10.109.164.166 192.168.1.52 22:31089/TCP 71s &lt;span class="nv">app&lt;/span>&lt;span class="o">=&lt;/span>r5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>So, r1 and r5 are loop crashing and from the logs it seems something hardware related.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ kubectl -n srl-test logs r1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Defaulted container &lt;span class="s2">&amp;#34;r1&amp;#34;&lt;/span> out of: r1, init-r1 &lt;span class="o">(&lt;/span>init&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Wed Jun &lt;span class="m">8&lt;/span> 18:59:10 UTC 2022: entrypoint.sh called
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Wed Jun &lt;span class="m">8&lt;/span> 18:59:10 UTC 2022: renaming docker interface eth0 to mgmt0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Cannot find device &lt;span class="s2">&amp;#34;eth0&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Device &lt;span class="s2">&amp;#34;eth0&amp;#34;&lt;/span> does not exist.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Cannot find device &lt;span class="s2">&amp;#34;eth0&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Cannot find device &lt;span class="s2">&amp;#34;eth0&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Wed Jun &lt;span class="m">8&lt;/span> 18:59:10 UTC 2022: turning off checksum offloading on mgmt0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Wed Jun &lt;span class="m">8&lt;/span> 18:59:10 UTC 2022: starting sshd
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ssh-keygen: generating new host keys: RSA DSA ECDSA ED25519
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Wed Jun &lt;span class="m">8&lt;/span> 18:59:11 UTC 2022: Calling boot_run script
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cat: /sys/class/dmi/id/board_name: No such file or directory
&lt;/span>&lt;/span>&lt;span class="line hl">&lt;span class="cl">/opt/srlinux/bin/bootscript/01_sr_bdb_arbitration.sh: line 9: &lt;span class="m">97&lt;/span> Aborted &lt;span class="o">(&lt;/span>core dumped&lt;span class="o">)&lt;/span> &lt;span class="si">${&lt;/span>&lt;span class="nv">dev_mgr&lt;/span>&lt;span class="si">}&lt;/span> --hw-details --matelink --log-stdout &amp;gt; &lt;span class="si">${&lt;/span>&lt;span class="nv">arbitration_log&lt;/span>&lt;span class="si">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cat: /sys/class/dmi/id/board_name: No such file or directory
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/opt/srlinux/bin/bootscript/05_sr_createuser.sh: line 270: !srl_is_running_on_nokia_rootfs: &lt;span class="nb">command&lt;/span> not found
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/opt/srlinux/bin/bootscript/05_sr_createuser.sh: line 282: python: &lt;span class="nb">command&lt;/span> not found
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">chmod: cannot access &lt;span class="s1">&amp;#39;/dev/console&amp;#39;&lt;/span>: No such file or directory
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">chmod: missing operand after &lt;span class="s1">&amp;#39;0664&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Try &lt;span class="s1">&amp;#39;chmod --help&amp;#39;&lt;/span> &lt;span class="k">for&lt;/span> more information.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/usr/bin/find: &lt;span class="s1">&amp;#39;/var/log/srlinux/file&amp;#39;&lt;/span>: No such file or directory
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">logmgr_set_env.sh: plain_bootup_start
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Wed Jun &lt;span class="m">8&lt;/span> 18:59:13 UTC &lt;span class="m">2022&lt;/span> logmgr_set_env.sh: restart of rsyslogd
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">which: no python in &lt;span class="o">(&lt;/span>/opt/srlinux/bin:/opt/srlinux/usr/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">readlink: missing operand
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Try &lt;span class="s1">&amp;#39;readlink --help&amp;#39;&lt;/span> &lt;span class="k">for&lt;/span> more information.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">setfacl: /mnt/nokiaos: No such file or directory
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">setfacl: /mnt/nokiaos: No such file or directory
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">setfacl: /mnt/nokiaos: No such file or directory
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">setfacl: /mnt/nokiaos: No such file or directory
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">setfacl: Option -m: Invalid argument near character &lt;span class="m">5&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">setfacl: Option -m: Invalid argument near character &lt;span class="m">3&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">setfacl: Option -m: Invalid argument near character &lt;span class="m">5&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">setfacl: Option -m: Invalid argument near character &lt;span class="m">3&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">System has not been booted with systemd as init system &lt;span class="o">(&lt;/span>PID 1&lt;span class="o">)&lt;/span>. Can&lt;span class="s1">&amp;#39;t operate.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">Failed to connect to bus: Host is down
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">Failed to open connection to &amp;#34;system&amp;#34; message bus: Failed to connect to socket /run/dbus/system_bus_socket: No such file or directory
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">System has not been booted with systemd as init system (PID 1). Can&amp;#39;&lt;/span>t operate.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Failed to connect to bus: Host is down
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">findfs: unable to resolve &lt;span class="s1">&amp;#39;LABEL=EFI-System&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">No disk with label EFI-System is found
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Failed to &lt;span class="nb">set&lt;/span> capabilities on file &lt;span class="sb">`&lt;/span>/usr/sbin/tcpdump&lt;span class="err">&amp;#39;&lt;/span> &lt;span class="o">(&lt;/span>No such file or directory&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">usage: setcap &lt;span class="o">[&lt;/span>-q&lt;span class="o">]&lt;/span> &lt;span class="o">[&lt;/span>-v&lt;span class="o">]&lt;/span> &lt;span class="o">[&lt;/span>-n &amp;lt;rootid&amp;gt;&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>-r&lt;span class="p">|&lt;/span>-&lt;span class="p">|&lt;/span>&amp;lt;caps&amp;gt;&lt;span class="o">)&lt;/span> &amp;lt;filename&amp;gt; &lt;span class="o">[&lt;/span> ... &lt;span class="o">(&lt;/span>-r&lt;span class="p">|&lt;/span>-&lt;span class="p">|&lt;/span>&amp;lt;capsN&amp;gt;&lt;span class="o">)&lt;/span> &amp;lt;filenameN&amp;gt; &lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Note &amp;lt;filename&amp;gt; must be a regular &lt;span class="o">(&lt;/span>non-symlink&lt;span class="o">)&lt;/span> file.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Wed Jun &lt;span class="m">8&lt;/span> 18:59:15 UTC 2022: entrypoint.sh &lt;span class="k">done&lt;/span>, executing sudo bash -c touch /.dockerenv &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> /opt/srlinux/bin/sr_linux
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">No/Invalid license found!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Not starting in a named namespace, giving it the name &lt;span class="s2">&amp;#34;srbase&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Unix domain socket directory is /opt/srlinux/var/run/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Log directory is /var/log/srlinux/stdout
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Started supportd: &lt;span class="nb">source&lt;/span> /etc/profile.d/sr_app_env.sh &lt;span class="p">&amp;amp;&lt;/span>&amp;gt;/dev/null&lt;span class="p">;&lt;/span> bash -c &lt;span class="s2">&amp;#34;./sr_supportd --server-mode&amp;#34;&lt;/span> &amp;gt;/var/log/srlinux/stdout/supportd.log 2&amp;gt;&lt;span class="p">&amp;amp;&lt;/span>&lt;span class="m">1&lt;/span> &lt;span class="p">&amp;amp;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Application supportd is running: PID &lt;span class="m">1474&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Started dev_mgr: &lt;span class="nb">source&lt;/span> /etc/profile.d/sr_app_env.sh &lt;span class="p">&amp;amp;&lt;/span>&amp;gt;/dev/null&lt;span class="p">;&lt;/span> bash -c &lt;span class="s2">&amp;#34;./sr_device_mgr&amp;#34;&lt;/span> &amp;gt;/var/log/srlinux/stdout/dev_mgr.log 2&amp;gt;&lt;span class="p">&amp;amp;&lt;/span>&lt;span class="m">1&lt;/span> &lt;span class="p">&amp;amp;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Application dev_mgr is running: PID &lt;span class="m">1496&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Found dev_mgr: PID &lt;span class="m">1496&lt;/span> - killing
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Found supportd: PID &lt;span class="m">1474&lt;/span> - killing
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Failed to &lt;span class="nb">kill&lt;/span> supportd: PID 1474. Another &lt;span class="nb">kill&lt;/span> is retried&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>I guess more to troubleshoot, but for another time &amp;#x1f604;. Let&amp;rsquo;s see what we got for the other variants&lt;/p>
&lt;table>
 &lt;thead>
 &lt;tr>
 &lt;th style="text-align: center">Device&lt;/th>
 &lt;th style="text-align: center">Variant&lt;/th>
 &lt;th style="text-align: center">Chassis Type&lt;/th>
 &lt;th style="text-align: center">Specs&lt;/th>
 &lt;/tr>
 &lt;/thead>
 &lt;tbody>
 &lt;tr>
 &lt;td style="text-align: center">r1&lt;/td>
 &lt;td style="text-align: center">ixr6&lt;/td>
 &lt;td style="text-align: center">NA&lt;/td>
 &lt;td style="text-align: center">NA&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td style="text-align: center">r2&lt;/td>
 &lt;td style="text-align: center">ixrd1&lt;/td>
 &lt;td style="text-align: center">7220 IXR-D1&lt;/td>
 &lt;td style="text-align: center">48x1G , 4x10G&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td style="text-align: center">r3&lt;/td>
 &lt;td style="text-align: center">ixrd2&lt;/td>
 &lt;td style="text-align: center">7220 IXR-D2&lt;/td>
 &lt;td style="text-align: center">48x25G, 4x100G&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td style="text-align: center">r4&lt;/td>
 &lt;td style="text-align: center">ixrd3&lt;/td>
 &lt;td style="text-align: center">7220 IXR-D3&lt;/td>
 &lt;td style="text-align: center">2x10G, 32x100G&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td style="text-align: center">r5&lt;/td>
 &lt;td style="text-align: center">ixrd10&lt;/td>
 &lt;td style="text-align: center">NA&lt;/td>
 &lt;td style="text-align: center">NA&lt;/td>
 &lt;/tr>
 &lt;/tbody>
&lt;/table>
&lt;hr>
&lt;h3 class="heading-element" id="test-arista-ceos">&lt;span>Test Arista cEOS&lt;/span>
 &lt;a href="#test-arista-ceos" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h3>&lt;hr>
&lt;p>Get the arista container image and copy it to all k8s nodes or only to the workers if you control-plane is tainted. Then import it in each node.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ sudo ctr -n k8s.io image import ceos.tgz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">unpacking docker.io/library/ceos:latest &lt;span class="o">(&lt;/span>sha256:bfd3f2fea1cad2d06f0e5113cb3a1dc81f0ccbb28acf11949e15dadcf68eda9a&lt;span class="o">)&lt;/span>...done&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Let&amp;rsquo;s create a simple lab file.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~/labs$ cat ceos.pbtxt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">name: &lt;span class="s2">&amp;#34;arista&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nodes: &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: &lt;span class="s2">&amp;#34;r1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> type: ARISTA_CEOS
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> services:&lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> key: &lt;span class="m">22&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> value: &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: &lt;span class="s2">&amp;#34;ssh&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> inside: &lt;span class="m">22&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nodes: &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: &lt;span class="s2">&amp;#34;r2&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> type: ARISTA_CEOS
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> services:&lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> key: &lt;span class="m">22&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> value: &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: &lt;span class="s2">&amp;#34;ssh&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> inside: &lt;span class="m">22&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">links: &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> a_node: &lt;span class="s2">&amp;#34;r1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> a_int: &lt;span class="s2">&amp;#34;eth1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> z_node: &lt;span class="s2">&amp;#34;r2&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> z_int: &lt;span class="s2">&amp;#34;eth1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">links: &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> a_node: &lt;span class="s2">&amp;#34;r1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> a_int: &lt;span class="s2">&amp;#34;eth2&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> z_node: &lt;span class="s2">&amp;#34;r2&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> z_int: &lt;span class="s2">&amp;#34;eth2&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>And fire up the topology.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~/labs$ kne_cli create ceos.pbtxt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> /home/ubuntu/labs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Creating manager &lt;span class="k">for&lt;/span>: arista
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Trying in-cluster configuration
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Falling back to kubeconfig: &lt;span class="s2">&amp;#34;/home/ubuntu/.kube/config&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Topology:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">name: &lt;span class="s2">&amp;#34;arista&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nodes: &amp;lt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: &lt;span class="s2">&amp;#34;r1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> type: ARISTA_CEOS
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> services: &amp;lt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> key: &lt;span class="m">22&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> value: &amp;lt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: &lt;span class="s2">&amp;#34;ssh&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> inside: &lt;span class="m">22&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nodes: &amp;lt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: &lt;span class="s2">&amp;#34;r2&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> type: ARISTA_CEOS
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> services: &amp;lt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> key: &lt;span class="m">22&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> value: &amp;lt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: &lt;span class="s2">&amp;#34;ssh&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> inside: &lt;span class="m">22&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">links: &amp;lt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> a_node: &lt;span class="s2">&amp;#34;r1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> a_int: &lt;span class="s2">&amp;#34;eth1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> z_node: &lt;span class="s2">&amp;#34;r2&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> z_int: &lt;span class="s2">&amp;#34;eth1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">links: &amp;lt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> a_node: &lt;span class="s2">&amp;#34;r1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> a_int: &lt;span class="s2">&amp;#34;eth2&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> z_node: &lt;span class="s2">&amp;#34;r2&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> z_int: &lt;span class="s2">&amp;#34;eth2&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Adding Link: r1:eth1 r2:eth1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Adding Link: r1:eth2 r2:eth2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Adding Node: r1:UNKNOWN:ARISTA_CEOS
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Adding Node: r2:UNKNOWN:ARISTA_CEOS
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Creating namespace &lt;span class="k">for&lt;/span> topology: &lt;span class="s2">&amp;#34;arista&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Server Namespace: &lt;span class="p">&amp;amp;&lt;/span>Namespace&lt;span class="o">{&lt;/span>ObjectMeta:&lt;span class="o">{&lt;/span>arista 82fe4826-a7dd-4fa3-bf2d-36d09236c2d7 &lt;span class="m">71849&lt;/span> &lt;span class="m">0&lt;/span> 2022-06-08 20:49:14 +0000 UTC &amp;lt;nil&amp;gt; &amp;lt;nil&amp;gt; map&lt;span class="o">[&lt;/span>kubernetes.io/metadata.name:arista&lt;span class="o">]&lt;/span> map&lt;span class="o">[]&lt;/span> &lt;span class="o">[]&lt;/span> &lt;span class="o">[]&lt;/span> &lt;span class="o">[{&lt;/span>kne_cli Update v1 2022-06-08 20:49:14 +0000 UTC FieldsV1 &lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;f:metadata&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;f:labels&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;.&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:kubernetes.io/metadata.name&amp;#34;&lt;/span>:&lt;span class="o">{}}}}}]}&lt;/span>,Spec:NamespaceSpec&lt;span class="o">{&lt;/span>Finalizers:&lt;span class="o">[&lt;/span>kubernetes&lt;span class="o">]&lt;/span>,&lt;span class="o">}&lt;/span>,Status:NamespaceStatus&lt;span class="o">{&lt;/span>Phase:Active,Conditions:&lt;span class="o">[]&lt;/span>NamespaceCondition&lt;span class="o">{}&lt;/span>,&lt;span class="o">}&lt;/span>,&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Getting topology specs &lt;span class="k">for&lt;/span> namespace arista
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Getting topology specs &lt;span class="k">for&lt;/span> node r1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Getting topology specs &lt;span class="k">for&lt;/span> node r2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Creating topology &lt;span class="k">for&lt;/span> meshnet node r1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Meshnet Node:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;amp;&lt;/span>&lt;span class="o">{&lt;/span>TypeMeta:&lt;span class="o">{&lt;/span>Kind: APIVersion:&lt;span class="o">}&lt;/span> ObjectMeta:&lt;span class="o">{&lt;/span>Name:r1 GenerateName: Namespace:arista SelfLink: UID:ba43116d-1c55-4e43-9201-cd7f2c9f3259 ResourceVersion:71852 Generation:1 CreationTimestamp:2022-06-08 20:49:14 +0000 UTC DeletionTimestamp:&amp;lt;nil&amp;gt; DeletionGracePeriodSeconds:&amp;lt;nil&amp;gt; Labels:map&lt;span class="o">[]&lt;/span> Annotations:map&lt;span class="o">[]&lt;/span> OwnerReferences:&lt;span class="o">[]&lt;/span> Finalizers:&lt;span class="o">[]&lt;/span> ClusterName: ManagedFields:&lt;span class="o">[{&lt;/span>Manager:kne_cli Operation:Update APIVersion:networkop.co.uk/v1beta1 Time:2022-06-08 20:49:14 +0000 UTC FieldsType:FieldsV1 FieldsV1:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;f:spec&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;.&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:links&amp;#34;&lt;/span>:&lt;span class="o">{}}}}]}&lt;/span> Status:&lt;span class="o">{&lt;/span>TypeMeta:&lt;span class="o">{&lt;/span>Kind: APIVersion:&lt;span class="o">}&lt;/span> ObjectMeta:&lt;span class="o">{&lt;/span>Name: GenerateName: Namespace: SelfLink: UID: ResourceVersion: Generation:0 CreationTimestamp:0001-01-01 00:00:00 +0000 UTC DeletionTimestamp:&amp;lt;nil&amp;gt; DeletionGracePeriodSeconds:&amp;lt;nil&amp;gt; Labels:map&lt;span class="o">[]&lt;/span> Annotations:map&lt;span class="o">[]&lt;/span> OwnerReferences:&lt;span class="o">[]&lt;/span> Finalizers:&lt;span class="o">[]&lt;/span> ClusterName: ManagedFields:&lt;span class="o">[]}&lt;/span> Skipped:&lt;span class="o">[]&lt;/span> SrcIp: NetNs:&lt;span class="o">}&lt;/span> Spec:&lt;span class="o">{&lt;/span>TypeMeta:&lt;span class="o">{&lt;/span>Kind: APIVersion:&lt;span class="o">}&lt;/span> Links:&lt;span class="o">[{&lt;/span>LocalIntf:eth1 LocalIP: PeerIntf:eth1 PeerIP: PeerPod:r2 UID:0&lt;span class="o">}&lt;/span> &lt;span class="o">{&lt;/span>LocalIntf:eth2 LocalIP: PeerIntf:eth2 PeerIP: PeerPod:r2 UID:1&lt;span class="o">}]}}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Creating topology &lt;span class="k">for&lt;/span> meshnet node r2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Meshnet Node:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;amp;&lt;/span>&lt;span class="o">{&lt;/span>TypeMeta:&lt;span class="o">{&lt;/span>Kind: APIVersion:&lt;span class="o">}&lt;/span> ObjectMeta:&lt;span class="o">{&lt;/span>Name:r2 GenerateName: Namespace:arista SelfLink: UID:e677078e-0dc1-4e02-8258-b759acb61cfd ResourceVersion:71853 Generation:1 CreationTimestamp:2022-06-08 20:49:14 +0000 UTC DeletionTimestamp:&amp;lt;nil&amp;gt; DeletionGracePeriodSeconds:&amp;lt;nil&amp;gt; Labels:map&lt;span class="o">[]&lt;/span> Annotations:map&lt;span class="o">[]&lt;/span> OwnerReferences:&lt;span class="o">[]&lt;/span> Finalizers:&lt;span class="o">[]&lt;/span> ClusterName: ManagedFields:&lt;span class="o">[{&lt;/span>Manager:kne_cli Operation:Update APIVersion:networkop.co.uk/v1beta1 Time:2022-06-08 20:49:14 +0000 UTC FieldsType:FieldsV1 FieldsV1:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;f:spec&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;.&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:links&amp;#34;&lt;/span>:&lt;span class="o">{}}}}]}&lt;/span> Status:&lt;span class="o">{&lt;/span>TypeMeta:&lt;span class="o">{&lt;/span>Kind: APIVersion:&lt;span class="o">}&lt;/span> ObjectMeta:&lt;span class="o">{&lt;/span>Name: GenerateName: Namespace: SelfLink: UID: ResourceVersion: Generation:0 CreationTimestamp:0001-01-01 00:00:00 +0000 UTC DeletionTimestamp:&amp;lt;nil&amp;gt; DeletionGracePeriodSeconds:&amp;lt;nil&amp;gt; Labels:map&lt;span class="o">[]&lt;/span> Annotations:map&lt;span class="o">[]&lt;/span> OwnerReferences:&lt;span class="o">[]&lt;/span> Finalizers:&lt;span class="o">[]&lt;/span> ClusterName: ManagedFields:&lt;span class="o">[]}&lt;/span> Skipped:&lt;span class="o">[]&lt;/span> SrcIp: NetNs:&lt;span class="o">}&lt;/span> Spec:&lt;span class="o">{&lt;/span>TypeMeta:&lt;span class="o">{&lt;/span>Kind: APIVersion:&lt;span class="o">}&lt;/span> Links:&lt;span class="o">[{&lt;/span>LocalIntf:eth1 LocalIP: PeerIntf:eth1 PeerIP: PeerPod:r1 UID:0&lt;span class="o">}&lt;/span> &lt;span class="o">{&lt;/span>LocalIntf:eth2 LocalIP: PeerIntf:eth2 PeerIP: PeerPod:r1 UID:1&lt;span class="o">}]}}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Creating Node Pods
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Creating Pod:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name:&lt;span class="s2">&amp;#34;r1&amp;#34;&lt;/span> type:ARISTA_CEOS labels:&lt;span class="o">{&lt;/span>key:&lt;span class="s2">&amp;#34;model&amp;#34;&lt;/span> value:&lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> labels:&lt;span class="o">{&lt;/span>key:&lt;span class="s2">&amp;#34;os&amp;#34;&lt;/span> value:&lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> labels:&lt;span class="o">{&lt;/span>key:&lt;span class="s2">&amp;#34;type&amp;#34;&lt;/span> value:&lt;span class="s2">&amp;#34;ARISTA_CEOS&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> labels:&lt;span class="o">{&lt;/span>key:&lt;span class="s2">&amp;#34;vendor&amp;#34;&lt;/span> value:&lt;span class="s2">&amp;#34;ARISTA&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> labels:&lt;span class="o">{&lt;/span>key:&lt;span class="s2">&amp;#34;version&amp;#34;&lt;/span> value:&lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> config:&lt;span class="o">{&lt;/span>command:&lt;span class="s2">&amp;#34;/sbin/init&amp;#34;&lt;/span> command:&lt;span class="s2">&amp;#34;systemd.setenv=INTFTYPE=eth&amp;#34;&lt;/span> command:&lt;span class="s2">&amp;#34;systemd.setenv=ETBA=1&amp;#34;&lt;/span> command:&lt;span class="s2">&amp;#34;systemd.setenv=SKIP_ZEROTOUCH_BARRIER_IN_SYSDBINIT=1&amp;#34;&lt;/span> command:&lt;span class="s2">&amp;#34;systemd.setenv=CEOS=1&amp;#34;&lt;/span> command:&lt;span class="s2">&amp;#34;systemd.setenv=EOS_PLATFORM=ceoslab&amp;#34;&lt;/span> command:&lt;span class="s2">&amp;#34;systemd.setenv=container=docker&amp;#34;&lt;/span> image:&lt;span class="s2">&amp;#34;ceos:latest&amp;#34;&lt;/span> env:&lt;span class="o">{&lt;/span>key:&lt;span class="s2">&amp;#34;CEOS&amp;#34;&lt;/span> value:&lt;span class="s2">&amp;#34;1&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> env:&lt;span class="o">{&lt;/span>key:&lt;span class="s2">&amp;#34;EOS_PLATFORM&amp;#34;&lt;/span> value:&lt;span class="s2">&amp;#34;ceoslab&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> env:&lt;span class="o">{&lt;/span>key:&lt;span class="s2">&amp;#34;ETBA&amp;#34;&lt;/span> value:&lt;span class="s2">&amp;#34;1&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> env:&lt;span class="o">{&lt;/span>key:&lt;span class="s2">&amp;#34;INTFTYPE&amp;#34;&lt;/span> value:&lt;span class="s2">&amp;#34;eth&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> env:&lt;span class="o">{&lt;/span>key:&lt;span class="s2">&amp;#34;SKIP_ZEROTOUCH_BARRIER_IN_SYSDBINIT&amp;#34;&lt;/span> value:&lt;span class="s2">&amp;#34;1&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> env:&lt;span class="o">{&lt;/span>key:&lt;span class="s2">&amp;#34;container&amp;#34;&lt;/span> value:&lt;span class="s2">&amp;#34;docker&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> entry_command:&lt;span class="s2">&amp;#34;kubectl exec -it r1 -- Cli&amp;#34;&lt;/span> config_path:&lt;span class="s2">&amp;#34;/mnt/flash&amp;#34;&lt;/span> config_file:&lt;span class="s2">&amp;#34;startup-config&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> services:&lt;span class="o">{&lt;/span>key:22 value:&lt;span class="o">{&lt;/span>name:&lt;span class="s2">&amp;#34;ssh&amp;#34;&lt;/span> inside:22&lt;span class="o">}}&lt;/span> constraints:&lt;span class="o">{&lt;/span>key:&lt;span class="s2">&amp;#34;cpu&amp;#34;&lt;/span> value:&lt;span class="s2">&amp;#34;0.5&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> constraints:&lt;span class="o">{&lt;/span>key:&lt;span class="s2">&amp;#34;memory&amp;#34;&lt;/span> value:&lt;span class="s2">&amp;#34;1Gi&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> interfaces:&lt;span class="o">{&lt;/span>key:&lt;span class="s2">&amp;#34;eth1&amp;#34;&lt;/span> value:&lt;span class="o">{&lt;/span>name:&lt;span class="s2">&amp;#34;Ethernet1&amp;#34;&lt;/span> int_name:&lt;span class="s2">&amp;#34;eth1&amp;#34;&lt;/span> peer_name:&lt;span class="s2">&amp;#34;r2&amp;#34;&lt;/span> peer_int_name:&lt;span class="s2">&amp;#34;eth1&amp;#34;&lt;/span>&lt;span class="o">}}&lt;/span> interfaces:&lt;span class="o">{&lt;/span>key:&lt;span class="s2">&amp;#34;eth2&amp;#34;&lt;/span> value:&lt;span class="o">{&lt;/span>name:&lt;span class="s2">&amp;#34;Ethernet2&amp;#34;&lt;/span> int_name:&lt;span class="s2">&amp;#34;eth2&amp;#34;&lt;/span> peer_name:&lt;span class="s2">&amp;#34;r2&amp;#34;&lt;/span> peer_int_name:&lt;span class="s2">&amp;#34;eth2&amp;#34;&lt;/span> uid:1&lt;span class="o">}}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Created Service:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;amp;&lt;/span>Service&lt;span class="o">{&lt;/span>ObjectMeta:&lt;span class="o">{&lt;/span>service-r1 arista 4c93f283-7153-4813-aca5-875e70277c9a &lt;span class="m">71860&lt;/span> &lt;span class="m">0&lt;/span> 2022-06-08 20:49:14 +0000 UTC &amp;lt;nil&amp;gt; &amp;lt;nil&amp;gt; map&lt;span class="o">[&lt;/span>pod:r1&lt;span class="o">]&lt;/span> map&lt;span class="o">[]&lt;/span> &lt;span class="o">[]&lt;/span> &lt;span class="o">[]&lt;/span> &lt;span class="o">[{&lt;/span>kne_cli Update v1 2022-06-08 20:49:14 +0000 UTC FieldsV1 &lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;f:metadata&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;f:labels&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;.&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:pod&amp;#34;&lt;/span>:&lt;span class="o">{}}}&lt;/span>,&lt;span class="s2">&amp;#34;f:spec&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;f:allocateLoadBalancerNodePorts&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:externalTrafficPolicy&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:internalTrafficPolicy&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:ports&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;.&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;k:{\&amp;#34;port\&amp;#34;:22,\&amp;#34;protocol\&amp;#34;:\&amp;#34;TCP\&amp;#34;}&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;.&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:name&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:port&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:protocol&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:targetPort&amp;#34;&lt;/span>:&lt;span class="o">{}}}&lt;/span>,&lt;span class="s2">&amp;#34;f:selector&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:sessionAffinity&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:type&amp;#34;&lt;/span>:&lt;span class="o">{}}}}]}&lt;/span>,Spec:ServiceSpec&lt;span class="o">{&lt;/span>Ports:&lt;span class="o">[]&lt;/span>ServicePort&lt;span class="o">{&lt;/span>ServicePort&lt;span class="o">{&lt;/span>Name:ssh,Protocol:TCP,Port:22,TargetPort:&lt;span class="o">{&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="m">22&lt;/span> &lt;span class="o">}&lt;/span>,NodePort:31088,AppProtocol:nil,&lt;span class="o">}&lt;/span>,&lt;span class="o">}&lt;/span>,Selector:map&lt;span class="o">[&lt;/span>string&lt;span class="o">]&lt;/span>string&lt;span class="o">{&lt;/span>app: r1,&lt;span class="o">}&lt;/span>,ClusterIP:10.102.188.238,Type:LoadBalancer,ExternalIPs:&lt;span class="o">[]&lt;/span>,SessionAffinity:None,LoadBalancerIP:,LoadBalancerSourceRanges:&lt;span class="o">[]&lt;/span>,ExternalName:,ExternalTrafficPolicy:Cluster,HealthCheckNodePort:0,PublishNotReadyAddresses:false,SessionAffinityConfig:nil,TopologyKeys:&lt;span class="o">[]&lt;/span>,IPFamilyPolicy:*SingleStack,ClusterIPs:&lt;span class="o">[&lt;/span>10.102.188.238&lt;span class="o">]&lt;/span>,IPFamilies:&lt;span class="o">[&lt;/span>IPv4&lt;span class="o">]&lt;/span>,AllocateLoadBalancerNodePorts:*true,LoadBalancerClass:nil,InternalTrafficPolicy:*Cluster,&lt;span class="o">}&lt;/span>,Status:ServiceStatus&lt;span class="o">{&lt;/span>LoadBalancer:LoadBalancerStatus&lt;span class="o">{&lt;/span>Ingress:&lt;span class="o">[]&lt;/span>LoadBalancerIngress&lt;span class="o">{}&lt;/span>,&lt;span class="o">}&lt;/span>,Conditions:&lt;span class="o">[]&lt;/span>Condition&lt;span class="o">{}&lt;/span>,&lt;span class="o">}&lt;/span>,&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Node &lt;span class="s2">&amp;#34;r1&amp;#34;&lt;/span> resource created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Creating Pod:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name:&lt;span class="s2">&amp;#34;r2&amp;#34;&lt;/span> type:ARISTA_CEOS labels:&lt;span class="o">{&lt;/span>key:&lt;span class="s2">&amp;#34;model&amp;#34;&lt;/span> value:&lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> labels:&lt;span class="o">{&lt;/span>key:&lt;span class="s2">&amp;#34;os&amp;#34;&lt;/span> value:&lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> labels:&lt;span class="o">{&lt;/span>key:&lt;span class="s2">&amp;#34;type&amp;#34;&lt;/span> value:&lt;span class="s2">&amp;#34;ARISTA_CEOS&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> labels:&lt;span class="o">{&lt;/span>key:&lt;span class="s2">&amp;#34;vendor&amp;#34;&lt;/span> value:&lt;span class="s2">&amp;#34;ARISTA&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> labels:&lt;span class="o">{&lt;/span>key:&lt;span class="s2">&amp;#34;version&amp;#34;&lt;/span> value:&lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> config:&lt;span class="o">{&lt;/span>command:&lt;span class="s2">&amp;#34;/sbin/init&amp;#34;&lt;/span> command:&lt;span class="s2">&amp;#34;systemd.setenv=INTFTYPE=eth&amp;#34;&lt;/span> command:&lt;span class="s2">&amp;#34;systemd.setenv=ETBA=1&amp;#34;&lt;/span> command:&lt;span class="s2">&amp;#34;systemd.setenv=SKIP_ZEROTOUCH_BARRIER_IN_SYSDBINIT=1&amp;#34;&lt;/span> command:&lt;span class="s2">&amp;#34;systemd.setenv=CEOS=1&amp;#34;&lt;/span> command:&lt;span class="s2">&amp;#34;systemd.setenv=EOS_PLATFORM=ceoslab&amp;#34;&lt;/span> command:&lt;span class="s2">&amp;#34;systemd.setenv=container=docker&amp;#34;&lt;/span> image:&lt;span class="s2">&amp;#34;ceos:latest&amp;#34;&lt;/span> env:&lt;span class="o">{&lt;/span>key:&lt;span class="s2">&amp;#34;CEOS&amp;#34;&lt;/span> value:&lt;span class="s2">&amp;#34;1&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> env:&lt;span class="o">{&lt;/span>key:&lt;span class="s2">&amp;#34;EOS_PLATFORM&amp;#34;&lt;/span> value:&lt;span class="s2">&amp;#34;ceoslab&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> env:&lt;span class="o">{&lt;/span>key:&lt;span class="s2">&amp;#34;ETBA&amp;#34;&lt;/span> value:&lt;span class="s2">&amp;#34;1&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> env:&lt;span class="o">{&lt;/span>key:&lt;span class="s2">&amp;#34;INTFTYPE&amp;#34;&lt;/span> value:&lt;span class="s2">&amp;#34;eth&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> env:&lt;span class="o">{&lt;/span>key:&lt;span class="s2">&amp;#34;SKIP_ZEROTOUCH_BARRIER_IN_SYSDBINIT&amp;#34;&lt;/span> value:&lt;span class="s2">&amp;#34;1&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> env:&lt;span class="o">{&lt;/span>key:&lt;span class="s2">&amp;#34;container&amp;#34;&lt;/span> value:&lt;span class="s2">&amp;#34;docker&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> entry_command:&lt;span class="s2">&amp;#34;kubectl exec -it r2 -- Cli&amp;#34;&lt;/span> config_path:&lt;span class="s2">&amp;#34;/mnt/flash&amp;#34;&lt;/span> config_file:&lt;span class="s2">&amp;#34;startup-config&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> services:&lt;span class="o">{&lt;/span>key:22 value:&lt;span class="o">{&lt;/span>name:&lt;span class="s2">&amp;#34;ssh&amp;#34;&lt;/span> inside:22&lt;span class="o">}}&lt;/span> constraints:&lt;span class="o">{&lt;/span>key:&lt;span class="s2">&amp;#34;cpu&amp;#34;&lt;/span> value:&lt;span class="s2">&amp;#34;0.5&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> constraints:&lt;span class="o">{&lt;/span>key:&lt;span class="s2">&amp;#34;memory&amp;#34;&lt;/span> value:&lt;span class="s2">&amp;#34;1Gi&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> interfaces:&lt;span class="o">{&lt;/span>key:&lt;span class="s2">&amp;#34;eth1&amp;#34;&lt;/span> value:&lt;span class="o">{&lt;/span>name:&lt;span class="s2">&amp;#34;Ethernet1&amp;#34;&lt;/span> int_name:&lt;span class="s2">&amp;#34;eth1&amp;#34;&lt;/span> peer_name:&lt;span class="s2">&amp;#34;r1&amp;#34;&lt;/span> peer_int_name:&lt;span class="s2">&amp;#34;eth1&amp;#34;&lt;/span>&lt;span class="o">}}&lt;/span> interfaces:&lt;span class="o">{&lt;/span>key:&lt;span class="s2">&amp;#34;eth2&amp;#34;&lt;/span> value:&lt;span class="o">{&lt;/span>name:&lt;span class="s2">&amp;#34;Ethernet2&amp;#34;&lt;/span> int_name:&lt;span class="s2">&amp;#34;eth2&amp;#34;&lt;/span> peer_name:&lt;span class="s2">&amp;#34;r1&amp;#34;&lt;/span> peer_int_name:&lt;span class="s2">&amp;#34;eth2&amp;#34;&lt;/span> uid:1&lt;span class="o">}}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Created Service:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;amp;&lt;/span>Service&lt;span class="o">{&lt;/span>ObjectMeta:&lt;span class="o">{&lt;/span>service-r2 arista 1ff432b7-ddd9-4ee4-9a07-dc28be6053d8 &lt;span class="m">71872&lt;/span> &lt;span class="m">0&lt;/span> 2022-06-08 20:49:14 +0000 UTC &amp;lt;nil&amp;gt; &amp;lt;nil&amp;gt; map&lt;span class="o">[&lt;/span>pod:r2&lt;span class="o">]&lt;/span> map&lt;span class="o">[]&lt;/span> &lt;span class="o">[]&lt;/span> &lt;span class="o">[]&lt;/span> &lt;span class="o">[{&lt;/span>kne_cli Update v1 2022-06-08 20:49:14 +0000 UTC FieldsV1 &lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;f:metadata&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;f:labels&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;.&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:pod&amp;#34;&lt;/span>:&lt;span class="o">{}}}&lt;/span>,&lt;span class="s2">&amp;#34;f:spec&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;f:allocateLoadBalancerNodePorts&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:externalTrafficPolicy&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:internalTrafficPolicy&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:ports&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;.&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;k:{\&amp;#34;port\&amp;#34;:22,\&amp;#34;protocol\&amp;#34;:\&amp;#34;TCP\&amp;#34;}&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;.&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:name&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:port&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:protocol&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:targetPort&amp;#34;&lt;/span>:&lt;span class="o">{}}}&lt;/span>,&lt;span class="s2">&amp;#34;f:selector&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:sessionAffinity&amp;#34;&lt;/span>:&lt;span class="o">{}&lt;/span>,&lt;span class="s2">&amp;#34;f:type&amp;#34;&lt;/span>:&lt;span class="o">{}}}}]}&lt;/span>,Spec:ServiceSpec&lt;span class="o">{&lt;/span>Ports:&lt;span class="o">[]&lt;/span>ServicePort&lt;span class="o">{&lt;/span>ServicePort&lt;span class="o">{&lt;/span>Name:ssh,Protocol:TCP,Port:22,TargetPort:&lt;span class="o">{&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="m">22&lt;/span> &lt;span class="o">}&lt;/span>,NodePort:30761,AppProtocol:nil,&lt;span class="o">}&lt;/span>,&lt;span class="o">}&lt;/span>,Selector:map&lt;span class="o">[&lt;/span>string&lt;span class="o">]&lt;/span>string&lt;span class="o">{&lt;/span>app: r2,&lt;span class="o">}&lt;/span>,ClusterIP:10.110.58.235,Type:LoadBalancer,ExternalIPs:&lt;span class="o">[]&lt;/span>,SessionAffinity:None,LoadBalancerIP:,LoadBalancerSourceRanges:&lt;span class="o">[]&lt;/span>,ExternalName:,ExternalTrafficPolicy:Cluster,HealthCheckNodePort:0,PublishNotReadyAddresses:false,SessionAffinityConfig:nil,TopologyKeys:&lt;span class="o">[]&lt;/span>,IPFamilyPolicy:*SingleStack,ClusterIPs:&lt;span class="o">[&lt;/span>10.110.58.235&lt;span class="o">]&lt;/span>,IPFamilies:&lt;span class="o">[&lt;/span>IPv4&lt;span class="o">]&lt;/span>,AllocateLoadBalancerNodePorts:*true,LoadBalancerClass:nil,InternalTrafficPolicy:*Cluster,&lt;span class="o">}&lt;/span>,Status:ServiceStatus&lt;span class="o">{&lt;/span>LoadBalancer:LoadBalancerStatus&lt;span class="o">{&lt;/span>Ingress:&lt;span class="o">[]&lt;/span>LoadBalancerIngress&lt;span class="o">{}&lt;/span>,&lt;span class="o">}&lt;/span>,Conditions:&lt;span class="o">[]&lt;/span>Condition&lt;span class="o">{}&lt;/span>,&lt;span class="o">}&lt;/span>,&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0000&lt;span class="o">]&lt;/span> Node &lt;span class="s2">&amp;#34;r2&amp;#34;&lt;/span> resource created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0004&lt;span class="o">]&lt;/span> Node &lt;span class="s2">&amp;#34;r2&amp;#34;&lt;/span>: Status RUNNING
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0004&lt;span class="o">]&lt;/span> Node &lt;span class="s2">&amp;#34;r1&amp;#34;&lt;/span>: Status RUNNING
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0004&lt;span class="o">]&lt;/span> Topology &lt;span class="s2">&amp;#34;arista&amp;#34;&lt;/span> created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0005&lt;span class="o">]&lt;/span> Pods:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0005&lt;span class="o">]&lt;/span> r1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO&lt;span class="o">[&lt;/span>0005&lt;span class="o">]&lt;/span> r2&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Check on k8s.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ kubectl -n arista get all -o wide
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod/r1 1/1 Running &lt;span class="m">0&lt;/span> 62s 10.244.1.23 kates-node-01 &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod/r2 1/1 Running &lt;span class="m">0&lt;/span> 62s 10.244.2.25 kates-node-02 &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME TYPE CLUSTER-IP EXTERNAL-IP PORT&lt;span class="o">(&lt;/span>S&lt;span class="o">)&lt;/span> AGE SELECTOR
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">service/service-r1 LoadBalancer 10.102.188.238 192.168.1.50 22:31088/TCP 62s &lt;span class="nv">app&lt;/span>&lt;span class="o">=&lt;/span>r1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">service/service-r2 LoadBalancer 10.110.58.235 192.168.1.51 22:30761/TCP 62s &lt;span class="nv">app&lt;/span>&lt;span class="o">=&lt;/span>r2&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Seems good. Let&amp;rsquo;s perform the initial configuration.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># For r1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ kubectl -n arista &lt;span class="nb">exec&lt;/span> -it r1 -- Cli
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Defaulted container &lt;span class="s2">&amp;#34;r1&amp;#34;&lt;/span> out of: r1, init-r1 &lt;span class="o">(&lt;/span>init&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">localhost&amp;gt;en
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">localhost#conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">localhost&lt;span class="o">(&lt;/span>config&lt;span class="o">)&lt;/span>&lt;span class="c1">#hostname r1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">r1&lt;span class="o">(&lt;/span>config&lt;span class="o">)&lt;/span>&lt;span class="c1">#interface ethernet 1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">r1&lt;span class="o">(&lt;/span>config-if-Et1&lt;span class="o">)&lt;/span>&lt;span class="c1">#no switchport&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">r1&lt;span class="o">(&lt;/span>config-if-Et1&lt;span class="o">)&lt;/span>&lt;span class="c1">#ip address 10.1.1.1/30&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">r1&lt;span class="o">(&lt;/span>config-if-Et1&lt;span class="o">)&lt;/span>&lt;span class="c1">#interface ethernet 2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">r1&lt;span class="o">(&lt;/span>config-if-Et2&lt;span class="o">)&lt;/span>&lt;span class="c1">#no switchport&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">r1&lt;span class="o">(&lt;/span>config-if-Et2&lt;span class="o">)&lt;/span>&lt;span class="c1">#ip address 10.2.2.1/30&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">r1&lt;span class="o">(&lt;/span>config-if-Et2&lt;span class="o">)&lt;/span>&lt;span class="c1">#end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">r1#conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">r1&lt;span class="o">(&lt;/span>config&lt;span class="o">)&lt;/span>&lt;span class="c1">#username admin privilege 15 secret admin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">r1&lt;span class="o">(&lt;/span>config&lt;span class="o">)&lt;/span>&lt;span class="c1">#end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">r1#write
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Copy completed successfully.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">r1#show interfaces status
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Port Name Status Vlan Duplex Speed Type Flags Encapsulation
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Et1 connected routed full 1G EbraTestPhyPort
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Et2 connected routed full 1G EbraTestPhyPort
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># For r2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ kubectl -n arista &lt;span class="nb">exec&lt;/span> -it r2 -- Cli
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Defaulted container &lt;span class="s2">&amp;#34;r2&amp;#34;&lt;/span> out of: r2, init-r2 &lt;span class="o">(&lt;/span>init&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">localhost&amp;gt;en
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">localhost#conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">localhost&lt;span class="o">(&lt;/span>config&lt;span class="o">)&lt;/span>&lt;span class="c1">#hostname r2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">r2&lt;span class="o">(&lt;/span>config&lt;span class="o">)&lt;/span>&lt;span class="c1">#username admin privilege 15 secret admin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">r2&lt;span class="o">(&lt;/span>config&lt;span class="o">)&lt;/span>&lt;span class="c1">#interface ethernet 1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">r2&lt;span class="o">(&lt;/span>config-if-Et1&lt;span class="o">)&lt;/span>&lt;span class="c1">#no switchport&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">r2&lt;span class="o">(&lt;/span>config-if-Et1&lt;span class="o">)&lt;/span>&lt;span class="c1">#ip address 10.1.1.2/30&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">r2&lt;span class="o">(&lt;/span>config-if-Et1&lt;span class="o">)&lt;/span>&lt;span class="c1">#interface ethernet 2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">r2&lt;span class="o">(&lt;/span>config-if-Et2&lt;span class="o">)&lt;/span>&lt;span class="c1">#no switchport&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">r2&lt;span class="o">(&lt;/span>config-if-Et2&lt;span class="o">)&lt;/span>&lt;span class="c1">#ip address 10.2.2.2/30&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">r2&lt;span class="o">(&lt;/span>config-if-Et2&lt;span class="o">)&lt;/span>&lt;span class="c1">#end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">r2#write
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Copy completed successfully.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Check connectivity&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">r2#ping 10.1.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PING 10.1.1.1 &lt;span class="o">(&lt;/span>10.1.1.1&lt;span class="o">)&lt;/span> 72&lt;span class="o">(&lt;/span>100&lt;span class="o">)&lt;/span> bytes of data.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">80&lt;/span> bytes from 10.1.1.1: &lt;span class="nv">icmp_seq&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">1&lt;/span> &lt;span class="nv">ttl&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">64&lt;/span> &lt;span class="nv">time&lt;/span>&lt;span class="o">=&lt;/span>1.36 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">80&lt;/span> bytes from 10.1.1.1: &lt;span class="nv">icmp_seq&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">2&lt;/span> &lt;span class="nv">ttl&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">64&lt;/span> &lt;span class="nv">time&lt;/span>&lt;span class="o">=&lt;/span>0.482 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">80&lt;/span> bytes from 10.1.1.1: &lt;span class="nv">icmp_seq&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">3&lt;/span> &lt;span class="nv">ttl&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">64&lt;/span> &lt;span class="nv">time&lt;/span>&lt;span class="o">=&lt;/span>0.621 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">80&lt;/span> bytes from 10.1.1.1: &lt;span class="nv">icmp_seq&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">4&lt;/span> &lt;span class="nv">ttl&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">64&lt;/span> &lt;span class="nv">time&lt;/span>&lt;span class="o">=&lt;/span>0.452 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">80&lt;/span> bytes from 10.1.1.1: &lt;span class="nv">icmp_seq&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">5&lt;/span> &lt;span class="nv">ttl&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">64&lt;/span> &lt;span class="nv">time&lt;/span>&lt;span class="o">=&lt;/span>1.26 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--- 10.1.1.1 ping statistics ---
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">5&lt;/span> packets transmitted, &lt;span class="m">5&lt;/span> received, 0% packet loss, &lt;span class="nb">time&lt;/span> 4ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rtt min/avg/max/mdev &lt;span class="o">=&lt;/span> 0.452/0.836/1.362/0.397 ms, ipg/ewma 1.118/1.106 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">r2#ping 10.2.2.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PING 10.2.2.1 &lt;span class="o">(&lt;/span>10.2.2.1&lt;span class="o">)&lt;/span> 72&lt;span class="o">(&lt;/span>100&lt;span class="o">)&lt;/span> bytes of data.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">80&lt;/span> bytes from 10.2.2.1: &lt;span class="nv">icmp_seq&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">1&lt;/span> &lt;span class="nv">ttl&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">64&lt;/span> &lt;span class="nv">time&lt;/span>&lt;span class="o">=&lt;/span>1.14 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">80&lt;/span> bytes from 10.2.2.1: &lt;span class="nv">icmp_seq&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">2&lt;/span> &lt;span class="nv">ttl&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">64&lt;/span> &lt;span class="nv">time&lt;/span>&lt;span class="o">=&lt;/span>0.512 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">80&lt;/span> bytes from 10.2.2.1: &lt;span class="nv">icmp_seq&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">3&lt;/span> &lt;span class="nv">ttl&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">64&lt;/span> &lt;span class="nv">time&lt;/span>&lt;span class="o">=&lt;/span>0.555 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">80&lt;/span> bytes from 10.2.2.1: &lt;span class="nv">icmp_seq&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">4&lt;/span> &lt;span class="nv">ttl&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">64&lt;/span> &lt;span class="nv">time&lt;/span>&lt;span class="o">=&lt;/span>0.556 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">80&lt;/span> bytes from 10.2.2.1: &lt;span class="nv">icmp_seq&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">5&lt;/span> &lt;span class="nv">ttl&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">64&lt;/span> &lt;span class="nv">time&lt;/span>&lt;span class="o">=&lt;/span>0.490 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--- 10.2.2.1 ping statistics ---
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">5&lt;/span> packets transmitted, &lt;span class="m">5&lt;/span> received, 0% packet loss, &lt;span class="nb">time&lt;/span> 4ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rtt min/avg/max/mdev &lt;span class="o">=&lt;/span> 0.490/0.650/1.140/0.247 ms, ipg/ewma 1.064/0.886 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Test OOB SSH access&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ ssh admin@192.168.1.50
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Password:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">r1&amp;gt;en
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">r1#conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">r1&lt;span class="o">(&lt;/span>config&lt;span class="o">)&lt;/span>&lt;span class="c1">#interface ethernet 1 - 2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">r1&lt;span class="o">(&lt;/span>config-if-Et1-2&lt;span class="o">)&lt;/span>&lt;span class="c1">#shutdown&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">r1&lt;span class="o">(&lt;/span>config-if-Et1-2&lt;span class="o">)&lt;/span>&lt;span class="c1">#end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">r1#show user de
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Session Username Roles TTY State Duration Auth Remote Host
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">------------- -------------- ------------------- ---------- ----------- -------------- ----------- -----------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">13&lt;/span> admin network-admin vty5 E 0:00:24 &lt;span class="nb">local&lt;/span> 10.244.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">r1#show interfaces status
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Port Name Status Vlan Duplex Speed Type Flags Encapsulation
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Et1 disabled routed full 1G EbraTestPhyPort
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Et2 disabled routed full 1G EbraTestPhyPort&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Seems we are ready now for some serious labbing. &amp;#x1f604;&lt;/p>
&lt;hr>
&lt;h3 class="heading-element" id="references-and-influences">&lt;span>References and influences&lt;/span>
 &lt;a href="#references-and-influences" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h3>&lt;ul>
&lt;li>&lt;a href="https://github.com/google/kne"target="_blank" rel="external nofollow noopener noreferrer">KNE on github&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://blog.itsalwaysthe.network/posts/kubernetes-based-network-emulation/"target="_blank" rel="external nofollow noopener noreferrer">Inspired by this Blog post&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://metallb.universe.tf/installation/"target="_blank" rel="external nofollow noopener noreferrer">metallb&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/srl-labs/srl-controller#readme"target="_blank" rel="external nofollow noopener noreferrer">srl-labs on github&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://learn.srlinux.dev/"target="_blank" rel="external nofollow noopener noreferrer">srlinux&lt;/a>&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 class="heading-element" id="outro">&lt;span>Outro&lt;/span>
 &lt;a href="#outro" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h2>&lt;hr>
&lt;p>Well, this was just a bare miminum and focused on how to set things up. I hope my post will help someone to start kicking the tyres with KNE. I also hope the project gets traction and evolves since the applications of it seem endless &amp;#x1f604; from all aspects. Thanking you, for reading the post, as well as all people sharing and contributing to the community making it sustainable and strong.&lt;/p>
&lt;p align="right">...till next time...&lt;em>have fun!&lt;/em>&lt;/p></description></item><item><title>Kube my router up! - Part Two</title><link>https://net4fungr.github.io/posts/kube-my-router-pt2/</link><pubDate>Tue, 31 May 2022 12:40:24 +0300</pubDate><guid>https://net4fungr.github.io/posts/kube-my-router-pt2/</guid><category domain="https://net4fungr.github.io/categories/art-of-labbing/">Art of Labbing</category><description>&lt;img src="https://net4fungr.github.io/posts/kube-my-router-pt2/featured-image-preview.png" alt="featured image" referrerpolicy="no-referrer">&lt;h2 class="heading-element" id="intro">&lt;span>&lt;a href="https://net4fungr.github.io/posts/kube-my-router-pt1/#intro">Intro&lt;/a>&lt;/span>
 &lt;a href="#intro" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h2>&lt;hr>
&lt;h2 class="heading-element" id="part-one---setting-up-the-k8s-vms-in-eve-ng">&lt;span>&lt;a href="https://net4fungr.github.io/posts/kube-my-router-pt1/">Part One - Setting up the k8s VMs in EVE-NG&lt;/a>&lt;/span>
 &lt;a href="#part-one---setting-up-the-k8s-vms-in-eve-ng" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h2>&lt;hr>
&lt;h2 class="heading-element" id="part-two---deploying-the-k8s-cluster-with-kubeadm">&lt;span>&lt;a href="https://net4fungr.github.io/posts/kube-my-router-pt2/">Part Two - Deploying the k8s cluster with kubeadm&lt;/a>&lt;/span>
 &lt;a href="#part-two---deploying-the-k8s-cluster-with-kubeadm" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h2>&lt;hr>
&lt;h3 class="heading-element" id="the-intent">&lt;span>The Intent&lt;/span>
 &lt;a href="#the-intent" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h3>&lt;ul>
&lt;li>Deploy k8s cluster with kubeadm&lt;/li>
&lt;li>Single control plane, two workers&lt;/li>
&lt;li>Use containerd as the container runtime&lt;/li>
&lt;li>Flannel as network overlay CNI plugin&lt;/li>
&lt;/ul>
&lt;hr>
&lt;p>The main question points while preparing the k8s cluster for KNE where which CRI and which CNI to use, since I am not very deep in to k8s. A brief research done on the kind container that KNE uses to deploy the cluster and run the simulations in it revealed that it uses containerd as the CRI.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">❯ kubectl get nodes -owide
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME STATUS ROLES AGE VERSION INTERNAL-IP EXTERNAL-IP OS-IMAGE KERNEL-VERSION CONTAINER-RUNTIME
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kne-control-plane Ready control-plane,master 14d v1.22.1 172.19.0.2 &amp;lt;none&amp;gt; Ubuntu Impish Indri &lt;span class="o">(&lt;/span>development branch&lt;span class="o">)&lt;/span> 5.4.0-107-generic containerd://1.5.5&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Kindnet as the primary the CNI.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">❯ kubectl get ds -n kube-system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME DESIRED CURRENT READY UP-TO-DATE AVAILABLE NODE SELECTOR AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kindnet &lt;span class="m">1&lt;/span> &lt;span class="m">1&lt;/span> &lt;span class="m">1&lt;/span> &lt;span class="m">1&lt;/span> &lt;span class="m">1&lt;/span> &amp;lt;none&amp;gt; 14d
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-proxy &lt;span class="m">1&lt;/span> &lt;span class="m">1&lt;/span> &lt;span class="m">1&lt;/span> &lt;span class="m">1&lt;/span> &lt;span class="m">1&lt;/span> kubernetes.io/os&lt;span class="o">=&lt;/span>linux 14d&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>In terms of network configuration:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">❯ docker ps
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">a099e5c3f7d3 kindest/node:v1.22.1 &lt;span class="s2">&amp;#34;/usr/local/bin/entr…&amp;#34;&lt;/span> &lt;span class="m">2&lt;/span> weeks ago Up &lt;span class="m">2&lt;/span> weeks 127.0.0.1:34459-&amp;gt;6443/tcp kne-control-plane
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">❯ docker &lt;span class="nb">exec&lt;/span> -it a099e5c3f7d3 bash
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@kne-control-plane:/#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@kne-control-plane:/# ll /etc/cni/net.d/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">total &lt;span class="m">16&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwx------ &lt;span class="m">2&lt;/span> root root &lt;span class="m">4096&lt;/span> May &lt;span class="m">22&lt;/span> 22:16 ./
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwx------ &lt;span class="m">3&lt;/span> root root &lt;span class="m">4096&lt;/span> May &lt;span class="m">22&lt;/span> 22:14 ../
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-r--r--r-- &lt;span class="m">1&lt;/span> root root &lt;span class="m">518&lt;/span> May &lt;span class="m">22&lt;/span> 22:16 00-meshnet.conflist
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> root root &lt;span class="m">409&lt;/span> May &lt;span class="m">22&lt;/span> 22:15 10-kindnet.conflist
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@kne-control-plane:/# cat /etc/cni/net.d/10-kindnet.conflist
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;cniVersion&amp;#34;&lt;/span>: &lt;span class="s2">&amp;#34;0.3.1&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;name&amp;#34;&lt;/span>: &lt;span class="s2">&amp;#34;kindnet&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;plugins&amp;#34;&lt;/span>: &lt;span class="o">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;type&amp;#34;&lt;/span>: &lt;span class="s2">&amp;#34;ptp&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;ipMasq&amp;#34;&lt;/span>: false,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;ipam&amp;#34;&lt;/span>: &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;type&amp;#34;&lt;/span>: &lt;span class="s2">&amp;#34;host-local&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;dataDir&amp;#34;&lt;/span>: &lt;span class="s2">&amp;#34;/run/cni-ipam-state&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;routes&amp;#34;&lt;/span>: &lt;span class="o">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">{&lt;/span> &lt;span class="s2">&amp;#34;dst&amp;#34;&lt;/span>: &lt;span class="s2">&amp;#34;0.0.0.0/0&amp;#34;&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;ranges&amp;#34;&lt;/span>: &lt;span class="o">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">[&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="s2">&amp;#34;subnet&amp;#34;&lt;/span>: &lt;span class="s2">&amp;#34;10.244.0.0/24&amp;#34;&lt;/span> &lt;span class="o">}&lt;/span> &lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;mtu&amp;#34;&lt;/span>: &lt;span class="m">1500&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;type&amp;#34;&lt;/span>: &lt;span class="s2">&amp;#34;portmap&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;capabilities&amp;#34;&lt;/span>: &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;portMappings&amp;#34;&lt;/span>: &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@kne-control-plane:/# cat /etc/cni/net.d/00-meshnet.conflist
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;cniVersion&amp;#34;&lt;/span>: &lt;span class="s2">&amp;#34;0.3.1&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;name&amp;#34;&lt;/span>: &lt;span class="s2">&amp;#34;kindnet&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;plugins&amp;#34;&lt;/span>: &lt;span class="o">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;ipMasq&amp;#34;&lt;/span>: false,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;ipam&amp;#34;&lt;/span>: &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;dataDir&amp;#34;&lt;/span>: &lt;span class="s2">&amp;#34;/run/cni-ipam-state&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;ranges&amp;#34;&lt;/span>: &lt;span class="o">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;subnet&amp;#34;&lt;/span>: &lt;span class="s2">&amp;#34;10.244.0.0/24&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;routes&amp;#34;&lt;/span>: &lt;span class="o">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;dst&amp;#34;&lt;/span>: &lt;span class="s2">&amp;#34;0.0.0.0/0&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;type&amp;#34;&lt;/span>: &lt;span class="s2">&amp;#34;host-local&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;mtu&amp;#34;&lt;/span>: 1500,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;type&amp;#34;&lt;/span>: &lt;span class="s2">&amp;#34;ptp&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;capabilities&amp;#34;&lt;/span>: &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;portMappings&amp;#34;&lt;/span>: &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;type&amp;#34;&lt;/span>: &lt;span class="s2">&amp;#34;portmap&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;name&amp;#34;&lt;/span>: &lt;span class="s2">&amp;#34;meshnet&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;type&amp;#34;&lt;/span>: &lt;span class="s2">&amp;#34;meshnet&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;ipam&amp;#34;&lt;/span>: &lt;span class="o">{}&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;dns&amp;#34;&lt;/span>: &lt;span class="o">{}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>root@kne-control-plane:/#&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>So it is a simple Layer 3 CNI, and meshnet will be installed on top of it. Let&amp;rsquo;s use a more common CNI, like flannel for our use case.&lt;/p>
&lt;div class="details admonition note">
 &lt;div class="details-summary admonition-title">&lt;i class="icon fa-fw fa-solid fa-pencil-alt" aria-hidden="true">&lt;/i>Using flannel&lt;i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true">&lt;/i>&lt;/div>
 &lt;div class="details-content">
 &lt;div class="admonition-content">When using flannel, the main drawback was the interface MTU inside the device container, seen on srlinux. Flannel, since it uses VXLAN, will inherit the MTU of the main ethernet interface of the host and create its bridge interface flannel.1 with an MTU of minus 50, i.e. 1450 by default. When spinning up the containers, they use this MTU and from what I saw, srlinux cannot bring up its interfaces that need a minimum of 1500 MTU. The only way of mitigating this easily is to use higher MTU on the host interface, so flannel can inherit this, which I presume in a &lt;em>production&lt;/em> environment should be something common and the network underlay would of course support jumbo&amp;rsquo;s. More on this during final part.&lt;/div>
 &lt;/div>
&lt;/div>
&lt;p>Let&amp;rsquo;s change gears now and deploy the k8s cluster on the three VMs that are running on the two EVE-NG servers. Here&amp;rsquo;s what we have up and running:&lt;/p>
&lt;table>
 &lt;thead>
 &lt;tr>
 &lt;th style="text-align: center">EVE-NG node&lt;/th>
 &lt;th style="text-align: center">Role&lt;/th>
 &lt;th style="text-align: center">VM name&lt;/th>
 &lt;th style="text-align: center">IP address&lt;/th>
 &lt;th style="text-align: center">CPU&lt;/th>
 &lt;th style="text-align: center">RAM&lt;/th>
 &lt;/tr>
 &lt;/thead>
 &lt;tbody>
 &lt;tr>
 &lt;td style="text-align: center">eve-01&lt;/td>
 &lt;td style="text-align: center">control-node&lt;/td>
 &lt;td style="text-align: center">kates-control&lt;/td>
 &lt;td style="text-align: center">192.168.1.30&lt;/td>
 &lt;td style="text-align: center">4&lt;/td>
 &lt;td style="text-align: center">4096&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td style="text-align: center">eve-01&lt;/td>
 &lt;td style="text-align: center">worker&lt;/td>
 &lt;td style="text-align: center">kates-node-01&lt;/td>
 &lt;td style="text-align: center">192.168.1.31&lt;/td>
 &lt;td style="text-align: center">8&lt;/td>
 &lt;td style="text-align: center">28672&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td style="text-align: center">eve-02&lt;/td>
 &lt;td style="text-align: center">worker&lt;/td>
 &lt;td style="text-align: center">kates-node-02&lt;/td>
 &lt;td style="text-align: center">192.168.1.32&lt;/td>
 &lt;td style="text-align: center">8&lt;/td>
 &lt;td style="text-align: center">28672&lt;/td>
 &lt;/tr>
 &lt;/tbody>
&lt;/table>
&lt;p>We are going to deploy a single control node with two workers using kubeadm and also use the containerd container runtime.&lt;/p>
&lt;hr>
&lt;h3 class="heading-element" id="prepare-all-nodes-for-kubeadm">&lt;span>Prepare all nodes for kubeadm&lt;/span>
 &lt;a href="#prepare-all-nodes-for-kubeadm" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h3>&lt;hr>
&lt;p>In all nodes, fix the &lt;mark class="mark-default">/etc/hosts&lt;/mark> since we are not using proper DNS resolution and we need to statically be able to resolve.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-diff" data-lang="diff">&lt;span class="line">&lt;span class="cl">$ diff /etc/hosts.orig /etc/hosts -p
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*** /etc/hosts.orig 2022-05-30 19:28:32.679321412 +0000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gd">--- /etc/hosts 2022-05-30 19:29:04.931472825 +0000
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gd">&lt;/span>***************
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*** 1,4 ****
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gd">--- 1,7 ----
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gd">&lt;/span> 127.0.0.1 localhost
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gi">+ 192.168.1.30 kates-control
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gi">+ 192.168.1.31 kates-node-01
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gi">+ 192.168.1.32 kates-node-02
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Install the pre-requisite packages if missing and add the k8s sources in apt.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">$ sudo apt -y install vim git curl wget apt-transport-https ca-certificates
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg &lt;span class="p">|&lt;/span> sudo apt-key add -
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">OK
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;deb https://apt.kubernetes.io/ kubernetes-xenial main&amp;#34;&lt;/span> &lt;span class="p">|&lt;/span> sudo tee /etc/apt/sources.list.d/kubernetes.list
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">deb https://apt.kubernetes.io/ kubernetes-xenial main
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ sudo apt update&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>You may upgrade any packages needed after the last apt update.&lt;/p>
&lt;p>Next, we are now ready to install &lt;strong>kubeadm&lt;/strong> along with &lt;strong>kubelet&lt;/strong> and &lt;strong>kubectl&lt;/strong> packages&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">$ sudo apt -y install kubeadm kubelet kubectl
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Lock the software version on these packages to avoid any accidental upgrade&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ sudo apt-mark hold kubelet kubeadm kubectl
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># This is the version used while I was deploying&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ kubectl version --output&lt;span class="o">=&lt;/span>yaml --client &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> kubeadm version -o yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">clientVersion:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> buildDate: &lt;span class="s2">&amp;#34;2022-05-24T12:26:19Z&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> compiler: gc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> gitCommit: 3ddd0f45aa91e2f30c70734b175631bec5b5825a
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> gitTreeState: clean
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> gitVersion: v1.24.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> goVersion: go1.18.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> major: &lt;span class="s2">&amp;#34;1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> minor: &lt;span class="s2">&amp;#34;24&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> platform: linux/amd64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kustomizeVersion: v4.5.4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">clientVersion:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> buildDate: &lt;span class="s2">&amp;#34;2022-05-24T12:24:38Z&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> compiler: gc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> gitCommit: 3ddd0f45aa91e2f30c70734b175631bec5b5825a
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> gitTreeState: clean
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> gitVersion: v1.24.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> goVersion: go1.18.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> major: &lt;span class="s2">&amp;#34;1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> minor: &lt;span class="s2">&amp;#34;24&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> platform: linux/amd64&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="details admonition note">
 &lt;div class="details-summary admonition-title">&lt;i class="icon fa-fw fa-solid fa-pencil-alt" aria-hidden="true">&lt;/i>Specific Version&lt;i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true">&lt;/i>&lt;/div>
 &lt;div class="details-content">
 &lt;div class="admonition-content">&lt;p>If you want to deploy a specific version of the packages and not the latest available you could execute:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">$ sudo apt list -a kubelet kubeadm kubectl &lt;span class="p">|&lt;/span> grep 1.22.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">WARNING: apt does not have a stable CLI interface. Use with caution in scripts.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kubeadm/kubernetes-xenial 1.22.2-00 amd64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kubectl/kubernetes-xenial 1.22.2-00 amd64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kubelet/kubernetes-xenial 1.22.2-00 amd64&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>And then install with:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">sudo apt -y install &lt;span class="nv">kubeadm&lt;/span>&lt;span class="o">=&lt;/span>1.22.2-00 &lt;span class="nv">kubelet&lt;/span>&lt;span class="o">=&lt;/span>1.22.2-00 &lt;span class="nv">kubectl&lt;/span>&lt;span class="o">=&lt;/span>1.22.2-00&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Remember that if you are using a specific version you will have to specify that while downloading the k8s images and/or during kubeadm init bootstrap of the control node.&lt;/p>
&lt;/div>
 &lt;/div>
&lt;/div>
&lt;p>We now need to disable swap if we are using any (cloud images do not by default), since kubelet will not run unless swap is disabled.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">$ sudo swapoff -a
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Comment out the relevant line in fstab to disable swap from loading on boot (usually last line)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ sudo vi /etc/fstab&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Enable kernel modules and bridge NF to iptables chains.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ sudo modprobe overlay
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ sudo modprobe br_netfilter
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ cat &lt;span class="s">&amp;lt;&amp;lt;EOF | sudo tee /etc/modules-load.d/k8s-cri.conf
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">&amp;gt; overlay
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">&amp;gt; br_netfilter
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">&amp;gt; EOF&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">overlay
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">br_netfilter
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ sudo tee /etc/sysctl.d/99-k8s-cri.conf&lt;span class="s">&amp;lt;&amp;lt;EOF
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">&amp;gt; net.bridge.bridge-nf-call-ip6tables = 1
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">&amp;gt; net.bridge.bridge-nf-call-iptables = 1
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">&amp;gt; net.ipv4.ip_forward = 1
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">&amp;gt; EOF&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">net.bridge.bridge-nf-call-ip6tables &lt;span class="o">=&lt;/span> &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">net.bridge.bridge-nf-call-iptables &lt;span class="o">=&lt;/span> &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">net.ipv4.ip_forward &lt;span class="o">=&lt;/span> &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Reload sysctl to apply changes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ sudo sysctl --system&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;hr>
&lt;h3 class="heading-element" id="install-a-container-runtime">&lt;span>Install a container runtime&lt;/span>
 &lt;a href="#install-a-container-runtime" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h3>&lt;hr>
&lt;p>As far as CRI, there are three options available. Go with either &lt;strong>docker&lt;/strong>, &lt;strong>containerd&lt;/strong> or use &lt;strong>CRI-O&lt;/strong>. For this post we are going with containerd, so the first step is to add the repo to our nodes and install the service.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ curl -fsSL https://download.docker.com/linux/ubuntu/gpg &lt;span class="p">|&lt;/span> sudo apt-key add -
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">OK
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ sudo add-apt-repository &lt;span class="s2">&amp;#34;deb [arch=amd64] https://download.docker.com/linux/ubuntu &lt;/span>&lt;span class="k">$(&lt;/span>lsb_release -cs&lt;span class="k">)&lt;/span>&lt;span class="s2"> stable&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ sudo apt update -y
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ sudo apt install -y containerd.io&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Next, put in place a default configuration.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ sudo mv /etc/containerd/config.toml /etc/containerd/config.toml.orig
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ containerd config default &lt;span class="p">|&lt;/span> sudo tee /etc/containerd/config.toml&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Next, set the cgroup to use systemd and re-start the service.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ sudo sed -i s/&lt;span class="s2">&amp;#34;SystemdCgroup = false&amp;#34;&lt;/span>/&lt;span class="s2">&amp;#34;SystemdCgroup = true&amp;#34;&lt;/span>/g /etc/containerd/config.toml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ sudo systemctl restart containerd&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Test that pulling images works.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ sudo ctr image pull docker.io/library/nginx:latest
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ sudo ctr image ls -q
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker.io/library/nginx:latest
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Delete the image&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ sudo ctr image rm docker.io/library/nginx:latest
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker.io/library/nginx:latest&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="details admonition note">
 &lt;div class="details-summary admonition-title">&lt;i class="icon fa-fw fa-solid fa-pencil-alt" aria-hidden="true">&lt;/i>Access via proxy&lt;i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true">&lt;/i>&lt;/div>
 &lt;div class="details-content">
 &lt;div class="admonition-content">&lt;p>If you are behind a proxy, you can expose the proxy environment variables to the daemon.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">$ sudo mkdir /etc/systemd/system/containerd.service.d/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ sudo tee /etc/systemd/system/containerd.service.d/http-proxy.conf&lt;span class="s">&amp;lt;&amp;lt;EOF
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">&amp;gt; [Service]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">&amp;gt; Environment=&amp;#34;HTTP_PROXY=http://&amp;lt;your_proxy&amp;gt;:&amp;lt;port&amp;gt;&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">&amp;gt; Environment=&amp;#34;HTTPS_PROXY=http://&amp;lt;your_proxy&amp;gt;:&amp;lt;port&amp;gt;&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">&amp;gt; Environment=&amp;#34;NO_PROXY=localhost,127.0.0.1,.domain.com&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">&amp;gt; EOF&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ sudo systemctl daemon-reload
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ sudo systemctl restart containerd&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>NOTE:&lt;/strong> The &lt;strong>no_proxy&lt;/strong> variable will not accept subnet masks, only full /32 ip addresses.&lt;/p>
&lt;/div>
 &lt;/div>
&lt;/div>
&lt;hr>
&lt;h3 class="heading-element" id="bootstrap-k8s-control-node">&lt;span>Bootstrap k8s control node&lt;/span>
 &lt;a href="#bootstrap-k8s-control-node" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h3>&lt;hr>
&lt;p>We are ready now to initialise the control node on the first VM. First we need to enable the &lt;strong>kubelet&lt;/strong> service if not already on.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ systemctl is-enabled kubelet &amp;gt;/dev/null &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="nb">echo&lt;/span> Service is already enabled &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="nb">echo&lt;/span> Enabling kubelet &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> sudo systemctl &lt;span class="nb">enable&lt;/span> kubelet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Service is already enabled&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>No worries if the service does not load correctly, it will, after kubeadm finishes configuring the control node.
Download k8s images from the registry, optionally, specifying the k8s version.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Check for the images first&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ sudo kubeadm config images list --kubernetes-version stable-1.24
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s.gcr.io/kube-apiserver:v1.24.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s.gcr.io/kube-controller-manager:v1.24.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s.gcr.io/kube-scheduler:v1.24.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s.gcr.io/kube-proxy:v1.24.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s.gcr.io/pause:3.7
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s.gcr.io/etcd:3.5.3-0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s.gcr.io/coredns/coredns:v1.8.6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># and then pull them&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ sudo kubeadm config images pull --kubernetes-version stable-1.24 --cri-socket unix:///run/containerd/containerd.sock
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>config/images&lt;span class="o">]&lt;/span> Pulled k8s.gcr.io/kube-apiserver:v1.24.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>config/images&lt;span class="o">]&lt;/span> Pulled k8s.gcr.io/kube-controller-manager:v1.24.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>config/images&lt;span class="o">]&lt;/span> Pulled k8s.gcr.io/kube-scheduler:v1.24.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>config/images&lt;span class="o">]&lt;/span> Pulled k8s.gcr.io/kube-proxy:v1.24.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>config/images&lt;span class="o">]&lt;/span> Pulled k8s.gcr.io/pause:3.7
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>config/images&lt;span class="o">]&lt;/span> Pulled k8s.gcr.io/etcd:3.5.3-0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>config/images&lt;span class="o">]&lt;/span> Pulled k8s.gcr.io/coredns/coredns:v1.8.6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ sudo ctr -n k8s.io image ls -q &lt;span class="p">|&lt;/span> grep -v sha
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s.gcr.io/coredns/coredns:v1.8.6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s.gcr.io/etcd:3.5.3-0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s.gcr.io/kube-apiserver:v1.24.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s.gcr.io/kube-controller-manager:v1.24.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s.gcr.io/kube-proxy:v1.24.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s.gcr.io/kube-scheduler:v1.24.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s.gcr.io/pause:3.7&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="details admonition note">
 &lt;div class="details-summary admonition-title">&lt;i class="icon fa-fw fa-solid fa-pencil-alt" aria-hidden="true">&lt;/i>Using crictl instead&lt;i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true">&lt;/i>&lt;/div>
 &lt;div class="details-content">
 &lt;div class="admonition-content">&lt;p>If you prefer to use crictl, you can create a configuration file for containerd to avoid the warnings&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ sudo tee cat /etc/crictl.yaml &lt;span class="s">&amp;lt;&amp;lt;EOF
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">&amp;gt; runtime-endpoint: unix:///var/run/containerd/containerd.sock
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">&amp;gt; image-endpoint: unix:///run/containerd/containerd.sock
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">&amp;gt; timeout: 10
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">&amp;gt; debug: false
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">&amp;gt; EOF&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">runtime-endpoint: unix:///var/run/containerd/containerd.sock
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">image-endpoint: unix:///run/containerd/containerd.sock
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">timeout: &lt;span class="m">10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">debug: &lt;span class="nb">false&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ sudo crictl images
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IMAGE TAG IMAGE ID SIZE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s.gcr.io/coredns/coredns v1.8.6 a4ca41631cc7a 13.6MB
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s.gcr.io/etcd 3.5.3-0 aebe758cef4cd 102MB
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s.gcr.io/kube-apiserver v1.24.1 e9f4b425f9192 33.8MB
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s.gcr.io/kube-controller-manager v1.24.1 b4ea7e648530d 31MB
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s.gcr.io/kube-proxy v1.24.1 beb86f5d8e6cd 39.5MB
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s.gcr.io/kube-scheduler v1.24.1 18688a72645c5 15.5MB
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s.gcr.io/pause 3.7 221177c6082a8 311kB&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
 &lt;/div>
&lt;/div>
&lt;p>Now we can use kubeadm to bootstrap the node setting the POD network and, again, by optionally specifying the version. The init process will get the appropriate images if they do not exist locally already.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ sudo kubeadm init --pod-network-cidr&lt;span class="o">=&lt;/span>10.244.0.0/16 --cri-socket /run/containerd/containerd.sock --kubernetes-version stable-1.24
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">W0606 09:39:22.344649 &lt;span class="m">33934&lt;/span> initconfiguration.go:120&lt;span class="o">]&lt;/span> Usage of CRI endpoints without URL scheme is deprecated and can cause kubelet errors in the future. Automatically prepending scheme &lt;span class="s2">&amp;#34;unix&amp;#34;&lt;/span> to the &lt;span class="s2">&amp;#34;criSocket&amp;#34;&lt;/span> with value &lt;span class="s2">&amp;#34;/run/containerd/containerd.sock&amp;#34;&lt;/span>. Please update your configuration!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>init&lt;span class="o">]&lt;/span> Using Kubernetes version: v1.24.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>preflight&lt;span class="o">]&lt;/span> Running pre-flight checks
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>preflight&lt;span class="o">]&lt;/span> Pulling images required &lt;span class="k">for&lt;/span> setting up a Kubernetes cluster
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>preflight&lt;span class="o">]&lt;/span> This might take a minute or two, depending on the speed of your internet connection
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>preflight&lt;span class="o">]&lt;/span> You can also perform this action in beforehand using &lt;span class="s1">&amp;#39;kubeadm config images pull&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> Using certificateDir folder &lt;span class="s2">&amp;#34;/etc/kubernetes/pki&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> Generating &lt;span class="s2">&amp;#34;ca&amp;#34;&lt;/span> certificate and key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> Generating &lt;span class="s2">&amp;#34;apiserver&amp;#34;&lt;/span> certificate and key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> apiserver serving cert is signed &lt;span class="k">for&lt;/span> DNS names &lt;span class="o">[&lt;/span>kates-control kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local&lt;span class="o">]&lt;/span> and IPs &lt;span class="o">[&lt;/span>10.96.0.1 192.168.1.30&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> Generating &lt;span class="s2">&amp;#34;apiserver-kubelet-client&amp;#34;&lt;/span> certificate and key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> Generating &lt;span class="s2">&amp;#34;front-proxy-ca&amp;#34;&lt;/span> certificate and key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> Generating &lt;span class="s2">&amp;#34;front-proxy-client&amp;#34;&lt;/span> certificate and key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> Generating &lt;span class="s2">&amp;#34;etcd/ca&amp;#34;&lt;/span> certificate and key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> Generating &lt;span class="s2">&amp;#34;etcd/server&amp;#34;&lt;/span> certificate and key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> etcd/server serving cert is signed &lt;span class="k">for&lt;/span> DNS names &lt;span class="o">[&lt;/span>kates-control localhost&lt;span class="o">]&lt;/span> and IPs &lt;span class="o">[&lt;/span>192.168.1.30 127.0.0.1 ::1&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> Generating &lt;span class="s2">&amp;#34;etcd/peer&amp;#34;&lt;/span> certificate and key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> etcd/peer serving cert is signed &lt;span class="k">for&lt;/span> DNS names &lt;span class="o">[&lt;/span>kates-control localhost&lt;span class="o">]&lt;/span> and IPs &lt;span class="o">[&lt;/span>192.168.1.30 127.0.0.1 ::1&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> Generating &lt;span class="s2">&amp;#34;etcd/healthcheck-client&amp;#34;&lt;/span> certificate and key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> Generating &lt;span class="s2">&amp;#34;apiserver-etcd-client&amp;#34;&lt;/span> certificate and key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> Generating &lt;span class="s2">&amp;#34;sa&amp;#34;&lt;/span> key and public key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>kubeconfig&lt;span class="o">]&lt;/span> Using kubeconfig folder &lt;span class="s2">&amp;#34;/etc/kubernetes&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>kubeconfig&lt;span class="o">]&lt;/span> Writing &lt;span class="s2">&amp;#34;admin.conf&amp;#34;&lt;/span> kubeconfig file
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>kubeconfig&lt;span class="o">]&lt;/span> Writing &lt;span class="s2">&amp;#34;kubelet.conf&amp;#34;&lt;/span> kubeconfig file
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>kubeconfig&lt;span class="o">]&lt;/span> Writing &lt;span class="s2">&amp;#34;controller-manager.conf&amp;#34;&lt;/span> kubeconfig file
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>kubeconfig&lt;span class="o">]&lt;/span> Writing &lt;span class="s2">&amp;#34;scheduler.conf&amp;#34;&lt;/span> kubeconfig file
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>kubelet-start&lt;span class="o">]&lt;/span> Writing kubelet environment file with flags to file &lt;span class="s2">&amp;#34;/var/lib/kubelet/kubeadm-flags.env&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>kubelet-start&lt;span class="o">]&lt;/span> Writing kubelet configuration to file &lt;span class="s2">&amp;#34;/var/lib/kubelet/config.yaml&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>kubelet-start&lt;span class="o">]&lt;/span> Starting the kubelet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>control-plane&lt;span class="o">]&lt;/span> Using manifest folder &lt;span class="s2">&amp;#34;/etc/kubernetes/manifests&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>control-plane&lt;span class="o">]&lt;/span> Creating static Pod manifest &lt;span class="k">for&lt;/span> &lt;span class="s2">&amp;#34;kube-apiserver&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>control-plane&lt;span class="o">]&lt;/span> Creating static Pod manifest &lt;span class="k">for&lt;/span> &lt;span class="s2">&amp;#34;kube-controller-manager&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>control-plane&lt;span class="o">]&lt;/span> Creating static Pod manifest &lt;span class="k">for&lt;/span> &lt;span class="s2">&amp;#34;kube-scheduler&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>etcd&lt;span class="o">]&lt;/span> Creating static Pod manifest &lt;span class="k">for&lt;/span> &lt;span class="nb">local&lt;/span> etcd in &lt;span class="s2">&amp;#34;/etc/kubernetes/manifests&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>wait-control-plane&lt;span class="o">]&lt;/span> Waiting &lt;span class="k">for&lt;/span> the kubelet to boot up the control plane as static Pods from directory &lt;span class="s2">&amp;#34;/etc/kubernetes/manifests&amp;#34;&lt;/span>. This can take up to 4m0s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>apiclient&lt;span class="o">]&lt;/span> All control plane components are healthy after 9.004673 seconds
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>upload-config&lt;span class="o">]&lt;/span> Storing the configuration used in ConfigMap &lt;span class="s2">&amp;#34;kubeadm-config&amp;#34;&lt;/span> in the &lt;span class="s2">&amp;#34;kube-system&amp;#34;&lt;/span> Namespace
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>kubelet&lt;span class="o">]&lt;/span> Creating a ConfigMap &lt;span class="s2">&amp;#34;kubelet-config&amp;#34;&lt;/span> in namespace kube-system with the configuration &lt;span class="k">for&lt;/span> the kubelets in the cluster
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>upload-certs&lt;span class="o">]&lt;/span> Skipping phase. Please see --upload-certs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>mark-control-plane&lt;span class="o">]&lt;/span> Marking the node kates-control as control-plane by adding the labels: &lt;span class="o">[&lt;/span>node-role.kubernetes.io/control-plane node.kubernetes.io/exclude-from-external-load-balancers&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>mark-control-plane&lt;span class="o">]&lt;/span> Marking the node kates-control as control-plane by adding the taints &lt;span class="o">[&lt;/span>node-role.kubernetes.io/master:NoSchedule node-role.kubernetes.io/control-plane:NoSchedule&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>bootstrap-token&lt;span class="o">]&lt;/span> Using token: kggzqq.5vz1esxhxfw1wgxf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>bootstrap-token&lt;span class="o">]&lt;/span> Configuring bootstrap tokens, cluster-info ConfigMap, RBAC Roles
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>bootstrap-token&lt;span class="o">]&lt;/span> Configured RBAC rules to allow Node Bootstrap tokens to get nodes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>bootstrap-token&lt;span class="o">]&lt;/span> Configured RBAC rules to allow Node Bootstrap tokens to post CSRs in order &lt;span class="k">for&lt;/span> nodes to get long term certificate credentials
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>bootstrap-token&lt;span class="o">]&lt;/span> Configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>bootstrap-token&lt;span class="o">]&lt;/span> Configured RBAC rules to allow certificate rotation &lt;span class="k">for&lt;/span> all node client certificates in the cluster
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>bootstrap-token&lt;span class="o">]&lt;/span> Creating the &lt;span class="s2">&amp;#34;cluster-info&amp;#34;&lt;/span> ConfigMap in the &lt;span class="s2">&amp;#34;kube-public&amp;#34;&lt;/span> namespace
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>kubelet-finalize&lt;span class="o">]&lt;/span> Updating &lt;span class="s2">&amp;#34;/etc/kubernetes/kubelet.conf&amp;#34;&lt;/span> to point to a rotatable kubelet client certificate and key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>addons&lt;span class="o">]&lt;/span> Applied essential addon: CoreDNS
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>addons&lt;span class="o">]&lt;/span> Applied essential addon: kube-proxy
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Your Kubernetes control-plane has initialized successfully!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">To start using your cluster, you need to run the following as a regular user:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mkdir -p &lt;span class="nv">$HOME&lt;/span>/.kube
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sudo cp -i /etc/kubernetes/admin.conf &lt;span class="nv">$HOME&lt;/span>/.kube/config
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sudo chown &lt;span class="k">$(&lt;/span>id -u&lt;span class="k">)&lt;/span>:&lt;span class="k">$(&lt;/span>id -g&lt;span class="k">)&lt;/span> &lt;span class="nv">$HOME&lt;/span>/.kube/config
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Alternatively, &lt;span class="k">if&lt;/span> you are the root user, you can run:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">export&lt;/span> &lt;span class="nv">KUBECONFIG&lt;/span>&lt;span class="o">=&lt;/span>/etc/kubernetes/admin.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">You should now deploy a pod network to the cluster.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Run &lt;span class="s2">&amp;#34;kubectl apply -f [podnetwork].yaml&amp;#34;&lt;/span> with one of the options listed at:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> https://kubernetes.io/docs/concepts/cluster-administration/addons/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Then you can join any number of worker nodes by running the following on each as root:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kubeadm join 192.168.1.30:6443 --token kggzqq.5vz1esxhxfw1wgxf &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --discovery-token-ca-cert-hash sha256:d83d4dd95515623997f68d12a5bb19adda871ba8d81dc389ac787746d49ea9e2&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;div class="details admonition tip open">
 &lt;div class="details-summary admonition-title">&lt;i class="icon fa-fw fa-regular fa-lightbulb" aria-hidden="true">&lt;/i>Join Token&lt;i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true">&lt;/i>&lt;/div>
 &lt;div class="details-content">
 &lt;div class="admonition-content">The join token created by kubeadm will last I think for 24hrs, so if you are joining workers sooner you could copy the join command in a text pad or something for later use.&lt;/div>
 &lt;/div>
&lt;/div>
Now as instructed by the init process, copy the admin.conf into your users directory in order to be able to use kubectl to operate your cluster.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ mkdir -p &lt;span class="nv">$HOME&lt;/span>/.kube
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ sudo cp -i /etc/kubernetes/admin.conf &lt;span class="nv">$HOME&lt;/span>/.kube/config
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ sudo chown &lt;span class="k">$(&lt;/span>id -u&lt;span class="k">)&lt;/span>:&lt;span class="k">$(&lt;/span>id -g&lt;span class="k">)&lt;/span> &lt;span class="nv">$HOME&lt;/span>/.kube/config&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>And run some kubectl to check your control-plane.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ kubectl cluster-info
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Kubernetes control plane is running at https://192.168.1.30:6443
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CoreDNS is running at https://192.168.1.30:6443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">To further debug and diagnose cluster problems, use &lt;span class="s1">&amp;#39;kubectl cluster-info dump&amp;#39;&lt;/span>.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ kubectl get nodes -owide
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME STATUS ROLES AGE VERSION INTERNAL-IP EXTERNAL-IP OS-IMAGE KERNEL-VERSION CONTAINER-RUNTIME
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kates-control NotReady control-plane 104s v1.24.1 192.168.1.30 &amp;lt;none&amp;gt; Ubuntu 20.04.4 LTS 5.4.0-117-generic containerd://1.6.6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ kubectl get all -A
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAMESPACE NAME READY STATUS RESTARTS AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-system pod/coredns-6d4b75cb6d-r5k7h 0/1 Pending &lt;span class="m">0&lt;/span> 2m8s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-system pod/coredns-6d4b75cb6d-xwfnq 0/1 Pending &lt;span class="m">0&lt;/span> 2m8s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-system pod/etcd-kates-control 1/1 Running &lt;span class="m">0&lt;/span> 2m23s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-system pod/kube-apiserver-kates-control 1/1 Running &lt;span class="m">0&lt;/span> 2m23s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-system pod/kube-controller-manager-kates-control 1/1 Running &lt;span class="m">0&lt;/span> 2m25s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-system pod/kube-proxy-gnq29 1/1 Running &lt;span class="m">0&lt;/span> 2m8s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-system pod/kube-scheduler-kates-control 1/1 Running &lt;span class="m">0&lt;/span> 2m23s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAMESPACE NAME TYPE CLUSTER-IP EXTERNAL-IP PORT&lt;span class="o">(&lt;/span>S&lt;span class="o">)&lt;/span> AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">default service/kubernetes ClusterIP 10.96.0.1 &amp;lt;none&amp;gt; 443/TCP 2m25s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-system service/kube-dns ClusterIP 10.96.0.10 &amp;lt;none&amp;gt; 53/UDP,53/TCP,9153/TCP 2m23s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAMESPACE NAME DESIRED CURRENT READY UP-TO-DATE AVAILABLE NODE SELECTOR AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-system daemonset.apps/kube-proxy &lt;span class="m">1&lt;/span> &lt;span class="m">1&lt;/span> &lt;span class="m">1&lt;/span> &lt;span class="m">1&lt;/span> &lt;span class="m">1&lt;/span> kubernetes.io/os&lt;span class="o">=&lt;/span>linux 2m23s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAMESPACE NAME READY UP-TO-DATE AVAILABLE AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-system deployment.apps/coredns 0/2 &lt;span class="m">2&lt;/span> &lt;span class="m">0&lt;/span> 2m23s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAMESPACE NAME DESIRED CURRENT READY AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-system replicaset.apps/coredns-6d4b75cb6d &lt;span class="m">2&lt;/span> &lt;span class="m">2&lt;/span> &lt;span class="m">0&lt;/span> 2m9s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># componentstatus seems old :smile:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ kubectl get cs -A
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Warning: v1 ComponentStatus is deprecated in v1.19+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME STATUS MESSAGE ERROR
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">scheduler Healthy ok
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">controller-manager Healthy ok
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">etcd-0 Healthy &lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;health&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;true&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;reason&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;hr>
&lt;h3 class="heading-element" id="install-network-cni">&lt;span>Install network CNI&lt;/span>
 &lt;a href="#install-network-cni" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h3>&lt;hr>
&lt;p>Now, still on the control node, we are going to deploy the Flannel CNI plugin.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Warning: policy/v1beta1 PodSecurityPolicy is deprecated in v1.21+, unavailable in v1.25+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">podsecuritypolicy.policy/psp.flannel.unprivileged created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">clusterrole.rbac.authorization.k8s.io/flannel created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">clusterrolebinding.rbac.authorization.k8s.io/flannel created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">serviceaccount/flannel created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">configmap/kube-flannel-cfg created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">daemonset.apps/kube-flannel-ds created&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Check how it looks on control-plane.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ kubectl get all -A
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAMESPACE NAME READY STATUS RESTARTS AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-system pod/coredns-6d4b75cb6d-fvskj 1/1 Running &lt;span class="m">0&lt;/span> 8m12s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-system pod/coredns-6d4b75cb6d-xrflm 1/1 Running &lt;span class="m">0&lt;/span> 8m12s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-system pod/etcd-kates-control 1/1 Running &lt;span class="m">0&lt;/span> 8m25s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-system pod/kube-apiserver-kates-control 1/1 Running &lt;span class="m">0&lt;/span> 8m27s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-system pod/kube-controller-manager-kates-control 1/1 Running &lt;span class="m">0&lt;/span> 8m25s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-system pod/kube-flannel-ds-55st2 1/1 Running &lt;span class="m">0&lt;/span> 65s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-system pod/kube-proxy-8wjpp 1/1 Running &lt;span class="m">0&lt;/span> 8m13s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-system pod/kube-scheduler-kates-control 1/1 Running &lt;span class="m">0&lt;/span> 8m25s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAMESPACE NAME TYPE CLUSTER-IP EXTERNAL-IP PORT&lt;span class="o">(&lt;/span>S&lt;span class="o">)&lt;/span> AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">default service/kubernetes ClusterIP 10.96.0.1 &amp;lt;none&amp;gt; 443/TCP 8m27s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-system service/kube-dns ClusterIP 10.96.0.10 &amp;lt;none&amp;gt; 53/UDP,53/TCP,9153/TCP 8m25s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAMESPACE NAME DESIRED CURRENT READY UP-TO-DATE AVAILABLE NODE SELECTOR AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-system daemonset.apps/kube-flannel-ds &lt;span class="m">1&lt;/span> &lt;span class="m">1&lt;/span> &lt;span class="m">1&lt;/span> &lt;span class="m">1&lt;/span> &lt;span class="m">1&lt;/span> &amp;lt;none&amp;gt; 65s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-system daemonset.apps/kube-proxy &lt;span class="m">1&lt;/span> &lt;span class="m">1&lt;/span> &lt;span class="m">1&lt;/span> &lt;span class="m">1&lt;/span> &lt;span class="m">1&lt;/span> kubernetes.io/os&lt;span class="o">=&lt;/span>linux 8m25s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAMESPACE NAME READY UP-TO-DATE AVAILABLE AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-system deployment.apps/coredns 2/2 &lt;span class="m">2&lt;/span> &lt;span class="m">2&lt;/span> 8m25s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAMESPACE NAME DESIRED CURRENT READY AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-system replicaset.apps/coredns-6d4b75cb6d &lt;span class="m">2&lt;/span> &lt;span class="m">2&lt;/span> &lt;span class="m">2&lt;/span> 8m13s&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>And from the network side.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ ip ro &lt;span class="p">;&lt;/span> ip add
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">default via 192.168.1.1 dev ens3 proto static
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">10.244.0.0/24 dev cni0 proto kernel scope link src 10.244.0.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.0/24 dev ens3 proto kernel scope link src 192.168.1.30
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">1: lo: &amp;lt;LOOPBACK,UP,LOWER_UP&amp;gt; mtu &lt;span class="m">65536&lt;/span> qdisc noqueue state UNKNOWN group default qlen &lt;span class="m">1000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> inet 127.0.0.1/8 scope host lo
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> valid_lft forever preferred_lft forever
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> inet6 ::1/128 scope host
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> valid_lft forever preferred_lft forever
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2: ens3: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu &lt;span class="m">1500&lt;/span> qdisc fq_codel state UP group default qlen &lt;span class="m">1000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> link/ether 00:50:02:00:01:00 brd ff:ff:ff:ff:ff:ff
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> inet 192.168.1.30/24 brd 192.168.1.255 scope global ens3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> valid_lft forever preferred_lft forever
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> inet6 2a02:587:e44a:d37:250:2ff:fe00:100/64 scope global dynamic mngtmpaddr noprefixroute
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> valid_lft 604763sec preferred_lft 86363sec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> inet6 fe80::250:2ff:fe00:100/64 scope link
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> valid_lft forever preferred_lft forever
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">3: flannel.1: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu &lt;span class="m">1450&lt;/span> qdisc noqueue state UNKNOWN group default
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> link/ether f2:64:03:ac:1f:68 brd ff:ff:ff:ff:ff:ff
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> inet 10.244.0.0/32 scope global flannel.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> valid_lft forever preferred_lft forever
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> inet6 fe80::f064:3ff:feac:1f68/64 scope link
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> valid_lft forever preferred_lft forever
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">4: cni0: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu &lt;span class="m">1450&lt;/span> qdisc noqueue state UP group default qlen &lt;span class="m">1000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> link/ether e2:92:cd:73:85:3d brd ff:ff:ff:ff:ff:ff
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> inet 10.244.0.1/24 brd 10.244.0.255 scope global cni0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> valid_lft forever preferred_lft forever
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> inet6 fe80::e092:cdff:fe73:853d/64 scope link
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> valid_lft forever preferred_lft forever
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">5: vethdc5600c6@if3: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu &lt;span class="m">1450&lt;/span> qdisc noqueue master cni0 state UP group default
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> link/ether f2:8f:bd:a7:dc:82 brd ff:ff:ff:ff:ff:ff link-netns cni-0155810e-5cb5-58a5-22c4-dc8038081174
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> inet6 fe80::f08f:bdff:fea7:dc82/64 scope link
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> valid_lft forever preferred_lft forever
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">6: vethe9a1a648@if3: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu &lt;span class="m">1450&lt;/span> qdisc noqueue master cni0 state UP group default
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> link/ether aa:09:c5:8c:bb:66 brd ff:ff:ff:ff:ff:ff link-netns cni-d71bf00b-ba62-2a8d-548a-9430a25d8dcd
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> inet6 fe80::a809:c5ff:fe8c:bb66/64 scope link
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> valid_lft forever preferred_lft forever&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;hr>
&lt;h3 class="heading-element" id="add-worker-nodes">&lt;span>Add worker nodes&lt;/span>
 &lt;a href="#add-worker-nodes" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h3>&lt;hr>
&lt;p>Let&amp;rsquo;s go and add the two other nodes to our cluster now. We can do this either by using the init token or we could create a new one.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ kubeadm token create --print-join-command
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kubeadm join 192.168.1.30:6443 --token r8ydn9.nkbo1b94w7a6s8em --discovery-token-ca-cert-hash sha256:42a47eb0e4872ebdd7ebbd6935a6e1c42f51a67d29d80fd53098d27323c59b2e&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Now on both worker nodes.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">ubuntu@kates-node-01:~$ sudo kubeadm join 192.168.1.30:6443 --token r8ydn9.nkbo1b94w7a6s8em --discovery-token-ca-cert-hash sha256:42a47eb0e4872ebdd7ebbd6935a6e1c42f51a67d29d80fd53098d27323c59b2e
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>preflight&lt;span class="o">]&lt;/span> Running pre-flight checks
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>preflight&lt;span class="o">]&lt;/span> Reading configuration from the cluster...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>preflight&lt;span class="o">]&lt;/span> FYI: You can look at this config file with &lt;span class="s1">&amp;#39;kubectl -n kube-system get cm kubeadm-config -o yaml&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>kubelet-start&lt;span class="o">]&lt;/span> Writing kubelet configuration to file &lt;span class="s2">&amp;#34;/var/lib/kubelet/config.yaml&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>kubelet-start&lt;span class="o">]&lt;/span> Writing kubelet environment file with flags to file &lt;span class="s2">&amp;#34;/var/lib/kubelet/kubeadm-flags.env&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>kubelet-start&lt;span class="o">]&lt;/span> Starting the kubelet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>kubelet-start&lt;span class="o">]&lt;/span> Waiting &lt;span class="k">for&lt;/span> the kubelet to perform the TLS Bootstrap...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">This node has joined the cluster:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">* Certificate signing request was sent to apiserver and a response was received.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">* The Kubelet was informed of the new secure connection details.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Run &lt;span class="s1">&amp;#39;kubectl get nodes&amp;#39;&lt;/span> on the control-plane to see this node join the cluster.&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>If all went well then we should have a 3 node k8s cluster &amp;#x1f604;&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ kubectl get nodes -owide
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME STATUS ROLES AGE VERSION INTERNAL-IP EXTERNAL-IP OS-IMAGE KERNEL-VERSION CONTAINER-RUNTIME
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kates-control Ready control-plane 11m v1.24.1 192.168.1.30 &amp;lt;none&amp;gt; Ubuntu 20.04.4 LTS 5.4.0-117-generic containerd://1.6.6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kates-node-01 Ready &amp;lt;none&amp;gt; 66s v1.24.1 192.168.1.31 &amp;lt;none&amp;gt; Ubuntu 20.04.4 LTS 5.4.0-117-generic containerd://1.6.6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kates-node-02 Ready &amp;lt;none&amp;gt; 59s v1.24.1 192.168.1.32 &amp;lt;none&amp;gt; Ubuntu 20.04.4 LTS 5.4.0-117-generic containerd://1.6.6&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Final touch is to set the &lt;em>worker&lt;/em> role to the workers and, if you like to run pods on the control node as well, untaint the node.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ kubectl get nodes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME STATUS ROLES AGE VERSION
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kates-control Ready control-plane 4h37m v1.24.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kates-node-01 Ready &amp;lt;none&amp;gt; 139m v1.24.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kates-node-02 Ready &amp;lt;none&amp;gt; 138m v1.24.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ kubectl label nodes kates-node-01 kubernetes.io/role&lt;span class="o">=&lt;/span>worker
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">node/kates-node-01 labeled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ kubectl label nodes kates-node-02 kubernetes.io/role&lt;span class="o">=&lt;/span>worker
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">node/kates-node-02 labeled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ kubectl get nodes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME STATUS ROLES AGE VERSION
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kates-control Ready control-plane 4h37m v1.24.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kates-node-01 Ready worker 140m v1.24.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kates-node-02 Ready worker 138m v1.24.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Untaint the control plane to run pods if you wish&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ kubectl taint nodes kates-control node-role.kubernetes.io/control-plane&lt;span class="o">=&lt;/span>:NoSchedule- node-role.kubernetes.io/master&lt;span class="o">=&lt;/span>:NoSchedule-
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">node/kates-control untainted&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;hr>
&lt;h3 class="heading-element" id="testing-applications">&lt;span>Testing applications&lt;/span>
 &lt;a href="#testing-applications" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h3>&lt;hr>
&lt;p>Let&amp;rsquo;s deploy a test application to verify the cluster is running fine. We can create a deployment of nginx demo image with three replicas and test connectivity. The three pods will normaly be distributed across the three nodes, so we can use a Loadbalancer service to expose the deployment and check the operation.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Create a 3 replica deployment of nginx demo image&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ kubectl create deployment web --image&lt;span class="o">=&lt;/span>nginxdemos/hello --replicas&lt;span class="o">=&lt;/span>&lt;span class="m">3&lt;/span> --port &lt;span class="m">80&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">deployment.apps/web created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Check to see that pods are distributed across the three nodes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ kubectl get all -owide
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES
&lt;/span>&lt;/span>&lt;span class="line hl">&lt;span class="cl">pod/web-54b75887bb-2glrx 1/1 Running &lt;span class="m">0&lt;/span> 11s 10.244.2.3 kates-node-02 &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line hl">&lt;span class="cl">pod/web-54b75887bb-7jrf4 1/1 Running &lt;span class="m">0&lt;/span> 11s 10.244.1.2 kates-node-01 &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line hl">&lt;span class="cl">pod/web-54b75887bb-j76kz 1/1 Running &lt;span class="m">0&lt;/span> 11s 10.244.2.2 kates-node-02 &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME TYPE CLUSTER-IP EXTERNAL-IP PORT&lt;span class="o">(&lt;/span>S&lt;span class="o">)&lt;/span> AGE SELECTOR
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">service/kubernetes ClusterIP 10.96.0.1 &amp;lt;none&amp;gt; 443/TCP 12m &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY UP-TO-DATE AVAILABLE AGE CONTAINERS IMAGES SELECTOR
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">deployment.apps/web 3/3 &lt;span class="m">3&lt;/span> &lt;span class="m">3&lt;/span> 11s hello nginxdemos/hello &lt;span class="nv">app&lt;/span>&lt;span class="o">=&lt;/span>web
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME DESIRED CURRENT READY AGE CONTAINERS IMAGES SELECTOR
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">replicaset.apps/web-54b75887bb &lt;span class="m">3&lt;/span> &lt;span class="m">3&lt;/span> &lt;span class="m">3&lt;/span> 11s hello nginxdemos/hello &lt;span class="nv">app&lt;/span>&lt;span class="o">=&lt;/span>web,pod-template-hash&lt;span class="o">=&lt;/span>54b75887bb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Create a LoadBalancer service&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ kubectl expose deployment web --type&lt;span class="o">=&lt;/span>LoadBalancer --name&lt;span class="o">=&lt;/span>web-service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">service/web-service exposed
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ kubectl get svc -o wide
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME TYPE CLUSTER-IP EXTERNAL-IP PORT&lt;span class="o">(&lt;/span>S&lt;span class="o">)&lt;/span> AGE SELECTOR
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kubernetes ClusterIP 10.96.0.1 &amp;lt;none&amp;gt; 443/TCP 13m &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line hl">&lt;span class="cl">web-service LoadBalancer 10.101.141.116 &amp;lt;pending&amp;gt; 80:30721/TCP 10s &lt;span class="nv">app&lt;/span>&lt;span class="o">=&lt;/span>web
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Test communication to each pod&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ curl -s 10.244.2.3 &lt;span class="p">|&lt;/span> grep Server
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;p&amp;gt;&amp;lt;span&amp;gt;Server&lt;span class="p">&amp;amp;&lt;/span>nbsp&lt;span class="p">;&lt;/span>address:&amp;lt;/span&amp;gt; &amp;lt;span&amp;gt;10.244.2.3:80&amp;lt;/span&amp;gt;&amp;lt;/p&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;p&amp;gt;&amp;lt;span&amp;gt;Server&lt;span class="p">&amp;amp;&lt;/span>nbsp&lt;span class="p">;&lt;/span>name:&amp;lt;/span&amp;gt; &amp;lt;span&amp;gt;web-54b75887bb-2glrx&amp;lt;/span&amp;gt;&amp;lt;/p&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ curl -s 10.244.1.2 &lt;span class="p">|&lt;/span> grep Server
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;p&amp;gt;&amp;lt;span&amp;gt;Server&lt;span class="p">&amp;amp;&lt;/span>nbsp&lt;span class="p">;&lt;/span>address:&amp;lt;/span&amp;gt; &amp;lt;span&amp;gt;10.244.1.2:80&amp;lt;/span&amp;gt;&amp;lt;/p&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;p&amp;gt;&amp;lt;span&amp;gt;Server&lt;span class="p">&amp;amp;&lt;/span>nbsp&lt;span class="p">;&lt;/span>name:&amp;lt;/span&amp;gt; &amp;lt;span&amp;gt;web-54b75887bb-7jrf4&amp;lt;/span&amp;gt;&amp;lt;/p&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ curl -s 10.244.2.2 &lt;span class="p">|&lt;/span> grep Server
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;p&amp;gt;&amp;lt;span&amp;gt;Server&lt;span class="p">&amp;amp;&lt;/span>nbsp&lt;span class="p">;&lt;/span>address:&amp;lt;/span&amp;gt; &amp;lt;span&amp;gt;10.244.2.2:80&amp;lt;/span&amp;gt;&amp;lt;/p&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;p&amp;gt;&amp;lt;span&amp;gt;Server&lt;span class="p">&amp;amp;&lt;/span>nbsp&lt;span class="p">;&lt;/span>name:&amp;lt;/span&amp;gt; &amp;lt;span&amp;gt;web-54b75887bb-j76kz&amp;lt;/span&amp;gt;&amp;lt;/p&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Now test on the exposed port on the k8s hosts &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@kates-control:~$ &lt;span class="k">for&lt;/span> server in kates-control kates-node-01 kates-node-02 &lt;span class="p">;&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>&amp;gt; &lt;span class="k">do&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>&amp;gt; &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;*** &lt;/span>&lt;span class="nv">$server&lt;/span>&lt;span class="s2"> ***&amp;#34;&lt;/span> &lt;span class="p">;&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>&amp;gt; &lt;span class="k">for&lt;/span> i in &lt;span class="o">{&lt;/span>1..5&lt;span class="o">}&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>&amp;gt; &lt;span class="k">do&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>&amp;gt; curl -s &lt;span class="nv">$server&lt;/span>:30721 &lt;span class="p">|&lt;/span> grep address &lt;span class="p">;&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>&amp;gt; &lt;span class="k">done&lt;/span> &lt;span class="p">;&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>&amp;gt; &lt;span class="k">done&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*** kates-control ***
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;p&amp;gt;&amp;lt;span&amp;gt;Server&lt;span class="p">&amp;amp;&lt;/span>nbsp&lt;span class="p">;&lt;/span>address:&amp;lt;/span&amp;gt; &amp;lt;span&amp;gt;10.244.2.3:80&amp;lt;/span&amp;gt;&amp;lt;/p&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;p&amp;gt;&amp;lt;span&amp;gt;Server&lt;span class="p">&amp;amp;&lt;/span>nbsp&lt;span class="p">;&lt;/span>address:&amp;lt;/span&amp;gt; &amp;lt;span&amp;gt;10.244.2.3:80&amp;lt;/span&amp;gt;&amp;lt;/p&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;p&amp;gt;&amp;lt;span&amp;gt;Server&lt;span class="p">&amp;amp;&lt;/span>nbsp&lt;span class="p">;&lt;/span>address:&amp;lt;/span&amp;gt; &amp;lt;span&amp;gt;10.244.2.2:80&amp;lt;/span&amp;gt;&amp;lt;/p&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;p&amp;gt;&amp;lt;span&amp;gt;Server&lt;span class="p">&amp;amp;&lt;/span>nbsp&lt;span class="p">;&lt;/span>address:&amp;lt;/span&amp;gt; &amp;lt;span&amp;gt;10.244.2.2:80&amp;lt;/span&amp;gt;&amp;lt;/p&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;p&amp;gt;&amp;lt;span&amp;gt;Server&lt;span class="p">&amp;amp;&lt;/span>nbsp&lt;span class="p">;&lt;/span>address:&amp;lt;/span&amp;gt; &amp;lt;span&amp;gt;10.244.2.3:80&amp;lt;/span&amp;gt;&amp;lt;/p&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*** kates-node-01 ***
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;p&amp;gt;&amp;lt;span&amp;gt;Server&lt;span class="p">&amp;amp;&lt;/span>nbsp&lt;span class="p">;&lt;/span>address:&amp;lt;/span&amp;gt; &amp;lt;span&amp;gt;10.244.2.3:80&amp;lt;/span&amp;gt;&amp;lt;/p&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;p&amp;gt;&amp;lt;span&amp;gt;Server&lt;span class="p">&amp;amp;&lt;/span>nbsp&lt;span class="p">;&lt;/span>address:&amp;lt;/span&amp;gt; &amp;lt;span&amp;gt;10.244.2.3:80&amp;lt;/span&amp;gt;&amp;lt;/p&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;p&amp;gt;&amp;lt;span&amp;gt;Server&lt;span class="p">&amp;amp;&lt;/span>nbsp&lt;span class="p">;&lt;/span>address:&amp;lt;/span&amp;gt; &amp;lt;span&amp;gt;10.244.1.2:80&amp;lt;/span&amp;gt;&amp;lt;/p&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;p&amp;gt;&amp;lt;span&amp;gt;Server&lt;span class="p">&amp;amp;&lt;/span>nbsp&lt;span class="p">;&lt;/span>address:&amp;lt;/span&amp;gt; &amp;lt;span&amp;gt;10.244.1.2:80&amp;lt;/span&amp;gt;&amp;lt;/p&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;p&amp;gt;&amp;lt;span&amp;gt;Server&lt;span class="p">&amp;amp;&lt;/span>nbsp&lt;span class="p">;&lt;/span>address:&amp;lt;/span&amp;gt; &amp;lt;span&amp;gt;10.244.2.2:80&amp;lt;/span&amp;gt;&amp;lt;/p&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*** kates-node-02 ***
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;p&amp;gt;&amp;lt;span&amp;gt;Server&lt;span class="p">&amp;amp;&lt;/span>nbsp&lt;span class="p">;&lt;/span>address:&amp;lt;/span&amp;gt; &amp;lt;span&amp;gt;10.244.1.2:80&amp;lt;/span&amp;gt;&amp;lt;/p&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;p&amp;gt;&amp;lt;span&amp;gt;Server&lt;span class="p">&amp;amp;&lt;/span>nbsp&lt;span class="p">;&lt;/span>address:&amp;lt;/span&amp;gt; &amp;lt;span&amp;gt;10.244.2.3:80&amp;lt;/span&amp;gt;&amp;lt;/p&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;p&amp;gt;&amp;lt;span&amp;gt;Server&lt;span class="p">&amp;amp;&lt;/span>nbsp&lt;span class="p">;&lt;/span>address:&amp;lt;/span&amp;gt; &amp;lt;span&amp;gt;10.244.1.2:80&amp;lt;/span&amp;gt;&amp;lt;/p&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;p&amp;gt;&amp;lt;span&amp;gt;Server&lt;span class="p">&amp;amp;&lt;/span>nbsp&lt;span class="p">;&lt;/span>address:&amp;lt;/span&amp;gt; &amp;lt;span&amp;gt;10.244.2.2:80&amp;lt;/span&amp;gt;&amp;lt;/p&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;p&amp;gt;&amp;lt;span&amp;gt;Server&lt;span class="p">&amp;amp;&lt;/span>nbsp&lt;span class="p">;&lt;/span>address:&amp;lt;/span&amp;gt; &amp;lt;span&amp;gt;10.244.2.2:80&amp;lt;/span&amp;gt;&amp;lt;/p&amp;gt;&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Perfect! It is working &amp;#x1f604;
You can always test it from multiple web browser tabs pointing to &lt;strong>http://&amp;lt;k8s-node&amp;gt;:30721/&lt;/strong> and refreshing several times&lt;/p>
&lt;hr>
&lt;figure>&lt;a class="lightgallery" href="https://net4fungr.github.io/posts/kube-my-router-pt2/nginx.png" title="/posts/kube-my-router-pt2/nginx.png" data-thumbnail="/posts/kube-my-router-pt2/nginx.png" data-sub-html="&lt;h2>LoadBalancer testing of nginxdemos images&lt;/h2>">&lt;img loading="lazy" src='https://net4fungr.github.io/posts/kube-my-router-pt2/nginx.png' alt="/posts/kube-my-router-pt2/nginx.png" height="895" width="400">&lt;/a>&lt;figcaption class="image-caption">LoadBalancer testing of nginxdemos images&lt;/figcaption>
 &lt;/figure>
&lt;hr>
&lt;h3 class="heading-element" id="references-and-influences">&lt;span>References and influences&lt;/span>
 &lt;a href="#references-and-influences" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h3>&lt;ul>
&lt;li>&lt;a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/"target="_blank" rel="external nofollow noopener noreferrer">Bootstrapping clusters with kubeadm&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://computingforgeeks.com/deploy-kubernetes-cluster-on-ubuntu-with-kubeadm/"target="_blank" rel="external nofollow noopener noreferrer">Install Kubernetes Cluster on Ubuntu 20.04 with kubeadm&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://kubesimplify.com/kubernetes-containerd-setup"target="_blank" rel="external nofollow noopener noreferrer">Kubernetes 1.23 + containerd&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://learnk8s.io/kubernetes-network-packets"target="_blank" rel="external nofollow noopener noreferrer">Tracing the path of network traffic in Kubernetes&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://kubernetes.io/docs/tutorials/stateless-application/expose-external-ip-address/"target="_blank" rel="external nofollow noopener noreferrer">Exposing an External IP Address to Access an Application in a Cluster&lt;/a>&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 class="heading-element" id="last-part---installing-and-testing-kne">&lt;span>&lt;a href="https://net4fungr.github.io/posts/kube-my-router-pt3/">Last Part - Installing and testing KNE&lt;/a>&lt;/span>
 &lt;a href="#last-part---installing-and-testing-kne" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h2>&lt;hr>
&lt;h2 class="heading-element" id="outro">&lt;span>&lt;a href="https://net4fungr.github.io/posts/kube-my-router-pt3/#outro">Outro&lt;/a>&lt;/span>
 &lt;a href="#outro" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h2>&lt;hr></description></item><item><title>Kube my router up! - Part One</title><link>https://net4fungr.github.io/posts/kube-my-router-pt1/</link><pubDate>Sat, 28 May 2022 10:36:24 +0300</pubDate><guid>https://net4fungr.github.io/posts/kube-my-router-pt1/</guid><category domain="https://net4fungr.github.io/categories/art-of-labbing/">Art of Labbing</category><description>&lt;img src="https://net4fungr.github.io/posts/kube-my-router-pt1/k8s.jpg" alt="featured image" referrerpolicy="no-referrer">&lt;h2 class="heading-element" id="intro">&lt;span>Intro&lt;/span>
 &lt;a href="#intro" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h2>&lt;hr>
&lt;p>While I was ramping up my skills in k8s, I bumped into google&amp;rsquo;s Kubernetes based Network Emulation (&lt;a href="https://github.com/google/kne"target="_blank" rel="external nofollow noopener noreferrer">KNE&lt;/a>), and since I&amp;rsquo;ve been a fool for network emulation software over the last twenty years, I knew I had to give it a go and see where it can get me. I first heard of KNE during episode #015 of this &lt;a href="https://anchor.fm/netauto-hangout"target="_blank" rel="external nofollow noopener noreferrer">podcast&lt;/a> and it seemed very promising to me since it is a way to spin up network topologies from devices running in containers orchestrated by a kubernetes cluster that, guess what, can span more than one host.&lt;/p>
&lt;p>So, in these series of posts I will try to document my experiences setting it up and having fun with it &amp;#x1f604; since up to now there is too little documentation around it and also I think this &lt;a href="https://blog.itsalwaysthe.network/posts/kubernetes-based-network-emulation/"target="_blank" rel="external nofollow noopener noreferrer">blog post&lt;/a> was the first to cover a basic orientation but still it covers running it inside a kind k8s node, i.e. in a container, where as my intent was to have the k8s spanning more than one machine since network devices are expensive in resources and my home lab is limited to 2x32GB EVE-NG servers.&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://net4fungr.github.io/posts/kube-my-router-pt1/">Part One - Setting up the k8s VMs in EVE-NG&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://net4fungr.github.io/posts/kube-my-router-pt2/">Part Two - Deploying the k8s cluster with kubeadm&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://net4fungr.github.io/posts/kube-my-router-pt3/">Last Part - Installing and testing KNE&lt;/a>&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 class="heading-element" id="part-one---setting-up-the-vms">&lt;span>Part One - Setting up the VMs&lt;/span>
 &lt;a href="#part-one---setting-up-the-vms" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h2>&lt;hr>
&lt;h3 class="heading-element" id="the-intent">&lt;span>The Intent&lt;/span>
 &lt;a href="#the-intent" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h3>&lt;ul>
&lt;li>EVE-NG for hosting linux VMs&lt;/li>
&lt;li>Ubuntu 20.04 cloud image as base&lt;/li>
&lt;li>2xEVE-NG servers, 2.0.3-112 community edition - 3 VMs in total&lt;/li>
&lt;li>Deployment of 3xLinux VMs for our k8s cluster&lt;/li>
&lt;/ul>
&lt;hr>
&lt;p>Well the first step towards testing KNE is to set up a k8s cluster. I have two EVE-NG bare metal servers at home so I could spin up three VMs split in those two servers of 32GM RAM each. I&amp;rsquo;ve chosen Ubuntu 20.04 linux flavor and decided to start by deploying the VMs using the cloud-image files. The approach followed here is to download the cloud image in both EVE-NG servers and create a seed file in order to pass the user password during first boot. This will be used as the base ubuntu image for all VMs. Finally, once the base VM is ready, the topology can be created and all the VMs can be brought up and configured with the appropriate settings.&lt;/p>
&lt;hr>
&lt;h3 class="heading-element" id="prepare-ubuntu-base-image-in-eve-ng">&lt;span>Prepare Ubuntu base image in EVE-NG&lt;/span>
 &lt;a href="#prepare-ubuntu-base-image-in-eve-ng" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h3>&lt;hr>
&lt;p>Download Ubuntu 20.04 cloud image and place it into a temporary directory on the first server, optionally, verifying the md5sum.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">root@eve-01# mkdir -p /opt/cloud &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="nb">cd&lt;/span> !$
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mkdir -p /opt/cloud &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="nb">cd&lt;/span> /opt/cloud/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@eve-01# wget https://cloud-images.ubuntu.com/focal/current/focal-server-cloudimg-amd64.img
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt; ...omitted... &amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@eve-01# ll
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">total &lt;span class="m">581388&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxr-xr-x &lt;span class="m">2&lt;/span> root root &lt;span class="m">4096&lt;/span> May &lt;span class="m">29&lt;/span> 21:19 ./
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxr-xr-x &lt;span class="m">16&lt;/span> root root &lt;span class="m">4096&lt;/span> May &lt;span class="m">29&lt;/span> 21:19 ../
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> root root &lt;span class="m">595329024&lt;/span> May &lt;span class="m">24&lt;/span> 01:51 focal-server-cloudimg-amd64.img
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@eve-01# curl -ks https://cloud-images.ubuntu.com/focal/current/MD5SUMS &lt;span class="p">|&lt;/span> md5sum -c --ignore-missing
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">focal-server-cloudimg-amd64.img: OK&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Copy the image to the appropriate &lt;strong>linux-&lt;/strong> directory of EVE-NG in so that is categorised as a linux image. You can resize the image to your linking as well.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">root@eve-01# mkdir -p /opt/unetlab/addons/qemu/linux-focal-server-cloudimg/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@eve-01# cp focal-server-cloudimg-amd64.img !&lt;span class="nv">$hda&lt;/span>.qcow2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cp focal-server-cloudimg-amd64.img /opt/unetlab/addons/qemu/linux-focal-server-cloudimg/hda.qcow2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@eve-01# &lt;span class="nb">cd&lt;/span> /opt/unetlab/addons/qemu/linux-focal-server-cloudimg/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@eve-01# ll
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">total &lt;span class="m">581384&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxr-xr-x &lt;span class="m">2&lt;/span> root root &lt;span class="m">4096&lt;/span> May &lt;span class="m">29&lt;/span> 21:46 ./
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxr-xr-x &lt;span class="m">12&lt;/span> root root &lt;span class="m">4096&lt;/span> May &lt;span class="m">29&lt;/span> 21:45 ../
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> root root &lt;span class="m">595329024&lt;/span> May &lt;span class="m">29&lt;/span> 21:46 hda.qcow2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@eve-01# qemu-img info hda.qcow2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">image: hda.qcow2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">file format: qcow2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">virtual size: 2.2G &lt;span class="o">(&lt;/span>&lt;span class="m">2361393152&lt;/span> bytes&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">disk size: 568M
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cluster_size: &lt;span class="m">65536&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Format specific information:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> compat: 0.10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> refcount bits: &lt;span class="m">16&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@eve-01# qemu-img resize hda.qcow2 50G
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Image resized.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@eve-01# qemu-img info hda.qcow2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">image: hda.qcow2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">file format: qcow2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">virtual size: 50G &lt;span class="o">(&lt;/span>&lt;span class="m">53687091200&lt;/span> bytes&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">disk size: 568M
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cluster_size: &lt;span class="m">65536&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Format specific information:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> compat: 0.10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> refcount bits: &lt;span class="m">16&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;hr>
&lt;h3 class="heading-element" id="install-cloud-image-utilities-and-prepare-the-seed-file">&lt;span>Install cloud-image utilities and prepare the seed file&lt;/span>
 &lt;a href="#install-cloud-image-utilities-and-prepare-the-seed-file" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h3>&lt;hr>
&lt;p>Install the required package.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">root@eve-01# &lt;span class="nb">cd&lt;/span> /opt/cloud/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@eve-01# apt install cloud-image-utils
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt; ...omitted...&amp;gt;&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Prepare the seed file and copy it to the base image location.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">root@eve-01# cat &lt;span class="s">&amp;lt;&amp;lt;EOF &amp;gt; cloud-config
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">#cloud-config
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">system_info:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> default_user:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> name: &amp;#34;ubuntu&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> home: /home/ubuntu
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">password: &amp;#34;ubuntu123&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">chpasswd: { expire: False }
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">hostname: &amp;#34;ubuntu&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">ssh_pwauth: True
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">EOF&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@eve-01# cloud-localds seed cloud-config
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@eve-01# qemu-img info seed
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">image: seed
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">file format: raw
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">virtual size: 366K &lt;span class="o">(&lt;/span>&lt;span class="m">374784&lt;/span> bytes&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">disk size: 368K
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@eve-01# cp seed /opt/unetlab/addons/qemu/linux-focal-server-cloudimg/cdrom.iso&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="details admonition warning open">
 &lt;div class="details-summary admonition-title">&lt;i class="icon fa-fw fa-solid fa-exclamation-triangle" aria-hidden="true">&lt;/i>Heads Up&lt;i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true">&lt;/i>&lt;/div>
 &lt;div class="details-content">
 &lt;div class="admonition-content">Make sure you include the comment #cloud-config in the seed file&lt;/div>
 &lt;/div>
&lt;/div>
&lt;hr>
&lt;h3 class="heading-element" id="build-the-vm-topology-in-eve-ng">&lt;span>Build the VM topology in EVE-NG&lt;/span>
 &lt;a href="#build-the-vm-topology-in-eve-ng" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h3>&lt;hr>
&lt;p>Once both boot disk and seed cdrom files are in place, copy them onto the other node and run the &lt;strong>fixpermissions&lt;/strong> script.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-Bash" data-lang="Bash">&lt;span class="line">&lt;span class="cl">root@eve-01# &lt;span class="nb">cd&lt;/span> /opt/unetlab/addons/qemu/linux-focal-server-cloudimg/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@eve-01# ll
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">total &lt;span class="m">581760&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxr-xr-x &lt;span class="m">2&lt;/span> root root &lt;span class="m">4096&lt;/span> May &lt;span class="m">29&lt;/span> 22:02 ./
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxr-xr-x &lt;span class="m">12&lt;/span> root root &lt;span class="m">4096&lt;/span> May &lt;span class="m">29&lt;/span> 21:45 ../
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> root root &lt;span class="m">374784&lt;/span> May &lt;span class="m">29&lt;/span> 22:02 cdrom.iso
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> root root &lt;span class="m">595330048&lt;/span> May &lt;span class="m">29&lt;/span> 21:47 hda.qcow2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@eve-01# /opt/unetlab/wrappers/unl_wrapper -a fixpermissions
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@eve-01# ssh eve-02 &lt;span class="s2">&amp;#34;mkdir -p /opt/unetlab/addons/qemu/linux-focal-server-cloudimg&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@eve-01# scp hda.qcow2 eve-02:/opt/unetlab/addons/qemu/linux-focal-server-cloudimg/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@eve-01# scp cdrom.iso 192.168.1.22:/opt/unetlab/addons/qemu/linux-focal-server-cloudimg/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@eve-01# ssh eve-02 &lt;span class="s2">&amp;#34;/opt/unetlab/wrappers/unl_wrapper -a fixpermissions&amp;#34;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Now everything is ready to start creating the topology via the GUI. The following table lists the planning for my deployment:&lt;/p>
&lt;table>
 &lt;thead>
 &lt;tr>
 &lt;th style="text-align: center">EVE-NG node&lt;/th>
 &lt;th style="text-align: center">Role&lt;/th>
 &lt;th style="text-align: center">VM name&lt;/th>
 &lt;th style="text-align: center">IP address&lt;/th>
 &lt;th style="text-align: center">CPU&lt;/th>
 &lt;th style="text-align: center">RAM&lt;/th>
 &lt;/tr>
 &lt;/thead>
 &lt;tbody>
 &lt;tr>
 &lt;td style="text-align: center">eve-01&lt;/td>
 &lt;td style="text-align: center">control-node&lt;/td>
 &lt;td style="text-align: center">kates-control&lt;/td>
 &lt;td style="text-align: center">192.168.1.30&lt;/td>
 &lt;td style="text-align: center">4&lt;/td>
 &lt;td style="text-align: center">4096&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td style="text-align: center">eve-01&lt;/td>
 &lt;td style="text-align: center">worker&lt;/td>
 &lt;td style="text-align: center">kates-node-01&lt;/td>
 &lt;td style="text-align: center">192.168.1.31&lt;/td>
 &lt;td style="text-align: center">8&lt;/td>
 &lt;td style="text-align: center">28672&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td style="text-align: center">eve-02&lt;/td>
 &lt;td style="text-align: center">worker&lt;/td>
 &lt;td style="text-align: center">kates-node-02&lt;/td>
 &lt;td style="text-align: center">192.168.1.32&lt;/td>
 &lt;td style="text-align: center">8&lt;/td>
 &lt;td style="text-align: center">28672&lt;/td>
 &lt;/tr>
 &lt;/tbody>
&lt;/table>
&lt;p>Here is how it looks like from GUI perspective:&lt;/p>
&lt;p>
&lt;figure>&lt;a class="lightgallery" href="https://net4fungr.github.io/posts/kube-my-router-pt1/eve-01.png" title="/posts/kube-my-router-pt1/eve-01.png" data-thumbnail="/posts/kube-my-router-pt1/eve-01.png" data-sub-html="&lt;h2>EVE-01 Topology&lt;/h2>">&lt;img loading="lazy" src='https://net4fungr.github.io/posts/kube-my-router-pt1/eve-01.png' alt="/posts/kube-my-router-pt1/eve-01.png" height="507" width="500">&lt;/a>&lt;figcaption class="image-caption">EVE-01 Topology&lt;/figcaption>
 &lt;/figure>
&lt;figure>&lt;a class="lightgallery" href="https://net4fungr.github.io/posts/kube-my-router-pt1/eve-02.png" title="/posts/kube-my-router-pt1/eve-02.png" data-thumbnail="/posts/kube-my-router-pt1/eve-02.png" data-sub-html="&lt;h2>EVE-02 Topology&lt;/h2>">&lt;img loading="lazy" src='https://net4fungr.github.io/posts/kube-my-router-pt1/eve-02.png' alt="/posts/kube-my-router-pt1/eve-02.png" height="406" width="500">&lt;/a>&lt;figcaption class="image-caption">EVE-02 Topology&lt;/figcaption>
 &lt;/figure>
&lt;/p>
&lt;p>You can also download the lab exports for &lt;a href="https://net4fungr.github.io/posts/kube-my-router-pt1/eve-01.zip">eve-01&lt;/a> and &lt;a href="https://net4fungr.github.io/posts/kube-my-router-pt1/eve-02.zip">eve-02&lt;/a>&lt;/p>
&lt;div class="details admonition danger open">
 &lt;div class="details-summary admonition-title">&lt;i class="icon fa-fw fa-solid fa-bolt" aria-hidden="true">&lt;/i>Heads Up&lt;i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true">&lt;/i>&lt;/div>
 &lt;div class="details-content">
 &lt;div class="admonition-content">&lt;p>Due to the fact that EVE-NG allocates MAC addresses sequentially from a pool which is allocated per-POD and if you are using the same LAB POD on both servers, &lt;strong>kates-control&lt;/strong> and &lt;strong>kates-node-02&lt;/strong> (i.e. the first VMs on each node, since only EVE-01 has two nodes) will end up having the same MAC address. In order to avoid this, we can either use &lt;em>dummy&lt;/em> VMs, i.e. powered off VMs or we can specify the value for the first MAC address on the &lt;strong>kates-node-02&lt;/strong> VM to cause EVE-NG to allocate a different MAC to the NIC, or simply we can use different EVE-NG PODs across the two servers to create the lab &amp;#x1f604;. I went for the latter and simpler method.&lt;/p>
&lt;figure>&lt;a class="lightgallery" href="https://net4fungr.github.io/posts/kube-my-router-pt1/kates2.png" title="/posts/kube-my-router-pt1/kates2.png" data-thumbnail="/posts/kube-my-router-pt1/kates2.png" data-sub-html="&lt;h2>Change MAC address of VM on second EVE server&lt;/h2>">&lt;img loading="lazy" src='https://net4fungr.github.io/posts/kube-my-router-pt1/kates2.png' alt="/posts/kube-my-router-pt1/kates2.png" height="950" width="400">&lt;/a>&lt;figcaption class="image-caption">Change MAC address of VM on second EVE server&lt;/figcaption>
 &lt;/figure>
Have this also in mind for all your other labs and topologies. The MAC allocation is per lab POD.&lt;/div>
 &lt;/div>
&lt;/div>
&lt;hr>
&lt;h3 class="heading-element" id="start-the-labs-and-perform-initial-configuration">&lt;span>Start the labs and perform initial configuration&lt;/span>
 &lt;a href="#start-the-labs-and-perform-initial-configuration" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h3>&lt;hr>
&lt;p>All VMs are ready to start. Once all nodes are booted you can access them from the VNC or HTML5 console and perform the initial configuration, which includes:&lt;/p>
&lt;ul>
&lt;li>Disabling cloud-init&lt;/li>
&lt;li>Setting the hostname&lt;/li>
&lt;li>Configuring network addresses&lt;/li>
&lt;li>Updating and Upgrading&lt;/li>
&lt;/ul>
&lt;p>But, let&amp;rsquo;s first check that all VMs are different and also the MAC addresses are not the same. The outputs shown are when using the same LAB POD in EVE-NG.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># On kates-control&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@ubuntu:~$ sudo dmidecode -s system-uuid &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> cat /etc/machine-id &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> ip link
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">df8f1876-080b-4bb0-b000-f63819c781f3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">df8f1876080b4bb0b000f63819c781f3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">1: lo: &amp;lt;LOOPBACK,UP,LOWER_UP&amp;gt; mtu &lt;span class="m">65536&lt;/span> qdisc noqueue state UNKNOWN mode DEFAULT group default qlen &lt;span class="m">1000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2: ens3: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu &lt;span class="m">1500&lt;/span> qdisc fq_codel state UP mode DEFAULT group default qlen &lt;span class="m">1000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line hl">&lt;span class="cl"> link/ether 00:50:00:00:01:00 brd ff:ff:ff:ff:ff:ff&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># On kates-node-01&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@ubuntu:~$ sudo dmidecode -s system-uuid &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> cat /etc/machine-id &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> ip link
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2b748bae-16c2-4abe-b65e-21a359658480
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2b748bae16c24abeb65e21a359658480
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">1: lo: &amp;lt;LOOPBACK,UP,LOWER_UP&amp;gt; mtu &lt;span class="m">65536&lt;/span> qdisc noqueue state UNKNOWN mode DEFAULT group default qlen &lt;span class="m">1000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2: ens3: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu &lt;span class="m">1500&lt;/span> qdisc fq_codel state UP mode DEFAULT group default qlen &lt;span class="m">1000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line hl">&lt;span class="cl"> link/ether 00:50:00:00:02:00 brd ff:ff:ff:ff:ff:ff&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># On kates-node-02&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@ubuntu:~$ sudo dmidecode -s system-uuid &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> cat /etc/machine-id &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> ip link
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">9ba9c500-5d18-40e8-98e4-3e027f84e971
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">9ba9c5005d1840e898e43e027f84e971
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">1: lo: &amp;lt;LOOPBACK,UP,LOWER_UP&amp;gt; mtu &lt;span class="m">65536&lt;/span> qdisc noqueue state UNKNOWN mode DEFAULT group default qlen &lt;span class="m">1000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2: ens3: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu &lt;span class="m">1500&lt;/span> qdisc fq_codel state UP mode DEFAULT group default qlen &lt;span class="m">1000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line hl">&lt;span class="cl"> link/ether 00:60:00:00:01:00 brd ff:ff:ff:ff:ff:ff&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Okay, now it is time to perform the initial configuration by disabling first the cloud-init service and then moving on.&lt;/p>
&lt;div class="details admonition note open">
 &lt;div class="details-summary admonition-title">&lt;i class="icon fa-fw fa-solid fa-pencil-alt" aria-hidden="true">&lt;/i>Note that&lt;i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true">&lt;/i>&lt;/div>
 &lt;div class="details-content">
 &lt;div class="admonition-content">If the cloud-init service is not disabled, then we will not be able to change the hostname, so either we disable cloud init or modify the appropriate config file in order not to reset the hostname according to the seed file&lt;/div>
 &lt;/div>
&lt;/div>
&lt;p>So from the VM console:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">ubuntu@ubuntu:~$ sudo touch /etc/cloud/cloud-init.disabled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@ubuntu:~$ sudo hostnamectl set-hostname kates-control&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Adjust the netplan file according to your environment and apply the configuration. I prefer to remove the static MAC assignment to the NIC&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">ubuntu@ubuntu:~$ sudo vi /etc/netplan/50-cloud-init.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@ubuntu:~$ cat /etc/netplan/50-cloud-init.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">network:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ethernets:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ens3:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dhcp4: &lt;span class="nb">false&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dhcp6: &lt;span class="nb">false&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> addresses: &lt;span class="o">[&lt;/span>192.168.1.30/24&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> gateway4: 192.168.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> nameservers:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> addresses: &lt;span class="o">[&lt;/span>192.168.1.1, 8.8.8.8&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> version: &lt;span class="m">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu@ubuntu:~$ sudo netplan apply&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;p>Now that the basic config has been done for all 3 nodes, we can reboot and login from a proper SSH terminal &amp;#x1f604; to verify network connectivity and by the next single command we perform any upgrade available and reboot the nodes if needed.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">ubuntu@kates-*:~$ sudo apt update &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> sudo apt -y full-upgrade &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="o">[&lt;/span> -f /var/run/reboot-required &lt;span class="o">]&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> sudo reboot -f&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;hr>
&lt;h3 class="heading-element" id="references-and-influences">&lt;span>References and influences&lt;/span>
 &lt;a href="#references-and-influences" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h3>&lt;hr>
&lt;ul>
&lt;li>&lt;a href="https://www.eve-ng.net/"target="_blank" rel="external nofollow noopener noreferrer">EVE-NG official site&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://cloudinit.readthedocs.io/en/latest/topics/examples.html"target="_blank" rel="external nofollow noopener noreferrer">Cloud config examples&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://www.theurbanpenguin.com/using-cloud-images-in-kvm/"target="_blank" rel="external nofollow noopener noreferrer">Using Cloud Images in KVM&lt;/a>&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 class="heading-element" id="part-two---deploying-the-k8s-cluster-with-kubeadm">&lt;span>&lt;a href="https://net4fungr.github.io/posts/kube-my-router-pt2/">Part Two - Deploying the k8s cluster with kubeadm&lt;/a>&lt;/span>
 &lt;a href="#part-two---deploying-the-k8s-cluster-with-kubeadm" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h2>&lt;hr>
&lt;h2 class="heading-element" id="last-part---installing-and-testing-kne">&lt;span>&lt;a href="https://net4fungr.github.io/posts/kube-my-router-pt3/">Last Part - Installing and testing KNE&lt;/a>&lt;/span>
 &lt;a href="#last-part---installing-and-testing-kne" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h2>&lt;hr>
&lt;h2 class="heading-element" id="outro">&lt;span>&lt;a href="https://net4fungr.github.io/posts/kube-my-router-pt3/#outro">Outro&lt;/a>&lt;/span>
 &lt;a href="#outro" class="heading-mark">
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z">&lt;/path>&lt;/svg>
 &lt;/a>
&lt;/h2>&lt;hr></description></item><item><title>Mutable vs. Immutable</title><link>https://net4fungr.github.io/posts/mutable-immutable/</link><pubDate>Sat, 30 Apr 2022 15:36:24 +0300</pubDate><guid>https://net4fungr.github.io/posts/mutable-immutable/</guid><category domain="https://net4fungr.github.io/categories/humour/">Humour</category><description>&lt;img src="https://net4fungr.github.io/posts/mutable-immutable/featured-image-preview.png" alt="featured image" referrerpolicy="no-referrer">&lt;p>Have you noticed that in some parts of the world, in some cafeterias, especially when the weather is hot, after you take your seat, a waiter comes and serves you a glass of water? Furthermore, in these places, the waiter has a frequent task to have this glass filled several times during your stay. Hence, we could say that the waiter has a task every once in a while to take a jug of water and re-fill the glasses of those customers that are not full, even if they are half-empty or half-full.&lt;/p>
&lt;p>We can say that the glass of water, in that case, is a &lt;strong>mutable&lt;/strong> object, i.e. the glass is brought full at first and then its status can be changed by refilling it again. In addition, the task is &lt;strong>idempotent&lt;/strong> because every time it is executed, the result would be the same, i.e. all glasses are full - unless someone asks no to have it filled &amp;#x1f604;.&lt;/p>
&lt;p>This drinking water idempotency task can also be seen in expensive restaurants, where again there is a waiter (maybe call him idempotent) that takes care of re-filling your glass and in such places it happens much more often and usually it happens per-table rather than for all customers at the same time &amp;#x1f604;. Now, this glass idempotency thing does not only apply to drinking water, but also to the wine glasses if you have ordered a bottle of wine, that is.&lt;/p>
&lt;p>But, what happens if you have only ordered and consumed a single glass of wine? Your glass is empty and the waiter will come and ask you if you&amp;rsquo;d like another one. You say yes, and then it happens. The waiter will take the empty glass and will go and fetch a new glass of wine for you, i.e. replacing the previous one. At this moment, you realize that the wine glass is not a mutable object, but it is &lt;strong>immutable&lt;/strong> &amp;#x1f604;. It cannot be re-filled, it cannot be changed and it has to be replaced by another glass of wine that could be the same or some other type, or something completely different, but they all will refer to the &lt;em>object&lt;/em> you drink.&lt;/p>
&lt;p>You enjoyed your wine, it fulfilled its purpose, but if you want it to serve it&amp;rsquo;s purpose again, it has to be replaced with a new one or a new drink &amp;#x1f604;&lt;/p></description></item></channel></rss>